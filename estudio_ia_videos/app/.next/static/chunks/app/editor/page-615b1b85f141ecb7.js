(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[219],{3955:function(e,t,s){Promise.resolve().then(s.bind(s,7393))},7393:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return eo}});var i=s(7437),r=s(2265),a=s(7695),l=s(6885),n=s(4391);let d={project:null,elements:[],selectedElementIds:[],tracks:[{id:"video-1",type:"video",name:"Video",locked:!1,muted:!1,visible:!0,clips:[]},{id:"audio-1",type:"audio",name:"Audio",locked:!1,muted:!1,visible:!0,clips:[]}],currentTime:0,isPlaying:!1,zoom:1,snapEnabled:!0,history:[],historyIndex:-1,clipboard:[],activePanel:"canvas",canvasZoom:1,showGrid:!0,showGuides:!0,isDirty:!1,lastSaved:null},o=(0,a.U)()((0,l.mW)((0,l.tJ)((0,n.n)((e,t)=>({...d,setProject:t=>e({project:t,isDirty:!1}),updateProject:t=>e(e=>{e.project&&(e.project={...e.project,...t},e.isDirty=!0)}),addElement:s=>{let i={type:"add-element",description:"Add ".concat(s.type),redo:()=>e(e=>{e.elements.push(s),e.selectedElementIds=[s.id],e.isDirty=!0}),undo:()=>e(e=>{e.elements=e.elements.filter(e=>e.id!==s.id),e.selectedElementIds=e.selectedElementIds.filter(e=>e!==s.id),e.isDirty=!0})};t().executeCommand(i)},updateElement:(s,i)=>{let r=t().elements.find(e=>e.id===s);if(!r)return;let a={...r},l={type:"update-element",description:"Update ".concat(r.type),redo:()=>e(e=>{let t=e.elements.find(e=>e.id===s);t&&Object.assign(t,i),e.isDirty=!0}),undo:()=>e(e=>{let t=e.elements.find(e=>e.id===s);t&&Object.assign(t,a),e.isDirty=!0})};t().executeCommand(l)},deleteElement:s=>{let i=t().elements.find(e=>e.id===s);if(!i)return;let r={type:"delete-element",description:"Delete ".concat(i.type),redo:()=>e(e=>{e.elements=e.elements.filter(e=>e.id!==s),e.selectedElementIds=e.selectedElementIds.filter(e=>e!==s),e.isDirty=!0}),undo:()=>e(e=>{e.elements.push(i),e.isDirty=!0})};t().executeCommand(r)},duplicateElement:e=>{let s=t().elements.find(t=>t.id===e);if(!s)return;let i={...s,id:"element-".concat(Date.now()),x:s.x+20,y:s.y+20};t().addElement(i)},selectElement:function(t){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e(e=>{s?e.selectedElementIds.includes(t)?e.selectedElementIds=e.selectedElementIds.filter(e=>e!==t):e.selectedElementIds.push(t):e.selectedElementIds=[t]})},selectAll:()=>e(e=>{e.selectedElementIds=e.elements.map(e=>e.id)}),deselectAll:()=>e({selectedElementIds:[]}),copy:()=>e(e=>{e.clipboard=e.elements.filter(t=>e.selectedElementIds.includes(t.id))}),cut:()=>{t().copy(),t().selectedElementIds.forEach(e=>t().deleteElement(e))},paste:()=>{let e=t().clipboard;0!==e.length&&e.map(e=>({...e,id:"element-".concat(Date.now(),"-").concat(Math.random()),x:e.x+20,y:e.y+20})).forEach(e=>t().addElement(e))},addTrack:t=>e(e=>{e.tracks.push(t),e.isDirty=!0}),removeTrack:t=>e(e=>{e.tracks=e.tracks.filter(e=>e.id!==t),e.isDirty=!0}),addClip:(s,i)=>{t().executeCommand({type:"add-clip",description:"Add clip",redo:()=>e(e=>{let t=e.tracks.find(e=>e.id===s);t&&(t.clips.push(i),e.isDirty=!0)}),undo:()=>e(e=>{let t=e.tracks.find(e=>e.id===s);t&&(t.clips=t.clips.filter(e=>e.id!==i.id),e.isDirty=!0)})})},updateClip:(s,i,r)=>{let a=t().tracks.find(e=>e.id===s),l=null==a?void 0:a.clips.find(e=>e.id===i);if(!l)return;let n={...l};t().executeCommand({type:"update-clip",description:"Update clip",redo:()=>e(e=>{let t=e.tracks.find(e=>e.id===s),a=null==t?void 0:t.clips.find(e=>e.id===i);a&&Object.assign(a,r),e.isDirty=!0}),undo:()=>e(e=>{let t=e.tracks.find(e=>e.id===s),r=null==t?void 0:t.clips.find(e=>e.id===i);r&&Object.assign(r,n),e.isDirty=!0})})},deleteClip:(s,i)=>{let r=t().tracks.find(e=>e.id===s),a=null==r?void 0:r.clips.find(e=>e.id===i);a&&t().executeCommand({type:"delete-clip",description:"Delete clip",redo:()=>e(e=>{let t=e.tracks.find(e=>e.id===s);t&&(t.clips=t.clips.filter(e=>e.id!==i),e.isDirty=!0)}),undo:()=>e(e=>{let t=e.tracks.find(e=>e.id===s);t&&(t.clips.push(a),e.isDirty=!0)})})},splitClip:(s,i,r)=>{let a=t().tracks.find(e=>e.id===s),l=null==a?void 0:a.clips.find(e=>e.id===i);if(!l||r<=l.startTime||r>=l.startTime+l.duration)return;let n=r-l.startTime,d={...l,duration:n},o={...l,id:"clip-".concat(Date.now()),startTime:r,duration:l.duration-n,trimStart:l.trimStart+n};t().executeCommand({type:"split-clip",description:"Split clip",redo:()=>e(e=>{let t=e.tracks.find(e=>e.id===s);t&&(t.clips=t.clips.filter(e=>e.id!==i),t.clips.push(d,o),e.isDirty=!0)}),undo:()=>e(e=>{let t=e.tracks.find(e=>e.id===s);t&&(t.clips=t.clips.filter(e=>e.id!==d.id&&e.id!==o.id),t.clips.push(l),e.isDirty=!0)})})},play:()=>e({isPlaying:!0}),pause:()=>e({isPlaying:!1}),stop:()=>e({isPlaying:!1,currentTime:0}),seekTo:t=>e({currentTime:t}),undo:()=>{let{history:s,historyIndex:i}=t();i<0||(s[i].undo(),e({historyIndex:i-1}))},redo:()=>{let{history:s,historyIndex:i}=t();i>=s.length-1||(s[i+1].redo(),e({historyIndex:i+1}))},canUndo:()=>t().historyIndex>=0,canRedo:()=>{let{history:e,historyIndex:s}=t();return s<e.length-1},executeCommand:t=>e(e=>{let s={...t,id:"cmd-".concat(Date.now()),timestamp:Date.now()};s.redo(),e.history=e.history.slice(0,e.historyIndex+1),e.history.push(s),e.historyIndex=e.history.length-1,e.history.length>100&&(e.history=e.history.slice(-100),e.historyIndex=e.history.length-1)}),setActivePanel:t=>e({activePanel:t}),setCanvasZoom:t=>e({canvasZoom:t}),toggleGrid:()=>e(e=>{e.showGrid=!e.showGrid}),toggleGuides:()=>e(e=>{e.showGuides=!e.showGuides}),setSnapEnabled:t=>e({snapEnabled:t}),markClean:()=>e({isDirty:!1,lastSaved:Date.now()}),reset:()=>e(d)})),{name:"editor-storage",partialize:e=>({project:e.project,elements:e.elements,tracks:e.tracks})}),{name:"EditorStore"})),c=()=>o(e=>e.elements.filter(t=>e.selectedElementIds.includes(t.id)));var u=s(4508);function m(e){let{className:t}=e,s=(0,r.useRef)(null),[a,l]=(0,r.useState)(null),[n,d]=(0,r.useState)(null),{project:c,elements:m,selectedElementIds:x,canvasZoom:h,showGrid:p,showGuides:f,selectElement:v,updateElement:g}=o(),y=e=>20*Math.round(e/20),b=(0,r.useCallback)((e,t,s,i,r)=>{if(!f)return{x:t,y:s,width:i,height:r};let a=t,l=s;for(let n of m.filter(t=>t.id!==e.id))5>Math.abs(t-n.x)&&(a=n.x),5>Math.abs(t+i-(n.x+n.width))&&(a=n.x+n.width-i),5>Math.abs(t+i/2-(n.x+n.width/2))&&(a=n.x+n.width/2-i/2),5>Math.abs(s-n.y)&&(l=n.y),5>Math.abs(s+r-(n.y+n.height))&&(l=n.y+n.height-r),5>Math.abs(s+r/2-(n.y+n.height/2))&&(l=n.y+n.height/2-r/2);return{x:a,y:l,width:i,height:r}},[f,m]),j=(e,t)=>{e.stopPropagation(),e.shiftKey||x.includes(t.id)?e.shiftKey&&v(t.id,!0):v(t.id),l({elementId:t.id,startX:e.clientX,startY:e.clientY,initialX:t.x,initialY:t.y})},N=(e,t,s)=>{e.stopPropagation(),d({elementId:t.id,handle:s,startX:e.clientX,startY:e.clientY,initialWidth:t.width,initialHeight:t.height,initialX:t.x,initialY:t.y})};return((0,r.useEffect)(()=>{if(!a&&!n)return;let e=e=>{if(a){let t=(e.clientX-a.startX)/h,s=(e.clientY-a.startY)/h,i=a.initialX+t,r=a.initialY+s;p&&(i=y(i),r=y(r));let l=m.find(e=>e.id===a.elementId);if(l){let e=b(l,i,r,l.width,l.height);g(a.elementId,{x:e.x,y:e.y})}}if(n){let t=(e.clientX-n.startX)/h,s=(e.clientY-n.startY)/h,i=n.initialWidth,r=n.initialHeight,a=n.initialX,l=n.initialY,{handle:d}=n;d.includes("e")&&(i=n.initialWidth+t),d.includes("w")&&(i=n.initialWidth-t,a=n.initialX+t),d.includes("s")&&(r=n.initialHeight+s),d.includes("n")&&(r=n.initialHeight-s,l=n.initialY+s),i=Math.max(20,i),r=Math.max(20,r),p&&(a=y(a),l=y(l),i=y(i),r=y(r)),g(n.elementId,{x:a,y:l,width:i,height:r})}},t=()=>{l(null),d(null)};return document.addEventListener("mousemove",e),document.addEventListener("mouseup",t),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t)}},[a,n,h,p,f,b,m,g]),c)?(0,i.jsx)("div",{className:(0,u.cn)("relative overflow-auto bg-gray-900",t),children:(0,i.jsxs)("div",{ref:s,className:"relative bg-white",style:{width:c.width*h,height:c.height*h,transform:"scale(".concat(h,")"),transformOrigin:"top left",backgroundColor:c.backgroundColor},children:[p&&(0,i.jsx)("div",{className:"absolute inset-0 pointer-events-none",style:{backgroundSize:"".concat(20,"px ").concat(20,"px"),backgroundImage:"\n                linear-gradient(to right, rgba(0,0,0,0.05) 1px, transparent 1px),\n                linear-gradient(to bottom, rgba(0,0,0,0.05) 1px, transparent 1px)\n              "}}),m.sort((e,t)=>{var s,i;return(null!==(s=e.layerIndex)&&void 0!==s?s:0)-(null!==(i=t.layerIndex)&&void 0!==i?i:0)}).map(e=>{let t=x.includes(e.id);return(0,i.jsxs)("div",{className:(0,u.cn)("absolute cursor-move",e.locked&&"cursor-not-allowed",!e.visible&&"opacity-0"),style:{left:e.x,top:e.y,width:e.width,height:e.height,transform:"rotate(".concat(e.rotation,"deg)"),opacity:e.opacity,zIndex:e.layerIndex},onMouseDown:t=>!e.locked&&j(t,e),children:[(0,i.jsx)("div",{className:"w-full h-full bg-blue-500/20 border-2 border-blue-500 rounded flex items-center justify-center",children:(0,i.jsx)("span",{className:"text-xs text-blue-600 font-medium",children:e.type})}),t&&!e.locked&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"absolute inset-0 border-2 border-blue-500 pointer-events-none"}),["nw","ne","sw","se","n","s","e","w"].map(t=>(0,i.jsx)("div",{className:(0,u.cn)("absolute w-2 h-2 bg-white border border-blue-500",t.includes("n")&&"top-0 -translate-y-1/2",t.includes("s")&&"bottom-0 translate-y-1/2",t.includes("e")&&"right-0 translate-x-1/2",t.includes("w")&&"left-0 -translate-x-1/2",!t.includes("n")&&!t.includes("s")&&"top-1/2 -translate-y-1/2",!t.includes("e")&&!t.includes("w")&&"left-1/2 -translate-x-1/2",("nw"===t||"se"===t)&&"cursor-nwse-resize",("ne"===t||"sw"===t)&&"cursor-nesw-resize",("n"===t||"s"===t)&&"cursor-ns-resize",("e"===t||"w"===t)&&"cursor-ew-resize"),onMouseDown:s=>N(s,e,t)},t))]})]},e.id)})]})}):(0,i.jsx)("div",{className:(0,u.cn)("flex items-center justify-center bg-gray-900",t),children:(0,i.jsx)("p",{className:"text-gray-500",children:"No project loaded"})})}var x=s(292),h=s(5274),p=s(9227),f=s(3276),v=s(1548),g=s(1473);function y(e){let{className:t}=e,s=(0,r.useRef)(null),[a,l]=(0,r.useState)(!1),[n,d]=(0,r.useState)(null),{tracks:c,currentTime:m,isPlaying:y,zoom:b,snapEnabled:j,play:N,pause:w,seekTo:k,updateClip:C,splitClip:E,setSnapEnabled:I}=o(),D=50*b,S=Math.max(...c.flatMap(e=>e.clips.map(e=>e.startTime+e.duration)),60),A=m*D,z=e=>"".concat(Math.floor(e/60).toString().padStart(2,"0"),":").concat(Math.floor(e%60).toString().padStart(2,"0"),":").concat(Math.floor(e%1*30).toString().padStart(2,"0")),T=(0,r.useCallback)(e=>j?.5*Math.round(e/.5):e,[j]),P=(e,t)=>{let s=t.startTime*D,r=Math.max(t.duration*D,20);return(0,i.jsxs)("div",{className:(0,u.cn)("absolute top-1 h-[52px] rounded bg-blue-500 border-2 border-blue-600","cursor-move hover:bg-blue-400 transition-colors","flex items-center justify-between px-2"),style:{left:s,width:r},onMouseDown:s=>{s.stopPropagation(),l(!0),d({trackId:e,clipId:t.id,startX:s.clientX,initialTime:t.startTime})},children:[(0,i.jsxs)("div",{className:"flex-1 overflow-hidden",children:[(0,i.jsxs)("div",{className:"text-xs text-white font-medium truncate",children:["Clip ",t.id.slice(-4)]}),(0,i.jsx)("div",{className:"text-xs text-blue-100",children:z(t.duration)})]}),(0,i.jsx)("button",{onClick:s=>{s.stopPropagation();let i=s.currentTarget.getBoundingClientRect(),r=s.clientX-i.left,a=t.startTime+r/D;E(e,t.id,a)},className:"ml-2 p-1 hover:bg-blue-600 rounded",title:"Split clip",children:(0,i.jsx)(x.Z,{className:"w-3 h-3 text-white"})}),t.transition&&(0,i.jsx)("div",{className:"absolute -right-4 top-0 bottom-0 w-8 bg-gradient-to-r from-blue-500/0 to-purple-500/50"})]},t.id)},M=(e,t)=>(0,i.jsxs)("div",{className:"relative border-b border-gray-700",style:{height:60},children:[(0,i.jsx)("div",{className:"absolute left-0 w-40 h-full bg-gray-800 border-r border-gray-700 flex items-center px-3",children:(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)("div",{className:"text-sm font-medium text-white",children:e.name}),(0,i.jsx)("div",{className:"text-xs text-gray-400",children:e.type})]})}),(0,i.jsx)("div",{className:"absolute left-40 right-0 h-full bg-gray-900",children:e.clips.map(t=>P(e.id,t))})]},e.id);return(0,r.useEffect)(()=>{if(!a||!n)return;let e=e=>{let t=(e.clientX-n.startX)/D,s=n.initialTime+t;s=Math.max(0,T(s)),C(n.trackId,n.clipId,{startTime:s})},t=()=>{l(!1),d(null)};return document.addEventListener("mousemove",e),document.addEventListener("mouseup",t),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t)}},[a,n,D,T,C]),(0,i.jsxs)("div",{className:(0,u.cn)("flex flex-col bg-gray-900 border-t border-gray-700",t),children:[(0,i.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-gray-800 border-b border-gray-700",children:[(0,i.jsx)("button",{onClick:()=>k(0),className:"p-2 hover:bg-gray-700 rounded transition-colors",title:"Go to start",children:(0,i.jsx)(h.Z,{className:"w-4 h-4 text-white"})}),(0,i.jsx)("button",{onClick:y?w:N,className:"p-2 hover:bg-gray-700 rounded transition-colors",title:y?"Pause":"Play",children:y?(0,i.jsx)(p.Z,{className:"w-4 h-4 text-white"}):(0,i.jsx)(f.Z,{className:"w-4 h-4 text-white"})}),(0,i.jsx)("button",{onClick:()=>k(Math.min(m+5,S)),className:"p-2 hover:bg-gray-700 rounded transition-colors",title:"Skip forward",children:(0,i.jsx)(v.Z,{className:"w-4 h-4 text-white"})}),(0,i.jsx)("div",{className:"ml-4 text-sm font-mono text-white",children:z(m)}),(0,i.jsxs)("div",{className:"ml-auto flex items-center gap-2",children:[(0,i.jsx)("button",{onClick:()=>I(!j),className:(0,u.cn)("p-2 rounded transition-colors",j?"bg-blue-600 text-white":"bg-gray-700 text-gray-400"),title:"Toggle snapping",children:(0,i.jsx)(g.Z,{className:"w-4 h-4"})}),(0,i.jsxs)("select",{value:b,onChange:e=>o.getState().zoom=Number(e.target.value),className:"px-2 py-1 bg-gray-700 text-white text-sm rounded",children:[(0,i.jsx)("option",{value:.5,children:"50%"}),(0,i.jsx)("option",{value:1,children:"100%"}),(0,i.jsx)("option",{value:2,children:"200%"}),(0,i.jsx)("option",{value:4,children:"400%"})]})]})]}),(0,i.jsxs)("div",{ref:s,className:"flex-1 overflow-auto relative",onClick:e=>{var t;if(a)return;let i=null===(t=s.current)||void 0===t?void 0:t.getBoundingClientRect();i&&k(T(Math.max(0,(e.clientX-i.left-160)/D)))},children:[(0,i.jsx)("div",{className:"relative bg-gray-800 border-b border-gray-700",style:{height:30,marginLeft:160,width:S*D},children:(()=>{let e=[];for(let t=0;t<=S;t+=5){let s=t*D;e.push((0,i.jsxs)("div",{className:"absolute flex flex-col items-center",style:{left:s},children:[(0,i.jsx)("div",{className:"w-px h-4 bg-gray-400"}),(0,i.jsx)("span",{className:"text-xs text-gray-600 mt-1",children:z(t)})]},t))}return e})()}),(0,i.jsx)("div",{className:"relative",children:c.map((e,t)=>M(e,t))}),(0,i.jsx)("div",{className:"absolute top-0 bottom-0 w-0.5 bg-red-500 pointer-events-none z-50",style:{left:160+A},children:(0,i.jsx)("div",{className:"absolute -top-2 -left-2 w-4 h-4 bg-red-500 rounded-full"})})]})]})}var b=s(5897),j=s(8223),N=s(6815),w=s(3647);function k(){let e=c(),{updateElement:t}=o();if(0===e.length)return(0,i.jsxs)("div",{className:"flex flex-col h-full bg-gray-800 border-l border-gray-700",children:[(0,i.jsx)("div",{className:"p-3 border-b border-gray-700",children:(0,i.jsx)("h3",{className:"text-sm font-semibold text-white",children:"Properties"})}),(0,i.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,i.jsx)("p",{className:"text-sm text-gray-500",children:"No element selected"})})]});if(e.length>1)return(0,i.jsxs)("div",{className:"flex flex-col h-full bg-gray-800 border-l border-gray-700",children:[(0,i.jsx)("div",{className:"p-3 border-b border-gray-700",children:(0,i.jsx)("h3",{className:"text-sm font-semibold text-white",children:"Properties"})}),(0,i.jsxs)("div",{className:"flex-1 p-4",children:[(0,i.jsxs)("p",{className:"text-sm text-gray-400 mb-4",children:[e.length," elements selected"]}),(0,i.jsx)("div",{className:"space-y-4",children:(0,i.jsx)(C,{label:"Opacity",children:(0,i.jsx)(b.i,{defaultValue:[100],max:100,step:1,onValueChange:s=>{let[i]=s;e.forEach(e=>{t(e.id,{opacity:i/100})})}})})})]})]});let s=e[0];return(0,i.jsxs)("div",{className:"flex flex-col h-full bg-gray-800 border-l border-gray-700",children:[(0,i.jsxs)("div",{className:"p-3 border-b border-gray-700",children:[(0,i.jsx)("h3",{className:"text-sm font-semibold text-white",children:"Properties"}),(0,i.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:s.type})]}),(0,i.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:[(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsx)("h4",{className:"text-xs font-semibold text-gray-400 uppercase",children:"Transform"}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,i.jsx)(C,{label:"X",children:(0,i.jsx)(j.I,{type:"number",value:Math.round(s.x),onChange:e=>t(s.id,{x:Number(e.target.value)}),className:"h-8"})}),(0,i.jsx)(C,{label:"Y",children:(0,i.jsx)(j.I,{type:"number",value:Math.round(s.y),onChange:e=>t(s.id,{y:Number(e.target.value)}),className:"h-8"})}),(0,i.jsx)(C,{label:"Width",children:(0,i.jsx)(j.I,{type:"number",value:Math.round(s.width),onChange:e=>t(s.id,{width:Number(e.target.value)}),className:"h-8"})}),(0,i.jsx)(C,{label:"Height",children:(0,i.jsx)(j.I,{type:"number",value:Math.round(s.height),onChange:e=>t(s.id,{height:Number(e.target.value)}),className:"h-8"})})]}),(0,i.jsx)(C,{label:"Rotation",children:(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(b.i,{value:[s.rotation],min:0,max:360,step:1,onValueChange:e=>{let[i]=e;return t(s.id,{rotation:i})},className:"flex-1"}),(0,i.jsxs)("span",{className:"text-sm text-white w-12 text-right",children:[s.rotation,"\xb0"]})]})}),(0,i.jsx)(C,{label:"Opacity",children:(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(b.i,{value:[100*s.opacity],max:100,step:1,onValueChange:e=>{let[i]=e;return t(s.id,{opacity:i/100})},className:"flex-1"}),(0,i.jsxs)("span",{className:"text-sm text-white w-12 text-right",children:[Math.round(100*s.opacity),"%"]})]})})]}),(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsx)("h4",{className:"text-xs font-semibold text-gray-400 uppercase",children:"Layer"}),(0,i.jsx)(C,{label:"Z-Index",children:(0,i.jsx)(j.I,{type:"number",value:s.layerIndex,onChange:e=>t(s.id,{layerIndex:Number(e.target.value)}),className:"h-8"})})]}),"text"===s.type&&(0,i.jsx)(E,{element:s}),"image"===s.type&&(0,i.jsx)(I,{element:s}),"video"===s.type&&(0,i.jsx)(D,{element:s}),"audio"===s.type&&(0,i.jsx)(S,{element:s})]})]})}function C(e){let{label:t,children:s}=e;return(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(N._,{className:"text-xs text-gray-400",children:t}),s]})}function E(e){var t,s,r;let{element:a}=e,{updateElement:l}=o();return(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsx)("h4",{className:"text-xs font-semibold text-gray-400 uppercase",children:"Text"}),(0,i.jsx)(C,{label:"Font Family",children:(0,i.jsxs)(w.Ph,{value:(null===(t=a.data)||void 0===t?void 0:t.fontFamily)||"Arial",onValueChange:e=>l(a.id,{data:{...a.data,fontFamily:e}}),children:[(0,i.jsx)(w.i4,{className:"h-8",children:(0,i.jsx)(w.ki,{})}),(0,i.jsxs)(w.Bw,{children:[(0,i.jsx)(w.Ql,{value:"Arial",children:"Arial"}),(0,i.jsx)(w.Ql,{value:"Helvetica",children:"Helvetica"}),(0,i.jsx)(w.Ql,{value:"Times New Roman",children:"Times New Roman"}),(0,i.jsx)(w.Ql,{value:"Courier",children:"Courier"})]})]})}),(0,i.jsx)(C,{label:"Font Size",children:(0,i.jsx)(j.I,{type:"number",value:(null===(s=a.data)||void 0===s?void 0:s.fontSize)||16,onChange:e=>l(a.id,{data:{...a.data,fontSize:Number(e.target.value)}}),className:"h-8"})}),(0,i.jsx)(C,{label:"Color",children:(0,i.jsx)(j.I,{type:"color",value:(null===(r=a.data)||void 0===r?void 0:r.color)||"#000000",onChange:e=>l(a.id,{data:{...a.data,color:e.target.value}}),className:"h-8"})})]})}function I(e){var t;let{element:s}=e,{updateElement:r}=o();return(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsx)("h4",{className:"text-xs font-semibold text-gray-400 uppercase",children:"Image"}),(0,i.jsx)(C,{label:"Object Fit",children:(0,i.jsxs)(w.Ph,{value:(null===(t=s.data)||void 0===t?void 0:t.objectFit)||"cover",onValueChange:e=>r(s.id,{data:{...s.data,objectFit:e}}),children:[(0,i.jsx)(w.i4,{className:"h-8",children:(0,i.jsx)(w.ki,{})}),(0,i.jsxs)(w.Bw,{children:[(0,i.jsx)(w.Ql,{value:"contain",children:"Contain"}),(0,i.jsx)(w.Ql,{value:"cover",children:"Cover"}),(0,i.jsx)(w.Ql,{value:"fill",children:"Fill"})]})]})})]})}function D(e){var t,s,r,a;let{element:l}=e,{updateElement:n}=o();return(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsx)("h4",{className:"text-xs font-semibold text-gray-400 uppercase",children:"Video"}),(0,i.jsx)(C,{label:"Volume",children:(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(b.i,{value:[100*((null===(t=l.data)||void 0===t?void 0:t.volume)||1)],max:100,step:1,onValueChange:e=>{let[t]=e;return n(l.id,{data:{...l.data,volume:t/100}})},className:"flex-1"}),(0,i.jsxs)("span",{className:"text-sm text-white w-12 text-right",children:[Math.round(100*((null===(s=l.data)||void 0===s?void 0:s.volume)||1)),"%"]})]})}),(0,i.jsx)(C,{label:"Speed",children:(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(b.i,{value:[100*((null===(r=l.data)||void 0===r?void 0:r.speed)||1)],min:25,max:400,step:25,onValueChange:e=>{let[t]=e;return n(l.id,{data:{...l.data,speed:t/100}})},className:"flex-1"}),(0,i.jsxs)("span",{className:"text-sm text-white w-12 text-right",children:[100*((null===(a=l.data)||void 0===a?void 0:a.speed)||1),"%"]})]})})]})}function S(e){var t,s;let{element:r}=e,{updateElement:a}=o();return(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsx)("h4",{className:"text-xs font-semibold text-gray-400 uppercase",children:"Audio"}),(0,i.jsx)(C,{label:"Volume",children:(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(b.i,{value:[100*((null===(t=r.data)||void 0===t?void 0:t.volume)||1)],max:100,step:1,onValueChange:e=>{let[t]=e;return a(r.id,{data:{...r.data,volume:t/100}})},className:"flex-1"}),(0,i.jsxs)("span",{className:"text-sm text-white w-12 text-right",children:[Math.round(100*((null===(s=r.data)||void 0===s?void 0:s.volume)||1)),"%"]})]})})]})}var A=s(8867),z=s(8930),T=s(2208),P=s(7769),M=s(6337),Z=s(9589);function R(){let{elements:e,selectedElementIds:t,selectElement:s,updateElement:r,deleteElement:a,duplicateElement:l}=o(),n=[...e].sort((e,t)=>{var s,i;return(null!==(s=t.layerIndex)&&void 0!==s?s:0)-(null!==(i=e.layerIndex)&&void 0!==i?i:0)}),d=(t,s)=>{s.stopPropagation();let i=e.find(e=>e.id===t);i&&r(t,{visible:!i.visible})},c=(t,s)=>{s.stopPropagation();let i=e.find(e=>e.id===t);i&&r(t,{locked:!i.locked})},u=(e,t)=>{t.stopPropagation(),a(e)},m=(e,t)=>{t.stopPropagation(),l(e)},x=(e,t)=>{s(e,t.shiftKey)};return(0,i.jsxs)("div",{className:"flex flex-col h-full bg-gray-800 border-l border-gray-700",children:[(0,i.jsx)("div",{className:"p-3 border-b border-gray-700",children:(0,i.jsx)("h3",{className:"text-sm font-semibold text-white",children:"Layers"})}),(0,i.jsx)("div",{className:"flex-1 overflow-y-auto",children:0===n.length?(0,i.jsx)("div",{className:"p-4 text-center text-gray-500 text-sm",children:"No layers yet"}):n.map(e=>(0,i.jsx)(U,{element:e,isSelected:t.includes(e.id),onClick:x,onToggleVisibility:d,onToggleLock:c,onDelete:u,onDuplicate:m},e.id))})]})}function U(e){let{element:t,isSelected:s,onClick:r,onToggleVisibility:a,onToggleLock:l,onDelete:n,onDuplicate:d}=e;return(0,i.jsxs)("div",{className:(0,u.cn)("group flex items-center gap-2 px-3 py-2 cursor-pointer hover:bg-gray-700/50 transition-colors",s&&"bg-blue-600 hover:bg-blue-600"),onClick:e=>r(t.id,e),children:[(0,i.jsx)("div",{className:"flex-shrink-0 w-6 h-6 rounded bg-gray-700 flex items-center justify-center",children:(0,i.jsx)("span",{className:"text-xs text-gray-400 uppercase",children:t.type[0]})}),(0,i.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,i.jsxs)("div",{className:"text-sm font-medium text-white truncate",children:[t.type," ",t.id.slice(-4)]}),(0,i.jsxs)("div",{className:"text-xs text-gray-400",children:[Math.round(t.width)," \xd7 ",Math.round(t.height)]})]}),(0,i.jsxs)("div",{className:"flex-shrink-0 flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,i.jsx)("button",{onClick:e=>d(t.id,e),className:"p-1 hover:bg-gray-600 rounded",title:"Duplicate",children:(0,i.jsx)(A.Z,{className:"w-3 h-3 text-gray-400"})}),(0,i.jsx)("button",{onClick:e=>n(t.id,e),className:"p-1 hover:bg-red-600 rounded",title:"Delete",children:(0,i.jsx)(z.Z,{className:"w-3 h-3 text-gray-400"})})]}),(0,i.jsx)("button",{onClick:e=>a(t.id,e),className:"flex-shrink-0 p-1 hover:bg-gray-600 rounded",title:t.visible?"Hide":"Show",children:t.visible?(0,i.jsx)(T.Z,{className:"w-4 h-4 text-gray-400"}):(0,i.jsx)(P.Z,{className:"w-4 h-4 text-gray-600"})}),(0,i.jsx)("button",{onClick:e=>l(t.id,e),className:"flex-shrink-0 p-1 hover:bg-gray-600 rounded",title:t.locked?"Unlock":"Lock",children:t.locked?(0,i.jsx)(M.Z,{className:"w-4 h-4 text-gray-400"}):(0,i.jsx)(Z.Z,{className:"w-4 h-4 text-gray-600"})})]})}var L=s(1545),X=s(5566);let O=X.env.NEXT_PUBLIC_SUPABASE_URL||"",F=X.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"";function _(){return O&&F?(0,L.eI)(O,F,{auth:{persistSession:!0,autoRefreshToken:!0}}):(console.warn("Supabase credentials not configured"),null)}_();var V=s(7689),B=s(3247),Y=s(3113),H=s(9374),K=s(2106),G=s(8736),Q=s(2869);function J(){let{addElement:e,project:t}=o(),[s,a]=(0,r.useState)([]),[l,n]=(0,r.useState)(!1),[d,c]=(0,r.useState)(""),[u,m]=(0,r.useState)(null),x=(0,r.useRef)(null),h=(0,r.useCallback)(async()=>{if(!(null==t?void 0:t.id))return;let e=_(),{data:s,error:i}=await e.storage.from("videos").list("".concat(t.id,"/assets"),{limit:100,sortBy:{column:"created_at",order:"desc"}});!i&&s&&a(s.map(s=>{var i;let{data:{publicUrl:r}}=e.storage.from("videos").getPublicUrl("".concat(t.id,"/assets/").concat(s.name));return{id:s.id,name:s.name,type:$(s.name),url:r,size:(null===(i=s.metadata)||void 0===i?void 0:i.size)||0,createdAt:new Date(s.created_at)}}))},[null==t?void 0:t.id]);r.useEffect(()=>{h()},[h]);let p=async e=>{if(!e||!(null==t?void 0:t.id))return;n(!0);let s=_();for(let i of Array.from(e)){let e="".concat(Date.now(),"-").concat(i.name),r="".concat(t.id,"/assets/").concat(e),{data:l,error:n}=await s.storage.from("videos").upload(r,i,{cacheControl:"3600",upsert:!1});if(!n&&l){let{data:{publicUrl:e}}=s.storage.from("videos").getPublicUrl(r),t={id:l.path,name:i.name,type:$(i.name),url:e,size:i.size,createdAt:new Date};a(e=>[t,...e])}}n(!1)},f=async e=>{if(!(null==t?void 0:t.id))return;let s=_(),{error:i}=await s.storage.from("videos").remove([e]);i||(a(t=>t.filter(t=>t.id!==e)),u===e&&m(null))},v=(e,t)=>{e.dataTransfer.setData("application/json",JSON.stringify({type:"asset",asset:t}))},g=t=>{let s="document"===t.type?"text":t.type;e({id:"element-".concat(Date.now()),type:s,x:50,y:50,width:t.width||300,height:t.height||200,rotation:0,opacity:1,visible:!0,locked:!1,layerIndex:0,data:{src:t.url,name:t.name}})},y=s.filter(e=>e.name.toLowerCase().includes(d.toLowerCase()));return(0,i.jsxs)("div",{className:"flex flex-col h-full bg-gray-800 border-r border-gray-700",children:[(0,i.jsxs)("div",{className:"p-3 border-b border-gray-700 space-y-2",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)("h3",{className:"text-sm font-semibold text-white",children:"Assets"}),(0,i.jsxs)(Q.z,{size:"sm",onClick:()=>{var e;return null===(e=x.current)||void 0===e?void 0:e.click()},disabled:l,className:"h-7 px-2",children:[(0,i.jsx)(V.Z,{className:"w-3 h-3 mr-1"}),"Upload"]})]}),(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsx)(B.Z,{className:"absolute left-2 top-1/2 -translate-y-1/2 w-3 h-3 text-gray-400"}),(0,i.jsx)(j.I,{placeholder:"Search assets...",value:d,onChange:e=>c(e.target.value),className:"h-7 pl-7 text-xs"})]})]}),(0,i.jsx)("input",{ref:x,type:"file",multiple:!0,accept:"image/*,video/*,audio/*",onChange:e=>p(e.target.files),className:"hidden"}),(0,i.jsxs)("div",{className:"flex-1 overflow-y-auto p-2",children:[l&&(0,i.jsxs)("div",{className:"p-4 text-center",children:[(0,i.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto"}),(0,i.jsx)("p",{className:"text-xs text-gray-400 mt-2",children:"Uploading..."})]}),(0,i.jsx)("div",{className:"grid grid-cols-2 gap-2",children:y.map(e=>(0,i.jsx)(W,{asset:e,isSelected:u===e.id,onSelect:()=>m(e.id),onDelete:()=>f(e.id),onDragStart:t=>v(t,e),onAddToCanvas:()=>g(e)},e.id))}),0===y.length&&!l&&(0,i.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center p-4",children:[(0,i.jsx)(V.Z,{className:"w-12 h-12 text-gray-600 mb-2"}),(0,i.jsx)("p",{className:"text-sm text-gray-400",children:"No assets yet"}),(0,i.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Upload images, videos, or audio files"})]})]}),u&&(0,i.jsx)(q,{asset:s.find(e=>e.id===u),onClose:()=>m(null)})]})}function W(e){let{asset:t,isSelected:s,onSelect:r,onDelete:a,onDragStart:l,onAddToCanvas:n}=e,d=function(e){switch(e){case"image":return Y.Z;case"video":return H.Z;case"audio":return K.Z;default:return G.Z}}(t.type);return(0,i.jsxs)("div",{draggable:!0,onDragStart:l,onClick:r,onDoubleClick:n,className:(0,u.cn)("relative group cursor-pointer rounded-lg overflow-hidden border-2 transition-all",s?"border-blue-500":"border-gray-700 hover:border-gray-600"),children:[(0,i.jsx)("div",{className:"aspect-square bg-gray-900 flex items-center justify-center",children:"image"===t.type?(0,i.jsx)("img",{src:t.url,alt:t.name,className:"w-full h-full object-cover"}):"video"===t.type?(0,i.jsx)("video",{src:t.url,className:"w-full h-full object-cover",muted:!0}):(0,i.jsx)(d,{className:"w-8 h-8 text-gray-500"})}),(0,i.jsx)("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2",children:(0,i.jsx)(Q.z,{size:"sm",variant:"destructive",onClick:e=>{e.stopPropagation(),a()},className:"h-7 w-7 p-0",children:(0,i.jsx)(z.Z,{className:"w-3 h-3"})})}),(0,i.jsxs)("div",{className:"p-1 bg-gray-900",children:[(0,i.jsx)("p",{className:"text-xs text-white truncate",children:t.name}),(0,i.jsx)("p",{className:"text-xs text-gray-500",children:ee(t.size)})]})]})}function q(e){var t;let{asset:s,onClose:r}=e;return(0,i.jsxs)("div",{className:"border-t border-gray-700 p-3 space-y-2",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)("h4",{className:"text-xs font-semibold text-white",children:"Preview"}),(0,i.jsx)(Q.z,{size:"sm",variant:"ghost",onClick:r,className:"h-6 w-6 p-0",children:"\xd7"})]}),(0,i.jsxs)("div",{className:"aspect-video bg-gray-900 rounded overflow-hidden flex items-center justify-center",children:["image"===s.type&&(0,i.jsx)("img",{src:s.url,alt:s.name,className:"max-w-full max-h-full"}),"video"===s.type&&(0,i.jsx)("video",{src:s.url,controls:!0,className:"max-w-full max-h-full"}),"audio"===s.type&&(0,i.jsx)("audio",{src:s.url,controls:!0,className:"w-full"})]}),(0,i.jsxs)("div",{className:"text-xs space-y-1",children:[(0,i.jsxs)("div",{className:"flex justify-between text-gray-400",children:[(0,i.jsx)("span",{children:"Name:"}),(0,i.jsx)("span",{className:"text-white",children:s.name})]}),(0,i.jsxs)("div",{className:"flex justify-between text-gray-400",children:[(0,i.jsx)("span",{children:"Size:"}),(0,i.jsx)("span",{className:"text-white",children:ee(s.size)})]}),s.duration&&(0,i.jsxs)("div",{className:"flex justify-between text-gray-400",children:[(0,i.jsx)("span",{children:"Duration:"}),(0,i.jsx)("span",{className:"text-white",children:(t=s.duration,"".concat(Math.floor(t/60),":").concat(Math.floor(t%60).toString().padStart(2,"0")))})]})]})]})}function $(e){var t;let s=null===(t=e.split(".").pop())||void 0===t?void 0:t.toLowerCase();return["jpg","jpeg","png","gif","webp","svg"].includes(s||"")?"image":["mp4","mov","avi","webm"].includes(s||"")?"video":["mp3","wav","ogg","m4a"].includes(s||"")?"audio":"document"}function ee(e){return e<1024?e+" B":e<1048576?(e/1024).toFixed(1)+" KB":(e/1048576).toFixed(1)+" MB"}var et=s(1817),es=s(2735),ei=s(4438);function er(){let{isRendering:e,progress:t,startRender:s,cancelRender:a}=function(){let{project:e}=o(),[t,s]=(0,r.useState)(!1),[i,a]=(0,r.useState)(null),[l,n]=(0,r.useState)(null),d=(0,r.useRef)(null);return(0,r.useEffect)(()=>{var e;if(!l)return;null===(e=d.current)||void 0===e||e.close();let t=new EventSource("/api/render/progress?jobId=".concat(l));return d.current=t,t.addEventListener("progress",e=>{let t=JSON.parse(e.data);a(t),"failed"===t.phase&&(s(!1),ei.Am.error("Render falhou",{description:t.error||"Erro desconhecido"}))}),t.addEventListener("complete",e=>{let i=JSON.parse(e.data);a(e=>({...e||{jobId:i.jobId,phase:"completed",progress:100},phase:"completed",progress:100,videoUrl:i.videoUrl})),s(!1),n(null),ei.Am.success("V\xeddeo renderizado com sucesso!",{description:i.videoUrl?"Dispon\xedvel em: ".concat(i.videoUrl):void 0}),t.close()}),t.addEventListener("job-error",e=>{let i=JSON.parse(e.data);a({jobId:i.jobId,phase:"failed",progress:0,error:i.error}),s(!1),n(null),ei.Am.error("Render falhou",{description:i.error||"Erro desconhecido"}),t.close()}),t.onerror=()=>{ei.Am.error("Conex\xe3o com o progresso foi perdida")},()=>{t.close(),d.current===t&&(d.current=null)}},[l]),(0,r.useEffect)(()=>()=>{var e;null===(e=d.current)||void 0===e||e.close()},[]),{isRendering:t,progress:i,jobId:l,startRender:async()=>{if(!(null==e?void 0:e.id)){ei.Am.error("No project loaded");return}s(!0),a({jobId:e.id,phase:"queued",progress:0});try{let t=e.width>=3840?"4K":e.height>=1080?"1080p":"720p",s=await fetch("/api/video/render",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({projectId:e.id,resolution:t,fps:e.fps||30,format:"mp4",quality:"high",transition:"fade",audioProvider:"elevenlabs"})});if(!s.ok)throw Error("Render enqueue failed: ".concat(s.statusText));let i=await s.json();n(i.jobId),a({jobId:i.jobId,phase:"queued",progress:0}),ei.Am.success("Renderiza\xe7\xe3o iniciada",{description:"Job ID: ".concat(i.jobId)})}catch(e){console.error("Render export error:",e),s(!1),a(null),ei.Am.error("Failed to start render",{description:e instanceof Error?e.message:"Unknown error"})}},cancelRender:()=>{d.current&&(d.current.close(),d.current=null),s(!1),a(null),n(null),ei.Am.info("Cancelamento manual interrompeu apenas o acompanhamento; o job continuar\xe1 processando.")}}}();return(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[t&&(0,i.jsxs)("div",{className:"text-xs text-gray-400",children:[t.phase," \xb7 ",Math.round(t.progress),"%"]}),(0,i.jsx)(Q.z,{onClick:e?a:s,disabled:!1,variant:e?"destructive":"default",size:"sm",children:e?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(et.Z,{className:"w-4 h-4 mr-2 animate-spin"}),t?"".concat(Math.round(t.progress),"%"):"Rendering..."]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(es.Z,{className:"w-4 h-4 mr-2"}),"Export Video"]})})]})}var ea=s(5277),el=s(5965),en=s(4353),ed=s(3229);function eo(){!function(){let{undo:e,redo:t,deleteElement:s,duplicateElement:i,selectedElementIds:a,isPlaying:l,currentTime:n,setCurrentTime:d,setIsPlaying:c,toggleGrid:u,toggleSnap:m,copy:x,cut:h,paste:p}=o();(0,r.useEffect)(()=>{let r=r=>{if(r.target instanceof HTMLInputElement||r.target instanceof HTMLTextAreaElement||"true"===r.target.contentEditable)return;let m=navigator.platform.toUpperCase().indexOf("MAC")>=0?r.metaKey:r.ctrlKey;if(m&&"z"===r.key&&!r.shiftKey){r.preventDefault(),e(),ei.Am.info("Undo");return}if(m&&("Z"===r.key||"z"===r.key&&r.shiftKey)){r.preventDefault(),t(),ei.Am.info("Redo");return}if(m&&"c"===r.key){r.preventDefault(),x(),ei.Am.info("Copied ".concat(a.length," element(s)"));return}if(m&&"x"===r.key){r.preventDefault(),h(),ei.Am.info("Cut ".concat(a.length," element(s)"));return}if(m&&"v"===r.key){r.preventDefault(),p(),ei.Am.info("Pasted");return}if(m&&"d"===r.key){r.preventDefault(),a.forEach(e=>i(e)),ei.Am.info("Duplicated ".concat(a.length," element(s)"));return}if("Delete"===r.key||"Backspace"===r.key){r.preventDefault(),a.forEach(e=>s(e)),ei.Am.info("Deleted ".concat(a.length," element(s)"));return}if(" "===r.key||"k"===r.key){r.preventDefault(),c(!l),ei.Am.info(l?"Paused":"Playing");return}if("Home"===r.key){r.preventDefault(),d(0);return}if("End"===r.key){r.preventDefault(),d(60);return}if("ArrowLeft"===r.key){r.preventDefault(),d(Math.max(0,n-(r.shiftKey?1:.1)));return}if("ArrowRight"===r.key){r.preventDefault(),d(n+(r.shiftKey?1:.1));return}if(m&&"'"===r.key){r.preventDefault(),u(),ei.Am.info("Grid toggled");return}if(m&&";"===r.key){r.preventDefault();let e=o.getState();e.setSnapEnabled(!e.snapEnabled),ei.Am.info("Snap toggled");return}if(m&&"a"===r.key){r.preventDefault(),ei.Am.info("Select all");return}if("Escape"===r.key){r.preventDefault(),o.getState().setSelectedElementIds([]),ei.Am.info("Deselected");return}};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[e,t,s,i,a,l,n,d,c,u,x,h,p])}();let{undo:e,redo:t,canUndo:s,canRedo:a,isDirty:l,project:n,addElement:d}=o(e=>({undo:e.undo,redo:e.redo,canUndo:e.canUndo(),canRedo:e.canRedo(),isDirty:e.isDirty,project:e.project,addElement:e.addElement})),c=async()=>{if(!(null==n?void 0:n.id)){ei.Am.error("No project loaded");return}try{let e=o.getState();if(!(await fetch("/api/projects/".concat(n.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({elements:e.elements,tracks:e.tracks,settings:{width:n.width,height:n.height,fps:n.fps,duration:n.duration}})})).ok)throw Error("Failed to save project");ei.Am.success("Project saved successfully")}catch(e){console.error("Save error:",e),ei.Am.error("Failed to save project")}};return(0,i.jsxs)("div",{className:"flex flex-col h-screen bg-gray-900",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between px-4 py-2 bg-gray-800 border-b border-gray-700",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("h1",{className:"text-lg font-semibold text-white",children:(null==n?void 0:n.name)||"Untitled Project"}),l&&(0,i.jsx)("span",{className:"text-xs text-yellow-500",children:"â€¢ Unsaved changes"})]}),(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsxs)(Q.z,{size:"sm",variant:"outline",onClick:()=>{d({id:"text-".concat(Date.now()),type:"text",trackId:"track-video",content:"Double-click to edit",x:100,y:100,width:300,height:100,rotation:0,opacity:1,visible:!0,locked:!1,startTime:0,duration:5,fontSize:48,fontFamily:"Arial",fontWeight:"normal",textAlign:"center",color:"#ffffff"}),ei.Am.success("Text element added")},title:"Add Text (T)",children:[(0,i.jsx)(ea.Z,{className:"w-4 h-4 mr-1"}),"Add Text"]}),(0,i.jsxs)(Q.z,{size:"sm",variant:"outline",onClick:()=>{d({id:"image-".concat(Date.now()),type:"image",trackId:"track-video",content:"",x:150,y:150,width:400,height:300,rotation:0,opacity:1,visible:!0,locked:!1,startTime:0,duration:5}),ei.Am.info("Image placeholder added - drag asset to replace")},title:"Add Image (I)",children:[(0,i.jsx)(Y.Z,{className:"w-4 h-4 mr-1"}),"Add Image"]}),(0,i.jsx)("div",{className:"w-px h-6 bg-gray-700 mx-2"}),(0,i.jsx)(Q.z,{size:"sm",variant:"ghost",onClick:e,disabled:!s,title:"Undo (Ctrl+Z)",children:(0,i.jsx)(el.Z,{className:"w-4 h-4"})}),(0,i.jsx)(Q.z,{size:"sm",variant:"ghost",onClick:t,disabled:!a,title:"Redo (Ctrl+Shift+Z)",children:(0,i.jsx)(en.Z,{className:"w-4 h-4"})}),(0,i.jsx)("div",{className:"w-px h-6 bg-gray-700 mx-2"}),(0,i.jsxs)(Q.z,{size:"sm",variant:"ghost",onClick:c,disabled:!l,title:"Save (Ctrl+S)",children:[(0,i.jsx)(ed.Z,{className:"w-4 h-4 mr-2"}),"Save"]}),(0,i.jsx)(er,{})]})]}),(0,i.jsxs)("div",{className:"flex flex-1 overflow-hidden",children:[(0,i.jsx)("div",{className:"w-64 flex-shrink-0",children:(0,i.jsx)(J,{})}),(0,i.jsxs)("div",{className:"flex-1 flex flex-col min-w-0",children:[(0,i.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,i.jsx)(m,{})}),(0,i.jsx)("div",{className:"h-64 border-t border-gray-700",children:(0,i.jsx)(y,{})})]}),(0,i.jsxs)("div",{className:"w-80 flex flex-col flex-shrink-0",children:[(0,i.jsx)("div",{className:"flex-1 border-t border-gray-700 overflow-hidden",children:(0,i.jsx)(R,{})}),(0,i.jsx)("div",{className:"flex-1 border-t border-gray-700 overflow-hidden",children:(0,i.jsx)(k,{})})]})]})]})}},2869:function(e,t,s){"use strict";s.d(t,{z:function(){return r}});var i=s(7437);let r=s(2265).forwardRef((e,t)=>{let{className:s="",variant:r="default",size:a="default",...l}=e;return(0,i.jsx)("button",{ref:t,className:["inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-red-600 text-white hover:bg-red-700",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"underline-offset-4 hover:underline text-blue-600 dark:text-blue-400 bg-transparent"}[r],{default:"h-10 px-4 py-2",sm:"h-9 px-3",lg:"h-11 px-8",icon:"h-10 w-10"}[a],s].join(" "),...l})});r.displayName="Button"},8223:function(e,t,s){"use strict";s.d(t,{I:function(){return r}});var i=s(7437);let r=s(2265).forwardRef((e,t)=>{let{className:s="",...r}=e;return(0,i.jsx)("input",{ref:t,className:["flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm","ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium","placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",s].join(" "),...r})});r.displayName="Input"},6815:function(e,t,s){"use strict";s.d(t,{_:function(){return r}});var i=s(7437);function r(e){let{className:t="",...s}=e;return(0,i.jsx)("label",{className:["text-sm font-medium leading-none ",t].join(" "),...s})}s(2265)},3647:function(e,t,s){"use strict";s.d(t,{Bw:function(){return n},Ph:function(){return r},Ql:function(){return d},i4:function(){return a},ki:function(){return l}});var i=s(7437);function r(e){let{className:t="",children:s}=e;return(0,i.jsx)("div",{className:["relative",t].join(" "),children:s})}function a(e){let{className:t="",...s}=e;return(0,i.jsx)("button",{type:"button",className:["flex h-10 w-full items-center justify-between rounded-md border px-3 py-2 text-sm",t].join(" "),...s})}function l(e){let{className:t=""}=e;return(0,i.jsx)("span",{className:t})}function n(e){let{className:t="",children:s}=e;return(0,i.jsx)("div",{className:["mt-2 rounded-md border bg-popover p-1 text-popover-foreground",t].join(" "),children:s})}function d(e){let{className:t="",value:s,children:r,onClick:a,selected:l}=e;return(0,i.jsx)("div",{role:"option","data-value":s,"aria-selected":!!l,tabIndex:0,onClick:a,className:["cursor-pointer select-none rounded-sm px-2 py-1.5 text-sm hover:bg-accent hover:text-accent-foreground",t].join(" "),children:r})}s(2265)},5897:function(e,t,s){"use strict";s.d(t,{i:function(){return n}});var i=s(7437),r=s(2265),a=s(553),l=s(4508);let n=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,i.jsxs)(a.fC,{ref:t,className:(0,l.cn)("relative flex w-full touch-none select-none items-center",s),...r,children:[(0,i.jsx)(a.fQ,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:(0,i.jsx)(a.e6,{className:"absolute h-full bg-primary"})}),(0,i.jsx)(a.bU,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]})});n.displayName=a.fC.displayName},4508:function(e,t,s){"use strict";s.d(t,{cn:function(){return a}});var i=s(1994),r=s(3335);function a(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.m6)((0,i.Z)(t))}}},function(e){e.O(0,[590,438,798,872,487,971,117,744],function(){return e(e.s=3955)}),_N_E=e.O()}]);