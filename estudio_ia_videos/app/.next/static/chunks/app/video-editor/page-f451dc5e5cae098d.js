(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[209],{2855:function(e,t,s){Promise.resolve().then(s.bind(s,7142))},7142:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return tM},dynamic:function(){return tz}});var a=s(7437),r=s(4401),l=s(464),i=s(1723),n=s(525),o=s(6070),c=s(5974);class d{calculateMetrics(e,t){var s;let a=(null===(s=t.timeline_data)||void 0===s?void 0:s.slides)||[],r={},l=0;a.forEach(e=>{e.elements&&e.elements.forEach(e=>{l++,r[e.type]=(r[e.type]||0)+1})});let i=a.length>0?l/a.length:0,n=Math.min(100,l/(5*a.length)*100),o={projectId:e,totalSlides:a.length,totalDuration:t.duration||0,totalElements:l,elementsByType:r,averageSlideComplexity:Math.round(10*i)/10,completionRate:Math.round(n),lastModified:new Date(t.updated_at||Date.now()),editCount:this.getEvents(e).filter(e=>"edit"===e.type).length,exportCount:this.getEvents(e).filter(e=>"export"===e.type).length,viewCount:this.getEvents(e).filter(e=>"view"===e.type).length};return this.metrics.set(e,o),o}trackEvent(e,t){let s={...t,id:"event-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),timestamp:new Date},a=this.events.get(e)||[];a.push(s),this.events.set(e,a),console.log("[ProjectAnalytics] Event tracked: ".concat(t.type," - ").concat(t.description))}getEvents(e,t){let s=this.events.get(e)||[];return t?s.slice(-t):s}getMetrics(e){return this.metrics.get(e)||null}getUsageStats(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:7,s=this.getEvents(e),a=new Date,r={};for(let e=0;e<t;e++){let t=new Date(a);t.setDate(t.getDate()-e),r[t.toISOString().split("T")[0]]=0}return s.forEach(e=>{let t=e.timestamp.toISOString().split("T")[0];r.hasOwnProperty(t)&&r[t]++}),Object.entries(r).map(e=>{let[t,s]=e;return{date:t,events:s}}).reverse()}compareProjects(e){return e.map(e=>({projectId:e,metrics:this.getMetrics(e)}))}exportReport(e){let t=this.getMetrics(e),s=this.getEvents(e),a=this.getUsageStats(e,30);return{projectId:e,generatedAt:new Date,metrics:t,totalEvents:s.length,recentEvents:s.slice(-10),usageStats:a,topElementTypes:t?Object.entries(t.elementsByType).sort((e,t)=>{let[,s]=e,[,a]=t;return a-s}).slice(0,5):[]}}constructor(){this.events=new Map,this.metrics=new Map}}let m=new d;function u(e){let{projectId:t,metrics:s}=e,d=m.getUsageStats(t,7),u=m.getEvents(t,5);return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[(0,a.jsx)(o.Zb,{children:(0,a.jsx)(o.aY,{className:"pt-6",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:s.totalSlides}),(0,a.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"Slides"})]})})}),(0,a.jsx)(o.Zb,{children:(0,a.jsx)(o.aY,{className:"pt-6",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-2xl font-bold text-green-600",children:s.totalElements}),(0,a.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"Elementos"})]})})}),(0,a.jsx)(o.Zb,{children:(0,a.jsx)(o.aY,{className:"pt-6",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("p",{className:"text-2xl font-bold text-purple-600",children:[Math.round(s.totalDuration),"s"]}),(0,a.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"Dura\xe7\xe3o"})]})})}),(0,a.jsx)(o.Zb,{children:(0,a.jsx)(o.aY,{className:"pt-6",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("p",{className:"text-2xl font-bold text-orange-600",children:[s.completionRate,"%"]}),(0,a.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"Conclus\xe3o"})]})})})]}),(0,a.jsxs)(o.Zb,{children:[(0,a.jsx)(o.Ol,{children:(0,a.jsxs)(o.ll,{className:"text-sm flex items-center gap-2",children:[(0,a.jsx)(r.Z,{className:"w-4 h-4"}),"Atividade (\xfaltimos 7 dias)"]})}),(0,a.jsx)(o.aY,{children:(0,a.jsx)("div",{className:"flex items-end gap-2 h-32",children:d.map((e,t)=>{let s=Math.max(...d.map(e=>e.events),1),r=e.events/s*100;return(0,a.jsxs)("div",{className:"flex-1 flex flex-col items-center gap-1",children:[(0,a.jsx)("div",{className:"w-full bg-blue-600 rounded-t transition-all hover:bg-blue-700",style:{height:"".concat(r,"%")},title:"".concat(e.events," eventos")}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:new Date(e.date).getDate()})]},t)})})})]}),(0,a.jsxs)(o.Zb,{children:[(0,a.jsx)(o.Ol,{children:(0,a.jsxs)(o.ll,{className:"text-sm flex items-center gap-2",children:[(0,a.jsx)(l.Z,{className:"w-4 h-4"}),"Elementos por Tipo"]})}),(0,a.jsx)(o.aY,{children:(0,a.jsx)("div",{className:"space-y-2",children:Object.entries(s.elementsByType).map(e=>{let[t,r]=e,l=r/s.totalElements*100;return(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsx)("span",{className:"capitalize text-gray-700",children:t}),(0,a.jsx)("span",{className:"font-medium",children:r})]}),(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,a.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all",style:{width:"".concat(l,"%")}})})]},t)})})})]}),(0,a.jsxs)(o.Zb,{children:[(0,a.jsx)(o.Ol,{children:(0,a.jsxs)(o.ll,{className:"text-sm flex items-center gap-2",children:[(0,a.jsx)(i.Z,{className:"w-4 h-4"}),"Atividades Recentes"]})}),(0,a.jsx)(o.aY,{children:0===u.length?(0,a.jsx)("p",{className:"text-sm text-gray-500 text-center py-4",children:"Nenhuma atividade registrada"}):(0,a.jsx)("div",{className:"space-y-2",children:u.map(e=>(0,a.jsxs)("div",{className:"flex items-start gap-2 text-xs p-2 bg-gray-50 rounded",children:[(0,a.jsx)(c.C,{variant:"outline",className:"text-xs shrink-0",children:e.type}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-gray-700",children:e.description}),(0,a.jsx)("p",{className:"text-gray-500 text-xs mt-1",children:new Date(e.timestamp).toLocaleString("pt-BR")})]})]},e.id))})})]}),(0,a.jsxs)(o.Zb,{children:[(0,a.jsx)(o.Ol,{children:(0,a.jsxs)(o.ll,{className:"text-sm flex items-center gap-2",children:[(0,a.jsx)(n.Z,{className:"w-4 h-4"}),"Estat\xedsticas"]})}),(0,a.jsx)(o.aY,{children:(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-lg font-bold text-gray-900",children:s.editCount}),(0,a.jsx)("p",{className:"text-xs text-gray-600",children:"Edi\xe7\xf5es"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-lg font-bold text-gray-900",children:s.exportCount}),(0,a.jsx)("p",{className:"text-xs text-gray-600",children:"Exporta\xe7\xf5es"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-lg font-bold text-gray-900",children:s.viewCount}),(0,a.jsx)("p",{className:"text-xs text-gray-600",children:"Visualiza\xe7\xf5es"})]})]})})]})]})}var h=s(2265),x=s(8906),p=s(2735),g=s(8930),f=s(2869);class v{createBackup(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"manual",a=arguments.length>3?arguments[3]:void 0,r=JSON.stringify(t),l=this.generateHash(r),i={id:"backup-".concat(Date.now()),projectId:e,timestamp:new Date,size:r.length,data:JSON.parse(r),type:s,description:a,hash:l},n=this.backups.get(e)||[];return n.push(i),n.length>this.maxBackupsPerProject&&n.shift(),this.backups.set(e,n),console.log("[BackupManager] Backup criado: ".concat(i.id," (").concat(s,")")),i}listBackups(e){return(this.backups.get(e)||[]).sort((e,t)=>t.timestamp.getTime()-e.timestamp.getTime())}getBackup(e){for(let t of this.backups.values()){let s=t.find(t=>t.id===e);if(s)return s}return null}restoreBackup(e){let t=this.getBackup(e);return t?(console.log("[BackupManager] Restaurando backup: ".concat(e)),JSON.parse(JSON.stringify(t.data))):null}deleteBackup(e){for(let[t,s]of this.backups.entries()){let a=s.findIndex(t=>t.id===e);if(-1!==a)return s.splice(a,1),this.backups.set(t,s),console.log("[BackupManager] Backup deletado: ".concat(e)),!0}return!1}cleanupOldBackups(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30,s=this.backups.get(e)||[],a=new Date;a.setDate(a.getDate()-t);let r=s.filter(e=>e.timestamp>=a),l=s.length-r.length;return this.backups.set(e,r),console.log("[BackupManager] ".concat(l," backups antigos removidos")),l}startAutoBackup(e,t){this.autoBackupInterval&&this.stopAutoBackup(),this.autoBackupInterval=setInterval(()=>{let s=t();this.createBackup(e,s,"auto","Auto-backup peri\xf3dico")},6e4*this.autoBackupMinutes),console.log("[BackupManager] Auto-backup iniciado (a cada ".concat(this.autoBackupMinutes," min)"))}stopAutoBackup(){this.autoBackupInterval&&(clearInterval(this.autoBackupInterval),this.autoBackupInterval=null,console.log("[BackupManager] Auto-backup parado"))}validateBackup(e){let t=this.getBackup(e);return!!t&&this.generateHash(JSON.stringify(t.data))===t.hash}exportBackup(e){let t=this.getBackup(e);return t?new Blob([JSON.stringify({...t,exportedAt:new Date,version:"1.0"},null,2)],{type:"application/json"}):null}generateHash(e){let t=0;for(let s=0;s<e.length;s++)t=(t<<5)-t+e.charCodeAt(s),t&=t;return Math.abs(t).toString(36)}getStats(e){let t=this.listBackups(e);return{total:t.length,auto:t.filter(e=>"auto"===e.type).length,manual:t.filter(e=>"manual"===e.type).length,totalSize:t.reduce((e,t)=>e+t.size,0),oldestBackup:t.length>0?t[t.length-1].timestamp:void 0,newestBackup:t.length>0?t[0].timestamp:void 0}}constructor(){this.backups=new Map,this.maxBackupsPerProject=20,this.autoBackupInterval=null,this.autoBackupMinutes=5}}let b=new v;function y(e){let{projectId:t,onRestore:s}=e,[r,l]=(0,h.useState)([]),[n,d]=(0,h.useState)(!1),[m,u]=(0,h.useState)(!1),[v,y]=(0,h.useState)(0),j=(0,h.useCallback)(()=>{l(b.listBackups(t))},[t]);(0,h.useEffect)(()=>{j()},[j]);let N=e=>{if(confirm("Restaurar este backup? As altera\xe7\xf5es n\xe3o salvas ser\xe3o perdidas.")){let t=b.restoreBackup(e);t&&s&&s(t)}},w=e=>{confirm("Deletar este backup?")&&(b.deleteBackup(e),j())},k=e=>{let t=b.exportBackup(e);if(t){let s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download="backup-".concat(e,".json"),a.click(),URL.revokeObjectURL(s)}},C=b.getStats(t),S=e=>new Intl.DateTimeFormat("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}).format(new Date(e)),E=e=>{if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["Bytes","KB","MB"][t]};return(0,a.jsxs)(o.Zb,{children:[(0,a.jsx)(o.Ol,{children:(0,a.jsxs)(o.ll,{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)(x.Z,{className:"w-4 h-4"}),"Backup e Seguran\xe7a"]})}),(0,a.jsxs)(o.aY,{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-2 text-center",children:[(0,a.jsxs)("div",{className:"p-2 bg-blue-50 rounded",children:[(0,a.jsx)("p",{className:"text-lg font-bold text-blue-600",children:C.total}),(0,a.jsx)("p",{className:"text-xs text-gray-600",children:"Total"})]}),(0,a.jsxs)("div",{className:"p-2 bg-green-50 rounded",children:[(0,a.jsx)("p",{className:"text-lg font-bold text-green-600",children:C.auto}),(0,a.jsx)("p",{className:"text-xs text-gray-600",children:"Auto"})]}),(0,a.jsxs)("div",{className:"p-2 bg-purple-50 rounded",children:[(0,a.jsx)("p",{className:"text-lg font-bold text-purple-600",children:C.manual}),(0,a.jsx)("p",{className:"text-xs text-gray-600",children:"Manual"})]})]}),(0,a.jsxs)(f.z,{size:"sm",className:"w-full",onClick:()=>{let e={projectId:t,timestamp:Date.now()};b.createBackup(t,e,"manual","Backup manual"),j()},children:[(0,a.jsx)(x.Z,{className:"w-3 h-3 mr-2"}),"Criar Backup Manual"]}),(0,a.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:0===r.length?(0,a.jsx)("p",{className:"text-xs text-gray-500 text-center py-4",children:"Nenhum backup ainda"}):r.slice(0,5).map(e=>(0,a.jsx)("div",{className:"p-2 bg-gray-50 rounded border border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)(c.C,{variant:"auto"===e.type?"outline":"default",className:"text-xs",children:"auto"===e.type?"Auto":"Manual"}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:E(e.size)})]}),(0,a.jsx)("p",{className:"text-xs text-gray-700",children:S(e.timestamp)})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(f.z,{size:"sm",variant:"ghost",onClick:()=>N(e.id),title:"Restaurar",className:"h-6 w-6 p-0",children:(0,a.jsx)(i.Z,{className:"w-3 h-3"})}),(0,a.jsx)(f.z,{size:"sm",variant:"ghost",onClick:()=>k(e.id),title:"Exportar",className:"h-6 w-6 p-0",children:(0,a.jsx)(p.Z,{className:"w-3 h-3"})}),(0,a.jsx)(f.z,{size:"sm",variant:"ghost",onClick:()=>w(e.id),title:"Deletar",className:"h-6 w-6 p-0 text-red-600",children:(0,a.jsx)(g.Z,{className:"w-3 h-3"})})]})]})},e.id))}),m&&(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-600",children:[(0,a.jsx)("span",{children:"Importando..."}),(0,a.jsxs)("span",{children:[v,"%"]})]}),(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,a.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all",style:{width:"".concat(v,"%")}})})]})]})]})}var j=s(3559),N=s(1473),w=s(6765),k=s(6002),C=s(6841),S=s(1774),E=s(4508);let I=h.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(S.fC,{className:(0,E.cn)("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...r,ref:t,children:(0,a.jsx)(S.bU,{className:(0,E.cn)("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})})});I.displayName=S.fC.displayName;var z=s(5897);function D(e){let{gridEnabled:t,snapEnabled:s,gridSize:r,onGridToggle:l,onSnapToggle:i,onGridSizeChange:n,onAlign:c,onDistribute:d}=e,[m,u]=(0,h.useState)(!1);return(0,a.jsxs)(o.Zb,{className:"bg-gray-900 border-gray-800",children:[(0,a.jsx)(o.Ol,{className:"border-b border-gray-800",children:(0,a.jsxs)(o.ll,{className:"text-white flex items-center gap-2 text-sm",children:[(0,a.jsx)(j.Z,{className:"w-4 h-4"}),"Grid & Alinhamento"]})}),(0,a.jsxs)(o.aY,{className:"p-3 space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(N.Z,{className:"w-4 h-4 text-gray-400"}),(0,a.jsx)("span",{className:"text-sm text-white",children:"Mostrar Grid"})]}),(0,a.jsx)(I,{checked:t,onCheckedChange:l})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(w.Z,{className:"w-4 h-4 text-gray-400"}),(0,a.jsx)("span",{className:"text-sm text-white",children:"Snap Autom\xe1tico"})]}),(0,a.jsx)(I,{checked:s,onCheckedChange:i})]}),t&&(0,a.jsxs)("div",{className:"space-y-2 pt-2 border-t border-gray-800",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-xs text-gray-400",children:"Tamanho do Grid"}),(0,a.jsxs)("span",{className:"text-xs text-white font-medium",children:[r,"px"]})]}),(0,a.jsx)(z.i,{value:[r],onValueChange:e=>n(e[0]),min:10,max:100,step:10,className:"w-full"})]}),c&&(0,a.jsxs)("div",{className:"pt-2 border-t border-gray-800",children:[(0,a.jsxs)("button",{className:"w-full text-left text-xs text-gray-400 hover:text-white mb-2 transition-colors",onClick:()=>u(!m),children:[m?"▼":"▶"," Ferramentas de Alinhamento"]}),m&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Horizontal"}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-1",children:[(0,a.jsx)(f.z,{size:"sm",variant:"outline",className:"h-8 text-xs",onClick:()=>c("left"),title:"Alinhar \xe0 esquerda",children:"⬅️"}),(0,a.jsx)(f.z,{size:"sm",variant:"outline",className:"h-8 text-xs",onClick:()=>c("center-h"),title:"Centralizar horizontalmente",children:"↔️"}),(0,a.jsx)(f.z,{size:"sm",variant:"outline",className:"h-8 text-xs",onClick:()=>c("right"),title:"Alinhar \xe0 direita",children:"➡️"})]})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Vertical"}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-1",children:[(0,a.jsx)(f.z,{size:"sm",variant:"outline",className:"h-8 text-xs",onClick:()=>c("top"),title:"Alinhar ao topo",children:"⬆️"}),(0,a.jsx)(f.z,{size:"sm",variant:"outline",className:"h-8 text-xs",onClick:()=>c("center-v"),title:"Centralizar verticalmente",children:"↕️"}),(0,a.jsx)(f.z,{size:"sm",variant:"outline",className:"h-8 text-xs",onClick:()=>c("bottom"),title:"Alinhar abaixo",children:"⬇️"})]})]}),d&&(0,a.jsxs)("div",{className:"space-y-1 pt-2 border-t border-gray-700",children:[(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Distribuir"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-1",children:[(0,a.jsxs)(f.z,{size:"sm",variant:"outline",className:"h-8 text-xs",onClick:()=>d("horizontal"),title:"Distribuir horizontalmente",children:[(0,a.jsx)(k.Z,{className:"w-3 h-3 mr-1"}),"H"]}),(0,a.jsxs)(f.z,{size:"sm",variant:"outline",className:"h-8 text-xs",onClick:()=>d("vertical"),title:"Distribuir verticalmente",children:[(0,a.jsx)(C.Z,{className:"w-3 h-3 mr-1"}),"V"]})]})]})]})]})]})]})}let A=null;async function M(){if(A)return A;try{let e=await s.e(788).then(s.bind(s,8960));return A=e.fabric||e}catch(e){return console.error("Failed to load Fabric.js:",e),null}}class T{static createGroup(e,t){if(t.length<2)return console.warn("\xc9 necess\xe1rio pelo menos 2 objetos para criar um grupo"),null;let s=new null.Group(t,{selectable:!0,evented:!0,hasControls:!0,hasBorders:!0,transparentCorners:!1,cornerColor:"#4F46E5",cornerStyle:"circle",cornerSize:10,borderColor:"#4F46E5"});return t.forEach(t=>e.remove(t)),e.add(s),e.setActiveObject(s),e.renderAll(),console.log("✅ Grupo criado com ".concat(t.length," elementos")),s}static ungroupElements(e,t){let s=t._objects?[...t._objects]:t.getObjects();return"function"==typeof t._restoreObjectsState?t._restoreObjectsState():s.forEach(e=>e.set({left:(e.left||0)+(t.left||0),top:(e.top||0)+(t.top||0)})),s.forEach(t=>{t.set({selectable:!0,evented:!0}),e.add(t)}),e.remove(t),e.discardActiveObject(),e.requestRenderAll(),console.log("✅ Grupo desfeito: ".concat(s.length," elementos liberados")),s}static isGroup(e){return"group"===e.type}static getGroupSize(e){return e.getObjects().length}}class O{setupListeners(){this.canvas.on("object:moving",e=>{this.config.enabled&&e.target&&this.handleSnap(e.target)}),this.canvas.on("object:scaling",e=>{this.config.enabled&&e.target&&this.handleSnapDuringScale(e.target)}),this.canvas.on("mouse:up",()=>{this.clearGuides()})}handleSnap(e){this.clearGuides(),this.config.snapToGrid&&this.snapToGrid(e),this.config.snapToObjects&&this.snapToObjects(e),this.config.snapToCenter&&this.snapToCenter(e)}snapToGrid(e){let t=this.config.gridSize,s=this.config.snapDistance,a=e.left,r=e.top,l=Math.round(a/t)*t,i=Math.round(r/t)*t;Math.abs(a-l)<s&&(e.set({left:l}),this.config.showGuides&&this.drawVerticalGuide(l,"".concat(l,"px"))),Math.abs(r-i)<s&&(e.set({top:i}),this.config.showGuides&&this.drawHorizontalGuide(i,"".concat(i,"px"))),e.setCoords()}snapToObjects(e){let t=this.config.snapDistance,s=this.canvas.getObjects().filter(t=>t!==e&&t.visible),a=e.getBoundingRect(),r=a.left,l=a.left+a.width,i=a.top,n=a.top+a.height,o=r+a.width/2,c=i+a.height/2;for(let a of s){let s=a.getBoundingRect(),d=s.left,m=s.left+s.width,u=s.top,h=s.top+s.height,x=d+s.width/2,p=u+s.height/2;Math.abs(r-d)<t?(e.set({left:e.left+(d-r)}),this.drawVerticalGuide(d,"Alinhado \xe0 esquerda")):Math.abs(l-m)<t?(e.set({left:e.left+(m-l)}),this.drawVerticalGuide(m,"Alinhado \xe0 direita")):Math.abs(o-x)<t&&(e.set({left:e.left+(x-o)}),this.drawVerticalGuide(x,"Centro alinhado")),Math.abs(i-u)<t?(e.set({top:e.top+(u-i)}),this.drawHorizontalGuide(u,"Alinhado ao topo")):Math.abs(n-h)<t?(e.set({top:e.top+(h-n)}),this.drawHorizontalGuide(h,"Alinhado abaixo")):Math.abs(c-p)<t&&(e.set({top:e.top+(p-c)}),this.drawHorizontalGuide(p,"Centro alinhado"))}e.setCoords()}snapToCenter(e){let t=this.config.snapDistance,s=this.canvas.width,a=this.canvas.height,r=s/2,l=a/2,i=e.getBoundingRect(),n=i.left+i.width/2,o=i.top+i.height/2;Math.abs(n-r)<t&&(e.set({left:e.left+(r-n)}),this.drawVerticalGuide(r,"Centro do canvas")),Math.abs(o-l)<t&&(e.set({top:e.top+(l-o)}),this.drawHorizontalGuide(l,"Centro do canvas")),e.setCoords()}handleSnapDuringScale(e){if(!this.config.snapToGrid)return;let t=this.config.gridSize,s=(e.width||0)*(e.scaleX||1),a=(e.height||0)*(e.scaleY||1),r=Math.round(s/t)*t,l=Math.round(a/t)*t;Math.abs(s-r)<this.config.snapDistance&&e.set({scaleX:r/(e.width||1)}),Math.abs(a-l)<this.config.snapDistance&&e.set({scaleY:l/(e.height||1)}),e.setCoords()}drawVerticalGuide(e,t){if(!this.config.showGuides)return;let s=new null.Line([e,0,e,this.canvas.height],{stroke:"#FF0000",strokeWidth:1,strokeDashArray:[5,5],selectable:!1,evented:!1,excludeFromExport:!0});s.isGuide=!0,this.guides.push(s),this.canvas.add(s),this.canvas.renderAll(),setTimeout(()=>{this.canvas.remove(s),this.canvas.renderAll()},1e3)}drawHorizontalGuide(e,t){if(!this.config.showGuides)return;let s=new null.Line([0,e,this.canvas.width,e],{stroke:"#FF0000",strokeWidth:1,strokeDashArray:[5,5],selectable:!1,evented:!1,excludeFromExport:!0});s.isGuide=!0,this.guides.push(s),this.canvas.add(s),this.canvas.renderAll(),setTimeout(()=>{this.canvas.remove(s),this.canvas.renderAll()},1e3)}clearGuides(){this.canvas.getObjects().filter(e=>e.isGuide).forEach(e=>this.canvas.remove(e)),this.guides=[]}drawGrid(){var e,t,s,a;if(!this.config.enabled)return;let r=this.config.gridSize,l=this.canvas.width,i=this.canvas.height;this.removeGrid();for(let s=0;s<=l;s+=r){let a=new null.Line([s,0,s,i],{stroke:"#E5E7EB",strokeWidth:s%(5*r)==0?1:.5,selectable:!1,evented:!1,excludeFromExport:!0});a.isGridLine=!0,this.canvas.add(a),null===(e=(t=this.canvas).sendToBack)||void 0===e||e.call(t,a)}for(let e=0;e<=i;e+=r){let t=new null.Line([0,e,l,e],{stroke:"#E5E7EB",strokeWidth:e%(5*r)==0?1:.5,selectable:!1,evented:!1,excludeFromExport:!0});t.isGridLine=!0,this.canvas.add(t),null===(s=(a=this.canvas).sendToBack)||void 0===s||s.call(a,t)}this.canvas.renderAll()}removeGrid(){this.canvas.getObjects().filter(e=>e.isGridLine).forEach(e=>this.canvas.remove(e)),this.canvas.renderAll()}updateConfig(e){this.config={...this.config,...e},this.config.enabled&&this.config.snapToGrid?this.drawGrid():this.removeGrid()}alignSelected(e){let t=this.canvas.getActiveObjects();if(t.length<2)return;let s=t.map(e=>e.getBoundingRect());switch(e){case"left":let a=Math.min(...s.map(e=>e.left));t.forEach((e,t)=>{e.set({left:e.left+(a-s[t].left)})});break;case"right":let r=Math.max(...s.map(e=>e.left+e.width));t.forEach((e,t)=>{let a=s[t].left+s[t].width;e.set({left:e.left+(r-a)})});break;case"center-h":let l=s.reduce((e,t)=>e+t.left+t.width/2,0)/s.length;t.forEach((e,t)=>{let a=s[t].left+s[t].width/2;e.set({left:e.left+(l-a)})});break;case"top":let i=Math.min(...s.map(e=>e.top));t.forEach((e,t)=>{e.set({top:e.top+(i-s[t].top)})});break;case"bottom":let n=Math.max(...s.map(e=>e.top+e.height));t.forEach((e,t)=>{let a=s[t].top+s[t].height;e.set({top:e.top+(n-a)})});break;case"center-v":let o=s.reduce((e,t)=>e+t.top+t.height/2,0)/s.length;t.forEach((e,t)=>{let a=s[t].top+s[t].height/2;e.set({top:e.top+(o-a)})})}t.forEach(e=>e.setCoords()),t.forEach(e=>{this.canvas.fire("object:modified",{target:e})}),this.canvas.renderAll()}distributeSelected(e){let t=this.canvas.getActiveObjects();if(t.length<3)return;let s=t.map(e=>e.getBoundingRect());if("horizontal"===e){let e=t.map((e,t)=>({obj:e,bounds:s[t]})).sort((e,t)=>e.bounds.left-t.bounds.left),a=e[0].bounds,r=(e[e.length-1].bounds.left-a.left-e.slice(1,-1).reduce((e,t)=>e+t.bounds.width,0))/(e.length-1),l=a.left+a.width;for(let t=1;t<e.length-1;t++){let s=(l+=r)-e[t].bounds.left;e[t].obj.set({left:e[t].obj.left+s}),e[t].obj.setCoords(),l+=e[t].bounds.width}}else{let e=t.map((e,t)=>({obj:e,bounds:s[t]})).sort((e,t)=>e.bounds.top-t.bounds.top),a=e[0].bounds,r=(e[e.length-1].bounds.top-a.top-e.slice(1,-1).reduce((e,t)=>e+t.bounds.height,0))/(e.length-1),l=a.top+a.height;for(let t=1;t<e.length-1;t++){let s=(l+=r)-e[t].bounds.top;e[t].obj.set({top:e[t].obj.top+s}),e[t].obj.setCoords(),l+=e[t].bounds.height}}t.forEach(e=>{e.setCoords(),this.canvas.fire("object:modified",{target:e})}),this.canvas.renderAll()}constructor(e,t={}){this.guides=[],this.canvas=e,this.config={enabled:!1!==t.enabled,gridSize:t.gridSize||20,snapToGrid:!1!==t.snapToGrid,snapToObjects:!1!==t.snapToObjects,snapToCenter:!1!==t.snapToCenter,snapDistance:t.snapDistance||10,showGuides:!1!==t.showGuides},this.setupListeners()}}class F{async init(e,t){if(this.fabric=await M(),!this.fabric)throw Error("Failed to load Fabric.js");this.canvas=new this.fabric.Canvas(e,{width:t.width,height:t.height,backgroundColor:t.backgroundColor||"#FFFFFF",selection:!1!==t.selection,preserveObjectStacking:!1!==t.preserveObjectStacking,renderOnAddRemove:!0,enableRetinaScaling:!0,stopContextMenu:!0}),this.setupEventListeners(),console.log("✅ Fabric Canvas inicializado:",t.width,"x",t.height)}setupEventListeners(){this.canvas&&(this.canvas.on("selection:created",e=>{let t=this.getSelectedElementIds(e.selected||[]);this.notifySelectionChange(t)}),this.canvas.on("selection:updated",e=>{let t=this.getSelectedElementIds(e.selected||[]);this.notifySelectionChange(t)}),this.canvas.on("selection:cleared",()=>{this.notifySelectionChange([])}),this.canvas.on("object:modified",e=>{if(e.target){let t=e.target.customId;if(t){let s=this.extractObjectChanges(e.target);this.notifyModification(t,s)}}}),this.canvas.on("object:moving",e=>{e.target&&this.handleSnapping(e.target)}),this.canvas.on("mouse:down",this.handleMouseDown))}async addTextElement(e){if(!this.canvas||!this.fabric)return;let t=new this.fabric.IText(e.content||"",{left:e.transform.x,top:e.transform.y,width:e.transform.width,fontSize:e.style.fontSize||18,fontFamily:e.style.fontFamily||"Arial",fill:e.style.color||"#000000",fontWeight:e.style.fontWeight||"normal",textAlign:e.style.textAlign||"left",angle:e.transform.rotation||0,selectable:!e.locked,evented:!e.locked,visible:!1!==e.visible,hasControls:!0,hasBorders:!0,transparentCorners:!1,cornerColor:"#4F46E5",cornerStyle:"circle",cornerSize:10,borderColor:"#4F46E5",borderScaleFactor:2});t.customId=e.id,t.customType="text",t.zIndex=e.zIndex,this.canvas.add(t),this.elements.set(e.id,{id:e.id,fabricObject:t,originalData:e}),this.canvas.renderAll()}async addImageElement(e){if(this.canvas&&this.fabric)try{let t=await this.fabric.Image.fromURL(e.src,{crossOrigin:"anonymous"});if(!t)throw Error("Falha ao carregar imagem");t.set({left:e.transform.x,top:e.transform.y,scaleX:e.transform.width/(t.width||1),scaleY:e.transform.height/(t.height||1),angle:e.transform.rotation||0,selectable:!e.locked,evented:!e.locked,visible:!1!==e.visible,hasControls:!0,hasBorders:!0,transparentCorners:!1,cornerColor:"#4F46E5",cornerStyle:"circle",cornerSize:10,borderColor:"#4F46E5",borderScaleFactor:2}),t.customId=e.id,t.customType="image",t.zIndex=e.zIndex,this.canvas.add(t),this.elements.set(e.id,{id:e.id,fabricObject:t,originalData:e}),this.canvas.renderAll()}catch(t){console.error("Falha ao carregar imagem:",e.src,t)}}async addShapeElement(e){var t,s,a;let r;if(!this.canvas)return;let l=null===(t=e.geometry)||void 0===t?void 0:t.type,i=null===(s=e.geometry)||void 0===s?void 0:s.preset;(r="preset"===l?this.createPresetShape(i,e):"custom"===l&&(null===(a=e.geometry)||void 0===a?void 0:a.path)?this.createPathShape(e.geometry.path,e):this.createPresetShape("rectangle",e)).customId=e.id,r.customType="shape",r.zIndex=e.zIndex,this.canvas.add(r),this.elements.set(e.id,{id:e.id,fabricObject:r,originalData:e}),this.canvas.renderAll()}createPresetShape(e,t){var s,a,r;if(!this.fabric)throw Error("Fabric not loaded");let l={left:t.transform.x,top:t.transform.y,width:t.transform.width,height:t.transform.height,angle:t.transform.rotation||0,fill:(null===(s=t.style.fill)||void 0===s?void 0:s.color)||"#CCCCCC",stroke:(null===(a=t.style.stroke)||void 0===a?void 0:a.color)||"#000000",strokeWidth:(null===(r=t.style.stroke)||void 0===r?void 0:r.width)||0,opacity:t.style.opacity||1,selectable:!t.locked,evented:!t.locked,visible:!1!==t.visible,hasControls:!0,hasBorders:!0,transparentCorners:!1,cornerColor:"#4F46E5",cornerStyle:"circle",cornerSize:10,borderColor:"#4F46E5",borderScaleFactor:2};switch(e){case"ellipse":case"circle":return new this.fabric.Circle({...l,radius:t.transform.width/2});default:return new this.fabric.Rect(l)}}createPathShape(e,t){var s,a,r;if(!this.fabric)throw Error("Fabric not loaded");return new this.fabric.Rect({left:t.transform.x,top:t.transform.y,angle:t.transform.rotation||0,fill:(null===(s=t.style.fill)||void 0===s?void 0:s.color)||"#CCCCCC",stroke:(null===(a=t.style.stroke)||void 0===a?void 0:a.color)||"#000000",strokeWidth:(null===(r=t.style.stroke)||void 0===r?void 0:r.width)||0,opacity:t.style.opacity||1,selectable:!t.locked,evented:!t.locked,visible:!1!==t.visible})}async addVideoElement(e){if(!this.canvas)return;if(e.src&&e.src.startsWith("data:video/")){let t=document.createElement("video");t.src=e.src,t.muted=!0;try{await new Promise((e,s)=>{t.onloadeddata=e,t.onerror=s,t.load()});let s=document.createElement("canvas");s.width=t.videoWidth||e.transform.width,s.height=t.videoHeight||e.transform.height;let a=s.getContext("2d");if(a){a.drawImage(t,0,0,s.width,s.height);let r=s.toDataURL("image/jpeg",.8);try{let t=await this.fabric.Image.fromURL(r,{crossOrigin:"anonymous"});if(t&&this.canvas){t.set({left:e.transform.x,top:e.transform.y,scaleX:e.transform.width/(t.width||1),scaleY:e.transform.height/(t.height||1),angle:e.transform.rotation||0,selectable:!e.locked,evented:!e.locked}),t.customId=e.id,t.customType="video",t.zIndex=e.zIndex,t.isVideoFrame=!0,this.canvas.add(t),this.elements.set(e.id,{id:e.id,fabricObject:t,originalData:e}),this.canvas.renderAll();return}}catch(e){console.warn("N\xe3o foi poss\xedvel gerar frame do v\xeddeo",e)}}}catch(e){console.warn("N\xe3o foi poss\xedvel carregar v\xeddeo, usando placeholder:",e)}}let t=new this.fabric.Rect({left:e.transform.x,top:e.transform.y,width:e.transform.width,height:e.transform.height,fill:"#1a1a1a",stroke:"#4F46E5",strokeWidth:3,angle:e.transform.rotation||0,selectable:!e.locked,evented:!e.locked,visible:!1!==e.visible,rx:8,ry:8}),s=new this.fabric.Rect({left:e.transform.x+e.transform.width/2-15,top:e.transform.y+e.transform.height/2-20,width:40,height:40,fill:"#4F46E5",angle:90,selectable:!1,evented:!1}),a=new this.fabric.IText("VIDEO",{left:e.transform.x+e.transform.width/2,top:e.transform.y+e.transform.height/2+30,fontSize:20,fill:"#9CA3AF",fontFamily:"Arial",originX:"center",originY:"center",selectable:!1,evented:!1}),r=new this.fabric.Group([t,s,a],{left:e.transform.x,top:e.transform.y,selectable:!e.locked,evented:!e.locked});r.customId=e.id,r.customType="video",r.zIndex=e.zIndex,this.canvas.add(r),this.elements.set(e.id,{id:e.id,fabricObject:r,originalData:e}),this.canvas.renderAll()}async addGroupElement(e){var t,s,a,r,l,i,n,o,c,d,m,u,h,x,p,g,f,v,b,y,j,N,w,k,C,S,E,I,z,D;if(!this.canvas||!e.children)return;let A=[];for(let v of e.children)if("text"===v.type&&v.content){let e=new this.fabric.IText(v.content,{left:null!==(i=null===(t=v.transform)||void 0===t?void 0:t.x)&&void 0!==i?i:0,top:null!==(n=null===(s=v.transform)||void 0===s?void 0:s.y)&&void 0!==n?n:0,width:null===(a=v.transform)||void 0===a?void 0:a.width,fontSize:(null===(r=v.style)||void 0===r?void 0:r.fontSize)||16,fill:(null===(l=v.style)||void 0===l?void 0:l.color)||"#000000",selectable:!1,evented:!1});e.customId=v.id,e.customType=v.type,A.push(e)}else if("shape"===v.type){let e=new this.fabric.Rect({left:null!==(x=null===(o=v.transform)||void 0===o?void 0:o.x)&&void 0!==x?x:0,top:null!==(p=null===(c=v.transform)||void 0===c?void 0:c.y)&&void 0!==p?p:0,width:null!==(g=null===(d=v.transform)||void 0===d?void 0:d.width)&&void 0!==g?g:100,height:null!==(f=null===(m=v.transform)||void 0===m?void 0:m.height)&&void 0!==f?f:100,fill:(null===(h=v.style)||void 0===h?void 0:null===(u=h.fill)||void 0===u?void 0:u.color)||"#CCCCCC",selectable:!1,evented:!1});e.customId=v.id,e.customType=v.type,A.push(e)}if(A.length>0){let t=T.createGroup(this.canvas,A);t&&(t.set({left:null!==(w=null===(v=e.transform)||void 0===v?void 0:v.x)&&void 0!==w?w:t.left,top:null!==(k=null===(b=e.transform)||void 0===b?void 0:b.y)&&void 0!==k?k:t.top,angle:null!==(S=null!==(C=null===(y=e.transform)||void 0===y?void 0:y.rotation)&&void 0!==C?C:t.angle)&&void 0!==S?S:0,scaleX:null!==(I=null!==(E=null===(j=e.transform)||void 0===j?void 0:j.scaleX)&&void 0!==E?E:t.scaleX)&&void 0!==I?I:1,scaleY:null!==(D=null!==(z=null===(N=e.transform)||void 0===N?void 0:N.scaleY)&&void 0!==z?z:t.scaleY)&&void 0!==D?D:1}),t.setCoords(),t.customId=e.id,t.customType="group",t.zIndex=e.zIndex,this.elements.set(e.id,{id:e.id,fabricObject:t,originalData:e}))}}async loadSlideElements(e){if(this.canvas){for(let t of(this.clear(),[...e].sort((e,t)=>e.zIndex-t.zIndex)))try{switch(t.type){case"text":await this.addTextElement(t);break;case"image":await this.addImageElement(t);break;case"shape":await this.addShapeElement(t);break;case"video":await this.addVideoElement(t);break;case"group":t.children&&t.children.length>0&&await this.addGroupElement(t)}}catch(e){console.error("Erro ao adicionar elemento ".concat(t.id,":"),e)}console.log("✅ ".concat(e.length," elementos carregados no canvas"))}}clear(){var e;this.canvas&&(this.canvas.clear(),this.elements.clear(),this.canvas.backgroundColor="#FFFFFF",this.canvas.renderAll(),null===(e=this.snapSystem)||void 0===e||e.removeGrid())}getSelectedElementIds(e){return e.map(e=>e.customId).filter(Boolean)}extractObjectChanges(e){return{x:e.left,y:e.top,width:e.width?e.width*(e.scaleX||1):void 0,height:e.height?e.height*(e.scaleY||1):void 0,rotation:e.angle,scaleX:e.scaleX,scaleY:e.scaleY}}getObjectSnapshot(e){var t,s,a,r,l;let i="function"==typeof e.getScaledWidth?e.getScaledWidth():(e.width||0)*(e.scaleX||1),n="function"==typeof e.getScaledHeight?e.getScaledHeight():(e.height||0)*(e.scaleY||1);return{x:null!==(t=e.left)&&void 0!==t?t:0,y:null!==(s=e.top)&&void 0!==s?s:0,width:i,height:n,rotation:null!==(a=e.angle)&&void 0!==a?a:0,scaleX:null!==(r=e.scaleX)&&void 0!==r?r:1,scaleY:null!==(l=e.scaleY)&&void 0!==l?l:1}}cloneData(e){return"function"==typeof globalThis.structuredClone?globalThis.structuredClone(e):JSON.parse(JSON.stringify(e))}handleSnapping(e){var t,s;let a=(null===(t=this.canvas)||void 0===t?void 0:t.width)||0,r=(null===(s=this.canvas)||void 0===s?void 0:s.height)||0;10>Math.abs(e.left)&&e.set({left:0}),10>Math.abs(e.top)&&e.set({top:0});let l=e.left+e.width*(e.scaleX||1)/2,i=e.top+e.height*(e.scaleY||1)/2,n=a/2,o=r/2;10>Math.abs(l-n)&&e.set({left:n-e.width*(e.scaleX||1)/2}),10>Math.abs(i-o)&&e.set({top:o-e.height*(e.scaleY||1)/2})}onSelectionChange(e){this.selectionCallbacks.push(e)}onModification(e){this.modificationCallbacks.push(e)}notifySelectionChange(e){this.selectionCallbacks.forEach(t=>t(e))}notifyModification(e,t){this.modificationCallbacks.forEach(s=>s(e,t))}notifyContextMenu(e){this.contextMenuCallbacks.forEach(t=>t(e))}toDataURL(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"png",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.canvas?this.canvas.toDataURL({format:e,quality:t,multiplier:1}):""}destroy(){this.canvas&&("function"==typeof this.canvas.off&&this.canvas.off("mouse:down",this.handleMouseDown),this.canvas.dispose(),this.canvas=null),this.elements.clear(),this.selectionCallbacks=[],this.modificationCallbacks=[],this.snapSystem=null,this.contextMenuCallbacks.clear()}getCanvas(){return this.canvas}selectElement(e){let t=this.elements.get(e);t&&this.canvas&&(this.canvas.setActiveObject(t.fabricObject),this.canvas.renderAll())}deselectAll(){this.canvas&&(this.canvas.discardActiveObject(),this.canvas.renderAll())}groupSelected(){if(!this.canvas)return null;let e=this.canvas.getActiveObjects();if(!e||e.length<2)return null;let t=e.map(e=>e.customId).filter(Boolean);if(!t.length)return null;let s=t.map(e=>this.elements.get(e)).filter(Boolean),a={};e.forEach(e=>{let t=e.customId;t&&(a[t]=this.getObjectSnapshot(e))});let r=T.createGroup(this.canvas,e);if(!r)return null;let l="group-".concat(Date.now());r.customId=l,r.customType="group";let i=this.getObjectSnapshot(r),n=s.map(e=>{let t=e.originalData?this.cloneData(e.originalData):{id:e.id},s=a[e.id];return{...t,transform:{...(null==t?void 0:t.transform)||{},...s}}}),o={id:l,type:"group",content:null,transform:i,zIndex:Math.max(...n.map(e=>{var t;return null!==(t=e.zIndex)&&void 0!==t?t:0}),0)+1,visible:!0,locked:!1,children:n,style:{position:{x:i.x,y:i.y,width:i.width,height:i.height},rotation:i.rotation}};return t.forEach(e=>this.elements.delete(e)),this.elements.set(l,{id:l,fabricObject:r,originalData:o}),this.canvas.renderAll(),{groupId:l,childIds:t,groupElement:o,childElements:n}}ungroupSelected(){if(!this.canvas)return null;let e=this.canvas.getActiveObject();if(!e||!T.isGroup(e))return null;let t=e.customId,s=t?this.elements.get(t):null,a=null==s?void 0:s.originalData,r=T.ungroupElements(this.canvas,e).map(e=>{var t;let s=e.customId,r=this.getObjectSnapshot(e),l=null==a?void 0:null===(t=a.children)||void 0===t?void 0:t.find(e=>e.id===s),i=l?this.cloneData(l):{id:s,type:e.customType||"unknown",content:e.text||null,visible:!0,locked:!1},n={...i,transform:{...(null==i?void 0:i.transform)||{},...r}};return s&&this.elements.set(s,{id:s,fabricObject:e,originalData:n}),n});return t&&this.elements.delete(t),this.canvas.renderAll(),{groupId:t,ungroupedElements:r}}updateZIndex(e,t){let s=this.elements.get(e);s&&this.canvas&&-1!==this.canvas.getObjects().indexOf(s.fabricObject)&&(s.fabricObject.moveTo(t),this.canvas.renderAll())}toggleVisibility(e){let t=this.elements.get(e);t&&this.canvas&&(t.fabricObject.set({visible:!t.fabricObject.visible}),this.canvas.renderAll())}toggleLock(e){let t=this.elements.get(e);if(!t||!this.canvas)return;let s=!t.fabricObject.selectable;t.fabricObject.set({selectable:!s,evented:!s}),this.canvas.renderAll()}configureSnapGuides(e){this.canvas&&(this.snapSystem?this.snapSystem.updateConfig(e):this.snapSystem=new O(this.canvas,e),!1===e.enabled?this.snapSystem.removeGrid():e.snapToGrid?this.snapSystem.drawGrid():!1===e.snapToGrid&&this.snapSystem.removeGrid())}alignSelected(e){var t;null===(t=this.snapSystem)||void 0===t||t.alignSelected(e)}distributeSelected(e){var t;null===(t=this.snapSystem)||void 0===t||t.distributeSelected(e)}onContextMenu(e){return this.contextMenuCallbacks.add(e),()=>{this.contextMenuCallbacks.delete(e)}}constructor(){this.canvas=null,this.elements=new Map,this.selectionCallbacks=[],this.modificationCallbacks=[],this.snapSystem=null,this.fabric=null,this.contextMenuCallbacks=new Set,this.handleMouseDown=e=>{var t,s;if(!this.canvas)return;let a=null==e?void 0:e.e;if(!a||2!==a.button)return;a.preventDefault(),a.stopPropagation();let r=e.target,l=r?r.customId:void 0,i=r?r.customType:void 0,n=this.getSelectedElementIds((null===(t=(s=this.canvas).getActiveObjects)||void 0===t?void 0:t.call(s))||[]);r&&l&&!n.includes(l)&&"function"==typeof this.canvas.setActiveObject&&(this.canvas.setActiveObject(r),this.canvas.renderAll(),n=[l],this.notifySelectionChange(n));let o=this.canvas.getPointer(a,!0);this.notifyContextMenu({clientPosition:{x:a.clientX,y:a.clientY},canvasPosition:o?{x:o.x,y:o.y}:void 0,targetElementId:l,targetElementType:i,selectedElementIds:n})}}}function B(e){let{slide:t,width:s=1920,height:r=1080,onElementUpdate:l,onSelectionChange:i,selectedElementIds:n=[],gridEnabled:o=!1,gridSize:c=20,snapEnabled:d=!0,onManagerReady:m,onContextMenu:u}=e,x=(0,h.useRef)(null),p=(0,h.useRef)(null),[g,f]=(0,h.useState)(!0),[v,b]=(0,h.useState)(null),y=(0,h.useRef)(!1),j=(0,h.useRef)(!1),N=(0,h.useRef)(l),w=(0,h.useRef)(i),k=(0,h.useRef)(m),C=(0,h.useRef)(u),S=(0,h.useRef)(null),E=(0,h.useCallback)(e=>{var t;null===(t=C.current)||void 0===t||t.call(C,e)},[]);return((0,h.useEffect)(()=>{N.current=l},[l]),(0,h.useEffect)(()=>{w.current=i},[i]),(0,h.useEffect)(()=>{k.current=m},[m]),(0,h.useEffect)(()=>{C.current=u},[u]),(0,h.useEffect)(()=>{if(!x.current||y.current)return;let e=!0;return y.current=!0,(async()=>{try{var t,a;let l=new F;if(await l.init(x.current,{width:s,height:r,backgroundColor:"#FFFFFF",selection:!0,preserveObjectStacking:!0}),!e){l.destroy();return}w.current&&l.onSelectionChange(w.current),N.current&&l.onModification(N.current),p.current=l,null===(t=S.current)||void 0===t||t.call(S),S.current=l.onContextMenu(E),f(!1),null===(a=k.current)||void 0===a||a.call(k,l)}catch(t){console.error("Failed to initialize canvas:",t),e&&(b("Erro ao inicializar canvas"),f(!1))}})(),()=>{var t,s;e=!1,p.current&&(p.current.destroy(),p.current=null,null===(s=k.current)||void 0===s||s.call(k,null)),null===(t=S.current)||void 0===t||t.call(S),S.current=null,y.current=!1}},[s,r,E]),(0,h.useEffect)(()=>{let e=p.current;e&&w.current&&e.onSelectionChange(w.current)},[i]),(0,h.useEffect)(()=>{let e=p.current;e&&N.current&&e.onModification(N.current)},[l]),(0,h.useEffect)(()=>{let e=p.current;e&&e.configureSnapGuides({enabled:d||o,snapToGrid:!!o,snapToObjects:!!d,gridSize:c,showGuides:!0})},[o,c,d]),(0,h.useEffect)(()=>{let e=p.current;e&&!j.current&&(async()=>{try{var s;j.current=!0,f(!0),b(null);let a=null!==(s=null==t?void 0:t.elements)&&void 0!==s?s:[];if(0===a.length){e.clear(),f(!1),j.current=!1;return}await e.loadSlideElements(a),f(!1),j.current=!1}catch(e){console.error("Erro ao carregar elementos do slide:",e),b(e instanceof Error?e.message:"Erro desconhecido ao carregar elementos"),f(!1),j.current=!1}})()},[t]),(0,h.useEffect)(()=>{let e=p.current;if(e){if(!n||0===n.length){e.deselectAll();return}1===n.length&&e.selectElement(n[0])}},[n]),v)?(0,a.jsx)("div",{className:"flex items-center justify-center w-full h-full bg-red-50 border border-red-200 rounded",children:(0,a.jsxs)("div",{className:"text-center p-4",children:[(0,a.jsx)("p",{className:"text-red-600 font-medium",children:"Erro no Canvas"}),(0,a.jsx)("p",{className:"text-sm text-red-500 mt-1",children:v})]})}):(0,a.jsxs)("div",{className:"relative w-full h-full flex items-center justify-center bg-gray-100",children:[g&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-white/80 z-10",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Carregando elementos..."})]})}),(0,a.jsxs)("div",{className:"relative shadow-2xl",children:[(0,a.jsx)("canvas",{ref:x,className:"border border-gray-300 bg-white",style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}}),o&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"absolute top-0 left-0 right-0 h-6 bg-gray-200 border-b border-gray-400 text-xs"}),(0,a.jsx)("div",{className:"absolute top-0 left-0 bottom-0 w-6 bg-gray-200 border-r border-gray-400 text-xs"})]})]}),(0,a.jsxs)("div",{className:"absolute top-4 left-4 flex gap-2 bg-white rounded-lg shadow-lg p-2",children:[(0,a.jsx)("button",{className:"p-2 hover:bg-gray-100 rounded transition-colors",title:"Deselecionar tudo",onClick:()=>{var e;return null===(e=p.current)||void 0===e?void 0:e.deselectAll()},children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,a.jsx)("button",{className:"p-2 hover:bg-gray-100 rounded transition-colors",title:"Exportar como imagem",onClick:()=>{var e;let s=null===(e=p.current)||void 0===e?void 0:e.toDataURL("png",1);if(!s)return;let a=document.createElement("a");a.download="slide-".concat((null==t?void 0:t.slideNumber)||"preview",".png"),a.href=s,a.click()},children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})})]})]})}var P=s(5805);function Z(e){let{connected:t,users:s}=e;return(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(t?"bg-green-500":"bg-gray-400")}),(0,a.jsx)("span",{className:"text-xs text-gray-600",children:t?"Online":"Offline"})]}),s.length>0&&(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(P.Z,{className:"w-4 h-4 text-gray-600"}),(0,a.jsx)("span",{className:"text-xs text-gray-600",children:s.length}),(0,a.jsxs)("div",{className:"flex -space-x-2",children:[s.slice(0,3).map(e=>(0,a.jsx)("div",{className:"w-6 h-6 rounded-full border-2 border-white flex items-center justify-center text-xs font-medium text-white",style:{backgroundColor:e.color},title:e.name,children:e.name.charAt(0).toUpperCase()},e.id)),s.length>3&&(0,a.jsxs)("div",{className:"w-6 h-6 rounded-full border-2 border-white bg-gray-400 flex items-center justify-center text-xs font-medium text-white",children:["+",s.length-3]})]})]})]})}var R=s(2718),L=s(4743),G=s(401);class U{addComment(e){let t={...e,id:"comment-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),createdAt:new Date,resolved:!1,replies:[]},s=this.comments.get(e.projectId)||[];return s.push(t),this.comments.set(e.projectId,s),console.log("[CommentSystem] Comment added: ".concat(t.id)),t}addReply(e,t){for(let[s,a]of this.comments.entries()){let r=a.find(t=>t.id===e);if(r){let l={...t,id:"reply-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),createdAt:new Date,resolved:!1,replies:[]};return r.replies.push(l),this.comments.set(s,a),console.log("[CommentSystem] Reply added to ".concat(e)),l}}return null}listComments(e,t){let s=this.comments.get(e)||[];return(null==t?void 0:t.slideId)&&(s=s.filter(e=>e.slideId===t.slideId)),(null==t?void 0:t.elementId)&&(s=s.filter(e=>e.elementId===t.elementId)),(null==t?void 0:t.resolved)!==void 0&&(s=s.filter(e=>e.resolved===t.resolved)),s.sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime())}resolveComment(e){for(let[t,s]of this.comments.entries()){let a=s.find(t=>t.id===e);if(a)return a.resolved=!0,this.comments.set(t,s),console.log("[CommentSystem] Comment resolved: ".concat(e)),!0}return!1}editComment(e,t){for(let[s,a]of this.comments.entries()){let r=a.find(t=>t.id===e);if(r)return r.content=t,r.updatedAt=new Date,this.comments.set(s,a),!0}return!1}deleteComment(e){for(let[t,s]of this.comments.entries()){let a=s.findIndex(t=>t.id===e);if(-1!==a)return s.splice(a,1),this.comments.set(t,s),console.log("[CommentSystem] Comment deleted: ".concat(e)),!0}return!1}countUnresolved(e){let t=this.listComments(e,{resolved:!1});return t.length+t.reduce((e,t)=>e+t.replies.filter(e=>!e.resolved).length,0)}constructor(){this.comments=new Map}}let V=new U;function Y(e){let{projectId:t,slideId:s,currentUser:r}=e,[l,i]=(0,h.useState)([]),[n,d]=(0,h.useState)(""),[m,u]=(0,h.useState)(!1),x=()=>{i(V.listComments(t,{slideId:s}))},p=e=>{V.resolveComment(e),x()},v=e=>{confirm("Deseja realmente deletar este coment\xe1rio?")&&(V.deleteComment(e),x())},b=e=>new Intl.RelativeTimeFormat("pt-BR",{numeric:"auto"}).format(Math.ceil((new Date(e).getTime()-Date.now())/864e5),"day");return(0,a.jsxs)(o.Zb,{children:[(0,a.jsx)(o.Ol,{children:(0,a.jsxs)(o.ll,{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)(R.Z,{className:"w-4 h-4"}),"Coment\xe1rios",s&&(0,a.jsxs)(c.C,{variant:"outline",className:"text-xs",children:["Slide ",s]})]})}),(0,a.jsxs)(o.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("textarea",{value:n,onChange:e=>d(e.target.value),placeholder:"Adicione um coment\xe1rio...",className:"w-full p-2 text-sm border rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3}),(0,a.jsx)("div",{className:"flex items-center justify-end gap-2",children:(0,a.jsxs)(f.z,{size:"sm",onClick:()=>{n.trim()&&(u(!0),V.addComment({projectId:t,slideId:s,author:r,content:n}),d(""),x(),u(!1))},disabled:!n.trim()||m,children:[(0,a.jsx)(L.Z,{className:"w-3 h-3 mr-1"}),"Comentar"]})})]}),(0,a.jsx)("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:0===l.length?(0,a.jsx)("p",{className:"text-sm text-gray-500 text-center py-8",children:"Nenhum coment\xe1rio ainda. Seja o primeiro!"}):l.map(e=>(0,a.jsx)("div",{className:"p-3 rounded-lg border ".concat(e.resolved?"bg-green-50 border-green-200":"bg-gray-50 border-gray-200"),children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center text-white text-xs font-medium flex-shrink-0",children:e.author.name.charAt(0).toUpperCase()}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.author.name}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:b(e.createdAt)}),e.resolved&&(0,a.jsxs)(c.C,{className:"text-xs bg-green-600",children:[(0,a.jsx)(G.Z,{className:"w-3 h-3 mr-1"}),"Resolvido"]})]}),(0,a.jsx)("p",{className:"text-sm text-gray-700",children:e.content}),e.replies.length>0&&(0,a.jsx)("div",{className:"mt-3 ml-4 space-y-2",children:e.replies.map(e=>(0,a.jsxs)("div",{className:"p-2 bg-white rounded border border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)("span",{className:"text-xs font-medium text-gray-900",children:e.author.name}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:b(e.createdAt)})]}),(0,a.jsx)("p",{className:"text-xs text-gray-700",children:e.content})]},e.id))})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",children:[!e.resolved&&(0,a.jsx)(f.z,{size:"sm",variant:"ghost",onClick:()=>p(e.id),title:"Resolver",className:"h-6 w-6 p-0",children:(0,a.jsx)(G.Z,{className:"w-3 h-3 text-green-600"})}),e.author.id===r.id&&(0,a.jsx)(f.z,{size:"sm",variant:"ghost",onClick:()=>v(e.id),title:"Deletar",className:"h-6 w-6 p-0 text-red-600",children:(0,a.jsx)(g.Z,{className:"w-3 h-3"})})]})]})},e.id))})]})]})}var _=s(1817),X=s(9322),K=s(1671),q=s(4747),W=s(6916);function H(e){let{isSaving:t,lastSaved:s,error:r,className:l}=e;if(t)return(0,a.jsxs)(c.C,{variant:"secondary",className:(0,E.cn)("flex items-center gap-2",l),children:[(0,a.jsx)(_.Z,{className:"w-3 h-3 animate-spin"}),(0,a.jsx)("span",{className:"text-xs",children:"Salvando..."})]});if(r)return(0,a.jsxs)(c.C,{variant:"destructive",className:(0,E.cn)("flex items-center gap-2",l),children:[(0,a.jsx)(X.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{className:"text-xs",children:"Erro ao salvar"})]});if(s){let e=(0,q.Q)(s,{addSuffix:!0,locale:W.F});return(0,a.jsxs)(c.C,{variant:"outline",className:(0,E.cn)("flex items-center gap-2 border-green-200 bg-green-50 text-green-700",l),children:[(0,a.jsx)(K.Z,{className:"w-3 h-3"}),(0,a.jsxs)("span",{className:"text-xs",children:["Salvo ",e]})]})}return(0,a.jsxs)(c.C,{variant:"outline",className:(0,E.cn)("flex items-center gap-2 border-gray-200",l),children:[(0,a.jsx)(i.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{className:"text-xs",children:"N\xe3o salvo"})]})}var J=s(1905),Q=s(8867);function $(e){let{slides:t,currentSlideIndex:s,onSlideSelect:r,onReorder:l,onDuplicate:i,onDelete:n}=e,[o,d]=(0,h.useState)(null),[m,u]=(0,h.useState)(null),x=(e,t)=>{d(t),e.dataTransfer.effectAllowed="move"},p=(e,t)=>{e.preventDefault(),e.dataTransfer.dropEffect="move",u(t)},v=()=>{u(null)},b=(e,t)=>{e.preventDefault(),null!==o&&o!==t&&l(o,t),d(null),u(null)},y=()=>{d(null),u(null)};return(0,a.jsx)("div",{className:"space-y-3",children:t.map((e,l)=>(0,a.jsxs)("div",{draggable:!0,onDragStart:e=>x(e,l),onDragOver:e=>p(e,l),onDragLeave:v,onDrop:e=>b(e,l),onDragEnd:y,className:"\n            rounded-lg cursor-move transition-all p-2 relative\n            ".concat(l===s?"bg-blue-600 ring-2 ring-blue-400":"bg-gray-800 hover:bg-gray-700","\n            ").concat(o===l?"opacity-50 scale-95":"","\n            ").concat(m===l&&o!==l?"ring-2 ring-green-400":"","\n          "),children:[(0,a.jsx)("div",{className:"absolute left-1 top-1/2 -translate-y-1/2",children:(0,a.jsx)(J.Z,{className:"w-4 h-4 text-gray-500"})}),(0,a.jsxs)("div",{className:"pl-6",onClick:()=>r(l),children:[(0,a.jsx)("div",{className:"aspect-video bg-gray-900 rounded mb-2 overflow-hidden",children:e.thumbnail?(0,a.jsx)("img",{src:e.thumbnail,alt:e.title||"Slide ".concat(l+1),className:"w-full h-full object-cover"}):(0,a.jsxs)("div",{className:"flex items-center justify-center h-full text-gray-600 text-xs",children:["Slide ",e.slideNumber||l+1]})}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-xs font-medium truncate ".concat(l===s?"text-white":"text-gray-300"),children:e.title||"Slide ".concat(e.slideNumber||l+1)}),(0,a.jsxs)("p",{className:"text-xs ".concat(l===s?"text-blue-200":"text-gray-500"),children:[e.duration||5,"s"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(f.z,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0",onClick:e=>{e.stopPropagation(),i(l)},children:(0,a.jsx)(Q.Z,{className:"w-3 h-3"})}),t.length>1&&(0,a.jsx)(f.z,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 text-red-500 hover:text-red-600",onClick:e=>{e.stopPropagation(),n(l)},children:(0,a.jsx)(g.Z,{className:"w-3 h-3"})})]})]})]}),o===l&&(0,a.jsx)(c.C,{className:"absolute top-2 right-2 bg-yellow-500 text-xs",children:"Movendo..."})]},e.id||l))})}var ee=s(4719),et=s(2489);class es{register(e){let t=this.getShortcutKey(e);this.shortcuts.set(t,e)}unregister(e){this.shortcuts.delete(e)}clear(){this.shortcuts.clear()}setEnabled(e){this.enabled=e}handleKeyDown(e){if(!this.enabled)return!1;let t=this.getKeyFromEvent(e),s=this.shortcuts.get(t);return!!s&&(e.preventDefault(),s.action(),!0)}list(){return Array.from(this.shortcuts.values())}listByCategory(e){return this.list().filter(t=>t.category===e)}getShortcutString(e){let t=[];return e.ctrl&&t.push("Ctrl"),e.shift&&t.push("Shift"),e.alt&&t.push("Alt"),e.meta&&t.push("Cmd"),t.push(e.key.toUpperCase()),t.join(" + ")}getShortcutKey(e){return"".concat(e.ctrl?"ctrl+":"").concat(e.shift?"shift+":"").concat(e.alt?"alt+":"").concat(e.meta?"meta+":"").concat(e.key.toLowerCase())}getKeyFromEvent(e){return"".concat(e.ctrlKey?"ctrl+":"").concat(e.shiftKey?"shift+":"").concat(e.altKey?"alt+":"").concat(e.metaKey?"meta+":"").concat(e.key.toLowerCase())}constructor(){this.shortcuts=new Map,this.enabled=!0}}let ea=new es,er={UNDO:{key:"z",ctrl:!0,description:"Desfazer",category:"editor"},REDO:{key:"y",ctrl:!0,description:"Refazer",category:"editor"},REDO_ALT:{key:"z",ctrl:!0,shift:!0,description:"Refazer (alternativo)",category:"editor"},SAVE:{key:"s",ctrl:!0,description:"Salvar",category:"editor"},DUPLICATE:{key:"d",ctrl:!0,description:"Duplicar",category:"editor"},DELETE:{key:"Delete",description:"Deletar",category:"editor"},SELECT_ALL:{key:"a",ctrl:!0,description:"Selecionar tudo",category:"editor"},NEXT_SLIDE:{key:"ArrowRight",description:"Pr\xf3ximo slide",category:"navigation"},PREV_SLIDE:{key:"ArrowLeft",description:"Slide anterior",category:"navigation"},FIRST_SLIDE:{key:"Home",description:"Primeiro slide",category:"navigation"},LAST_SLIDE:{key:"End",description:"\xdaltimo slide",category:"navigation"},PLAY_PAUSE:{key:" ",description:"Play/Pause",category:"navigation"},COPY:{key:"c",ctrl:!0,description:"Copiar",category:"tools"},PASTE:{key:"v",ctrl:!0,description:"Colar",category:"tools"},CUT:{key:"x",ctrl:!0,description:"Cortar",category:"tools"},ZOOM_IN:{key:"=",ctrl:!0,description:"Zoom +",category:"view"},ZOOM_OUT:{key:"-",ctrl:!0,description:"Zoom -",category:"view"},ZOOM_RESET:{key:"0",ctrl:!0,description:"Zoom 100%",category:"view"},TOGGLE_GRID:{key:"g",ctrl:!0,description:"Mostrar/Ocultar Grid",category:"view"},FULLSCREEN:{key:"f11",description:"Tela cheia",category:"view"}};function el(){let[e,t]=(0,h.useState)(!1),s=Object.entries(er).map(e=>{let[t,s]=e;return{id:t,...s}}),r=Object.entries({editor:"Editor",navigation:"Navega\xe7\xe3o",tools:"Ferramentas",view:"Visualiza\xe7\xe3o"}).map(e=>{let[t,a]=e;return{category:t,label:a,items:s.filter(e=>e.category===t)}});return e?(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,a.jsxs)(o.Zb,{className:"w-full max-w-2xl max-h-[80vh] overflow-hidden",children:[(0,a.jsxs)(o.Ol,{className:"flex flex-row items-center justify-between",children:[(0,a.jsxs)(o.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(ee.Z,{className:"w-5 h-5"}),"Atalhos de Teclado"]}),(0,a.jsx)("button",{onClick:()=>t(!1),className:"p-1 hover:bg-gray-100 rounded",children:(0,a.jsx)(et.Z,{className:"w-5 h-5"})})]}),(0,a.jsx)(o.aY,{className:"overflow-y-auto max-h-[calc(80vh-80px)]",children:(0,a.jsx)("div",{className:"space-y-6",children:r.map(e=>(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-gray-700 mb-3",children:e.label}),(0,a.jsx)("div",{className:"space-y-2",children:e.items.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[(0,a.jsx)("span",{className:"text-sm text-gray-700",children:e.description}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[e.ctrl&&(0,a.jsx)(c.C,{variant:"outline",className:"text-xs px-2",children:"Ctrl"}),e.shift&&(0,a.jsx)(c.C,{variant:"outline",className:"text-xs px-2",children:"Shift"}),e.alt&&(0,a.jsx)(c.C,{variant:"outline",className:"text-xs px-2",children:"Alt"}),e.meta&&(0,a.jsx)(c.C,{variant:"outline",className:"text-xs px-2",children:"Cmd"}),(0,a.jsx)(c.C,{variant:"outline",className:"text-xs px-2 font-mono",children:" "===e.key?"Space":e.key})]})]},e.id))})]},e.category))})})]})}):(0,a.jsxs)(f.z,{size:"sm",variant:"outline",onClick:()=>t(!0),className:"fixed bottom-4 right-4 z-50",children:[(0,a.jsx)(ee.Z,{className:"w-4 h-4 mr-2"}),"Atalhos"]})}var ei=s(2023);function en(e){var t;let{onApply:s}=e,[r,l]=(0,h.useState)([]),[i,n]=(0,h.useState)("fade"),[d,m]=(0,h.useState)(!0);(0,h.useEffect)(()=>{u()},[]);let u=async()=>{try{let e=await fetch("/api/transitions/list"),t=await e.json();t.success&&l(t.transitions)}catch(e){console.error("Erro ao carregar transi\xe7\xf5es:",e)}finally{m(!1)}};return(0,a.jsxs)(o.Zb,{children:[(0,a.jsx)(o.Ol,{children:(0,a.jsxs)(o.ll,{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)(ei.Z,{className:"w-4 h-4"}),"Transi\xe7\xf5es"]})}),(0,a.jsx)(o.aY,{className:"space-y-3",children:d?(0,a.jsx)("p",{className:"text-xs text-gray-500 text-center py-4",children:"Carregando..."}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"grid grid-cols-2 gap-2",children:r.map(e=>(0,a.jsx)("button",{onClick:()=>n(e.type),className:"\n                    p-2 rounded text-xs font-medium transition\n                    ".concat(i===e.type?"bg-blue-600 text-white":"bg-gray-100 hover:bg-gray-200","\n                  "),children:e.name},e.type))}),i&&(0,a.jsxs)("div",{className:"pt-2 border-t",children:[r.find(e=>e.type===i)&&(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-xs text-gray-600",children:"Dura\xe7\xe3o:"}),(0,a.jsxs)(c.C,{variant:"outline",className:"text-xs",children:[null===(t=r.find(e=>e.type===i))||void 0===t?void 0:t.duration,"s"]})]}),(0,a.jsx)(f.z,{size:"sm",className:"w-full",onClick:()=>{let e=r.find(e=>e.type===i);e&&s(e)},children:"Aplicar a Todos os Slides"})]})]})})]})}var eo=s(2805),ec=s(2883);class ed{listAll(){return[...this.COLOR_FILTERS,...this.ANIMATIONS,...this.OVERLAYS]}listByCategory(e){return this.listAll().filter(t=>t.category===e)}get(e){return this.listAll().find(t=>t.id===e)||null}apply(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,a=this.get(t);if(!a)return e;let r={...e.style};return a.cssFilter&&(r.filter=this.adjustIntensity(a.cssFilter,s)),a.cssAnimation&&(r.animation=a.cssAnimation),{...e,style:r,effects:[...e.effects||[],t]}}remove(e,t){return{...e,effects:(e.effects||[]).filter(e=>e!==t)}}adjustIntensity(e,t){return e.replace(/\d+%/,"".concat(t,"%"))}generateKeyframes(){return"\n      @keyframes fadeIn {\n        from { opacity: 0; }\n        to { opacity: 1; }\n      }\n      \n      @keyframes fadeOut {\n        from { opacity: 1; }\n        to { opacity: 0; }\n      }\n      \n      @keyframes slideInLeft {\n        from { transform: translateX(-100%); }\n        to { transform: translateX(0); }\n      }\n      \n      @keyframes slideInRight {\n        from { transform: translateX(100%); }\n        to { transform: translateX(0); }\n      }\n      \n      @keyframes slideInUp {\n        from { transform: translateY(100%); }\n        to { transform: translateY(0); }\n      }\n      \n      @keyframes slideInDown {\n        from { transform: translateY(-100%); }\n        to { transform: translateY(0); }\n      }\n      \n      @keyframes zoomIn {\n        from { transform: scale(0); }\n        to { transform: scale(1); }\n      }\n      \n      @keyframes zoomOut {\n        from { transform: scale(1); }\n        to { transform: scale(0); }\n      }\n    "}generateOverlayCSS(e){return({vignette:"\n        background: radial-gradient(ellipse at center, transparent 0%, rgba(0,0,0,0.7) 100%);\n      ",gradient:"\n        background: linear-gradient(135deg, rgba(0,0,0,0.3) 0%, transparent 100%);\n      ",dots:"\n        background-image: radial-gradient(circle, rgba(0,0,0,0.1) 1px, transparent 1px);\n        background-size: 20px 20px;\n      ",scanlines:"\n        background: repeating-linear-gradient(\n          0deg,\n          rgba(0,0,0,0) 0px,\n          rgba(0,0,0,0) 1px,\n          rgba(0,0,0,0.1) 2px,\n          rgba(0,0,0,0.1) 3px\n        );\n      ","film-grain":"\n        background-image: url(\"data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' /%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.3'/%3E%3C/svg%3E\");\n      "})[e]||""}constructor(){this.COLOR_FILTERS=[{id:"grayscale",name:"Preto e Branco",category:"filter",cssFilter:"grayscale(100%)"},{id:"sepia",name:"S\xe9pia (Vintage)",category:"filter",cssFilter:"sepia(100%)"},{id:"blur",name:"Desfoque",category:"filter",cssFilter:"blur(5px)"},{id:"brightness",name:"Brilho",category:"filter",cssFilter:"brightness(150%)"},{id:"contrast",name:"Contraste",category:"filter",cssFilter:"contrast(150%)"},{id:"saturate",name:"Satura\xe7\xe3o",category:"filter",cssFilter:"saturate(200%)"},{id:"hue-rotate",name:"Rota\xe7\xe3o de Cor",category:"filter",cssFilter:"hue-rotate(180deg)"},{id:"invert",name:"Invers\xe3o",category:"filter",cssFilter:"invert(100%)"},{id:"drop-shadow",name:"Sombra",category:"filter",cssFilter:"drop-shadow(0 0 10px rgba(0,0,0,0.5))"},{id:"opacity",name:"Opacidade",category:"filter",cssFilter:"opacity(0.7)"}],this.ANIMATIONS=[{id:"fade-in",name:"Fade In",category:"animation",cssAnimation:"fadeIn 1s ease-in"},{id:"fade-out",name:"Fade Out",category:"animation",cssAnimation:"fadeOut 1s ease-out"},{id:"slide-in-left",name:"Slide da Esquerda",category:"animation",cssAnimation:"slideInLeft 1s ease"},{id:"slide-in-right",name:"Slide da Direita",category:"animation",cssAnimation:"slideInRight 1s ease"},{id:"slide-in-up",name:"Slide de Baixo",category:"animation",cssAnimation:"slideInUp 1s ease"},{id:"slide-in-down",name:"Slide de Cima",category:"animation",cssAnimation:"slideInDown 1s ease"},{id:"zoom-in",name:"Zoom In",category:"animation",cssAnimation:"zoomIn 1s ease"},{id:"zoom-out",name:"Zoom Out",category:"animation",cssAnimation:"zoomOut 1s ease"}],this.OVERLAYS=[{id:"vignette",name:"Vinheta",category:"overlay"},{id:"gradient",name:"Gradiente",category:"overlay"},{id:"dots",name:"Padr\xe3o de Pontos",category:"overlay"},{id:"scanlines",name:"Scanlines",category:"overlay"},{id:"film-grain",name:"Filme Antigo",category:"overlay"}]}}let em=new ed;function eu(e){let{onApplyEffect:t}=e,[s,r]=(0,h.useState)("filter"),[l,i]=(0,h.useState)(100),n=em.listByCategory(s),d=[{id:"filter",label:"Filtros",icon:(0,a.jsx)(eo.Z,{className:"w-4 h-4"})},{id:"animation",label:"Anima\xe7\xf5es",icon:(0,a.jsx)(ei.Z,{className:"w-4 h-4"})},{id:"overlay",label:"Overlays",icon:(0,a.jsx)(ec.Z,{className:"w-4 h-4"})}];return(0,a.jsxs)(o.Zb,{children:[(0,a.jsx)(o.Ol,{children:(0,a.jsxs)(o.ll,{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)(ec.Z,{className:"w-4 h-4"}),"Efeitos Visuais"]})}),(0,a.jsxs)(o.aY,{className:"space-y-3",children:[(0,a.jsx)("div",{className:"flex gap-2",children:d.map(e=>(0,a.jsxs)("button",{onClick:()=>r(e.id),className:"flex-1 px-3 py-2 rounded-lg text-xs font-medium transition flex items-center justify-center gap-1 ".concat(s===e.id?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[e.icon,e.label]},e.id))}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-2 max-h-48 overflow-y-auto",children:n.map(e=>(0,a.jsx)("button",{onClick:()=>t(e.id,l),className:"p-2 text-left text-xs bg-gray-50 hover:bg-gray-100 rounded-lg border border-gray-200 transition",children:e.name},e.id))}),"filter"===s&&(0,a.jsxs)("div",{className:"space-y-2 pt-2 border-t",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-600",children:[(0,a.jsx)("span",{children:"Intensidade"}),(0,a.jsxs)("span",{children:[l,"%"]})]}),(0,a.jsx)("input",{type:"range",min:"0",max:"100",value:l,onChange:e=>i(Number(e.target.value)),className:"w-full"})]}),(0,a.jsx)("div",{className:"text-center pt-2 border-t",children:(0,a.jsxs)(c.C,{variant:"outline",className:"text-xs",children:[n.length," efeitos dispon\xedveis"]})})]})]})}var eh=s(2431),ex=s(6678);function ep(e){let{children:t}=e;return(0,a.jsx)(ex.S,{fallback:(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gray-900",children:(0,a.jsxs)("div",{className:"text-center p-8 max-w-md",children:[(0,a.jsx)("div",{className:"inline-flex p-4 rounded-full bg-red-500/10 mb-4",children:(0,a.jsx)(X.Z,{className:"w-12 h-12 text-red-500"})}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-white mb-2",children:"Erro no Canvas"}),(0,a.jsx)("p",{className:"text-gray-400 mb-6",children:"O editor de canvas encontrou um problema. Tente recarregar ou volte ao dashboard."}),(0,a.jsxs)("div",{className:"flex gap-3 justify-center",children:[(0,a.jsxs)(f.z,{onClick:()=>window.location.reload(),variant:"default",children:[(0,a.jsx)(eh.Z,{className:"w-4 h-4 mr-2"}),"Recarregar"]}),(0,a.jsx)(f.z,{onClick:()=>window.location.href="/dashboard",variant:"outline",children:"Voltar ao Dashboard"})]})]})}),onError:(e,t)=>{console.error("\uD83C\uDFA8 Canvas Error:",e,t),s.e(206).then(s.bind(s,8206)).then(s=>{var a,r;let{analyticsService:l}=s;l.trackEvent("canvas_error",{error:e.message,component:null===(r=t.componentStack)||void 0===r?void 0:null===(a=r.split("\n")[1])||void 0===a?void 0:a.trim()})})},children:t})}var eg=s(7689),ef=s(8736),ev=s(3113);class eb{validateFile(e){return"application/pdf"!==e.type?{valid:!1,error:"Arquivo n\xe3o \xe9 PDF"}:e.size>this.maxFileSize?{valid:!1,error:"PDF muito grande (m\xe1x 50MB)"}:{valid:!0}}async importPDF(e){try{let t=this.validateFile(e);if(!t.valid)return{success:!1,slides:[],pageCount:0,error:t.error};console.log("[PDFImporter] Processando PDF:",e.name);let s=this.generateMockPages(5),a=s.map((t,s)=>({id:"pdf-slide-".concat(s+1),slideNumber:s+1,title:"P\xe1gina ".concat(t.pageNumber),thumbnail:t.thumbnail,duration:5,elements:[{id:"text-".concat(s),type:"text",content:t.text||"Conte\xfado da p\xe1gina ".concat(t.pageNumber),style:{x:50,y:50,width:t.width-100,height:t.height-100,fontSize:24,color:"#000000"}}],source:"pdf",originalFile:e.name}));return{success:!0,slides:a,pageCount:s.length}}catch(e){return console.error("[PDFImporter] Erro:",e),{success:!1,slides:[],pageCount:0,error:"Erro ao processar PDF"}}}generateMockPages(e){return Array.from({length:e},(e,t)=>({pageNumber:t+1,thumbnail:"data:image/svg+xml,".concat(encodeURIComponent('\n        <svg width="1920" height="1080" xmlns="http://www.w3.org/2000/svg">\n          <rect width="1920" height="1080" fill="#f3f4f6"/>\n          <text x="960" y="540" text-anchor="middle" font-size="48" fill="#6b7280">\n            P\xe1gina '.concat(t+1,"\n          </text>\n        </svg>\n      "))),width:1920,height:1080,text:"Conte\xfado extra\xeddo da p\xe1gina ".concat(t+1)}))}async extractText(e){return Array.from({length:5},(e,t)=>"Texto extra\xeddo da p\xe1gina ".concat(t+1))}constructor(){this.maxFileSize=52428800}}let ey=new eb;class ej{validateFile(e){return this.supportedFormats.includes(e.type)?e.size>this.maxFileSize?{valid:!1,error:"Imagem muito grande (m\xe1x 10MB)"}:{valid:!0}:{valid:!1,error:"Formato n\xe3o suportado"}}async importImages(e){try{let t=e.filter(e=>this.validateFile(e).valid);if(0===t.length)return{success:!1,slides:[],imageCount:0,error:"Nenhuma imagem v\xe1lida encontrada"};let s=await Promise.all(t.map((e,t)=>this.createSlideFromImage(e,t)));return{success:!0,slides:s,imageCount:s.length}}catch(e){return console.error("[ImageImporter] Erro:",e),{success:!1,slides:[],imageCount:0,error:"Erro ao processar imagens"}}}async createSlideFromImage(e,t){let s=URL.createObjectURL(e),a=await this.getImageDimensions(e);return{id:"image-slide-".concat(t+1),slideNumber:t+1,title:e.name.replace(/\.[^/.]+$/,""),thumbnail:s,duration:5,elements:[{id:"image-".concat(t),type:"image",content:s,style:{x:0,y:0,width:a.width,height:a.height}}],source:"image",originalFile:e.name}}getImageDimensions(e){return new Promise(t=>{let s=new Image,a=URL.createObjectURL(e);s.onload=()=>{URL.revokeObjectURL(a);let e=s.width,r=s.height;if(e>1920||r>1080){let t=Math.min(1920/e,1080/r);e=Math.round(e*t),r=Math.round(r*t)}t({width:e,height:r})},s.onerror=()=>{URL.revokeObjectURL(a),t({width:1920,height:1080})},s.src=a})}async importSingleImage(e){return this.importImages([e])}constructor(){this.maxFileSize=10485760,this.supportedFormats=["image/jpeg","image/png","image/gif","image/webp"]}}let eN=new ej;function ew(e){let{onImportComplete:t}=e,[s,r]=(0,h.useState)(!1),[l,i]=(0,h.useState)(0),n=(0,h.useRef)(null),d=async e=>{if(e&&0!==e.length){r(!0),i(0);try{let s=e[0],a=[];if("application/pdf"===s.type){i(20);let e=await ey.importPDF(s);if(i(80),e.success)a=e.slides;else{alert(e.error||"Erro ao importar PDF"),r(!1);return}}else if(s.type.startsWith("image/")){i(20);let t=Array.from(e).filter(e=>e.type.startsWith("image/")),s=await eN.importImages(t);if(i(80),s.success)a=s.slides;else{alert(s.error||"Erro ao importar imagens"),r(!1);return}}else{alert("Formato n\xe3o suportado. Use PDF ou imagens (JPEG, PNG, GIF, WebP)"),r(!1);return}i(100),t(a)}catch(e){console.error("Erro na importa\xe7\xe3o:",e),alert("Erro ao importar arquivo")}finally{r(!1),i(0)}}};return(0,a.jsxs)(o.Zb,{children:[(0,a.jsx)(o.Ol,{children:(0,a.jsxs)(o.ll,{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)(eg.Z,{className:"w-4 h-4"}),"Importa\xe7\xe3o Multi-formato"]})}),(0,a.jsxs)(o.aY,{className:"space-y-3",children:[(0,a.jsxs)("div",{onClick:()=>{var e;return null===(e=n.current)||void 0===e?void 0:e.click()},className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:border-blue-400 transition",children:[(0,a.jsx)(eg.Z,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Clique para selecionar arquivo"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"PDF ou Imagens (JPEG, PNG, GIF, WebP)"})]}),(0,a.jsx)("input",{ref:n,type:"file",accept:".pdf,image/*",multiple:!0,onChange:e=>d(e.target.files),className:"hidden"}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,a.jsxs)(c.C,{variant:"outline",className:"text-xs",children:[(0,a.jsx)(ef.Z,{className:"w-3 h-3 mr-1"}),"PDF"]}),(0,a.jsxs)(c.C,{variant:"outline",className:"text-xs",children:[(0,a.jsx)(ev.Z,{className:"w-3 h-3 mr-1"}),"JPEG"]}),(0,a.jsxs)(c.C,{variant:"outline",className:"text-xs",children:[(0,a.jsx)(ev.Z,{className:"w-3 h-3 mr-1"}),"PNG"]}),(0,a.jsxs)(c.C,{variant:"outline",className:"text-xs",children:[(0,a.jsx)(ev.Z,{className:"w-3 h-3 mr-1"}),"GIF"]}),(0,a.jsxs)(c.C,{variant:"outline",className:"text-xs",children:[(0,a.jsx)(ev.Z,{className:"w-3 h-3 mr-1"}),"WebP"]})]}),s&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-600",children:[(0,a.jsx)("span",{children:"Importando..."}),(0,a.jsxs)("span",{children:[l,"%"]})]}),(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,a.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all",style:{width:"".concat(l,"%")}})})]})]})]})}var ek=s(2208),eC=s(7769),eS=s(6337),eE=s(9589),eI=s(795),ez=s(3662),eD=s(9892);function eA(e){let{element:t,isSelected:s,onSelect:r,onToggleVisibility:l,onToggleLock:i,onDelete:n,onDuplicate:o}=e,{attributes:c,listeners:d,setNodeRef:m,transform:u,transition:h,isDragging:x}=(0,ez.nB)({id:t.id}),p={transform:eD.ux.Transform.toString(u),transition:h,opacity:x?.5:1};return(0,a.jsxs)("div",{ref:m,style:p,className:"\n        flex items-center gap-2 p-2 rounded-lg border transition-all\n        ".concat(s?"bg-blue-50 border-blue-400":"bg-white border-gray-200 hover:border-gray-300","\n        ").concat(x?"shadow-lg z-50":"","\n      "),children:[(0,a.jsx)("div",{...c,...d,className:"cursor-grab active:cursor-grabbing p-1 hover:bg-gray-100 rounded",children:(0,a.jsx)("svg",{className:"w-4 h-4 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{d:"M7 2a2 2 0 1 0 .001 4.001A2 2 0 0 0 7 2zm0 6a2 2 0 1 0 .001 4.001A2 2 0 0 0 7 8zm0 6a2 2 0 1 0 .001 4.001A2 2 0 0 0 7 14zm6-8a2 2 0 1 0-.001-4.001A2 2 0 0 0 13 6zm0 2a2 2 0 1 0 .001 4.001A2 2 0 0 0 13 8zm0 6a2 2 0 1 0 .001 4.001A2 2 0 0 0 13 14z"})})}),(0,a.jsxs)("div",{className:"flex-1 flex items-center gap-2 cursor-pointer",onClick:()=>r(t.id),children:[(0,a.jsx)("span",{className:"text-lg",children:(e=>{switch(e){case"text":return"\uD83D\uDCDD";case"image":return"\uD83D\uDDBC️";case"video":return"\uD83C\uDFA5";case"shape":return"\uD83D\uDD37";case"group":return"\uD83D\uDCE6";default:return"\uD83D\uDCC4"}})(t.type)}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:t.content?t.content.substring(0,30)+(t.content.length>30?"...":""):"".concat(t.type.charAt(0).toUpperCase()+t.type.slice(1)," ").concat(t.zIndex+1)}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["Z: ",t.zIndex]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("button",{className:"p-1 hover:bg-gray-100 rounded transition-colors",onClick:e=>{e.stopPropagation(),l(t.id)},title:t.visible?"Ocultar":"Mostrar",children:t.visible?(0,a.jsx)(ek.Z,{className:"w-4 h-4 text-gray-600"}):(0,a.jsx)(eC.Z,{className:"w-4 h-4 text-gray-400"})}),(0,a.jsx)("button",{className:"p-1 hover:bg-gray-100 rounded transition-colors",onClick:e=>{e.stopPropagation(),i(t.id)},title:t.locked?"Desbloquear":"Bloquear",children:t.locked?(0,a.jsx)(eS.Z,{className:"w-4 h-4 text-gray-600"}):(0,a.jsx)(eE.Z,{className:"w-4 h-4 text-gray-400"})}),(0,a.jsx)("button",{className:"p-1 hover:bg-gray-100 rounded transition-colors",onClick:e=>{e.stopPropagation(),o(t.id)},title:"Duplicar",children:(0,a.jsx)(Q.Z,{className:"w-4 h-4 text-gray-600"})}),(0,a.jsx)("button",{className:"p-1 hover:bg-red-100 rounded transition-colors",onClick:e=>{e.stopPropagation(),confirm("Deletar este elemento?")&&n(t.id)},title:"Deletar",children:(0,a.jsx)(g.Z,{className:"w-4 h-4 text-red-600"})})]})]})}function eM(e){let{elements:t,selectedIds:s,onReorder:r,onToggleVisibility:l,onToggleLock:i,onSelect:n,onDelete:c,onDuplicate:d}=e,m=[...t].sort((e,t)=>t.zIndex-e.zIndex),u=m.map(e=>e.id),h=(0,eI.Dy)((0,eI.VT)(eI.we),(0,eI.VT)(eI.Lg,{coordinateGetter:ez.is}));return(0,a.jsxs)(o.Zb,{className:"bg-gray-900 border-gray-800",children:[(0,a.jsx)(o.Ol,{className:"border-b border-gray-800",children:(0,a.jsxs)(o.ll,{className:"text-white flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})}),"Camadas (",t.length,")"]})}),(0,a.jsxs)(o.aY,{className:"p-3",children:[0===t.length?(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)("svg",{className:"w-12 h-12 mx-auto mb-2 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),(0,a.jsx)("p",{className:"text-sm",children:"Nenhuma camada ainda"})]}):(0,a.jsx)(eI.LB,{sensors:h,collisionDetection:eI.pE,onDragEnd:e=>{let{active:t,over:s}=e;if(!s||t.id===s.id)return;let a=u.indexOf(t.id),l=u.indexOf(s.id);if(-1===a||-1===l)return;let i=(0,ez.Rp)(m,a,l);r(i.map((e,t)=>({...e,zIndex:i.length-t-1})))},children:(0,a.jsx)(ez.Fo,{items:u,strategy:ez.qw,children:(0,a.jsx)("div",{className:"space-y-2",children:m.map(e=>(0,a.jsx)(eA,{element:e,isSelected:s.includes(e.id),onSelect:n,onToggleVisibility:l,onToggleLock:i,onDelete:c,onDuplicate:d},e.id))})})}),t.length>0&&(0,a.jsxs)("div",{className:"mt-4 pt-3 border-t border-gray-800 text-xs text-gray-400",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Vis\xedveis:"}),(0,a.jsx)("span",{className:"text-white font-medium",children:t.filter(e=>e.visible).length})]}),(0,a.jsxs)("div",{className:"flex justify-between mt-1",children:[(0,a.jsx)("span",{children:"Bloqueadas:"}),(0,a.jsx)("span",{className:"text-white font-medium",children:t.filter(e=>e.locked).length})]})]})]})]})}var eT=s(2106),eO=s(3247),eF=s(3276),eB=s(8223);function eP(e){let{onAddAsset:t}=e,[s,r]=(0,h.useState)([]),[l,i]=(0,h.useState)(!0),[n,d]=(0,h.useState)("");(0,h.useEffect)(()=>{m()},[]);let m=async()=>{try{let e=await fetch("/api/media/library"),t=await e.json();t.success&&r(t.assets)}catch(e){console.error("Erro ao carregar biblioteca:",e)}finally{i(!1)}},u=n?s.filter(e=>e.name.toLowerCase().includes(n.toLowerCase())||e.tags.some(e=>e.toLowerCase().includes(n.toLowerCase()))):s;return(0,a.jsxs)(o.Zb,{children:[(0,a.jsx)(o.Ol,{children:(0,a.jsxs)(o.ll,{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)(eT.Z,{className:"w-4 h-4"}),"Biblioteca de M\xeddia"]})}),(0,a.jsxs)(o.aY,{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(eO.Z,{className:"absolute left-2 top-2.5 w-4 h-4 text-gray-400"}),(0,a.jsx)(eB.I,{placeholder:"Buscar \xe1udio...",value:n,onChange:e=>d(e.target.value),className:"pl-8 text-sm"})]}),l?(0,a.jsx)("p",{className:"text-xs text-gray-500 text-center py-4",children:"Carregando..."}):(0,a.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:0===u.length?(0,a.jsx)("p",{className:"text-xs text-gray-500 text-center py-4",children:"Nenhum \xe1udio encontrado"}):u.map(e=>(0,a.jsx)("div",{className:"p-2 bg-gray-50 hover:bg-gray-100 rounded transition cursor-pointer",onClick:()=>null==t?void 0:t(e),children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-xs font-medium truncate",children:e.name}),(0,a.jsxs)("div",{className:"flex items-center gap-1 mt-1",children:[(0,a.jsx)(c.C,{variant:"outline",className:"text-xs px-1 py-0",children:e.category}),(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:[e.duration,"s"]})]})]}),(0,a.jsx)("button",{className:"p-1 hover:bg-blue-100 rounded",children:(0,a.jsx)(eF.Z,{className:"w-3 h-3 text-blue-600"})})]})},e.id))})]})]})}var eZ=s(9388),eR=s(6865),eL=s(3245);class eG{show(e){var t,s,a;let r="toast-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),l={...e,id:r,duration:null!==(t=e.duration)&&void 0!==t?t:this.defaultDuration,position:null!==(s=e.position)&&void 0!==s?s:this.defaultPosition,dismissible:null===(a=e.dismissible)||void 0===a||a};return this.toasts.set(r,l),this.notifyListeners(),l.duration&&l.duration>0&&setTimeout(()=>this.dismiss(r),l.duration),r}success(e,t,s){return this.show({type:"success",title:e,message:t,duration:s,icon:"✅"})}error(e,t,s){return this.show({type:"error",title:e,message:t,duration:null!=s?s:0,icon:"❌"})}warning(e,t,s){return this.show({type:"warning",title:e,message:t,duration:s,icon:"⚠️"})}info(e,t,s){return this.show({type:"info",title:e,message:t,duration:s,icon:"ℹ️"})}loading(e,t){return this.show({type:"info",title:e,message:t,duration:0,icon:"⏳",dismissible:!1})}update(e,t){let s=this.toasts.get(e);if(!s)return!1;let a={...s,...t};return this.toasts.set(e,a),this.notifyListeners(),!0}dismiss(e){let t=this.toasts.delete(e);return t&&this.notifyListeners(),t}dismissAll(){this.toasts.clear(),this.notifyListeners()}list(){return Array.from(this.toasts.values())}listByPosition(e){return this.list().filter(t=>t.position===e)}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}notifyListeners(){let e=this.list();this.listeners.forEach(t=>t(e))}async promise(e,t){let s=this.loading(t.loading);try{let a=await e;return this.dismiss(s),this.success(t.success),a}catch(e){throw this.dismiss(s),this.error(t.error,e instanceof Error?e.message:void 0),e}}constructor(){this.toasts=new Map,this.listeners=new Set,this.defaultDuration=5e3,this.defaultPosition="bottom-right"}}let eU=new eG;function eV(){let[e,t]=(0,h.useState)([]);(0,h.useEffect)(()=>eU.subscribe(t),[]);let s=e=>({"top-left":"top-4 left-4","top-center":"top-4 left-1/2 -translate-x-1/2","top-right":"top-4 right-4","bottom-left":"bottom-4 left-4","bottom-center":"bottom-4 left-1/2 -translate-x-1/2","bottom-right":"bottom-4 right-4"})[e],r=e=>{switch(e){case"success":return(0,a.jsx)(K.Z,{className:"w-5 h-5 text-green-500"});case"error":return(0,a.jsx)(eZ.Z,{className:"w-5 h-5 text-red-500"});case"warning":return(0,a.jsx)(eR.Z,{className:"w-5 h-5 text-yellow-500"});case"info":return(0,a.jsx)(eL.Z,{className:"w-5 h-5 text-blue-500"})}},l=e=>{switch(e){case"success":return"bg-green-50 border-green-200";case"error":return"bg-red-50 border-red-200";case"warning":return"bg-yellow-50 border-yellow-200";case"info":return"bg-blue-50 border-blue-200"}},i=e.reduce((e,t)=>{let s=t.position||"bottom-right";return e[s]||(e[s]=[]),e[s].push(t),e},{});return(0,a.jsx)(a.Fragment,{children:Object.entries(i).map(e=>{let[t,i]=e;return(0,a.jsx)("div",{className:"fixed z-50 flex flex-col gap-2 ".concat(s(t)),children:i.map(e=>(0,a.jsx)("div",{className:"\n                min-w-80 max-w-md rounded-lg border-2 shadow-lg p-4\n                animate-in slide-in-from-right duration-300\n                ".concat(l(e.type),"\n              "),children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[r(e.type),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h4",{className:"font-semibold text-gray-900 text-sm mb-1",children:e.title}),e.message&&(0,a.jsx)("p",{className:"text-xs text-gray-600",children:e.message}),e.action&&(0,a.jsx)("button",{onClick:e.action.onClick,className:"mt-2 text-xs font-medium text-blue-600 hover:text-blue-700",children:e.action.label})]}),e.dismissible&&(0,a.jsx)("button",{onClick:()=>eU.dismiss(e.id),className:"flex-shrink-0 text-gray-400 hover:text-gray-600",children:(0,a.jsx)(et.Z,{className:"w-4 h-4"})})]})},e.id))},t)})})}let eY=e=>({drive:()=>{},destroy:()=>{},highlight:()=>{}}),e_=(0,h.createContext)(void 0),eX={warn:(e,t)=>console.warn("[Onboarding] ".concat(e),t||"")},eK="video-editor-onboarding-completed",eq=e=>{let{projectId:t,children:s}=e,[r,l]=(0,h.useState)("idle"),i=(0,h.useRef)(null),n=(0,h.useRef)(null),o=(0,h.useCallback)(async(e,s)=>{try{await fetch("/api/analytics/onboarding",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:t,event:e,stepId:s,occurredAt:new Date().toISOString()}),keepalive:!0})}catch(e){eX.warn("Falha ao registrar analytics de onboarding",{error:e instanceof Error?e.message:e})}},[t]),c=(0,h.useCallback)(()=>{try{localStorage.setItem(eK,"true")}catch(e){eX.warn("N\xe3o foi poss\xedvel gravar completion flag",{error:e})}},[]),d=(0,h.useCallback)(()=>[{element:'[data-onboarding-target="upload"]',popover:{title:"Comece pelo Upload",description:"Envie um PPTX ou arquivos multim\xeddia para transformar em v\xeddeo.",side:"bottom",align:"start"},id:"upload"},{element:'[data-onboarding-target="timeline"]',popover:{title:"Timeline Visual",description:"Arraste, corte e ajuste clipes. Undo/redo + autosave trabalham aqui.",side:"top",align:"center"},id:"timeline"},{element:'[data-onboarding-target="templates"]',popover:{title:"Galeria de Templates",description:"Abra a galeria para aplicar estruturas prontas em segundos.",side:"bottom",align:"center"},id:"templates"},{element:'[data-onboarding-target="stock"]',popover:{title:"Biblioteca de Assets",description:"Pesquise v\xeddeos, fotos e GIFs para compor seu projeto.",side:"right",align:"center"},id:"stock"},{element:'[data-onboarding-target="export"]',popover:{title:"Exporte e publique",description:"Escolha presets por plataforma com um clique e gere o v\xeddeo final.",side:"left",align:"center"},id:"export"}],[]),m=(0,h.useCallback)(async e=>{if("running"===r)return;let t=d().filter(e=>document.querySelector(e.element));0!==t.length&&(await o("start"),l("running"),n.current=eY({showProgress:!0,steps:t,onHighlightStarted:e=>{let{id:t}=e;o("step","string"==typeof t?t:void 0)},onDestroyed:e=>{let{status:t}=e;(null==t?void 0:t.status)==="finished"?(c(),l("completed"),o("complete")):(l("idle"),o("skip"))}}),n.current.drive())},[o,d,c,r]),u=(0,h.useCallback)(()=>{m("manual")},[m]),x=(0,h.useCallback)(()=>{localStorage.removeItem(eK),l("idle"),m("manual")},[m]),p=(0,h.useCallback)(()=>{i.current&&clearTimeout(i.current),i.current=setTimeout(async()=>{if("true"!==localStorage.getItem(eK)){await o("start"),l("running");let e=d().filter(e=>document.querySelector(e.element));e.length>0&&(n.current=eY({showProgress:!0,steps:e,onHighlightStarted:e=>{let{id:t}=e;o("step","string"==typeof t?t:void 0)},onDestroyed:e=>{let{status:t}=e;(null==t?void 0:t.status)==="finished"?(c(),l("completed"),o("complete")):(l("idle"),o("skip"))}}),n.current.drive())}},9e4)},[o,d,c]);(0,h.useEffect)(()=>{"true"===localStorage.getItem(eK)&&l("completed"),p();let e=["mousemove","keydown","mousedown","touchstart","scroll"],t=()=>p();return e.forEach(e=>window.addEventListener(e,t,{passive:!0})),()=>{var s;e.forEach(e=>window.removeEventListener(e,t)),i.current&&clearTimeout(i.current),null===(s=n.current)||void 0===s||s.destroy()}},[p]);let g=(0,h.useMemo)(()=>({startTour:u,restartTour:x,status:r}),[u,x,r]);return(0,a.jsxs)(e_.Provider,{value:g,children:[s,(0,a.jsx)("button",{type:"button","aria-label":"Reabrir tour guiado",onClick:u,className:"fixed bottom-6 right-6 z-50 flex h-12 w-12 items-center justify-center rounded-full bg-blue-600 text-white shadow-lg transition hover:bg-blue-500","data-onboarding-helper":"true",children:"?"})]})};var eW=s(3577),eH=s(9374);class eJ{search(e,t){let s=e.map(e=>({slide:e,score:0,matches:[]}));return t.query&&t.query.trim()&&(s=this.searchByText(s,t.query)),t.slideNumbers&&t.slideNumbers.length>0&&(s=s.filter(e=>t.slideNumbers.includes(e.slide.slideNumber))),t.tags&&t.tags.length>0&&(s=s.filter(e=>e.slide.tags&&t.tags.some(t=>e.slide.tags.includes(t)))),void 0!==t.hasAudio&&(s=s.filter(e=>{var s;return(null===(s=e.slide.elements)||void 0===s?void 0:s.some(e=>"audio"===e.type))===t.hasAudio})),void 0!==t.hasVideo&&(s=s.filter(e=>{var s;return(null===(s=e.slide.elements)||void 0===s?void 0:s.some(e=>"video"===e.type))===t.hasVideo})),void 0!==t.hasImages&&(s=s.filter(e=>{var s;return(null===(s=e.slide.elements)||void 0===s?void 0:s.some(e=>"image"===e.type))===t.hasImages})),t.duration&&(s=s.filter(e=>{let s=e.slide.duration||0;return s>=t.duration.min&&s<=t.duration.max})),s.sort((e,t)=>t.score-e.score),s.filter(e=>e.score>0||!t.query)}searchByText(e,t){let s=t.toLowerCase().split(" ").filter(e=>e.length>0);return e.map(e=>{let t=0,a=[];if(e.slide.title){let r=e.slide.title.toLowerCase();s.forEach(s=>{r.includes(s)&&(t+=10,a.push({field:"title",text:e.slide.title,highlight:this.highlight(e.slide.title,s)}))})}if(e.slide.elements&&e.slide.elements.forEach(e=>{if("text"===e.type&&e.content){let r=e.content.toLowerCase();s.forEach(s=>{r.includes(s)&&(t+=5,a.push({field:"content",text:e.content,highlight:this.highlight(e.content,s)}))})}}),e.slide.notes){let r=e.slide.notes.toLowerCase();s.forEach(s=>{r.includes(s)&&(t+=3,a.push({field:"notes",text:e.slide.notes,highlight:this.highlight(e.slide.notes,s)}))})}return{...e,score:t,matches:a}})}highlight(e,t){let s=RegExp("(".concat(t,")"),"gi");return e.replace(s,"<mark>$1</mark>")}suggest(e,t){if(!t||t.length<2)return[];let s=new Set,a=t.toLowerCase();return e.forEach(e=>{var t,r;e.title&&e.title.toLowerCase().includes(a)&&s.add(e.title),null===(t=e.elements)||void 0===t||t.forEach(e=>{"text"===e.type&&e.content&&e.content.split(" ").forEach(e=>{e.toLowerCase().startsWith(a)&&s.add(e)})}),null===(r=e.tags)||void 0===r||r.forEach(e=>{e.toLowerCase().includes(a)&&s.add(e)})}),Array.from(s).slice(0,10)}buildIndex(e){let t=new Map;return e.forEach((e,s)=>{var a;let r=new Set;e.title&&e.title.toLowerCase().split(" ").forEach(e=>r.add(e)),null===(a=e.elements)||void 0===a||a.forEach(e=>{"text"===e.type&&e.content&&e.content.toLowerCase().split(" ").forEach(e=>r.add(e))}),r.forEach(e=>{t.has(e)||t.set(e,[]),t.get(e).push(s)})}),t}}let eQ=new eJ;function e$(e){let{slides:t,onSelectSlide:s,onClose:r}=e,[l,i]=(0,h.useState)(""),[n,d]=(0,h.useState)({}),[m,u]=(0,h.useState)([]),[x,p]=(0,h.useState)(!1),g=()=>{let e={query:l,...n};u(eQ.search(t,e))},v=(e,t)=>{d(s=>({...s,[e]:s[e]===t?void 0:t}))};return(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-start justify-center bg-black/50 pt-20",children:(0,a.jsxs)(o.Zb,{className:"w-full max-w-3xl max-h-[80vh] overflow-hidden",children:[(0,a.jsxs)(o.Ol,{className:"flex flex-row items-center justify-between",children:[(0,a.jsxs)(o.ll,{className:"flex items-center gap-2 text-lg",children:[(0,a.jsx)(eO.Z,{className:"w-5 h-5"}),"Busca Avan\xe7ada"]}),(0,a.jsx)("button",{onClick:r,className:"text-gray-500 hover:text-gray-700",children:(0,a.jsx)(et.Z,{className:"w-5 h-5"})})]}),(0,a.jsxs)(o.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("div",{className:"flex-1 relative",children:[(0,a.jsx)(eO.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,a.jsx)(eB.I,{value:l,onChange:e=>i(e.target.value),onKeyDown:e=>"Enter"===e.key&&g(),placeholder:"Buscar slides por texto...",className:"pl-10"})]}),(0,a.jsxs)(f.z,{variant:"outline",onClick:()=>p(!x),className:x?"bg-blue-50":"",children:[(0,a.jsx)(eW.Z,{className:"w-4 h-4 mr-2"}),"Filtros"]}),(0,a.jsx)(f.z,{onClick:g,children:"Buscar"})]}),x&&(0,a.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg space-y-3",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-gray-700",children:"Filtros"}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,a.jsxs)("button",{onClick:()=>v("hasImages",!0),className:"px-3 py-1 rounded-full text-xs border transition ".concat(n.hasImages?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300 hover:border-gray-400"),children:[(0,a.jsx)(ev.Z,{className:"w-3 h-3 inline mr-1"}),"Com Imagens"]}),(0,a.jsxs)("button",{onClick:()=>v("hasVideo",!0),className:"px-3 py-1 rounded-full text-xs border transition ".concat(n.hasVideo?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300 hover:border-gray-400"),children:[(0,a.jsx)(eH.Z,{className:"w-3 h-3 inline mr-1"}),"Com V\xeddeo"]}),(0,a.jsxs)("button",{onClick:()=>v("hasAudio",!0),className:"px-3 py-1 rounded-full text-xs border transition ".concat(n.hasAudio?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300 hover:border-gray-400"),children:[(0,a.jsx)(eT.Z,{className:"w-3 h-3 inline mr-1"}),"Com \xc1udio"]})]}),Object.keys(n).length>0&&(0,a.jsx)("button",{onClick:()=>{i(""),d({}),u([])},className:"text-xs text-red-600 hover:text-red-700",children:"Limpar filtros"})]}),(0,a.jsxs)("div",{className:"max-h-96 overflow-y-auto space-y-2",children:[0===m.length&&l&&(0,a.jsxs)("div",{className:"text-center py-12 text-gray-500",children:[(0,a.jsx)(eO.Z,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),(0,a.jsx)("p",{children:"Nenhum resultado encontrado"}),(0,a.jsx)("p",{className:"text-xs mt-1",children:"Tente buscar por outros termos"})]}),0===m.length&&!l&&(0,a.jsxs)("div",{className:"text-center py-12 text-gray-500",children:[(0,a.jsx)(eO.Z,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),(0,a.jsx)("p",{children:"Digite algo para buscar"}),(0,a.jsx)("p",{className:"text-xs mt-1",children:"Use filtros para refinar sua busca"})]}),m.map((e,l)=>(0,a.jsx)("div",{onClick:()=>{s(t.indexOf(e.slide)),r()},className:"p-3 bg-white border rounded-lg hover:bg-gray-50 cursor-pointer transition",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"flex-shrink-0 w-16 h-16 bg-gray-200 rounded overflow-hidden",children:e.slide.thumbnail?(0,a.jsx)("img",{src:e.slide.thumbnail,alt:"Slide ".concat(e.slide.slideNumber),className:"w-full h-full object-cover"}):(0,a.jsxs)("div",{className:"w-full h-full flex items-center justify-center text-xs text-gray-500",children:["#",e.slide.slideNumber]})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsxs)(c.C,{variant:"outline",className:"text-xs",children:["Slide ",e.slide.slideNumber]}),e.score>0&&(0,a.jsxs)(c.C,{className:"text-xs bg-green-600",children:[e.score," pts"]})]}),(0,a.jsx)("h4",{className:"font-medium text-sm text-gray-900 mb-1",children:e.slide.title||"Sem t\xedtulo"}),e.matches.length>0&&(0,a.jsx)("div",{className:"text-xs text-gray-600",children:(0,a.jsx)("span",{dangerouslySetInnerHTML:{__html:e.matches[0].highlight.substring(0,100)+"..."}})})]})]})},l))]}),m.length>0&&(0,a.jsxs)("div",{className:"text-sm text-gray-600 text-center pt-2 border-t",children:[m.length," ",1===m.length?"resultado":"resultados"," encontrado",1!==m.length?"s":""]})]})]})})}var e0=s(1740),e1=s(9397);function e2(e){var t,s,r,l;let{elementId:i,elementName:n,tracks:c,duration:d,currentTime:m,onAddKeyframe:u,onUpdateKeyframe:x,onDeleteKeyframe:p,onTimeChange:v}=e,[b,y]=(0,h.useState)("opacity"),[j,N]=(0,h.useState)(null),w=[{id:"opacity",label:"Opacidade",min:0,max:1,step:.1},{id:"x",label:"Posi\xe7\xe3o X",min:-1e3,max:2e3,step:10},{id:"y",label:"Posi\xe7\xe3o Y",min:-1e3,max:2e3,step:10},{id:"scaleX",label:"Escala X",min:0,max:3,step:.1},{id:"scaleY",label:"Escala Y",min:0,max:3,step:.1},{id:"rotation",label:"Rota\xe7\xe3o",min:-360,max:360,step:15}],k=d/1e3*100,C=e=>e/1e3*100,S=e=>e/100*1e3,E=c.find(e=>e.property===b),I=null==E?void 0:E.keyframes.find(e=>e.id===j);return(0,a.jsxs)(o.Zb,{className:"bg-gray-900 border-gray-800",children:[(0,a.jsx)(o.Ol,{className:"border-b border-gray-800",children:(0,a.jsxs)(o.ll,{className:"text-white flex items-center justify-between text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(e0.Z,{className:"w-4 h-4"}),"Keyframes: ",n]}),(0,a.jsxs)(f.z,{size:"sm",onClick:()=>{if(!w.find(e=>e.id===b))return;let e="opacity"===b?1:0;u(b,m,e)},className:"h-7",children:[(0,a.jsx)(e1.Z,{className:"w-3 h-3 mr-1"}),"Add Keyframe"]})]})}),(0,a.jsxs)(o.aY,{className:"p-3 space-y-3",children:[(0,a.jsx)("div",{className:"flex gap-1 flex-wrap",children:w.map(e=>(0,a.jsx)("button",{className:"\n                px-3 py-1 rounded text-xs font-medium transition-colors\n                ".concat(b===e.id?"bg-blue-600 text-white":"bg-gray-800 text-gray-400 hover:bg-gray-700","\n              "),onClick:()=>y(e.id),children:e.label},e.id))}),(0,a.jsxs)("div",{className:"bg-gray-800 rounded-lg p-2",children:[(0,a.jsx)("div",{className:"h-6 border-b border-gray-700 relative mb-2",children:(0,a.jsx)("div",{style:{width:"".concat(k,"px")},className:"relative h-full",children:Array.from({length:Math.ceil(d/1e3)+1}).map((e,t)=>{let s=100*t;return(0,a.jsx)("div",{className:"absolute top-0 h-full border-l border-gray-600",style:{left:"".concat(s,"px")},children:(0,a.jsxs)("span",{className:"absolute top-0 left-1 text-xs text-gray-500",children:[t,"s"]})},t)})})}),(0,a.jsx)("div",{className:"relative h-20 overflow-x-auto",children:(0,a.jsxs)("div",{className:"relative h-full bg-gray-850 rounded cursor-crosshair",style:{width:"".concat(k,"px")},onClick:e=>{let t=e.currentTarget.getBoundingClientRect();v(S(e.clientX-t.left))},children:[null==E?void 0:E.keyframes.map(e=>{let t=C(e.time),s=e.id===j;return(0,a.jsx)("div",{className:"\n                      absolute top-1/2 -translate-y-1/2 -translate-x-1/2\n                      w-4 h-4 rounded-full cursor-pointer transition-all\n                      ".concat(s?"bg-blue-500 ring-4 ring-blue-500/30 scale-125":"bg-yellow-500 hover:bg-yellow-400","\n                    "),style:{left:"".concat(t,"px")},onClick:t=>{t.stopPropagation(),N(e.id)},title:"".concat(e.time,"ms")},e.id)}),(0,a.jsx)("div",{className:"absolute top-0 bottom-0 w-0.5 bg-red-500 pointer-events-none",style:{left:"".concat(C(m),"px"),transform:"translateX(-50%)"},children:(0,a.jsx)("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 -translate-y-full",children:(0,a.jsx)("div",{className:"w-2 h-2 bg-red-500 rotate-45 transform translate-y-1"})})}),E&&E.keyframes.length>=2&&(0,a.jsx)("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",style:{overflow:"visible"},children:(0,a.jsx)("polyline",{points:E.keyframes.map((e,t)=>{let s=C(e.time),a=e.properties[b]||0,r=w.find(e=>e.id===b),l=r?(a-r.min)/(r.max-r.min):.5;return"".concat(s,",").concat(80-60*l)}).join(" "),fill:"none",stroke:"#60A5FA",strokeWidth:"2",strokeDasharray:"3,3"})})]})}),I&&(0,a.jsxs)("div",{className:"mt-3 p-3 bg-gray-850 rounded space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("h4",{className:"text-sm text-white font-medium",children:["Keyframe em ",I.time,"ms"]}),(0,a.jsxs)("div",{className:"flex gap-1",children:[(0,a.jsx)(f.z,{size:"sm",variant:"outline",onClick:()=>{u(b,I.time+500,I.properties[b])},className:"h-7 w-7 p-0",children:(0,a.jsx)(Q.Z,{className:"w-3 h-3"})}),(0,a.jsx)(f.z,{size:"sm",variant:"outline",onClick:()=>{p(I.id),N(null)},className:"h-7 w-7 p-0 hover:bg-red-600 hover:text-white",children:(0,a.jsx)(g.Z,{className:"w-3 h-3"})})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-xs text-gray-400",children:"Easing"}),(0,a.jsx)("div",{className:"grid grid-cols-3 gap-1",children:["linear","ease","ease-in","ease-out","ease-in-out"].map(e=>(0,a.jsx)("button",{className:"\n                        px-2 py-1 rounded text-xs transition-colors\n                        ".concat(I.easing===e?"bg-blue-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600","\n                      "),onClick:()=>{x(I.id,{easing:e})},children:e},e))})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("label",{className:"text-xs text-gray-400",children:["Valor de ",b]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(z.i,{value:[I.properties[b]||0],onValueChange:e=>{x(I.id,{properties:{...I.properties,[b]:e[0]}})},min:(null===(t=w.find(e=>e.id===b))||void 0===t?void 0:t.min)||0,max:(null===(s=w.find(e=>e.id===b))||void 0===s?void 0:s.max)||100,step:(null===(r=w.find(e=>e.id===b))||void 0===r?void 0:r.step)||1,className:"flex-1"}),(0,a.jsx)("span",{className:"text-xs text-white font-mono w-16 text-right",children:(null===(l=I.properties[b])||void 0===l?void 0:l.toFixed(2))||"0.00"})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-xs text-gray-400",children:"Tempo (ms)"}),(0,a.jsx)("input",{type:"number",value:I.time,onChange:e=>{let t=parseInt(e.target.value)||0;x(I.id,{time:Math.max(0,Math.min(d,t))})},className:"w-full bg-gray-700 text-white px-2 py-1 rounded text-sm",min:0,max:d,step:100})]})]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(f.z,{size:"sm",variant:"outline",onClick:()=>{u(b,0,0)},className:"flex-1 h-8 text-xs",children:"Keyframe In\xedcio"}),(0,a.jsx)(f.z,{size:"sm",variant:"outline",onClick:()=>{u(b,d,1)},className:"flex-1 h-8 text-xs",children:"Keyframe Fim"})]}),(0,a.jsx)("div",{className:"text-xs text-gray-500 pt-2 border-t border-gray-800",children:E?(0,a.jsxs)("span",{children:[E.keyframes.length," keyframes em ",b]}):(0,a.jsx)("span",{children:"Nenhum keyframe nesta propriedade"})})]})]})}var e4=s(5274),e3=s(9227),e5=s(1548);let e6=(e,t,s)=>Math.min(Math.max(e,t),s);function e8(e){let{totalDuration:t,layers:s,currentTime:r,viewportStart:l,viewportEnd:i,onNavigate:n,onScrub:o}=e,c=(0,h.useRef)(null),[d,m]=(0,h.useState)(null),u=t>0?t:1,x=(0,h.useMemo)(()=>s.flatMap(e=>e.elements),[s]),p=Math.max(0,i-l),g=l/u,f=p/u,v=f>0?f:.02,b=e6(r/u,0,1),y=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f/2,s=c.current;if(!s)return l;let a=s.getBoundingClientRect();return e6((e-a.left)/a.width-t,0,1-f)*u},j=e=>{if(d&&d.pointerId===e.pointerId){var t;m(null),null===(t=c.current)||void 0===t||t.releasePointerCapture(e.pointerId)}};return(0,a.jsxs)("div",{className:"px-4 py-3",children:[(0,a.jsxs)("div",{className:"text-xs text-gray-400 mb-2 flex items-center justify-between",children:[(0,a.jsx)("span",{children:"Vis\xe3o Geral"}),(0,a.jsxs)("span",{children:[Math.round(100*e6(f,0,1)),"% vis\xedvel"]})]}),(0,a.jsxs)("div",{ref:c,className:"relative h-14 rounded-md border border-gray-800 bg-gray-900/70",onPointerDown:e=>{if(0!==e.button||"viewport"===e.target.dataset.type)return;let t=y(e.clientX);null==n||n(t)},onPointerMove:e=>{if(!d)return;let t=y(e.clientX,d.offset);null==n||n(t)},onPointerUp:j,onPointerLeave:j,onDoubleClick:e=>{let t=e6(y(e.clientX,0)+p/2,0,u);null==o||o(t)},children:[x.map(e=>{let t=e6(e.duration/u,.002,1),s=e6(e.startTime/u,0,1);return(0,a.jsx)("div",{className:"absolute top-1 bottom-1 rounded-sm opacity-50 pointer-events-none",style:{left:"".concat(100*s,"%"),width:"".concat(100*t,"%"),background:e.color}},e.id)}),(0,a.jsx)("div",{role:"button","data-type":"viewport",tabIndex:0,onPointerDown:e=>{if(0!==e.button)return;let t=c.current;if(!t)return;let s=t.getBoundingClientRect(),a=s.width>0?(e.clientX-s.left)/s.width:0;m({pointerId:e.pointerId,offset:a-g}),t.setPointerCapture(e.pointerId),e.preventDefault()},className:"absolute top-0 bottom-0 cursor-grab border border-blue-400/70 bg-blue-500/10",style:{left:"".concat(100*g,"%"),width:"".concat(100*v,"%")}}),(0,a.jsx)("div",{className:"absolute top-0 bottom-0 w-px bg-red-500",style:{left:"".concat(100*b,"%")}})]}),(0,a.jsx)("p",{className:"mt-2 text-[11px] text-gray-500",children:"Arraste a \xe1rea destacada para navegar • Clique duas vezes para mover o playhead"})]})}function e7(e){let{layers:t,currentTime:s,totalDuration:r,onTimeChange:l,onElementUpdate:n,onElementSelect:o,onPlay:c,onPause:d,playing:m,zoom:u=1,onZoomChange:x,selectedElementIds:p}=e,g=(0,h.useRef)(null),[v,b]=(0,h.useState)(null),[y,j]=(0,h.useState)(()=>({start:0,end:r})),N=100*u,w=r/1e3*N,k=(0,h.useCallback)(e=>e/N*1e3,[N]),C=(0,h.useCallback)(e=>e/1e3*N,[N]),S=(e,t,s)=>Math.min(Math.max(e,t),s),E=(0,h.useCallback)(()=>{let e=g.current;if(!e)return;let{scrollLeft:t,clientWidth:s}=e,a=t/N*1e3,l=(t+s)/N*1e3;j({start:S(a,0,r),end:S(l,a,r)})},[N,r]),I=(e,t,s,a)=>{e.stopPropagation(),o&&o(t,s.id),s.locked||b({slideId:t,elementId:s.id,type:a,startX:e.clientX,initialStartTime:s.startTime,initialDuration:s.duration})};(0,h.useEffect)(()=>{if(!v)return;let e=e=>{let s=k(e.clientX-v.startX),a=t.find(e=>e.slideId===v.slideId);if(!a)return;let l=a.elements.find(e=>e.id===v.elementId);if(!l)return;let i=v.initialStartTime,o=v.initialDuration;if("move"===v.type)i=Math.min(i=Math.max(0,v.initialStartTime+s),r-l.duration);else if("resize-left"===v.type){let e=Math.min(s,v.initialDuration-100);i=Math.max(0,v.initialStartTime+e),o=v.initialDuration-e}else"resize-right"===v.type&&(o=Math.min(o=Math.max(100,v.initialDuration+s),r-i));n(v.slideId,v.elementId,i,o)},s=()=>{b(null)};return document.addEventListener("mousemove",e),document.addEventListener("mouseup",s),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",s)}},[v,t,r,n,k]);let z=e=>{let t=Math.floor(e/1e3);return"".concat(Math.floor(t/60),":").concat((t%60).toString().padStart(2,"0"),".").concat(Math.floor(e%1e3/10).toString().padStart(2,"0"))};return(0,h.useEffect)(()=>{let e;let t=g.current;if(!t)return;let s=()=>E();return t.addEventListener("scroll",s),s(),"undefined"!=typeof ResizeObserver&&(e=new ResizeObserver(()=>E())).observe(t),()=>{t.removeEventListener("scroll",s),null==e||e.disconnect()}},[E]),(0,h.useEffect)(()=>{E()},[E,u,r]),(0,a.jsxs)("div",{className:"bg-gray-900 rounded-lg border border-gray-800","data-testid":"multi-layer-timeline",children:[(0,a.jsxs)("div",{className:"p-3 border-b border-gray-800 flex items-center justify-between","data-testid":"timeline-header",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(i.Z,{className:"w-4 h-4 text-gray-400"}),(0,a.jsx)("h3",{className:"text-white font-medium text-sm",children:"Timeline Multicamadas"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(f.z,{size:"sm",variant:"outline",onClick:()=>l(0),disabled:0===s,className:"h-8 w-8 p-0",children:(0,a.jsx)(e4.Z,{className:"w-4 h-4"})}),(0,a.jsx)(f.z,{size:"sm",variant:"outline",onClick:m?d:c,className:"h-8 w-8 p-0",children:m?(0,a.jsx)(e3.Z,{className:"w-4 h-4"}):(0,a.jsx)(eF.Z,{className:"w-4 h-4"})}),(0,a.jsx)(f.z,{size:"sm",variant:"outline",onClick:()=>l(r),disabled:s===r,className:"h-8 w-8 p-0",children:(0,a.jsx)(e5.Z,{className:"w-4 h-4"})})]}),(0,a.jsxs)("div",{className:"text-xs text-white font-mono bg-gray-800 px-2 py-1 rounded",children:[z(s)," / ",z(r)]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(f.z,{size:"sm",variant:"outline",onClick:()=>x(Math.max(.5,u-.25)),className:"h-8 w-8 p-0",children:"-"}),(0,a.jsxs)("span",{className:"text-xs text-white w-12 text-center",children:[Math.round(100*u),"%"]}),(0,a.jsx)(f.z,{size:"sm",variant:"outline",onClick:()=>x(Math.min(3,u+.25)),className:"h-8 w-8 p-0",children:"+"})]})]})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"h-8 bg-gray-800 border-b border-gray-700 overflow-hidden",children:(0,a.jsx)("div",{className:"relative h-full",style:{width:"".concat(w,"px")},children:Array.from({length:Math.ceil(r/1e3)+1}).map((e,t)=>{let s=t*N;return(0,a.jsx)("div",{className:"absolute top-0 h-full border-l border-gray-600",style:{left:"".concat(s,"px")},children:(0,a.jsxs)("span",{className:"absolute top-1 left-1 text-xs text-gray-400",children:[t,"s"]})},t)})})}),(0,a.jsx)("div",{ref:g,className:"overflow-x-auto overflow-y-auto max-h-96 cursor-pointer",onClick:e=>{if(!g.current||v)return;let t=g.current.getBoundingClientRect();l(Math.max(0,Math.min(r,k(e.clientX-t.left))))},"data-testid":"timeline-scroll-area",children:(0,a.jsx)("div",{style:{width:"".concat(w,"px")},children:t.map(e=>(0,a.jsxs)("div",{className:"border-b border-gray-800","data-testid":"timeline-layer","data-slide-id":e.slideId,"data-slide-number":e.slideNumber,children:[(0,a.jsx)("div",{className:"h-8 bg-gray-850 px-3 flex items-center border-b border-gray-700","data-testid":"timeline-layer-header",children:(0,a.jsxs)("span",{className:"text-xs text-gray-400 font-medium",children:["Slide ",e.slideNumber]})}),0===e.elements.length?(0,a.jsx)("div",{className:"h-12 flex items-center justify-center text-xs text-gray-600",children:"Nenhum elemento"}):e.elements.map(t=>{let s=C(t.startTime),r=C(t.duration),l=t.selected||(null==p?void 0:p.includes(t.id));return(0,a.jsx)("div",{className:"h-12 relative border-b border-gray-800/50","data-testid":"timeline-element-row","data-element-id":t.id,children:(0,a.jsxs)("div",{className:"\n                            absolute h-8 top-2 rounded cursor-move\n                            transition-opacity hover:opacity-90\n                            ".concat(t.locked?"cursor-not-allowed opacity-50":"","\n                            ").concat(l?"ring-2 ring-offset-2 ring-blue-400 ring-offset-gray-900 shadow-lg":"","\n                          "),style:{left:"".concat(s,"px"),width:"".concat(r,"px"),backgroundColor:t.color},"data-testid":"timeline-element","data-slide-id":e.slideId,"data-element-id":t.id,onMouseDown:s=>I(s,e.slideId,t,"move"),children:[!t.locked&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"absolute left-0 top-0 bottom-0 w-2 cursor-ew-resize bg-black/20 hover:bg-black/40","data-testid":"resize-left",onMouseDown:s=>{s.stopPropagation(),I(s,e.slideId,t,"resize-left")}}),(0,a.jsx)("div",{className:"absolute right-0 top-0 bottom-0 w-2 cursor-ew-resize bg-black/20 hover:bg-black/40","data-testid":"resize-right",onMouseDown:s=>{s.stopPropagation(),I(s,e.slideId,t,"resize-right")}})]}),(0,a.jsx)("div",{className:"px-2 flex items-center h-full",children:(0,a.jsx)("span",{className:"text-xs text-white font-medium truncate",children:t.name})})]})},t.id)})]},e.slideId))})}),(0,a.jsx)("div",{className:"absolute top-0 bottom-0 w-0.5 bg-red-500 pointer-events-none z-50",style:{left:"".concat(C(s),"px"),transform:"translateX(-50%)"},"data-testid":"timeline-playhead",children:(0,a.jsx)("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 -translate-y-full",children:(0,a.jsx)("div",{className:"w-3 h-3 bg-red-500 rotate-45 transform translate-y-1.5"})})})]}),(0,a.jsx)("div",{className:"border-t border-gray-800 bg-gray-850",children:(0,a.jsx)(e8,{totalDuration:r,layers:t,currentTime:s,viewportStart:y.start,viewportEnd:y.end,onNavigate:e=>{let t=g.current;if(!t)return;let s=S(e,0,Math.max(0,r-k(t.clientWidth)));t.scrollTo({left:C(s),behavior:"smooth"})},onScrub:e=>{l(S(e,0,r))}})}),(0,a.jsxs)("div",{className:"p-2 border-t border-gray-800 flex items-center justify-between text-xs",children:[(0,a.jsxs)("div",{className:"text-gray-400",children:[t.reduce((e,t)=>e+t.elements.length,0)," ","elementos em ",t.length," slides"]}),(0,a.jsx)("div",{className:"text-gray-400",children:"Use scroll para navegar • Arraste elementos para reposicionar"})]})]})}var e9=s(1706),te=s(4438);function tt(e){let{slideContent:t,slideIndex:s,onAudioGenerated:r}=e,[l,i]=(0,h.useState)(!1),[n,c]=(0,h.useState)(null),d=async()=>{try{i(!0),te.Am.info("Gerando narra\xe7\xe3o...",{description:"Criando \xe1udio com IA"});let e=await fetch("/api/tts/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:t,language:"pt-BR",voice:"pt-BR-default"})}),s=await e.json();if(!s.success)throw Error(s.error||"Erro ao gerar \xe1udio");c(s.audioUrl),r&&r(s.audioUrl),te.Am.success("Narra\xe7\xe3o criada!",{description:"".concat(s.duration,"s de \xe1udio gerado")})}catch(e){console.error("Erro ao gerar TTS:",e),te.Am.error("Erro ao gerar narra\xe7\xe3o",{description:e instanceof Error?e.message:"Erro desconhecido"})}finally{i(!1)}};return(0,a.jsxs)(o.Zb,{children:[(0,a.jsx)(o.Ol,{children:(0,a.jsxs)(o.ll,{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)(e9.Z,{className:"w-4 h-4"}),"Narra\xe7\xe3o do Slide"]})}),(0,a.jsxs)(o.aY,{className:"space-y-3",children:[(0,a.jsx)("div",{className:"text-xs text-gray-600 bg-gray-50 p-3 rounded max-h-24 overflow-y-auto",children:t||"Nenhum texto para narrar"}),n?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("audio",{controls:!0,className:"w-full",src:n,children:"Seu navegador n\xe3o suporta \xe1udio"}),(0,a.jsxs)(f.z,{variant:"outline",size:"sm",className:"w-full",onClick:()=>{new Audio(n).play()},children:[(0,a.jsx)(eF.Z,{className:"w-4 h-4 mr-2"}),"Reproduzir"]})]}):(0,a.jsx)(f.z,{onClick:d,disabled:l||!t,className:"w-full",size:"sm",children:l?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(_.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Gerando..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e9.Z,{className:"w-4 h-4 mr-2"}),"Gerar Narra\xe7\xe3o"]})})]})]})}function ts(e){let{items:t,x:s,y:r,onClose:l}=e,i=(0,h.useRef)(null);(0,h.useEffect)(()=>{let e=e=>{i.current&&!i.current.contains(e.target)&&l()},t=e=>{"Escape"===e.key&&l()};return document.addEventListener("mousedown",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t)}},[l]),(0,h.useEffect)(()=>{if(i.current){let e=i.current.getBoundingClientRect(),t=window.innerWidth,a=window.innerHeight,l=s,n=r;e.right>t&&(l=t-e.width-10),e.bottom>a&&(n=a-e.height-10),i.current.style.left="".concat(l,"px"),i.current.style.top="".concat(n,"px")}},[s,r]);let n=e=>{e.disabled||e.separator||(e.action(),l())};return(0,a.jsx)("div",{ref:i,className:"fixed z-50 min-w-48 bg-white rounded-lg shadow-xl border border-gray-200 py-1",style:{left:s,top:r},children:t.map((e,t)=>e.separator?(0,a.jsx)("div",{className:"h-px bg-gray-200 my-1"},e.id||t):(0,a.jsxs)("button",{onClick:()=>n(e),disabled:e.disabled,className:"\n              w-full px-3 py-2 text-left text-sm flex items-center justify-between gap-3\n              ".concat(e.disabled?"text-gray-400 cursor-not-allowed":"text-gray-700 hover:bg-gray-100 cursor-pointer","\n            "),children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[e.icon&&(0,a.jsx)("span",{className:"text-base",children:e.icon}),(0,a.jsx)("span",{children:e.label})]}),e.shortcut&&(0,a.jsx)("span",{className:"text-xs text-gray-400",children:e.shortcut})]},e.id||t))})}function ta(e){let{projectId:t,onUploadComplete:s}=e,[r,l]=(0,h.useState)([]),[i,n]=(0,h.useState)(!1),d=(0,h.useRef)(null),m=e=>e.type.startsWith("image/")?"image":e.type.startsWith("video/")?"video":e.type.startsWith("audio/")?"audio":"document",u=async e=>{if(e)for(let a=0;a<e.length;a++){let r=e[a],i="temp-".concat(Date.now(),"-").concat(a),n=m(r),o={id:i,name:r.name,type:n,url:"",size:r.size,status:"uploading"};l(e=>[...e,o]);try{let e=new FormData;e.append("file",r),e.append("type",n),t&&e.append("projectId",t);let a=await fetch("/api/assets/upload",{method:"POST",body:e}),o=await a.json();if(o.success){let e={id:o.asset.id,name:o.asset.name,type:o.asset.type,url:o.asset.url,size:o.asset.metadata.size,status:"success"};l(t=>t.map(t=>t.id===i?e:t)),null==s||s(e)}else l(e=>e.map(e=>e.id===i?{...e,status:"error"}:e))}catch(e){console.error("Erro no upload:",e),l(e=>e.map(e=>e.id===i?{...e,status:"error"}:e))}}},x=e=>{l(t=>t.filter(t=>t.id!==e))},p=e=>{switch(e){case"image":return(0,a.jsx)(ev.Z,{className:"w-4 h-4"});case"video":return(0,a.jsx)(eH.Z,{className:"w-4 h-4"});case"audio":return(0,a.jsx)(eT.Z,{className:"w-4 h-4"});default:return(0,a.jsx)(ef.Z,{className:"w-4 h-4"})}},g=e=>{if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["Bytes","KB","MB","GB"][t]};return(0,a.jsxs)(o.Zb,{children:[(0,a.jsx)(o.Ol,{children:(0,a.jsxs)(o.ll,{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)(eg.Z,{className:"w-4 h-4"}),"Upload de Assets"]})}),(0,a.jsxs)(o.aY,{className:"space-y-3",children:[(0,a.jsxs)("div",{onDrop:e=>{e.preventDefault(),n(!1),u(e.dataTransfer.files)},onDragOver:e=>{e.preventDefault(),n(!0)},onDragLeave:()=>n(!1),onClick:()=>{var e;return null===(e=d.current)||void 0===e?void 0:e.click()},className:"\n            border-2 border-dashed rounded-lg p-6 text-center cursor-pointer transition\n            ".concat(i?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400","\n          "),children:[(0,a.jsx)(eg.Z,{className:"w-8 h-8 mx-auto mb-2 ".concat(i?"text-blue-500":"text-gray-400")}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Arraste arquivos aqui ou clique para selecionar"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Imagens, v\xeddeos, \xe1udios, fontes ou documentos"})]}),(0,a.jsx)("input",{ref:d,type:"file",multiple:!0,accept:"image/*,video/*,audio/*,.ttf,.otf,.woff,.woff2,.pdf,.doc,.docx",onChange:e=>u(e.target.files),className:"hidden"}),r.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("p",{className:"text-xs font-medium text-gray-700",children:["Uploads (",r.length,")"]}),(0,a.jsx)("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:r.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded text-xs",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:p(e.type)}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"font-medium truncate",children:e.name}),(0,a.jsx)("p",{className:"text-gray-500",children:g(e.size)})]}),(0,a.jsxs)("div",{className:"flex-shrink-0",children:["uploading"===e.status&&(0,a.jsx)(c.C,{variant:"outline",className:"text-xs",children:"Enviando..."}),"success"===e.status&&(0,a.jsx)(G.Z,{className:"w-4 h-4 text-green-500"}),"error"===e.status&&(0,a.jsx)(c.C,{variant:"destructive",className:"text-xs",children:"Erro"})]}),(0,a.jsx)("button",{onClick:()=>x(e.id),className:"flex-shrink-0 p-1 hover:bg-gray-200 rounded",children:(0,a.jsx)(et.Z,{className:"w-3 h-3"})})]},e.id))})]})]})]})}function tr(e){let{projectId:t,slideCount:s}=e,[r,l]=(0,h.useState)(!1),[i,n]=(0,h.useState)(0),[c,d]=(0,h.useState)(null),m=(0,h.useRef)(null),u=s>0,x=()=>{m.current&&(clearInterval(m.current),m.current=null)};(0,h.useEffect)(()=>()=>{x()},[]);let g=async()=>{try{x(),l(!0),n(0),d(null),te.Am.info("Iniciando renderiza\xe7\xe3o...",{description:"Gerando v\xeddeo com ".concat(s," slides")});let e=await fetch("/api/video/render",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:t,resolution:"1080p",fps:30,format:"mp4",quality:"high"})}),a=await e.json();if(!e.ok||!a.success)throw Error(a.error||"Erro ao iniciar renderiza\xe7\xe3o");let r=a.jobId;if(!r)throw Error("Job de renderiza\xe7\xe3o inv\xe1lido");m.current=setInterval(async()=>{try{let e=await fetch("/api/video/render?jobId=".concat(r));if(!e.ok)throw Error("N\xe3o foi poss\xedvel consultar o status da renderiza\xe7\xe3o");let t=await e.json();if("completed"===t.status)x(),n(100),l(!1),d(t.videoUrl||null),te.Am.success("V\xeddeo pronto!",{description:"Seu v\xeddeo foi gerado com sucesso",action:t.videoUrl?{label:"Baixar",onClick:()=>window.open(t.videoUrl,"_blank")}:void 0});else if("failed"===t.status)x(),l(!1),te.Am.error("Renderiza\xe7\xe3o interrompida",{description:t.error||"Renderiza\xe7\xe3o falhou"});else if("number"==typeof t.progress){let e=t.progress>1?t.progress:100*t.progress;n(Math.max(0,Math.min(100,Math.round(e))))}}catch(e){x(),l(!1),console.error("Erro ao verificar progresso:",e),te.Am.error("Erro ao consultar status da exporta\xe7\xe3o",{description:e instanceof Error?e.message:"Erro desconhecido"})}},2e3)}catch(e){x(),l(!1),console.error("Erro ao exportar:",e),te.Am.error("Erro ao exportar v\xeddeo",{description:e instanceof Error?e.message:"Erro desconhecido"})}};return(0,a.jsxs)(o.Zb,{"data-testid":"export-panel",children:[(0,a.jsx)(o.Ol,{children:(0,a.jsxs)(o.ll,{className:"flex items-center gap-2","data-testid":"export-icon",children:[(0,a.jsx)(p.Z,{className:"w-5 h-5"}),"Exportar V\xeddeo"]})}),(0,a.jsx)(o.aY,{className:"space-y-4",children:r?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(_.Z,{className:"w-5 h-5 animate-spin text-blue-600"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-medium text-sm","data-testid":"export-status",children:"Renderizando v\xeddeo..."}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Isso pode levar alguns minutos"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",role:"progressbar","aria-valuenow":i,"aria-valuemin":0,"aria-valuemax":100,children:(0,a.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-500",style:{width:"".concat(i,"%")},"data-testid":"export-progress-bar"})}),(0,a.jsxs)("p",{className:"text-xs text-gray-600 mt-1 text-center","data-testid":"export-progress-value","aria-live":"polite",children:[i,"%"]})]}),100===i&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-green-600 text-sm",children:[(0,a.jsx)(K.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{"data-testid":"export-complete",children:"V\xeddeo gerado com sucesso!"})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("ul",{className:"list-disc pl-4 space-y-1 text-sm text-gray-600","aria-live":"polite",children:[(0,a.jsx)("li",{children:1===s?"1 slide pronto":"".concat(s," slides prontos")}),(0,a.jsx)("li",{children:"Resolu\xe7\xe3o: 1080p (Full HD)"}),(0,a.jsx)("li",{children:"Formato: MP4"}),(0,a.jsx)("li",{children:"Qualidade: Alta"})]}),!u&&(0,a.jsx)("p",{className:"text-sm text-amber-600","data-testid":"export-disabled-hint",children:"Adicione pelo menos um slide para exportar."}),(0,a.jsxs)(f.z,{onClick:g,className:"w-full bg-blue-600 hover:bg-blue-700",size:"lg","data-testid":"start-export",disabled:!u,children:[(0,a.jsx)(p.Z,{className:"w-4 h-4 mr-2"}),"Gerar V\xeddeo"]}),c&&(0,a.jsxs)("div",{className:"space-y-3 border-t pt-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-green-600 text-sm",children:[(0,a.jsx)(K.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{"data-testid":"export-complete",children:"V\xeddeo gerado com sucesso!"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)(f.z,{type:"button",onClick:()=>window.open(c,"_blank"),className:"bg-green-600 hover:bg-green-700","data-testid":"export-download-button",children:[(0,a.jsx)(p.Z,{className:"w-4 h-4 mr-2"})," Baixar v\xeddeo"]}),(0,a.jsx)("a",{href:c,target:"_blank",rel:"noreferrer",className:"text-blue-600 underline text-sm","data-testid":"export-asset",children:"Abrir asset"})]})]})]})})]})}class tl{connect(e,t,s){var a;if((null===(a=this.ws)||void 0===a?void 0:a.readyState)===WebSocket.OPEN){console.log("[WebSocket] J\xe1 conectado");return}console.log("[WebSocket] Conectando ao projeto: ".concat(e)),console.log("[WebSocket] Usu\xe1rio: ".concat(s," (").concat(t,")")),this.simulateCollaboration(t,s),this.emit("connected",{projectId:e,userId:t,userName:s}),this.startHeartbeat()}disconnect(){this.ws&&(this.ws.close(),this.ws=null),this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null),this.emit("disconnected",{}),console.log("[WebSocket] Desconectado")}send(e){let t={...e,timestamp:Date.now()};console.log("[WebSocket] Enviando evento:",t.type,t.data)}updateCursor(e,t){this.send({type:"cursor-move",userId:"current-user",userName:"Voc\xea",data:{x:e,y:t}})}changeSlide(e){this.send({type:"slide-change",userId:"current-user",userName:"Voc\xea",data:{slideIndex:e}})}updateElement(e,t){this.send({type:"element-update",userId:"current-user",userName:"Voc\xea",data:{elementId:e,changes:t}})}on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t)}off(e,t){var s;null===(s=this.listeners.get(e))||void 0===s||s.delete(t)}emit(e,t){var s;null===(s=this.listeners.get(e))||void 0===s||s.forEach(s=>{try{s(t)}catch(t){console.error("[WebSocket] Erro no listener de ".concat(e,":"),t)}})}startHeartbeat(){this.heartbeatInterval=setInterval(()=>{console.log("[WebSocket] Heartbeat")},3e4)}simulateCollaboration(e,t){setTimeout(()=>{let e={id:"user-mock-123",name:"Ana Silva",email:"ana@example.com",color:"#3b82f6",currentSlide:0,lastSeen:Date.now()};this.emit("user-join",e),console.log("[WebSocket] Usu\xe1rio entrou:",e.name)},3e3),setInterval(()=>{this.emit("cursor-move",{userId:"user-mock-123",userName:"Ana Silva",cursor:{x:100*Math.random(),y:100*Math.random()}})},5e3)}constructor(){this.ws=null,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=3e3,this.heartbeatInterval=null,this.listeners=new Map}}let ti=new tl;class tn{reorderSlides(e,t,s){if(t===s)return{success:!1,newOrder:e,movedFrom:t,movedTo:s};let a=[...e],[r]=a.splice(t,1);return a.splice(s,0,r),{success:!0,newOrder:a.map((e,t)=>({...e,order:t,slideNumber:t+1})),movedFrom:t,movedTo:s}}duplicateSlide(e,t){if(t<0||t>=e.length)return e;let s=[...e],a={...e[t],id:"".concat(e[t].id,"-copy-").concat(Date.now()),slideNumber:t+2};return s.splice(t+1,0,a),s.map((e,t)=>({...e,order:t,slideNumber:t+1}))}removeSlide(e,t){if(t<0||t>=e.length||1===e.length)return e;let s=[...e];return s.splice(t,1),s.map((e,t)=>({...e,order:t,slideNumber:t+1}))}}let to=new tn;var tc=s(4489),td=s(7695),tm=s(5882);let tu=e=>"function"==typeof globalThis.structuredClone?globalThis.structuredClone(e):JSON.parse(JSON.stringify(e)),th=e=>{var t,s,a,r,l,i,n,o,c,d,m,u;let h="number"==typeof(null==e?void 0:null===(t=e.transform)||void 0===t?void 0:t.x)?e.transform.x:"number"==typeof(null==e?void 0:e.x)?e.x:"number"==typeof(null==e?void 0:null===(a=e.style)||void 0===a?void 0:null===(s=a.position)||void 0===s?void 0:s.x)?e.style.position.x:0;return{x:h,y:"number"==typeof(null==e?void 0:null===(r=e.transform)||void 0===r?void 0:r.y)?e.transform.y:"number"==typeof(null==e?void 0:e.y)?e.y:"number"==typeof(null==e?void 0:null===(i=e.style)||void 0===i?void 0:null===(l=i.position)||void 0===l?void 0:l.y)?e.style.position.y:0,width:"number"==typeof(null==e?void 0:null===(n=e.transform)||void 0===n?void 0:n.width)?e.transform.width:"number"==typeof(null==e?void 0:e.width)?e.width:"number"==typeof(null==e?void 0:null===(c=e.style)||void 0===c?void 0:null===(o=c.position)||void 0===o?void 0:o.width)?e.style.position.width:0,height:"number"==typeof(null==e?void 0:null===(d=e.transform)||void 0===d?void 0:d.height)?e.transform.height:"number"==typeof(null==e?void 0:e.height)?e.height:"number"==typeof(null==e?void 0:null===(u=e.style)||void 0===u?void 0:null===(m=u.position)||void 0===m?void 0:m.height)?e.style.position.height:0}},tx=e=>{if(!e.length)return null;let t=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY,l=!1;return(e.forEach(e=>{let{x:i,y:n,width:o,height:c}=th(e);if(!Number.isFinite(i)||!Number.isFinite(n))return;let d=Number.isFinite(o)?o:0,m=Number.isFinite(c)?c:0;t=Math.min(t,i),s=Math.min(s,n),a=Math.max(a,i+d),r=Math.max(r,n+m),l=!0}),l)?{minX:t,minY:s,maxX:a,maxY:r,width:a-t,height:r-s}:null},tp=e=>{let t=[];return(e.forEach(e=>{let s=e.startTime;"number"==typeof s&&Number.isFinite(s)&&t.push(s)}),t.length)?{minStartTime:Math.min(...t)}:{minStartTime:null}},tg=(e,t)=>({elements:e.map(e=>tu(e)),sourceSlideId:t,copiedAt:Date.now(),boundingBox:tx(e),timeline:tp(e)}),tf=(e,t,s)=>{var a;let{x:r,y:l}=th(e);"number"==typeof e.x&&(e.x=r+t),"number"==typeof e.y&&(e.y=l+s),e.transform&&(e.transform.x=("number"==typeof e.transform.x?e.transform.x:r)+t,e.transform.y=("number"==typeof e.transform.y?e.transform.y:l)+s),(null===(a=e.style)||void 0===a?void 0:a.position)&&(e.style.position.x=r+t,e.style.position.y=l+s)},tv=(e,t)=>{var s,a,r,l;return(null==e?void 0:e.position)&&t.boundingBox?{x:e.position.x-t.boundingBox.minX,y:e.position.y-t.boundingBox.minY}:{x:null!==(r=null==e?void 0:null===(s=e.offset)||void 0===s?void 0:s.x)&&void 0!==r?r:24,y:null!==(l=null==e?void 0:null===(a=e.offset)||void 0===a?void 0:a.y)&&void 0!==l?l:24}},tb=(0,td.U)((0,tm.O)((e,t)=>({slides:[],currentSlideIndex:0,selectedElementIds:[],clipboard:null,setSlides:t=>e({slides:t}),updateSlide:(t,s)=>e(e=>{let a=[...e.slides];return a[t]&&(a[t]={...a[t],...s}),{slides:a}}),addSlide:t=>e(e=>({slides:[...e.slides,t]})),removeSlide:t=>e(e=>({slides:e.slides.filter((e,s)=>s!==t),currentSlideIndex:Math.max(0,Math.min(e.currentSlideIndex,e.slides.length-2))})),selectSlide:t=>e({currentSlideIndex:t,selectedElementIds:[]}),selectElements:t=>e({selectedElementIds:t}),toggleElementSelection:t=>e(e=>({selectedElementIds:e.selectedElementIds.includes(t)?e.selectedElementIds.filter(e=>e!==t):[...e.selectedElementIds,t]})),copySelectedElements:()=>{var s;let a=t(),r=a.slides[a.currentSlideIndex];if(!r||0===a.selectedElementIds.length)return;let l=new Set(a.selectedElementIds),i=r.elements.filter(e=>l.has(e.id));i.length&&e({clipboard:tg(i,null!==(s=r.id)&&void 0!==s?s:null)})},cutSelectedElements:()=>{var s;let a=t(),r=a.slides[a.currentSlideIndex];if(!r||0===a.selectedElementIds.length)return;let l=new Set(a.selectedElementIds),i=r.elements.filter(e=>l.has(e.id));if(!i.length)return;let n=tg(i,null!==(s=r.id)&&void 0!==s?s:null);e(e=>{let t=[...e.slides],s=t[e.currentSlideIndex];if(!s)return e;let a=s.elements.filter(e=>!l.has(e.id));return t[e.currentSlideIndex]={...s,elements:a},{slides:t,selectedElementIds:[],clipboard:n}})},pasteClipboardElements:s=>{var a;let r=t().clipboard;if(!r||0===r.elements.length)return;let l=null!==(a=null==s?void 0:s.targetSlideIndex)&&void 0!==a?a:t().currentSlideIndex,i=tv(s,r),n="number"==typeof(null==s?void 0:s.timelineStart)&&Number.isFinite(s.timelineStart)?Math.max(s.timelineStart,0):null;e(e=>{let t=[...e.slides],a=t[l];if(!a)return e;let o=a.elements.reduce((e,t)=>{var s;return Math.max(e,null!==(s=t.zIndex)&&void 0!==s?s:0)},0),c=Date.now(),d=r.elements.map((e,t)=>{let s=tu(e);if(s.id="".concat(e.id,"-paste-").concat(c+t),tf(s,i.x,i.y),null!==n){var a;let e="number"==typeof s.startTime?s.startTime:null;r.timeline.minStartTime;let t=null!==e&&null!==r.timeline.minStartTime?e-r.timeline.minStartTime:0;s.startTime=Math.max(n+t,0)}return s.zIndex=o+t+1,s});if(!d.length)return e;let m=[...a.elements,...d];m.sort((e,t)=>(e.zIndex||0)-(t.zIndex||0)),t[l]={...a,elements:m};let u={slides:t,selectedElementIds:(null==s?void 0:s.maintainSelection)===!1?e.selectedElementIds:d.map(e=>e.id)};return l!==e.currentSlideIndex&&(u.currentSlideIndex=l),u})},clearClipboard:()=>e({clipboard:null}),updateElement:(t,s,a)=>e(e=>{let r=[...e.slides],l=r[t];if(l){let e=l.elements.findIndex(e=>e.id===s);e>=0&&(l.elements[e]={...l.elements[e],...a})}return{slides:r}}),applyElementTransforms:(t,s)=>e(e=>{if(!s||0===s.length)return e;let a=[...e.slides],r=a[t];if(!r)return e;let l=new Map;if(s.forEach(e=>{if(!(null==e?void 0:e.elementId)||!e.transform)return;let t={};if(Object.entries(e.transform).forEach(e=>{let[s,a]=e;"number"==typeof a&&Number.isFinite(a)&&(t[s]=a)}),!Object.keys(t).length)return;let s=l.get(e.elementId)||{};l.set(e.elementId,{...s,...t})}),!l.size)return e;let i=!1,n=(r.elements||[]).map(e=>{var t;let s=l.get(e.id);if(!s)return e;if(!Object.keys(s).length)return l.delete(e.id),e;i=!0;let a={...e.transform||{},...s},r=e.style;if(null===(t=e.style)||void 0===t?void 0:t.position){let t={...e.style.position};"number"==typeof s.x&&(t.x=s.x),"number"==typeof s.y&&(t.y=s.y),"number"==typeof s.width&&(t.width=s.width),"number"==typeof s.height&&(t.height=s.height),r={...e.style,position:t}}return{...e,transform:a,style:r}});return i?(a[t]={...r,elements:n},{slides:a}):e}),addElement:(t,s)=>e(e=>{let a=[...e.slides],r=a[t];return r&&r.elements.push(s),{slides:a}}),removeElement:(t,s)=>e(e=>{let a=[...e.slides],r=a[t];return r&&(r.elements=r.elements.filter(e=>e.id!==s)),{slides:a,selectedElementIds:e.selectedElementIds.filter(e=>e!==s)}}),duplicateElement:(t,s)=>e(e=>{let a=[...e.slides],r=a[t];if(r){let e=r.elements.find(e=>e.id===s);if(e){var l,i;let t="".concat(e.id,"-copy-").concat(Date.now()),s={...JSON.parse(JSON.stringify(e)),id:t,transform:{...e.transform,x:((null===(l=e.transform)||void 0===l?void 0:l.x)||0)+20,y:((null===(i=e.transform)||void 0===i?void 0:i.y)||0)+20}};r.elements.push(s)}}return{slides:a}}),groupElements:(t,s,a)=>e(e=>{var r;let l=[...e.slides],i=l[t];if(!i)return e;i.elements=i.elements.filter(e=>!a.includes(e.id));let n=Math.max(...i.elements.map(e=>{var t;return null!==(t=e.zIndex)&&void 0!==t?t:0}),0),o=tu(s);return o.zIndex=null!==(r=null==o?void 0:o.zIndex)&&void 0!==r?r:n+1,i.elements.push(o),i.elements.sort((e,t)=>(e.zIndex||0)-(t.zIndex||0)),{slides:l,selectedElementIds:[o.id]}}),ungroupElement:(t,s,a)=>e(e=>{let r=[...e.slides],l=r[t];if(!l)return e;let i=l.elements.filter(e=>e.id!==s),n=a.map(e=>tu(e)),o=[...i,...n];return o.sort((e,t)=>(e.zIndex||0)-(t.zIndex||0)),l.elements=o,{slides:r,selectedElementIds:n.map(e=>e.id)}}),moveElement:(t,s,a,r)=>e(e=>{let l=[...e.slides],i=l[t];if(i){let e=i.elements.find(e=>e.id===s);e&&e.transform&&(e.transform.x=a,e.transform.y=r)}return{slides:l}}),resizeElement:(t,s,a,r)=>e(e=>{let l=[...e.slides],i=l[t];if(i){let e=i.elements.find(e=>e.id===s);e&&e.transform&&(e.transform.width=a,e.transform.height=r)}return{slides:l}}),rotateElement:(t,s,a)=>e(e=>{let r=[...e.slides],l=r[t];if(l){let e=l.elements.find(e=>e.id===s);e&&e.transform&&(e.transform.rotation=a)}return{slides:r}}),scaleElement:(t,s,a,r)=>e(e=>{let l=[...e.slides],i=l[t];if(i){let e=i.elements.find(e=>e.id===s);e&&e.transform&&(e.transform.scaleX=a,e.transform.scaleY=r)}return{slides:l}}),updateElementZIndex:(t,s,a)=>e(e=>{let r=[...e.slides],l=r[t];if(l){let e=l.elements.find(e=>e.id===s);e&&(e.zIndex=a,l.elements.sort((e,t)=>(e.zIndex||0)-(t.zIndex||0)))}return{slides:r}}),bringToFront:(t,s)=>e(e=>{let a=[...e.slides],r=a[t];if(r){let e=Math.max(...r.elements.map(e=>e.zIndex||0),0),t=r.elements.find(e=>e.id===s);t&&(t.zIndex=e+1,r.elements.sort((e,t)=>(e.zIndex||0)-(t.zIndex||0)))}return{slides:a}}),sendToBack:(t,s)=>e(e=>{let a=[...e.slides],r=a[t];if(r){let e=r.elements.find(e=>e.id===s);e&&(e.zIndex=0,r.elements.forEach(e=>{e.id!==s&&void 0!==e.zIndex&&(e.zIndex+=1)}),r.elements.sort((e,t)=>(e.zIndex||0)-(t.zIndex||0)))}return{slides:a}}),bringForward:(t,s)=>e(e=>{let a=[...e.slides],r=a[t];if(r){let e=r.elements.find(e=>e.id===s);e&&void 0!==e.zIndex&&(e.zIndex+=1,r.elements.sort((e,t)=>(e.zIndex||0)-(t.zIndex||0)))}return{slides:a}}),sendBackward:(t,s)=>e(e=>{let a=[...e.slides],r=a[t];if(r){let e=r.elements.find(e=>e.id===s);e&&void 0!==e.zIndex&&e.zIndex>0&&(e.zIndex-=1,r.elements.sort((e,t)=>(e.zIndex||0)-(t.zIndex||0)))}return{slides:a}}),toggleElementVisibility:(t,s)=>e(e=>{let a=[...e.slides],r=a[t];if(r){let e=r.elements.find(e=>e.id===s);e&&(e.visible=!e.visible)}return{slides:a}}),toggleElementLock:(t,s)=>e(e=>{let a=[...e.slides],r=a[t];if(r){let e=r.elements.find(e=>e.id===s);e&&(e.locked=!e.locked)}return{slides:a}}),addKeyframe:(t,s,a,r,l)=>e(e=>{let i=[...e.slides],n=i[t];if(n){let e=n.elements.find(e=>e.id===s);e&&(e.keyframes||(e.keyframes=[]),e.keyframes.push({id:"kf-".concat(Date.now()),time:r,easing:"ease",properties:{[a]:l}}))}return{slides:i}}),updateKeyframe:(t,s,a,r)=>e(e=>{let l=[...e.slides],i=l[t];if(i){let e=i.elements.find(e=>e.id===s);if(e&&e.keyframes){let t=e.keyframes.findIndex(e=>e.id===a);t>=0&&(e.keyframes[t]={...e.keyframes[t],...r})}}return{slides:l}}),removeKeyframe:(t,s,a)=>e(e=>{let r=[...e.slides],l=r[t];if(l){let e=l.elements.find(e=>e.id===s);e&&e.keyframes&&(e.keyframes=e.keyframes.filter(e=>e.id!==a))}return{slides:r}}),duplicateSlide:t=>e(e=>{let s=[...e.slides],a=s[t];if(a){let e={...a,id:"".concat(a.id,"-copy-").concat(Date.now()),elements:a.elements.map(e=>({...e,id:"".concat(e.id,"-copy-").concat(Date.now())}))};s.splice(t+1,0,e)}return{slides:s}}),reorderSlides:(t,s)=>e(e=>{let a=[...e.slides],[r]=a.splice(t,1);return a.splice(s,0,r),{slides:a}})}),{partialize:e=>{let{slides:t,currentSlideIndex:s,selectedElementIds:a,clipboard:r}=e;return{slides:t,currentSlideIndex:s,selectedElementIds:a,clipboard:r}},limit:50,equality:(e,t)=>JSON.stringify(e)===JSON.stringify(t)})),ty=Object.assign(function(e){let t=tb(),s=function(){var e,t,s,a;let r=tb.temporal.getState();return{undo:()=>r.undo(),redo:()=>r.redo(),canUndo:(null!==(s=null===(e=r.pastStates)||void 0===e?void 0:e.length)&&void 0!==s?s:0)>0,canRedo:(null!==(a=null===(t=r.futureStates)||void 0===t?void 0:t.length)&&void 0!==a?a:0)>0}}(),a=e?e(t):null;return null!=a?a:{...t,...s}},tb);var tj=s(2141);class tN{listTransitions(){return[{type:"none",name:"Sem transi\xe7\xe3o",duration:0},{type:"fade",name:"Fade",duration:.5},{type:"slide-left",name:"Deslizar ←",duration:.6},{type:"slide-right",name:"Deslizar →",duration:.6},{type:"slide-up",name:"Deslizar ↑",duration:.6},{type:"slide-down",name:"Deslizar ↓",duration:.6},{type:"zoom-in",name:"Zoom In",duration:.7},{type:"zoom-out",name:"Zoom Out",duration:.7},{type:"dissolve",name:"Dissolver",duration:.8},{type:"wipe",name:"Wipe",duration:.5}]}applyTransitions(e,t){return e.map((e,s)=>({...e,transition:s>0?t:{type:"none",duration:0,easing:"linear"}}))}generateCSS(e){let{type:t,duration:s,easing:a}=e;return({none:"",fade:"\n        @keyframes fade {\n          from { opacity: 0; }\n          to { opacity: 1; }\n        }\n        animation: fade ".concat(s,"s ").concat(a,";\n      "),"slide-left":"\n        @keyframes slideLeft {\n          from { transform: translateX(100%); }\n          to { transform: translateX(0); }\n        }\n        animation: slideLeft ".concat(s,"s ").concat(a,";\n      "),"slide-right":"\n        @keyframes slideRight {\n          from { transform: translateX(-100%); }\n          to { transform: translateX(0); }\n        }\n        animation: slideRight ".concat(s,"s ").concat(a,";\n      "),"slide-up":"\n        @keyframes slideUp {\n          from { transform: translateY(100%); }\n          to { transform: translateY(0); }\n        }\n        animation: slideUp ".concat(s,"s ").concat(a,";\n      "),"slide-down":"\n        @keyframes slideDown {\n          from { transform: translateY(-100%); }\n          to { transform: translateY(0); }\n        }\n        animation: slideDown ".concat(s,"s ").concat(a,";\n      "),"zoom-in":"\n        @keyframes zoomIn {\n          from { transform: scale(0); opacity: 0; }\n          to { transform: scale(1); opacity: 1; }\n        }\n        animation: zoomIn ".concat(s,"s ").concat(a,";\n      "),"zoom-out":"\n        @keyframes zoomOut {\n          from { transform: scale(2); opacity: 0; }\n          to { transform: scale(1); opacity: 1; }\n        }\n        animation: zoomOut ".concat(s,"s ").concat(a,";\n      "),dissolve:"\n        @keyframes dissolve {\n          0% { opacity: 0; filter: blur(10px); }\n          100% { opacity: 1; filter: blur(0); }\n        }\n        animation: dissolve ".concat(s,"s ").concat(a,";\n      "),wipe:"\n        @keyframes wipe {\n          from { clip-path: inset(0 100% 0 0); }\n          to { clip-path: inset(0 0 0 0); }\n        }\n        animation: wipe ".concat(s,"s ").concat(a,";\n      ")})[t]||""}constructor(){this.defaultTransition={type:"fade",duration:.5,easing:"ease-in-out"}}}let tw=new tN;var tk=s(4064),tC=s(8477),tS=s(292),tE=s(5136),tI=s(9376);let tz="force-dynamic";function tD(){return(0,a.jsx)("div",{className:"flex h-screen items-center justify-center bg-gray-900",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-500 mx-auto mb-4"}),(0,a.jsx)("div",{className:"text-white text-xl mb-2",children:"Carregando Editor de V\xeddeo..."}),(0,a.jsx)("div",{className:"text-gray-400 text-sm",children:"Aguarde enquanto preparamos o ambiente"})]})})}function tA(e){var t,s,r,l,i,n;let{projectId:o,projectData:d}=e,[x,p]=(0,h.useState)(!1),[g,v]=(0,h.useState)(0),[b,j]=(0,h.useState)(!1),[N,w]=(0,h.useState)(!1),[k,C]=(0,h.useState)(null),[S,E]=(0,h.useState)(!1),[I,z]=(0,h.useState)(!0),[A,M]=(0,h.useState)(20),[T,O]=(0,h.useState)(1),[F,P]=(0,h.useState)(!1),[R,L]=(0,h.useState)(!0),[G,U]=(0,h.useState)(!0),[V,_]=(0,h.useState)(null),X=(0,h.useRef)(null),K=(0,h.useCallback)(()=>{_(null)},[]),{slides:q,currentSlideIndex:W,setSlides:J,selectSlide:ee,selectElements:et,updateElement:es,applyElementTransforms:er,removeElement:ei,duplicateElement:eo,toggleElementVisibility:ec,toggleElementLock:ed,bringToFront:em,sendToBack:eh,bringForward:eg,sendBackward:ef,reorderSlides:ev,duplicateSlide:eb,removeSlide:ey,addKeyframe:ej,updateKeyframe:eN,removeKeyframe:ek,updateSlide:eC,groupElements:eS,ungroupElement:eE,copySelectedElements:eI,cutSelectedElements:ez,pasteClipboardElements:eD}=ty(e=>({slides:e.slides,currentSlideIndex:e.currentSlideIndex,setSlides:e.setSlides,selectSlide:e.selectSlide,selectElements:e.selectElements,updateElement:e.updateElement,applyElementTransforms:e.applyElementTransforms,removeElement:e.removeElement,duplicateElement:e.duplicateElement,toggleElementVisibility:e.toggleElementVisibility,toggleElementLock:e.toggleElementLock,bringToFront:e.bringToFront,sendToBack:e.sendToBack,bringForward:e.bringForward,sendBackward:e.sendBackward,reorderSlides:e.reorderSlides,duplicateSlide:e.duplicateSlide,removeSlide:e.removeSlide,addKeyframe:e.addKeyframe,updateKeyframe:e.updateKeyframe,removeKeyframe:e.removeKeyframe,updateSlide:e.updateSlide,groupElements:e.groupElements,ungroupElement:e.ungroupElement,copySelectedElements:e.copySelectedElements,cutSelectedElements:e.cutSelectedElements,pasteClipboardElements:e.pasteClipboardElements})),eA=ty(e=>e.selectedElementIds),eT=ty(e=>e.clipboard),eO=eA.length>0,eF=!!(null==eT?void 0:null===(t=eT.elements)||void 0===t?void 0:t.length),{undo:eB,redo:eZ,canUndo:eR,canRedo:eL}=ty(),eG=(0,h.useRef)(q);(0,h.useEffect)(()=>{eG.current=q},[q]);let eY=(0,h.useRef)(W);(0,h.useEffect)(()=>{eY.current=W},[W]);let e_=(0,h.useRef)(new Map),eX=(0,h.useRef)(null),eK=(0,h.useCallback)(e=>{X.current=e},[]),eq=(0,h.useCallback)(()=>{null!==eX.current&&(eX.current=null);let e=e_.current;if(!e.size)return;let t=eY.current,s=eG.current,a=null==s?void 0:s[t];if(!a){e.clear();return}let r=[];e.forEach((e,t)=>{if(!(a.elements||[]).some(e=>(null==e?void 0:e.id)===t))return;let s=Object.entries(e).filter(e=>{let[,t]=e;return"number"==typeof t&&Number.isFinite(t)});s.length&&r.push({elementId:t,transform:Object.fromEntries(s)})}),e.clear(),r.length&&er(t,r)},[er]),eW=(0,h.useCallback)(()=>{if(null===eX.current){if("function"!=typeof window.requestAnimationFrame){eq();return}eX.current=window.requestAnimationFrame(()=>{eq()})}},[eq]);(0,h.useEffect)(()=>{e_.current.size&&eq()},[W,eq]),(0,h.useEffect)(()=>{let e=eX.current,t=e_.current;return()=>{null!==e&&"function"==typeof window.cancelAnimationFrame&&window.cancelAnimationFrame(e),eX.current=null,t.size&&(eq(),t.clear())}},[eq]),(0,h.useEffect)(()=>{let e=e=>{if(!(("undefined"!=typeof navigator?navigator.platform:"").toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey))return;let t=e.key.toLowerCase();"z"===t?(e.preventDefault(),e.shiftKey?eL&&eZ():eR&&eB()):"y"===t&&(e.preventDefault(),eL&&eZ())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[eB,eZ,eR,eL]),(0,h.useEffect)(()=>{_(null)},[W]);let{connected:eH,users:eJ,changeSlide:eQ}=function(e,t,s){let[a,r]=(0,h.useState)(!1),[l,i]=(0,h.useState)([]);return(0,h.useEffect)(()=>{ti.connect(e,t,s);let a=()=>{r(!0),console.log("[Collaboration] Conectado")},l=()=>{r(!1),console.log("[Collaboration] Desconectado")},n=e=>{i(t=>t.find(t=>t.id===e.id)?t:[...t,e])},o=e=>{i(t=>t.filter(t=>t.id!==e.userId))},c=e=>{i(t=>t.map(t=>t.id===e.userId?{...t,cursor:e.cursor,lastSeen:Date.now()}:t))};return ti.on("connected",a),ti.on("disconnected",l),ti.on("user-join",n),ti.on("user-leave",o),ti.on("cursor-move",c),()=>{ti.off("connected",a),ti.off("disconnected",l),ti.off("user-join",n),ti.off("user-leave",o),ti.off("cursor-move",c),ti.disconnect()}},[e,t,s]),{connected:a,users:l,updateCursor:(e,t)=>ti.updateCursor(e,t),changeSlide:e=>ti.changeSlide(e),updateElement:(e,t)=>ti.updateElement(e,t)}}(o,"current-user-id","Usu\xe1rio Atual");(0,h.useEffect)(()=>{var e;(null==d?void 0:null===(e=d.timeline_data)||void 0===e?void 0:e.slides)&&(J(d.timeline_data.slides),ee(0))},[d,ee,J]),(0,h.useEffect)(()=>{d&&(C(m.calculateMetrics(o,d)),m.trackEvent(o,{type:"view",description:"Projeto aberto no editor"}))},[o,d]);let e0=(0,h.useMemo)(()=>q.length?q.reduce((e,t)=>{let s="number"!=typeof(null==t?void 0:t.duration)||Number.isNaN(t.duration)?5:t.duration;return e+(s>0?s:5)},0):(null==d?void 0:d.duration)||0,[q,null==d?void 0:d.duration]),e1=q[W],e4=(0,h.useMemo)(()=>JSON.stringify((null==d?void 0:d.timeline_data)||{slides:[]}),[null==d?void 0:d.timeline_data]),{isSaving:e3,lastSaved:e5,error:e6,saveNow:e8}=function(e){let{projectId:t,buildPayload:s,delay:a=5e3,initialHash:r=""}=e,[l,i]=(0,h.useState)(!1),[n,o]=(0,h.useState)(null),[c,d]=(0,h.useState)(null),m=(0,h.useRef)(r),u=(0,h.useRef)(null),x=(0,h.useRef)(null),p=(0,h.useMemo)(()=>!0,[]),g=(0,h.useCallback)(()=>{null!==u.current&&p&&(window.clearTimeout(u.current),u.current=null)},[p]),f=(0,h.useCallback)(async(e,s)=>{if(!t)return!1;i(!0),d(null);try{let a=await fetch("/api/projects/".concat(t,"/autosave"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,timestamp:new Date().toISOString(),reason:s})});if(!a.ok){let e=await a.json().catch(()=>null);throw Error((null==e?void 0:e.details)||(null==e?void 0:e.error)||"Erro ao salvar projeto")}return o(new Date),d(null),!0}catch(e){return d(e instanceof Error?e:Error(String(e))),console.error("[EditorAutosave] Falha ao salvar",e),!1}finally{i(!1)}},[t]),v=(0,h.useCallback)(async()=>{let e=s(),t=JSON.stringify(e.timeline_data);x.current={payload:e,hash:t},g();let a=await f(e,"manual");return a&&(m.current=t,x.current=null),a},[s,g,f]);return(0,h.useEffect)(()=>{m.current=r,x.current=null,g()},[g,r,t]),(0,h.useEffect)(()=>{if(!p||!t)return;let e=s(),r=JSON.stringify(e.timeline_data);if(r!==m.current)return x.current={payload:e,hash:r},g(),u.current=window.setTimeout(async()=>{let e=x.current;e&&await f(e.payload,"auto")&&(m.current=e.hash,x.current=null)},a),()=>{g()}},[s,g,a,p,f,t]),(0,h.useEffect)(()=>()=>g(),[g]),{isSaving:l,lastSaved:n,error:c,saveNow:v}}({projectId:o,buildPayload:(0,h.useCallback)(()=>({timeline_data:{...(null==d?void 0:d.timeline_data)||{},slides:q},duration:e0,projectName:null==d?void 0:d.title}),[null==d?void 0:d.timeline_data,null==d?void 0:d.title,q,e0]),delay:4e3,initialHash:e4}),{timelineLayers:e9,totalTimelineDurationMs:te,slideOffsetsMs:tl}=(0,h.useMemo)(()=>{let e=["#4F46E5","#EC4899","#F97316","#10B981","#38BDF8","#F59E0B","#8B5CF6","#F472B6"],t=new Map,s=0,a=a=>(t.has(a)||(t.set(a,e[s%e.length]),s+=1),t.get(a)),r=0,l=[];return{timelineLayers:q.map((e,t)=>{var s;let i="number"!=typeof(null==e?void 0:e.duration)||Number.isNaN(e.duration)?5:e.duration,n=i>0?i:5,o=Math.round(1e3*n);l.push(r);let c=((null==e?void 0:e.elements)||[]).map((e,s)=>{var r;let l=(null==e?void 0:e.type)||"element-".concat(s),i=a(l),o=Math.max(Math.round((null!==(r=null==e?void 0:e.startTime)&&void 0!==r?r:0)*1e3),0),c="number"!=typeof(null==e?void 0:e.duration)||Number.isNaN(e.duration)?n:e.duration,d="string"==typeof(null==e?void 0:e.name)&&e.name.trim()?e.name.trim():"string"==typeof(null==e?void 0:e.content)&&e.content.trim()?e.content.trim():Array.isArray(null==e?void 0:e.content)&&e.content.length>0?e.content.join(" ").slice(0,64):(null==e?void 0:e.type)||"Elemento ".concat(s+1);return{id:(null==e?void 0:e.id)||"".concat(l,"-").concat(t,"-").concat(s),type:(null==e?void 0:e.type)||"element",name:d.slice(0,48),startTime:o,duration:Math.max(Math.round(1e3*c),200),color:i,locked:!!(null==e?void 0:e.locked),selected:eA.includes(null==e?void 0:e.id)}}),d={slideId:(null==e?void 0:e.id)||"slide-".concat(t),slideNumber:null!==(s=null==e?void 0:e.slideNumber)&&void 0!==s?s:t+1,elements:c,totalDuration:o};return r+=o,d}),totalTimelineDurationMs:r,slideOffsetsMs:l}},[q,eA]),tn=(0,h.useMemo)(()=>{var e;return q.length?(null!==(e=tl[W])&&void 0!==e?e:0)+1e3*g:0},[q.length,tl,W,g]),tc=(0,h.useCallback)(e=>{var t,s,a,r;if(!q.length){v(e/1e3),p(!1);return}let l=Math.max(0,Math.min(e,te||e)),i=0;for(let e=0;e<tl.length;e+=1){let t=null!==(s=tl[e])&&void 0!==s?s:0,a=e<tl.length-1?tl[e+1]:te;if(l>=t&&l<a){i=e;break}l>=(te||0)&&(i=tl.length-1)}v(Math.min(Math.max(l-(null!==(a=tl[i])&&void 0!==a?a:0),0),null!==(r=null===(t=e9[i])||void 0===t?void 0:t.totalDuration)&&void 0!==r?r:1)/1e3),i!==W&&(ee(i),eQ(i)),p(!1)},[q.length,te,tl,e9,W,ee,eQ,p]),td=(0,h.useCallback)(()=>{q.length&&p(!0)},[q.length,p]),tm=(0,h.useCallback)(()=>{p(!1)},[p]),tu=(0,h.useCallback)((e,t)=>{var s;let a=q.findIndex(t=>t.id===e);if(-1===a)return;a!==W&&(ee(a),eQ(a)),et([t]);let r=q[a],l=null==r?void 0:null===(s=r.elements)||void 0===s?void 0:s.find(e=>e.id===t);l&&"number"==typeof l.startTime&&!Number.isNaN(l.startTime)&&v(Math.max(l.startTime,0)),p(!1)},[q,W,ee,eQ,et,v,p]),th=()=>{p(!x)},tx=e=>{ee(e),v(0),p(!1),eQ(e)},tp=(0,h.useCallback)(()=>{if(!eO){eU.info("Nenhum elemento selecionado","Selecione elementos para copiar primeiro.",2600);return}eI(),eU.success("Elementos copiados","Use Ctrl+V para colar.",1800)},[eI,eO]),tg=(0,h.useCallback)(()=>{if(!eO){eU.info("Nenhum elemento selecionado","Selecione elementos para cortar primeiro.",2600);return}ez(),eU.success("Elementos cortados","Cole em outro ponto com Ctrl+V.",2e3)},[ez,eO]),tf=(0,h.useCallback)(e=>{if(!eF||!eT){eU.info("Nada para colar","Copie ou corte elementos antes de colar.",2400);return}eD({targetSlideIndex:W,timelineStart:tn,position:e}),p(!1),eU.success("Elementos colados",e?"Inseridos na posi\xe7\xe3o do cursor.":"Adicionados ao slide ".concat(W+1,"."),2200)},[eT,W,tn,eF,eD,p]),tv=(0,h.useCallback)(()=>{tf()},[tf]),tb=(0,h.useCallback)(()=>{var e;let t=q[W],s=null!==(e=null==t?void 0:t.elements)&&void 0!==e?e:[];if(!s.length){eU.info("Nada para selecionar","Este slide n\xe3o possui elementos.",2200);return}let a=s.map(e=>null==e?void 0:e.id).filter(e=>!!e);if(!a.length){eU.info("Nada para selecionar","Nenhum elemento possui identificador v\xe1lido.",2200);return}et(a)},[W,et,q]),tj=(0,h.useCallback)(e=>{ec(W,e)},[W,ec]),tN=(0,h.useCallback)(e=>{ed(W,e)},[W,ed]),tI=(0,h.useCallback)(e=>{ei(W,e)},[W,ei]),tz=(0,h.useCallback)(e=>{eo(W,e)},[W,eo]),tD=(0,h.useCallback)(()=>{var e,t;let s=null===(e=X.current)||void 0===e?void 0:e.groupSelected();if(!s)return;let a=q[W];if(!a)return;let r=Math.max(...(a.elements||[]).map(e=>e.zIndex||0),0),l="function"==typeof globalThis.structuredClone?globalThis.structuredClone(s.groupElement):JSON.parse(JSON.stringify(s.groupElement));eS(W,{...l,zIndex:Math.max(null!==(t=null==l?void 0:l.zIndex)&&void 0!==t?t:0,r+1)},s.childIds),m.trackEvent(o,{type:"edit",description:"Group criado: ".concat(s.groupId)})},[W,q,eS,o]),tA=(0,h.useCallback)(()=>{var e;let t=null===(e=X.current)||void 0===e?void 0:e.ungroupSelected();if(!t||!t.groupId||!q[W])return;let s=t.ungroupedElements||[];s.length&&(eE(W,t.groupId,s),m.trackEvent(o,{type:"edit",description:"Group desfeito: ".concat(t.groupId)}))},[W,q,eE,o]),tM=(0,h.useCallback)(e=>{var t,s;K(),e.targetElementId&&!eA.includes(e.targetElementId)&&et([e.targetElementId]);let a=e.targetElementId?eA.includes(e.targetElementId)?eA.length:eA.length+1:eA.length,r=a>=2,l=X.current,i=[],n=e=>{i.push(e)},o=e=>{i.length&&!i[i.length-1].separator&&i.push({id:e,label:"",separator:!0,action:()=>{}})};n({id:"copy-elements",label:"Copiar",icon:"\uD83D\uDCCB",shortcut:"Ctrl+C",action:tp,disabled:!eO}),n({id:"cut-elements",label:"Cortar",icon:"✂️",shortcut:"Ctrl+X",action:tg,disabled:!eO}),n({id:"paste-elements",label:"Colar",icon:"\uD83D\uDCC4",shortcut:"Ctrl+V",action:()=>tf(e.canvasPosition),disabled:!eF});let c=null!==(s=null===(t=q[W])||void 0===t?void 0:t.elements)&&void 0!==s?s:[];if(e.targetElementId){o("separator-target-actions"),n({id:"duplicate-element",label:"Duplicar elemento",icon:"➕",shortcut:"Ctrl+D",action:()=>tz(e.targetElementId)}),n({id:"delete-element",label:"Remover elemento",icon:"\uD83D\uDDD1️",shortcut:"Delete",action:()=>tI(e.targetElementId)});let t=c.find(t=>t.id===e.targetElementId),s=!t||!1!==t.visible,a=!!t&&!!t.locked;n({id:"toggle-visibility",label:s?"Ocultar":"Mostrar",icon:s?"\uD83D\uDE48":"\uD83D\uDC41️",action:()=>tj(e.targetElementId)}),n({id:"toggle-lock",label:a?"Desbloquear":"Bloquear",icon:a?"\uD83D\uDD13":"\uD83D\uDD12",action:()=>tN(e.targetElementId)}),o("separator-zindex");let r=eO?eA:[e.targetElementId];n({id:"bring-to-front",label:"Trazer para frente",icon:"⤴️",action:()=>r.forEach(e=>em(W,e))}),n({id:"send-to-back",label:"Enviar para tr\xe1s",icon:"⤵️",action:()=>r.forEach(e=>eh(W,e))}),n({id:"bring-forward",label:"Trazer um n\xedvel",icon:"⬆️",action:()=>r.forEach(e=>eg(W,e))}),n({id:"send-backward",label:"Enviar um n\xedvel",icon:"⬇️",action:()=>r.forEach(e=>ef(W,e))})}o("separator-selection"),n({id:"select-all-elements",label:"Selecionar todos",icon:"\uD83D\uDD32",shortcut:"Ctrl+A",action:tb,disabled:0===c.length}),r&&(o("separator-align-tools"),n({id:"align-left",label:"Alinhar \xe0 esquerda",icon:"<-",action:()=>null==l?void 0:l.alignSelected("left"),disabled:!l}),n({id:"align-center-h",label:"Alinhar horizontalmente",icon:"<->",action:()=>null==l?void 0:l.alignSelected("center-h"),disabled:!l}),n({id:"align-right",label:"Alinhar \xe0 direita",icon:"->",action:()=>null==l?void 0:l.alignSelected("right"),disabled:!l}),n({id:"align-top",label:"Alinhar ao topo",icon:"UP",action:()=>null==l?void 0:l.alignSelected("top"),disabled:!l}),n({id:"align-center-v",label:"Alinhar verticalmente",icon:"UP/DN",action:()=>null==l?void 0:l.alignSelected("center-v"),disabled:!l}),n({id:"align-bottom",label:"Alinhar \xe0 base",icon:"DN",action:()=>null==l?void 0:l.alignSelected("bottom"),disabled:!l})),a>=3&&(o("separator-distribute"),n({id:"distribute-horizontal",label:"Distribuir horizontalmente",icon:"H-SP",action:()=>null==l?void 0:l.distributeSelected("horizontal"),disabled:!l}),n({id:"distribute-vertical",label:"Distribuir verticalmente",icon:"V-SP",action:()=>null==l?void 0:l.distributeSelected("vertical"),disabled:!l})),r&&(o("separator-group"),n({id:"group-selection",label:"Agrupar sele\xe7\xe3o",icon:"GRP",action:()=>tD()})),1===a&&n({id:"ungroup-selection",label:"Desagrupar",icon:"UNGRP",action:()=>tA()}),i.length&&_({items:i,position:{x:e.clientPosition.x,y:e.clientPosition.y}})},[K,W,tp,tg,tI,tz,tb,tD,tA,tj,tN,eF,eO,tf,em,eh,eg,ef,eA,et,X,q]);!function(e){let{shortcuts:t,enabled:s=!0}=e;(0,h.useEffect)(()=>{if(!s)return;t.forEach(e=>{ea.register({...e,category:"editor"})});let e=e=>{let t=e.target,s="INPUT"===t.tagName||"TEXTAREA"===t.tagName,a=t.isContentEditable;s||a||ea.handleKeyDown(e)};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e),t.forEach(e=>{let t="".concat(e.ctrl?"ctrl+":"").concat(e.shift?"shift+":"").concat(e.alt?"alt+":"").concat(e.key.toLowerCase());ea.unregister(t)})}},[t,s])}({shortcuts:[{key:"ArrowRight",description:"Pr\xf3ximo slide",action:()=>tx(Math.min(q.length-1,W+1))},{key:"ArrowLeft",description:"Slide anterior",action:()=>tx(Math.max(0,W-1))},{key:" ",description:"Play/Pause",action:th},{key:"Home",description:"Primeiro slide",action:()=>tx(0)},{key:"End",description:"\xdaltimo slide",action:()=>tx(q.length-1)},{key:"c",ctrl:!0,description:"Copiar elementos selecionados",action:tp},{key:"x",ctrl:!0,description:"Cortar elementos selecionados",action:tg},{key:"v",ctrl:!0,description:"Colar elementos",action:tv},{key:"]",ctrl:!0,description:"Trazer um n\xedvel",action:()=>eA.forEach(e=>eg(W,e))},{key:"[",ctrl:!0,description:"Enviar um n\xedvel",action:()=>eA.forEach(e=>ef(W,e))},{key:"]",ctrl:!0,shift:!0,description:"Trazer para frente",action:()=>eA.forEach(e=>em(W,e))},{key:"[",ctrl:!0,shift:!0,description:"Enviar para tr\xe1s",action:()=>eA.forEach(e=>eh(W,e))},{key:"h",ctrl:!0,description:"Mostrar/Ocultar sele\xe7\xe3o",action:()=>eA.forEach(e=>tj(e))},{key:"l",ctrl:!0,description:"Bloquear/Desbloquear sele\xe7\xe3o",action:()=>eA.forEach(e=>tN(e))}],enabled:!0});let tT=(0,h.useCallback)((e,t)=>{if(!e||!t)return;let s=Object.entries(t).filter(e=>{let[,t]=e;return"number"==typeof t&&Number.isFinite(t)});if(!s.length)return;let a=Object.fromEntries(s),r=e_.current.get(e)||{};e_.current.set(e,{...r,...a}),eW()},[eW]),tO=(0,h.useCallback)(e=>{eC(W,{elements:e})},[W,eC]),tF=(0,h.useCallback)(e=>{et([e])},[et]);return(0,h.useEffect)(()=>{if(!x)return;let e=setInterval(()=>{v(e=>{let t=e+.1;return t>=((null==e1?void 0:e1.duration)||5)?(W<q.length-1?ee(W+1):p(!1),0):t})},100);return()=>clearInterval(e)},[x,W,q.length,null==e1?void 0:e1.duration,ee]),(0,a.jsx)(ex.S,{children:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eV,{}),b&&(0,a.jsx)(e$,{slides:q,onSelectSlide:e=>{tx(e),j(!1)},onClose:()=>j(!1)}),N&&k&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-4xl w-full max-h-[80vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold",children:"Analytics do Projeto"}),(0,a.jsx)("button",{onClick:()=>w(!1),className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),(0,a.jsx)(u,{projectId:o,metrics:k})]})}),(0,a.jsxs)("div",{className:"flex h-screen flex-col bg-gray-900",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between border-b border-gray-800 bg-gray-950 px-6 py-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-xl font-semibold text-white",children:null!==(i=null==d?void 0:d.title)&&void 0!==i?i:"Projeto sem t\xedtulo"}),(0,a.jsxs)("p",{className:"text-sm text-gray-400",children:[q.length," slides • ",Math.floor(e0/60),":",(e0%60).toString().padStart(2,"0")," dura\xe7\xe3o"]})]}),(0,a.jsx)(Z,{connected:eH,users:eJ}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)(f.z,{size:"sm",variant:"outline",onClick:eB,disabled:!eR,className:"text-white border-gray-700 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,a.jsx)(tk.Z,{className:"h-4 w-4"}),"Desfazer"]}),(0,a.jsxs)(f.z,{size:"sm",variant:"outline",onClick:eZ,disabled:!eL,className:"text-white border-gray-700 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,a.jsx)(tC.Z,{className:"h-4 w-4"}),"Refazer"]}),(0,a.jsxs)(f.z,{size:"sm",variant:"outline",onClick:tp,disabled:!eO,className:"text-white border-gray-700 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,a.jsx)(Q.Z,{className:"h-4 w-4"}),"Copiar"]}),(0,a.jsxs)(f.z,{size:"sm",variant:"outline",onClick:tg,disabled:!eO,className:"text-white border-gray-700 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,a.jsx)(tS.Z,{className:"h-4 w-4"}),"Cortar"]}),(0,a.jsxs)(f.z,{size:"sm",variant:"outline",onClick:tv,disabled:!eF,className:"text-white border-gray-700 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,a.jsx)(tE.Z,{className:"h-4 w-4"}),"Colar"]}),(0,a.jsx)(f.z,{size:"sm",variant:"outline",onClick:()=>j(!0),className:"text-white border-gray-700",children:"\uD83D\uDD0D Buscar"}),(0,a.jsx)(f.z,{size:"sm",variant:"outline",onClick:()=>w(!0),className:"text-white border-gray-700",children:"\uD83D\uDCCA Analytics"}),(0,a.jsx)(H,{isSaving:e3,lastSaved:e5,error:e6}),(0,a.jsx)("button",{className:"rounded-lg bg-gray-800 px-4 py-2 text-sm text-white hover:bg-gray-700",onClick:async()=>{await e8()?eU.success("Projeto salvo com sucesso!"):eU.error("N\xe3o foi poss\xedvel salvar o projeto.")},children:"Salvar"}),(0,a.jsx)("button",{"data-testid":"export-button",className:"rounded-lg bg-blue-600 px-4 py-2 text-sm text-white hover:bg-blue-700",onClick:async()=>{if(!confirm("Gerar v\xeddeo com ".concat(q.length," slides?")))return;let e=await fetch("/api/video/render",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:o,resolution:"1080p",fps:30,format:"mp4",quality:"high"})}),t=await e.json();t.success?alert("Renderiza\xe7\xe3o iniciada! Job ID: ".concat(t.jobId)):alert("Erro: ".concat(t.error))},children:"Exportar V\xeddeo"})]})]}),(0,a.jsxs)("div",{className:"flex flex-1 overflow-hidden",children:[(0,a.jsxs)("div",{className:"w-64 border-r border-gray-800 bg-gray-950 p-4 overflow-y-auto",children:[(0,a.jsxs)("h2",{className:"mb-4 text-sm font-semibold text-white flex items-center justify-between",children:[(0,a.jsxs)("span",{children:["Slides (",q.length,")"]}),(0,a.jsx)(c.C,{variant:"outline",className:"text-xs",children:"Drag & Drop"})]}),(0,a.jsx)($,{slides:q,currentSlideIndex:W,onSlideSelect:tx,onReorder:(e,t)=>{let s=to.reorderSlides(q,e,t);s.success&&(J(s.newOrder),W===e?ee(t):W===t&&ee(Math.min(Math.max(e>t?W+1:W-1,0),s.newOrder.length-1)),m.trackEvent(o,{type:"edit",description:"Slide reordenado: ".concat(e+1," → ").concat(t+1)}))},onDuplicate:e=>{eb(e),m.trackEvent(o,{type:"edit",description:"Slide ".concat(e+1," duplicado")})},onDelete:e=>{ey(e),m.trackEvent(o,{type:"edit",description:"Slide ".concat(e+1," deletado")})}})]}),(0,a.jsxs)("div",{className:"flex flex-1 flex-col",children:[(0,a.jsxs)("div",{className:"bg-gray-900 border-b border-gray-800 px-4 py-2 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>tx(Math.max(0,W-1)),disabled:0===W,className:"px-3 py-1 bg-gray-800 text-white rounded disabled:opacity-50",children:"← Anterior"}),(0,a.jsx)("button",{onClick:th,className:"px-4 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",children:x?"⏸ Pause":"▶ Play"}),(0,a.jsx)("button",{onClick:()=>tx(Math.min(q.length-1,W+1)),disabled:W===q.length-1,className:"px-3 py-1 bg-gray-800 text-white rounded disabled:opacity-50",children:"Pr\xf3ximo →"})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-400",children:["Slide ",W+1,"/",q.length," •"," ",g.toFixed(1),"s"]})]}),(0,a.jsx)("div",{className:"flex flex-1 items-center justify-center bg-gray-800 p-8",children:e1&&e1.elements?(0,a.jsx)(ep,{children:(0,a.jsx)(B,{slide:e1,width:1920,height:1080,onElementUpdate:tT,onSelectionChange:et,selectedElementIds:eA,gridEnabled:S,gridSize:A,snapEnabled:I,onContextMenu:tM,onManagerReady:eK})}):(0,a.jsx)("div",{className:"rounded-lg bg-black shadow-2xl relative",style:{width:"960px",height:"540px"},children:(null==e1?void 0:e1.thumbnail)?(0,a.jsx)("img",{src:e1.thumbnail,alt:"Slide ".concat(W+1),className:"w-full h-full object-contain"}):(0,a.jsxs)("div",{className:"flex h-full flex-col items-center justify-center text-gray-500",children:[(0,a.jsx)("p",{className:"text-lg mb-2",children:"Canvas 1920x1080"}),(0,a.jsxs)("p",{className:"text-sm",children:[q.length," slides carregados"]}),(0,a.jsx)("p",{className:"text-xs text-gray-600 mt-2",children:"Selecione um slide para visualizar"})]})})}),(0,a.jsxs)("div",{className:"border-t border-gray-800 bg-gray-950 p-4",children:[(0,a.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-sm font-semibold text-white",children:"Timeline"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(f.z,{size:"sm",variant:G?"default":"outline",onClick:()=>U(!0),className:"h-8 text-xs",children:"Avan\xe7ada"}),(0,a.jsx)(f.z,{size:"sm",variant:G?"outline":"default",onClick:()=>U(!1),className:"h-8 text-xs",children:"Simplificada"})]})]}),G?(0,a.jsx)(e7,{layers:e9,currentTime:tn,totalDuration:Math.max(te,1e3),onTimeChange:tc,onElementUpdate:(e,t,s,a)=>{let r=q.findIndex(t=>t.id===e),l=q[r];if(-1===r||!l)return;let i=Math.max(s/1e3,0),n=Math.max(a/1e3,.1);es(r,t,{startTime:i,duration:n});let o=(l.elements||[]).map(e=>e.id===t?{...e,startTime:i,duration:n}:e),c="number"!=typeof l.duration||Number.isNaN(l.duration)?5:l.duration,d=o.reduce((e,t)=>Math.max(e,("number"!=typeof(null==t?void 0:t.startTime)||Number.isNaN(t.startTime)?0:t.startTime)+("number"!=typeof(null==t?void 0:t.duration)||Number.isNaN(t.duration)?0:t.duration)),0);eC(r,{duration:Math.max(o.length?d:c,1)})},onElementSelect:tu,onPlay:td,onPause:tm,playing:x,zoom:T,onZoomChange:O,selectedElementIds:eA}):(0,a.jsx)("div",{className:"flex gap-3 overflow-x-auto pb-2",children:q.length?q.map((e,t)=>{let s="number"!=typeof(null==e?void 0:e.duration)||Number.isNaN(e.duration)?5:e.duration,r=t===W;return(0,a.jsxs)("button",{type:"button",onClick:()=>tx(t),className:"flex-shrink-0 overflow-hidden rounded-lg border transition focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(r?"border-blue-500 bg-blue-950/40":"border-gray-800 bg-gray-900 hover:bg-gray-800"),style:{width:"".concat(Math.max(12*s,120),"px"),minWidth:"120px"},children:[(0,a.jsx)("div",{className:"aspect-video w-full bg-gray-950",children:e.thumbnail?(0,a.jsx)("img",{src:e.thumbnail,alt:"Slide ".concat(t+1),className:"h-full w-full object-cover"}):(0,a.jsx)("div",{className:"flex h-full w-full items-center justify-center text-xs text-gray-500",children:"Pr\xe9-visualiza\xe7\xe3o"})}),(0,a.jsxs)("div",{className:"flex items-center justify-between px-2 py-1 text-xs text-gray-300",children:[(0,a.jsxs)("span",{children:["Slide ",e.slideNumber||t+1]}),(0,a.jsxs)("span",{children:[Math.round(s),"s"]})]})]},e.id||t)}):(0,a.jsx)("div",{className:"w-full rounded-lg border border-dashed border-gray-700 p-4 text-center text-sm text-gray-500",children:"Adicione slides para visualizar a timeline."})})]})]}),(0,a.jsxs)("div",{className:"w-80 border-l border-gray-800 bg-gray-950 p-4 overflow-y-auto",children:[(0,a.jsx)("h2",{className:"mb-4 text-sm font-semibold text-white",children:"Propriedades"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(D,{gridEnabled:S,snapEnabled:I,gridSize:A,onGridToggle:E,onSnapToggle:z,onGridSizeChange:M}),R&&e1&&e1.elements&&(0,a.jsxs)("div",{className:"pt-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)(f.z,{size:"sm",onClick:tD,className:"h-8 text-xs",children:"Agrupar"}),(0,a.jsx)(f.z,{size:"sm",onClick:tA,className:"h-8 text-xs",children:"Desagrupar"})]}),(0,a.jsx)(eM,{elements:(e1.elements||[]).map(e=>({id:e.id,type:e.type,content:e.content,zIndex:e.zIndex||0,visible:!1!==e.visible,locked:e.locked||!1})),selectedIds:eA,onReorder:tO,onToggleVisibility:tj,onToggleLock:tN,onSelect:tF,onDelete:tI,onDuplicate:tz})]}),1===eA.length&&F&&(0,a.jsx)("div",{className:"pt-2",children:(0,a.jsx)(e2,{elementId:eA[0],elementName:(null==e1?void 0:null===(l=e1.elements)||void 0===l?void 0:null===(r=l.find(e=>e.id===eA[0]))||void 0===r?void 0:null===(s=r.content)||void 0===s?void 0:s.substring(0,20))||"Elemento ".concat(eA[0]),tracks:[],duration:1e3*((null==e1?void 0:e1.duration)||5),currentTime:1e3*g,onAddKeyframe:(e,t,s)=>{1===eA.length&&ej(W,eA[0],e,t,s)},onUpdateKeyframe:(e,t)=>{1===eA.length&&eN(W,eA[0],e,t)},onDeleteKeyframe:e=>{1===eA.length&&ek(W,eA[0],e)},onTimeChange:e=>v(e/1e3)})}),(0,a.jsxs)("div",{className:"pt-2 border-t border-gray-800",children:[(0,a.jsx)("label",{className:"mb-2 block text-sm text-gray-400",children:"T\xedtulo do Projeto"}),(0,a.jsx)("input",{type:"text",className:"w-full rounded-lg bg-gray-800 px-3 py-2 text-white text-sm",value:null!==(n=null==d?void 0:d.title)&&void 0!==n?n:"",readOnly:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"mb-2 block text-sm text-gray-400",children:"Dura\xe7\xe3o Total"}),(0,a.jsx)("input",{type:"text",className:"w-full rounded-lg bg-gray-800 px-3 py-2 text-white text-sm",value:"".concat(e0,"s"),readOnly:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"mb-2 block text-sm text-gray-400",children:"Resolu\xe7\xe3o"}),(0,a.jsxs)("select",{className:"w-full rounded-lg bg-gray-800 px-3 py-2 text-white text-sm",children:[(0,a.jsx)("option",{children:"1920x1080 (Full HD)"}),(0,a.jsx)("option",{children:"1280x720 (HD)"}),(0,a.jsx)("option",{children:"3840x2160 (4K)"})]})]}),(0,a.jsxs)("div",{className:"flex gap-2 pt-2 border-t border-gray-800",children:[(0,a.jsx)(f.z,{size:"sm",variant:R?"default":"outline",onClick:()=>L(!R),className:"flex-1 h-8 text-xs",children:"Camadas"}),(0,a.jsx)(f.z,{size:"sm",variant:F?"default":"outline",onClick:()=>P(!F),className:"flex-1 h-8 text-xs",disabled:1!==eA.length,children:"Keyframes"})]}),e1&&e1.elements&&(0,a.jsx)("div",{className:"pt-4 border-t border-gray-800",children:(0,a.jsx)(tt,{slideContent:e1.elements.filter(e=>"text"===e.type).map(e=>e.content).join(" "),slideIndex:W})}),(0,a.jsx)("div",{className:"pt-4 border-t border-gray-800",children:(0,a.jsx)(eP,{onAddAsset:e=>{console.log("Asset adicionado:",e.name)}})}),(0,a.jsx)("div",{className:"pt-4 border-t border-gray-800",children:(0,a.jsx)(en,{onApply:e=>{J(tw.applyTransitions(q,{type:e.type,duration:e.duration,easing:"ease-in-out"})),m.trackEvent(o,{type:"edit",description:"Transi\xe7\xe3o ".concat(e.name," aplicada")})}})}),(0,a.jsx)("div",{className:"pt-4 border-t border-gray-800",children:(0,a.jsx)(ta,{projectId:o,onUploadComplete:e=>{m.trackEvent(o,{type:"edit",description:"Asset uploaded: ".concat(e.name)})}})}),(0,a.jsx)("div",{className:"pt-4 border-t border-gray-800",children:(0,a.jsx)(ew,{onImportComplete:e=>{J([...q,...e])}})}),(0,a.jsx)("div",{className:"pt-4 border-t border-gray-800",children:(0,a.jsx)(eu,{onApplyEffect:(e,t)=>{console.log("Efeito aplicado:",e,t)}})}),(0,a.jsx)("div",{className:"pt-4 border-t border-gray-800",children:(0,a.jsx)(y,{projectId:o,onRestore:e=>{console.log("Backup restaurado")}})}),(0,a.jsx)("div",{className:"pt-4 border-t border-gray-800",children:(0,a.jsx)(Y,{projectId:o,slideId:null==e1?void 0:e1.id,currentUser:{id:"current-user-id",name:"Usu\xe1rio Atual"}})}),(0,a.jsx)("div",{className:"pt-4 border-t border-gray-800",children:(0,a.jsx)(tr,{projectId:o,slideCount:q.length})}),(0,a.jsxs)("div",{className:"pt-4 border-t border-gray-800",children:[(0,a.jsxs)("h3",{className:"text-sm font-semibold text-white mb-3",children:["Elementos (Slide ",W+1,")"]}),e1&&e1.elements?(0,a.jsxs)("div",{className:"space-y-2",children:[e1.elements.slice(0,5).map(e=>{var t,s;return(0,a.jsxs)("div",{className:"text-xs bg-gray-800 hover:bg-gray-700 p-2 rounded text-gray-300 cursor-pointer transition",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsx)("span",{className:"font-medium",children:e.type}),(0,a.jsxs)(c.C,{variant:"outline",className:"text-xs px-1 py-0",children:[(null===(t=e.style)||void 0===t?void 0:t.fontSize)||"N/A","px"]})]}),(0,a.jsxs)("p",{className:"truncate",children:[null===(s=e.content)||void 0===s?void 0:s.substring(0,30),"..."]})]},e.id)}),e1.elements.length>5&&(0,a.jsxs)("p",{className:"text-xs text-gray-500 text-center",children:["+",e1.elements.length-5," elementos"]})]}):(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Nenhum elemento"})]})]})]})]}),(0,a.jsx)(el,{})]}),V&&(0,a.jsx)(ts,{items:V.items,x:V.position.x,y:V.position.y,onClose:K})]})})}function tM(){return(0,a.jsx)(h.Suspense,{fallback:(0,a.jsx)(tD,{}),children:(0,a.jsx)(tT,{})})}function tT(){let e=(0,tI.useSearchParams)().get("projectId")||"demo",[t,r]=(0,h.useState)(null),[l,i]=(0,h.useState)(!0),[n,o]=(0,h.useState)(null);return((0,h.useEffect)(()=>{(async()=>{try{var t,a;i(!0),o(null);let{data:l,error:n}=await tj.OQ.from("projects").select("*").eq("id",e).single();if(n){let{fallbackStorage:a}=await s.e(171).then(s.bind(s,1405)),l=a.getProject(e);if(l){console.log("✅ Projeto encontrado no fallback storage"),r({id:l.id,title:l.title,duration:l.duration||0,slides:(null===(t=l.timeline_data)||void 0===t?void 0:t.slides)||[],timeline_data:l.timeline_data||{slides:[]}}),i(!1);return}console.warn("Projeto n\xe3o encontrado, usando demo"),r({id:e,title:"Projeto de Demonstra\xe7\xe3o",duration:30,slides:[],timeline_data:{slides:[]}}),i(!1);return}l&&r({id:l.id,title:l.title||"Projeto",duration:l.duration||0,slides:(null===(a=l.timeline_data)||void 0===a?void 0:a.slides)||[],timeline_data:l.timeline_data||{slides:[]}}),i(!1)}catch(e){console.error("Erro ao carregar projeto:",e),o("Falha ao carregar o projeto"),i(!1)}})(),(0,tc.Z0)("/video-editor",{projectId:e}),s.e(206).then(s.bind(s,8206)).then(t=>{let{analyticsService:s}=t;s.trackEditorOpened(e)})},[e]),l)?(0,a.jsx)(tD,{}):n?(0,a.jsx)("div",{className:"flex h-screen items-center justify-center bg-gray-900",children:(0,a.jsxs)("div",{className:"text-center max-w-md",children:[(0,a.jsx)("div",{className:"text-red-500 text-6xl mb-4",children:"⚠️"}),(0,a.jsx)("h2",{className:"text-white text-2xl mb-2",children:"Erro ao Carregar Projeto"}),(0,a.jsx)("p",{className:"text-gray-400 mb-6",children:n}),(0,a.jsx)("button",{onClick:()=>window.location.href="/dashboard",className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Voltar ao Dashboard"})]})}):(0,a.jsx)(eq,{projectId:e,children:(0,a.jsx)(tA,{projectId:e,projectData:t})})}},8223:function(e,t,s){"use strict";s.d(t,{I:function(){return r}});var a=s(7437);let r=s(2265).forwardRef((e,t)=>{let{className:s="",...r}=e;return(0,a.jsx)("input",{ref:t,className:["flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm","ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium","placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",s].join(" "),...r})});r.displayName="Input"},5897:function(e,t,s){"use strict";s.d(t,{i:function(){return n}});var a=s(7437),r=s(2265),l=s(553),i=s(4508);let n=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsxs)(l.fC,{ref:t,className:(0,i.cn)("relative flex w-full touch-none select-none items-center",s),...r,children:[(0,a.jsx)(l.fQ,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:(0,a.jsx)(l.e6,{className:"absolute h-full bg-primary"})}),(0,a.jsx)(l.bU,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]})});n.displayName=l.fC.displayName},2141:function(e,t,s){"use strict";s.d(t,{OQ:function(){return o}});var a=s(1545),r=s(5566);let l=r.env.NEXT_PUBLIC_SUPABASE_URL||"",i=r.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"";r.env.SUPABASE_SERVICE_ROLE_KEY;let n=null,o=n=l&&i?(0,a.eI)(l,i,{auth:{persistSession:!0,autoRefreshToken:!0,storage:window.localStorage,storageKey:"supabase.auth.token"}}):(0,a.eI)("https://placeholder.supabase.co","placeholder-key",{auth:{persistSession:!1,autoRefreshToken:!1}})}},function(e){e.O(0,[590,438,798,872,635,761,363,971,117,744],function(){return e(e.s=2855)}),_N_E=e.O()}]);