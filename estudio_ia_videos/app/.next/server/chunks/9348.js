"use strict";exports.id=9348,exports.ids=[9348],exports.modules={19348:(t,e,r)=>{r.d(e,{PPTXTextParserAdvanced:()=>n});var a=r(18159);class n{static async extractFormattedText(t,e){try{let r=`ppt/slides/slide${e}.xml`,n=await t.file(r)?.async("text");if(!n)return{success:!1,textBoxes:[],plainText:"",formattedHTML:"",wordCount:0,characterCount:0,error:`Slide ${e} n\xe3o encontrado`};let i=await (0,a.parseStringPromise)(n),s=[],l=i["p:sld"]?.[0]?.["p:cSld"]?.[0]?.["p:spTree"]?.[0];if(!l)return{success:!0,textBoxes:[],plainText:"",formattedHTML:"",wordCount:0,characterCount:0};let o=l["p:sp"]||[];for(let r=0;r<o.length;r++){let a=await this.parseTextBox(o[r],r,t,e);a&&s.push(a)}let c=this.extractPlainText(s),p=this.generateHTML(s),u=this.countWords(c),h=c.length;return{success:!0,textBoxes:s,plainText:c,formattedHTML:p,wordCount:u,characterCount:h}}catch(t){return console.error(`Erro ao extrair texto formatado do slide ${e}:`,t),{success:!1,textBoxes:[],plainText:"",formattedHTML:"",wordCount:0,characterCount:0,error:t instanceof Error?t.message:"Erro desconhecido"}}}static async parseTextBox(t,e,r,a){try{let n=t["p:txBody"]?.[0];if(!n)return null;let i=t["p:nvSpPr"]?.[0],s=i?.["p:cNvPr"]?.[0],l=s?.$?.id||`text-${e}`,o=t["p:spPr"]?.[0],c=this.extractTransform(o),p=this.extractPadding(n),u=n["a:bodyPr"]?.[0],h=u?.$?.anchor||"t",x=this.mapVerticalAlign(h),f=u?.$?.wrap!=="none",d=[];for(let t of n["a:p"]||[]){let e=await this.parseParagraph(t,r,a);e&&d.push(e)}return{id:l,paragraphs:d,x:c.x,y:c.y,width:c.width,height:c.height,rotation:c.rotation,padding:p,verticalAlign:x,textWrap:f}}catch(t){return console.error("Erro ao parsear text box:",t),null}}static async parseParagraph(t,e,r){try{let a=[],n=[],i=t["a:pPr"]?.[0],s=this.extractParagraphStyle(i),l=this.extractListStyle(i);for(let e of t["a:r"]||[]){let t=this.parseTextRun(e);t&&a.push(t)}for(let a of t["a:hyperlink"]||[]){let t=await this.parseHyperlink(a,e,r);t&&n.push(t)}return{runs:a,style:s,list:l,hyperlinks:n}}catch(t){return console.error("Erro ao parsear par\xe1grafo:",t),null}}static parseTextRun(t){try{let e=t["a:t"]?.[0];if(!e)return null;let r=t["a:rPr"]?.[0],a=this.extractFontStyle(r);return{text:e,style:a}}catch(t){return console.error("Erro ao parsear text run:",t),null}}static extractFontStyle(t){let e;if(!t)return this.getDefaultFontStyle();let r=t.$||{},a=r.sz?parseInt(r.sz)/100:18,n="1"===r.b,i="1"===r.i,s=r.u&&"none"!==r.u,l=r.strike&&"noStrike"!==r.strike,o=t["a:latin"]?.[0]?.$?.typeface,c="#000000",p=t["a:solidFill"]?.[0];p&&(c=this.extractColor(p));let u=t["a:highlight"]?.[0];return u&&(e=this.extractColor(u)),{family:o||"Arial",size:a,bold:n,italic:i,underline:s,strikethrough:l,color:c,highlight:e}}static extractParagraphStyle(t){if(!t)return this.getDefaultParagraphStyle();let e=t.$||{},r=e.algn||"l",a=this.mapAlignment(r),n=t["a:lnSpc"]?.[0],i=n?this.extractLineHeight(n):1.2,s=t["a:spcBef"]?.[0],l=t["a:spcAft"]?.[0],o=s?this.extractSpacing(s):0,c=l?this.extractSpacing(l):0,p=parseInt(e.lvl||"0");return{alignment:a,lineHeight:i,spaceBefore:o,spaceAfter:c,indentLevel:p,indentLeft:parseInt(e.marL||"0")/12700,indentRight:parseInt(e.marR||"0")/12700,indentFirstLine:parseInt(e.indent||"0")/12700}}static extractListStyle(t){if(!t)return;t["a:buFont"]?.[0];let e=t["a:buChar"]?.[0],r=t["a:buAutoNum"]?.[0];if(t["a:buNone"])return{type:"none",level:0};let a=parseInt(t.$?.lvl||"0");if(r){let t=r.$?.type||"arabicPlain",e=parseInt(r.$?.startAt||"1");return{type:"number",level:a,numberFormat:this.mapNumberFormat(t),startAt:e}}if(e)return{type:"bullet",level:a,bulletChar:e.$?.char||"â€¢"}}static async parseHyperlink(t,e,r){try{let a=t.$?.["r:id"],n=t.$?.tooltip,i=(t["a:r"]||[]).map(t=>t["a:t"]?.[0]||"").join(""),s="#";return a&&(s=await this.resolveRelationship(a,e,r)),{text:i,url:s,tooltip:n}}catch(t){return console.error("Erro ao parsear hyperlink:",t),null}}static async resolveRelationship(t,e,r){try{let n=`ppt/slides/_rels/slide${r}.xml.rels`,i=await e.file(n)?.async("text");if(!i)return"#";let s=await (0,a.parseStringPromise)(i),l=(s.Relationships?.Relationship||[]).find(e=>e.$?.Id===t);if(!l)return"#";let o=l.$?.Target,c=l.$?.TargetMode;if("External"===c)return o||"#";return`#slide-${o}`}catch(t){return console.error("Erro ao resolver relacionamento:",t),"#"}}static extractTransform(t){let e=t?.["a:xfrm"]?.[0];if(!e)return{x:0,y:0,width:200,height:100,rotation:0};let r=e["a:off"]?.[0]?.$,a=e["a:ext"]?.[0]?.$,n=e.$?.rot,i=t=>Math.round(parseInt(t)/914400*96);return{x:r?i(r.x):0,y:r?i(r.y):0,width:a?i(a.cx):200,height:a?i(a.cy):100,rotation:n?parseInt(n)/6e4:0}}static extractPadding(t){let e=t["a:bodyPr"]?.[0],r=e?.$||{},a=t=>Math.round(parseInt(t)/12700);return{top:r.tIns?a(r.tIns):5,right:r.rIns?a(r.rIns):5,bottom:r.bIns?a(r.bIns):5,left:r.lIns?a(r.lIns):5}}static extractColor(t){let e=t["a:srgbClr"]?.[0];if(e)return`#${e.$?.val||"000000"}`;let r=t["a:schemeClr"]?.[0];if(r){let t=r.$?.val;return this.resolveSchemeColor(t)}return"#000000"}static extractLineHeight(t){let e=t["a:spcPct"]?.[0]?.$?.val;return e?parseInt(e)/1e5:1.2}static extractSpacing(t){let e=t["a:spcPts"]?.[0]?.$?.val;return e?parseInt(e)/100:0}static mapAlignment(t){return({l:"left",ctr:"center",r:"right",just:"justify",dist:"justify"})[t]||"left"}static mapVerticalAlign(t){return({t:"top",ctr:"middle",b:"bottom"})[t]||"top"}static mapNumberFormat(t){return({arabicPlain:"1",alphaLcParenR:"a",alphaUcParenR:"A",romanLcParenR:"i",romanUcParenR:"I"})[t]||"1"}static resolveSchemeColor(t){return({tx1:"#000000",bg1:"#FFFFFF",accent1:"#4472C4",accent2:"#ED7D31",accent3:"#A5A5A5",accent4:"#FFC000",accent5:"#5B9BD5",accent6:"#70AD47"})[t]||"#000000"}static extractPlainText(t){return t.flatMap(t=>t.paragraphs).flatMap(t=>t.runs).map(t=>t.text).join(" ")}static generateHTML(t){let e='<div class="pptx-content">\n';for(let r of t){for(let t of(e+=`  <div class="text-box" style="position: absolute; left: ${r.x}px; top: ${r.y}px; width: ${r.width}px; height: ${r.height}px; transform: rotate(${r.rotation}deg);">
`,r.paragraphs)){let{alignment:r,lineHeight:a}=t.style;for(let n of(e+=`    <p style="text-align: ${r}; line-height: ${a};">
`,t.runs)){let{family:t,size:r,bold:a,italic:i,underline:s,color:l}=n.style,o=[`font-family: '${t}'`,`font-size: ${r}pt`,`color: ${l}`,a?"font-weight: bold":"",i?"font-style: italic":"",s?"text-decoration: underline":""].filter(Boolean).join("; ");e+=`      <span style="${o}">${this.escapeHTML(n.text)}</span>
`}e+=`    </p>
`}e+=`  </div>
`}return e+"</div>"}static countWords(t){return t.trim().split(/\s+/).filter(Boolean).length}static escapeHTML(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}static getDefaultFontStyle(){return{family:"Arial",size:18,bold:!1,italic:!1,underline:!1,strikethrough:!1,color:"#000000"}}static getDefaultParagraphStyle(){return{alignment:"left",lineHeight:1.2,spaceBefore:0,spaceAfter:0,indentLevel:0,indentLeft:0,indentRight:0,indentFirstLine:0}}}}};