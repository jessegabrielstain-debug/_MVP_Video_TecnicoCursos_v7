(()=>{var e={};e.id=8065,e.ids=[8065],e.modules={92885:e=>{"use strict";e.exports=require("@supabase/supabase-js")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{"use strict";e.exports=require("crypto")},16305:()=>{},70541:(e,r,t)=>{"use strict";t.r(r),t.d(r,{originalPathname:()=>w,patchFetch:()=>S,requestAsyncStorage:()=>v,routeModule:()=>f,serverHooks:()=>h,staticGenerationAsyncStorage:()=>g});var s={};t.r(s),t.d(s,{POST:()=>m,dynamic:()=>p});var a=t(49303),o=t(88716),i=t(60670),n=t(87070),u=t(26231),c=t(91232);class l{validateFile(e,r){return e.size>this.maxFileSizes[r]?{valid:!1,error:`Arquivo muito grande. M\xe1ximo: ${this.formatBytes(this.maxFileSizes[r])}`}:this.allowedTypes[r].includes(e.type)?{valid:!0}:{valid:!1,error:`Tipo de arquivo n\xe3o suportado: ${e.type}`}}async uploadToSupabase(e,r,t,s){try{let s=this.validateFile(e,r);if(!s.valid)return{success:!1,error:s.error};let a=Date.now(),o=e.name.replace(/[^a-z0-9.]/gi,"_"),i=`${t}/${r}s/${a}-${o}`;await new Promise(e=>setTimeout(e,1e3));let n=`/storage/assets/${i}`,u=await this.extractMetadata(e,r);return{success:!0,url:n,fileId:`asset-${a}`,metadata:u}}catch(e){return console.error("Erro no upload:",e),{success:!1,error:"Erro ao fazer upload do arquivo"}}}async extractMetadata(e,r){let t={size:e.size,type:e.type};if("image"===r){let r=await this.getImageDimensions(e);r&&(t.dimensions=r)}if("video"===r||"audio"===r){let r=await this.getMediaDuration(e);r&&(t.duration=r)}return t}getImageDimensions(e){return new Promise(r=>{let t=new Image,s=URL.createObjectURL(e);t.onload=()=>{URL.revokeObjectURL(s),r({width:t.width,height:t.height})},t.onerror=()=>{URL.revokeObjectURL(s),r(null)},t.src=s})}getMediaDuration(e){return new Promise(r=>{let t=document.createElement(e.type.startsWith("video")?"video":"audio"),s=URL.createObjectURL(e);t.onloadedmetadata=()=>{URL.revokeObjectURL(s),r(t.duration)},t.onerror=()=>{URL.revokeObjectURL(s),r(null)},t.src=s})}formatBytes(e){if(0===e)return"0 Bytes";let r=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,r)*100)/100+" "+["Bytes","KB","MB","GB"][r]}constructor(){this.maxFileSizes={image:10485760,video:524288e3,audio:52428800,font:5242880,document:20971520},this.allowedTypes={image:["image/jpeg","image/png","image/gif","image/webp","image/svg+xml"],video:["video/mp4","video/webm","video/quicktime"],audio:["audio/mpeg","audio/wav","audio/ogg","audio/mp3"],font:["font/ttf","font/otf","font/woff","font/woff2"],document:["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]}}}let d=new l,p="force-dynamic";async function m(e){try{let r=await (0,u.default)(c.L);if(!r?.user?.id)return n.NextResponse.json({error:"N\xe3o autenticado"},{status:401});let t=await e.formData(),s=t.get("file"),a=t.get("type"),o=t.get("projectId");if(!s||!a)return n.NextResponse.json({error:"Arquivo e tipo s\xe3o obrigat\xf3rios"},{status:400});let i=await d.uploadToSupabase(s,a,r.user.id,o);if(!i.success)return n.NextResponse.json({error:i.error},{status:400});return n.NextResponse.json({success:!0,asset:{id:i.fileId,url:i.url,type:a,name:s.name,metadata:i.metadata}})}catch(e){return console.error("Erro no upload:",e),n.NextResponse.json({error:"Erro ao fazer upload"},{status:500})}}let f=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/assets/upload/route",pathname:"/api/assets/upload",filename:"route",bundlePath:"app/api/assets/upload/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\app\\api\\assets\\upload\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:v,staticGenerationAsyncStorage:g,serverHooks:h}=f,w="/api/assets/upload/route";function S(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:g})}},91232:(e,r,t)=>{"use strict";t.d(r,{L:()=>f});var s=t(74194),a=t(92885),o=t(98691),i=t(80772),n=t(64198),u=t(8204);let c=process.env.NEXT_PUBLIC_SUPABASE_URL||"",l=process.env.SUPABASE_SERVICE_ROLE_KEY||"",d=!!(c&&l)&&c.includes("supabase.co"),p=d?(0,a.createClient)(c,l,{auth:{persistSession:!1,autoRefreshToken:!1}}):null,m=[(0,i.Z)({name:"Credentials",credentials:{email:{label:"Email",type:"email",placeholder:"seu@email.com"},password:{label:"Senha",type:"password"}},async authorize(e){let r=String(e?.email||"").trim().toLowerCase(),t=String(e?.password||"");if(!r||!t)throw Error("Email e senha s\xe3o obrigat\xf3rios");if(!d||!p)throw console.warn("⚠️ Supabase n\xe3o configurado. Configure as vari\xe1veis de ambiente ou use credenciais de teste."),Error("Servi\xe7o de autentica\xe7\xe3o indispon\xedvel");try{let{data:e,error:s}=await p.from("users").select("id, email, name, role, tier, password_hash, avatar_url, metadata").eq("email",r).single();if(s||!e||!await (0,o.qu)(t,e.password_hash))throw Error("Credenciais inv\xe1lidas");let a=e.metadata&&"object"==typeof e.metadata?e.metadata:{};return{id:e.id,email:e.email,name:e.name,role:e.role||"user",subscriptionTier:e.tier||"free",tier:e.tier||"free",preferences:a,image:e.avatar_url}}catch(e){throw console.error("Erro na autentica\xe7\xe3o:",e),Error("Credenciais inv\xe1lidas")}}})];process.env.GOOGLE_CLIENT_ID&&process.env.GOOGLE_CLIENT_SECRET&&m.push((0,u.Z)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET})),process.env.SMTP_HOST&&process.env.SMTP_USER&&process.env.SMTP_PASS&&m.push((0,n.Z)({server:{host:process.env.SMTP_HOST,port:parseInt(process.env.SMTP_PORT||"587",10),auth:{user:process.env.SMTP_USER,pass:process.env.SMTP_PASS}},from:process.env.SMTP_FROM||process.env.SMTP_USER}));let f={...d?{adapter:(0,s.S3)({url:c,secret:l})}:{},providers:m,callbacks:{async jwt({token:e,user:r}){if(r)e.id=r.id,e.email=r.email,e.role=r.role||"user",e.subscriptionTier=r.subscriptionTier||r.tier||"free",e.preferences=r.preferences||{};else if(e.sub&&d&&p&&(!e.role||!e.subscriptionTier))try{let{data:r}=await p.from("users").select("role, tier, metadata").eq("id",e.sub).single();r&&(e.role=r.role||"user",e.subscriptionTier=r.tier||"free",e.preferences=r.metadata||{})}catch(e){console.error("Erro ao carregar perfil do usu\xe1rio no JWT:",e)}return e},session:async({session:e,token:r})=>(e.user&&(e.user.id=r.id||r.sub,e.user.role=r.role||"user",e.user.subscriptionTier=r.subscriptionTier||"free",e.user.preferences=r.preferences||{}),e)},pages:{signIn:"/login",error:"/auth/error",verifyRequest:"/auth/verify-request",newUser:"/register"},session:{strategy:"jwt",maxAge:2592e3},secret:process.env.NEXTAUTH_SECRET||"test-secret",debug:!1}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[9276,5972,6231,5326],()=>t(70541));module.exports=s})();