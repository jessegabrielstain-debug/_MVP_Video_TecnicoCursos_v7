(()=>{var e={};e.id=7092,e.ids=[7092],e.modules={92885:e=>{"use strict";e.exports=require("@supabase/supabase-js")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},76162:e=>{"use strict";e.exports=require("stream")},74026:e=>{"use strict";e.exports=require("string_decoder")},95346:e=>{"use strict";e.exports=require("timers")},21764:e=>{"use strict";e.exports=require("util")},16305:()=>{},24191:(e,t,s)=>{"use strict";s.r(t),s.d(t,{originalPathname:()=>P,patchFetch:()=>_,requestAsyncStorage:()=>y,routeModule:()=>x,serverHooks:()=>v,staticGenerationAsyncStorage:()=>b});var r={};s.r(r),s.d(r,{POST:()=>f,dynamic:()=>h,runtime:()=>m});var a=s(49303),i=s(88716),o=s(60670),n=s(87070),l=s(26231),d=s(91232),u=s(85662),c=s(89190),p=s.n(c);let m="nodejs",h="force-dynamic";async function f(e){try{let t=await (0,l.default)(d.L),r="true"===process.env.ALLOW_UNAUTHENTICATED_PPTX;if(!t?.user?.id&&!r)return n.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let a=t?.user?.id||process.env.DEV_DEFAULT_USER_ID||"dev-user";t?.user?.id||console.warn("âš ï¸  [PPTX Process] Sess\xe3o ausente. Usando usu\xe1rio fallback para ambiente de desenvolvimento:",a);let i=await e.formData(),o=i.get("file"),c=i.get("title")||o.name.replace(".pptx","");if(!o)return n.NextResponse.json({error:"Nenhum arquivo enviado"},{status:400});console.log(`ðŸ“¤ [PPTX Process] Processando: ${o.name}`);let m=await o.arrayBuffer(),h=await p().loadAsync(m),f=await g(h);if(0===f.length)return n.NextResponse.json({error:"Nenhum slide encontrado no arquivo"},{status:400});console.log(`âœ… [PPTX Process] ${f.length} slides extra\xeddos`);let x=null;if(t?.user?.id)try{let{data:e,error:s}=await u.pR.from("projects").insert({user_id:t.user.id,title:c,description:`Projeto criado a partir de ${o.name}`,file_url:`uploads/${t.user.id}/${Date.now()}_${o.name}`,status:"draft",duration:f.reduce((e,t)=>e+t.estimatedDuration,0),timeline_data:{slides:f.map((e,t)=>({id:`slide-${t}`,slideNumber:e.slideNumber,title:e.title,elements:e.elements,duration:e.estimatedDuration,thumbnail:e.thumbnail})),totalDuration:f.reduce((e,t)=>e+t.estimatedDuration,0)}}).select().single();if(s)throw s;x=e,console.log(`âœ… [PPTX Process] Projeto salvo no Supabase: ${x.id}`)}catch(r){console.warn("âš ï¸  [PPTX Process] Supabase falhou, usando fallback:",r);let{fallbackStorage:e}=await s.e(2152).then(s.bind(s,42152));x=e.createProject({user_id:t.user.id,title:c,description:`Projeto criado a partir de ${o.name}`,file_url:`uploads/${t.user.id}/${Date.now()}_${o.name}`,status:"draft",duration:f.reduce((e,t)=>e+t.estimatedDuration,0),timeline_data:{slides:f.map((e,t)=>({id:`slide-${t}`,slideNumber:e.slideNumber,title:e.title,elements:e.elements,duration:e.estimatedDuration,thumbnail:e.thumbnail})),totalDuration:f.reduce((e,t)=>e+t.estimatedDuration,0)}}),console.log(`âœ… [PPTX Process] Projeto salvo em mem\xf3ria: ${x.id}`)}else{let{fallbackStorage:e}=await s.e(2152).then(s.bind(s,42152));x=e.createProject({user_id:a,title:c,description:`Projeto criado a partir de ${o.name}`,file_url:`uploads/${a}/${Date.now()}_${o.name}`,status:"draft",duration:f.reduce((e,t)=>e+t.estimatedDuration,0),timeline_data:{slides:f.map((e,t)=>({id:`slide-${t}`,slideNumber:e.slideNumber,title:e.title,elements:e.elements,duration:e.estimatedDuration,thumbnail:e.thumbnail})),totalDuration:f.reduce((e,t)=>e+t.estimatedDuration,0)}}),console.log(`âœ… [PPTX Process] Projeto salvo em mem\xf3ria (sem sess\xe3o): ${x.id}`)}return n.NextResponse.json({success:!0,project:{id:x.id,title:x.title,slideCount:f.length,duration:x.duration,thumbnail:f[0]?.thumbnail},slides:f.map(e=>({slideNumber:e.slideNumber,title:e.title,thumbnail:e.thumbnail,content:e.content,notes:e.notes,hasImages:e.hasImages,hasAnimations:e.hasAnimations,estimatedDuration:e.estimatedDuration})),metadata:{totalSlides:f.length,estimatedDuration:f.reduce((e,t)=>e+t.estimatedDuration,0),totalImages:f.filter(e=>e.hasImages).length,totalAnimations:f.filter(e=>e.hasAnimations).length}})}catch(e){return console.error("âŒ [PPTX Process] Erro:",e),n.NextResponse.json({error:"Erro ao processar arquivo",details:e instanceof Error?e.message:"Erro desconhecido"},{status:500})}}async function g(e){let{PPTXVideoParser:t}=await Promise.all([s.e(8159),s.e(2822)]).then(s.bind(s,32822)),{PPTXShapeParser:r}=await Promise.all([s.e(8159),s.e(5508)]).then(s.bind(s,85508)),{PPTXAnimationParser:a}=await Promise.all([s.e(8159),s.e(7550)]).then(s.bind(s,17550)),{PPTXTextParserAdvanced:i}=await Promise.all([s.e(8159),s.e(9348)]).then(s.bind(s,19348)),o=[],n=Object.keys(e.files).filter(e=>e.match(/ppt\/slides\/slide\d+\.xml/)).sort((e,t)=>parseInt(e.match(/\d+/)?.[0]||"0")-parseInt(t.match(/\d+/)?.[0]||"0"));console.log(`ðŸ“„ Processando ${n.length} slides com extra\xe7\xe3o avan\xe7ada...`);for(let s=0;s<n.length;s++){let l=s+1,d=[],u=0;try{let c=await i.extractFormattedText(e,l);if(c.success)for(let e of c.textBoxes)d.push({id:e.id,type:"text",content:e.paragraphs.map(e=>e.runs.map(e=>e.text).join("")).join("\n"),transform:{x:e.x,y:e.y,width:e.width,height:e.height,rotation:e.rotation},zIndex:u++,style:{opacity:1,fontFamily:e.paragraphs[0]?.runs[0]?.style.family||"Arial",fontSize:e.paragraphs[0]?.runs[0]?.style.size||18,color:e.paragraphs[0]?.runs[0]?.style.color||"#000000",textAlign:e.paragraphs[0]?.style.alignment||"left"},visible:!0,locked:!1});let p=await r.extractShapesFromSlide(e,l);if(p.success){for(let e of p.shapes)d.push({id:e.id,type:e.type,content:e.textContent,geometry:e.geometry,transform:{x:e.transform.x,y:e.transform.y,width:e.transform.width,height:e.transform.height,rotation:e.transform.rotation,flipH:e.transform.flipH,flipV:e.transform.flipV},zIndex:e.zIndex+u,style:{fill:e.style.fill,stroke:e.style.stroke,opacity:e.style.opacity,filters:e.style.effects},visible:!e.hidden,locked:e.locked,children:e.children?.map(e=>({id:e.id,type:e.type,content:e.textContent,geometry:e.geometry,transform:{x:e.transform.x,y:e.transform.y,width:e.transform.width,height:e.transform.height,rotation:e.transform.rotation},zIndex:e.zIndex,style:{fill:e.style.fill,stroke:e.style.stroke,opacity:e.style.opacity},visible:!0,locked:!1}))});u+=p.shapes.length}let m=await t.extractVideosFromSlide(e,l);if(m.success)for(let e of m.videos)d.push({id:e.id,type:"video",src:e.src,transform:{x:100,y:100,width:e.width||640,height:e.height||360,rotation:0},zIndex:u++,style:{opacity:1},visible:!0,locked:!1});let h=await a.extractAnimationsFromSlide(e,l);if(h.success&&h.sequences.length>0)for(let e of h.sequences[0].animations){let t=d.find(t=>t.id===e.elementId);t&&(t.animations||(t.animations=[]),t.animations.push({type:e.type,effect:e.effect,duration:e.duration,delay:e.delay,easing:e.easing}))}d.sort((e,t)=>e.zIndex-t.zIndex);let f=d.filter(e=>"text"===e.type).map(e=>e.content).join(" ").substring(0,50)||`Slide ${l}`,g=d.filter(e=>"text"===e.type).map(e=>e.content).join("\n"),x=d.some(e=>"image"===e.type),y=d.some(e=>"video"===e.type),b=d.some(e=>e.animations&&e.animations.length>0),v=5,P=g.length;P>100&&(v+=2*Math.ceil(P/100)),x&&(v+=2),y&&(v+=5),b&&(v+=3),v=Math.min(v,45);let _="",S=n[s];if(await e.file(S)?.async("text"))for(let t of[`ppt/media/image${l}.png`,`ppt/media/image${l}.jpg`,`ppt/media/image${l}.jpeg`,"ppt/media/image1.png"]){let s=e.file(t);if(s){let e=await s.async("base64"),r=t.split(".").pop();_=`data:image/${r};base64,${e}`;break}}_||(_=function(e,t){let s=[["139,92,246","59,130,246"],["249,115,22","239,68,68"],["34,197,94","16,185,129"],["236,72,153","168,85,247"]],r=s[(e-1)%s.length],a=`
    <svg width="1920" height="1080" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <linearGradient id="grad${e}" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:rgb(${r[0]});stop-opacity:1" />
          <stop offset="100%" style="stop-color:rgb(${r[1]});stop-opacity:1" />
        </linearGradient>
      </defs>
      <rect width="1920" height="1080" fill="url(#grad${e})" />
      <text x="960" y="500" font-family="Arial, sans-serif" font-size="120" font-weight="bold" fill="white" text-anchor="middle" opacity="0.9">
        ${e}
      </text>
      <text x="960" y="620" font-family="Arial, sans-serif" font-size="48" fill="white" text-anchor="middle" opacity="0.8">
        ${t.substring(0,30)}
      </text>
    </svg>
  `;return`data:image/svg+xml;base64,${Buffer.from(a).toString("base64")}`}(l,f)),o.push({slideNumber:l,title:f,content:g,notes:null,elements:d,thumbnail:_,hasImages:x||y,hasAnimations:b,estimatedDuration:v}),console.log(`âœ… Slide ${l}: ${d.length} elementos extra\xeddos`)}catch(e){console.error(`âŒ Erro ao processar slide ${l}:`,e)}}return o}let x=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/pptx/process/route",pathname:"/api/pptx/process",filename:"route",bundlePath:"app/api/pptx/process/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\app\\api\\pptx\\process\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:y,staticGenerationAsyncStorage:b,serverHooks:v}=x,P="/api/pptx/process/route";function _(){return(0,o.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:b})}},91232:(e,t,s)=>{"use strict";s.d(t,{L:()=>h});var r=s(74194),a=s(92885),i=s(98691),o=s(80772),n=s(64198),l=s(8204);let d=process.env.NEXT_PUBLIC_SUPABASE_URL||"",u=process.env.SUPABASE_SERVICE_ROLE_KEY||"",c=!!(d&&u)&&d.includes("supabase.co"),p=c?(0,a.createClient)(d,u,{auth:{persistSession:!1,autoRefreshToken:!1}}):null,m=[(0,o.Z)({name:"Credentials",credentials:{email:{label:"Email",type:"email",placeholder:"seu@email.com"},password:{label:"Senha",type:"password"}},async authorize(e){let t=String(e?.email||"").trim().toLowerCase(),s=String(e?.password||"");if(!t||!s)throw Error("Email e senha s\xe3o obrigat\xf3rios");if(!c||!p)throw console.warn("âš ï¸ Supabase n\xe3o configurado. Configure as vari\xe1veis de ambiente ou use credenciais de teste."),Error("Servi\xe7o de autentica\xe7\xe3o indispon\xedvel");try{let{data:e,error:r}=await p.from("users").select("id, email, name, role, tier, password_hash, avatar_url, metadata").eq("email",t).single();if(r||!e||!await (0,i.qu)(s,e.password_hash))throw Error("Credenciais inv\xe1lidas");let a=e.metadata&&"object"==typeof e.metadata?e.metadata:{};return{id:e.id,email:e.email,name:e.name,role:e.role||"user",subscriptionTier:e.tier||"free",tier:e.tier||"free",preferences:a,image:e.avatar_url}}catch(e){throw console.error("Erro na autentica\xe7\xe3o:",e),Error("Credenciais inv\xe1lidas")}}})];process.env.GOOGLE_CLIENT_ID&&process.env.GOOGLE_CLIENT_SECRET&&m.push((0,l.Z)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET})),process.env.SMTP_HOST&&process.env.SMTP_USER&&process.env.SMTP_PASS&&m.push((0,n.Z)({server:{host:process.env.SMTP_HOST,port:parseInt(process.env.SMTP_PORT||"587",10),auth:{user:process.env.SMTP_USER,pass:process.env.SMTP_PASS}},from:process.env.SMTP_FROM||process.env.SMTP_USER}));let h={...c?{adapter:(0,r.S3)({url:d,secret:u})}:{},providers:m,callbacks:{async jwt({token:e,user:t}){if(t)e.id=t.id,e.email=t.email,e.role=t.role||"user",e.subscriptionTier=t.subscriptionTier||t.tier||"free",e.preferences=t.preferences||{};else if(e.sub&&c&&p&&(!e.role||!e.subscriptionTier))try{let{data:t}=await p.from("users").select("role, tier, metadata").eq("id",e.sub).single();t&&(e.role=t.role||"user",e.subscriptionTier=t.tier||"free",e.preferences=t.metadata||{})}catch(e){console.error("Erro ao carregar perfil do usu\xe1rio no JWT:",e)}return e},session:async({session:e,token:t})=>(e.user&&(e.user.id=t.id||t.sub,e.user.role=t.role||"user",e.user.subscriptionTier=t.subscriptionTier||"free",e.user.preferences=t.preferences||{}),e)},pages:{signIn:"/login",error:"/auth/error",verifyRequest:"/auth/verify-request",newUser:"/register"},session:{strategy:"jwt",maxAge:2592e3},secret:process.env.NEXTAUTH_SECRET||"test-secret",debug:!1}},85662:(e,t,s)=>{"use strict";s.d(t,{pR:()=>d});var r=s(92885);let a=process.env.NEXT_PUBLIC_SUPABASE_URL||"",i=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"",o=process.env.SUPABASE_SERVICE_ROLE_KEY||"",n=null;a&&i?(0,r.createClient)(a,i,{auth:{persistSession:!0,autoRefreshToken:!0,storage:void 0,storageKey:"supabase.auth.token"}}):(0,r.createClient)("https://placeholder.supabase.co","placeholder-key",{auth:{persistSession:!1,autoRefreshToken:!1}});let l=null,d=l=a&&o?(0,r.createClient)(a,o,{auth:{persistSession:!1,autoRefreshToken:!1}}):(0,r.createClient)("https://placeholder.supabase.co","placeholder-service-key",{auth:{persistSession:!1,autoRefreshToken:!1}})}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[9276,5972,6231,5326,9190],()=>s(24191));module.exports=r})();