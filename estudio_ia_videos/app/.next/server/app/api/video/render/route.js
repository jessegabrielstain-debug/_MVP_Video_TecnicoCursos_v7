(()=>{var e={};e.id=8401,e.ids=[8401],e.modules={92885:e=>{"use strict";e.exports=require("@supabase/supabase-js")},46718:e=>{"use strict";e.exports=require("canvas")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},78893:e=>{"use strict";e.exports=require("buffer")},61282:e=>{"use strict";e.exports=require("child_process")},84770:e=>{"use strict";e.exports=require("crypto")},80665:e=>{"use strict";e.exports=require("dns")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},20629:e=>{"use strict";e.exports=require("fs/promises")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},85807:e=>{"use strict";e.exports=require("module")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74026:e=>{"use strict";e.exports=require("string_decoder")},82452:e=>{"use strict";e.exports=require("tls")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},6162:e=>{"use strict";e.exports=require("worker_threads")},71568:e=>{"use strict";e.exports=require("zlib")},16305:()=>{},65169:(e,r,t)=>{"use strict";t.r(r),t.d(r,{originalPathname:()=>b,patchFetch:()=>q,requestAsyncStorage:()=>T,routeModule:()=>y,serverHooks:()=>_,staticGenerationAsyncStorage:()=>E});var s={};t.r(s),t.d(s,{GET:()=>S,POST:()=>v,dynamic:()=>f,runtime:()=>m});var i=t(49303),o=t(88716),a=t(60670),n=t(87070),u=t(91232),c=t(84770),l=t(67589);class p{async render(e){try{let r=Array.isArray(e.slides)?e.slides:[];if(0===r.length)return{success:!1,error:"Nenhum slide dispon\xedvel para renderiza\xe7\xe3o"};let t=this.generateJobId(),s=(0,l.h)(),i=r.map((e,r)=>({id:e.id||`slide-${r+1}`,title:this.extractTitle(e,r),content:this.extractTextBlocks(e).map(e=>({text:e})),notes:this.extractNotes(e),images:this.extractImages(e),duration:this.extractDuration(e)})),o=this.buildConfig(e);await s.addJob({jobId:t,projectId:e.projectId,userId:e.userId,slides:i,config:o});let a=i.reduce((e,r)=>e+(r.duration||0),0);return{success:!0,jobId:t,duration:a}}catch(e){return console.error("[VideoRenderer] Erro ao enfileirar renderiza\xe7\xe3o:",e),{success:!1,error:e instanceof Error?e.message:"Erro desconhecido"}}}async getStatus(e){let r=(0,l.h)(),t=await r.getJobStatus(e);return t?{status:t.status,progress:t.progress,videoUrl:t.videoUrl,error:t.error}:{status:"queued",progress:0}}buildConfig(e){let r={"4K":{width:3840,height:2160},"1080p":{width:1920,height:1080},"720p":{width:1280,height:720}},t={low:"web",medium:"standard",high:"high"},s=r[e.resolution]||r["1080p"],i=t[e.quality]||t.high;return{fps:e.fps,resolution:s,quality:i,transition:e.transition||"fade",audioProvider:e.audioProvider||"elevenlabs",voiceId:e.voiceId}}extractTitle(e,r){let t=this.normalizeText(e.title);if(t)return t;let s=this.extractTextBlocks(e);return s.length>0?s[0]:`Slide ${r+1}`}extractTextBlocks(e){let r=new Set,t=e=>{let t=this.normalizeText(e);t&&r.add(t)};if(t(e.content),Array.isArray(e.elements)){for(let r of e.elements)if(r&&(("text"===r.type||"richText"===r.type)&&t(r.content||r.text||r.value),Array.isArray(r.children)))for(let e of r.children)t(e?.content||e?.text||e?.value)}return Array.from(r)}extractImages(e){if(!Array.isArray(e.elements))return[];let r=[];for(let t of e.elements)if(t&&"image"===t.type){let e=t.src||t.url||t.dataUrl;"string"==typeof e&&e.trim().length>0&&r.push(e.trim())}return r}extractNotes(e){return this.normalizeText(e.notes)||void 0}extractDuration(e){let r=e.duration??e.estimatedDuration;return"number"==typeof r&&r>0?r:5}normalizeText(e){if(Array.isArray(e)){let r=e.map(e=>this.normalizeText(e)).filter(e=>"string"==typeof e&&e.length>0);return 0===r.length?null:r.join(" ")}if("string"==typeof e){let r=e.replace(/\s+/g," ").trim();return r.length>0?r:null}return"object"==typeof e&&null!==e&&"text"in e?this.normalizeText(e.text):null}generateJobId(){return"function"==typeof c.randomUUID?(0,c.randomUUID)():`job_${Date.now()}_${Math.random().toString(36).slice(2,11)}`}}let d=new p;var h=t(85662);let m="nodejs",f="force-dynamic",x=null;async function g(){if(x)return x;let e=await t.e(6231).then(t.bind(t,26231));if("function"!=typeof e.getServerSession)throw Error("getServerSession n\xe3o est\xe1 dispon\xedvel na instala\xe7\xe3o de next-auth");return x=e.getServerSession}async function v(e){try{let r=await g(),s=await r(u.L);if(!s?.user?.id)return n.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let{projectId:i,resolution:o,fps:a,format:c,quality:l,transition:p,audioProvider:m,voiceId:f}=await e.json();if(!i)return n.NextResponse.json({error:"projectId \xe9 obrigat\xf3rio"},{status:400});console.log(`[Render API] Iniciando renderiza\xe7\xe3o: ${i}`);let x=null;try{let{data:e}=await h.pR.from("projects").select("*").eq("id",i).single();x=e}catch{let{fallbackStorage:e}=await t.e(2152).then(t.bind(t,42152));x=e.getProject(i)}if(!x)return n.NextResponse.json({error:"Projeto n\xe3o encontrado"},{status:404});let v=x.timeline_data?.slides||[];if(0===v.length)return n.NextResponse.json({error:"Projeto sem slides"},{status:400});let S=await d.render({projectId:i,userId:s.user.id,slides:v,resolution:o||"1080p",fps:a||30,format:c||"mp4",quality:l||"high",transition:p,audioProvider:m,voiceId:f});if(!S.success)return n.NextResponse.json({error:S.error},{status:500});try{await h.pR.from("projects").update({status:"processing"}).eq("id",i)}catch{let{fallbackStorage:e}=await t.e(2152).then(t.bind(t,42152));e.updateProject(i,{status:"processing"})}return n.NextResponse.json({success:!0,jobId:S.jobId,message:"Renderiza\xe7\xe3o iniciada",estimatedTime:S.duration})}catch(e){return console.error("[Render API] Erro:",e),n.NextResponse.json({error:"Erro ao iniciar renderiza\xe7\xe3o"},{status:500})}}async function S(e){try{let{searchParams:r}=e.nextUrl,t=r.get("jobId");if(!t)return n.NextResponse.json({error:"jobId \xe9 obrigat\xf3rio"},{status:400});let s=await d.getStatus(t);return n.NextResponse.json({success:!0,...s})}catch(e){return n.NextResponse.json({error:"Erro ao verificar status"},{status:500})}}let y=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/video/render/route",pathname:"/api/video/render",filename:"route",bundlePath:"app/api/video/render/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\app\\api\\video\\render\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:T,staticGenerationAsyncStorage:E,serverHooks:_}=y,b="/api/video/render/route";function q(){return(0,a.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:E})}},91232:(e,r,t)=>{"use strict";t.d(r,{L:()=>m});var s=t(74194),i=t(92885),o=t(98691),a=t(80772),n=t(64198),u=t(8204);let c=process.env.NEXT_PUBLIC_SUPABASE_URL||"",l=process.env.SUPABASE_SERVICE_ROLE_KEY||"",p=!!(c&&l)&&c.includes("supabase.co"),d=p?(0,i.createClient)(c,l,{auth:{persistSession:!1,autoRefreshToken:!1}}):null,h=[(0,a.Z)({name:"Credentials",credentials:{email:{label:"Email",type:"email",placeholder:"seu@email.com"},password:{label:"Senha",type:"password"}},async authorize(e){let r=String(e?.email||"").trim().toLowerCase(),t=String(e?.password||"");if(!r||!t)throw Error("Email e senha s\xe3o obrigat\xf3rios");if(!p||!d)throw console.warn("⚠️ Supabase n\xe3o configurado. Configure as vari\xe1veis de ambiente ou use credenciais de teste."),Error("Servi\xe7o de autentica\xe7\xe3o indispon\xedvel");try{let{data:e,error:s}=await d.from("users").select("id, email, name, role, tier, password_hash, avatar_url, metadata").eq("email",r).single();if(s||!e||!await (0,o.qu)(t,e.password_hash))throw Error("Credenciais inv\xe1lidas");let i=e.metadata&&"object"==typeof e.metadata?e.metadata:{};return{id:e.id,email:e.email,name:e.name,role:e.role||"user",subscriptionTier:e.tier||"free",tier:e.tier||"free",preferences:i,image:e.avatar_url}}catch(e){throw console.error("Erro na autentica\xe7\xe3o:",e),Error("Credenciais inv\xe1lidas")}}})];process.env.GOOGLE_CLIENT_ID&&process.env.GOOGLE_CLIENT_SECRET&&h.push((0,u.Z)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET})),process.env.SMTP_HOST&&process.env.SMTP_USER&&process.env.SMTP_PASS&&h.push((0,n.Z)({server:{host:process.env.SMTP_HOST,port:parseInt(process.env.SMTP_PORT||"587",10),auth:{user:process.env.SMTP_USER,pass:process.env.SMTP_PASS}},from:process.env.SMTP_FROM||process.env.SMTP_USER}));let m={...p?{adapter:(0,s.S3)({url:c,secret:l})}:{},providers:h,callbacks:{async jwt({token:e,user:r}){if(r)e.id=r.id,e.email=r.email,e.role=r.role||"user",e.subscriptionTier=r.subscriptionTier||r.tier||"free",e.preferences=r.preferences||{};else if(e.sub&&p&&d&&(!e.role||!e.subscriptionTier))try{let{data:r}=await d.from("users").select("role, tier, metadata").eq("id",e.sub).single();r&&(e.role=r.role||"user",e.subscriptionTier=r.tier||"free",e.preferences=r.metadata||{})}catch(e){console.error("Erro ao carregar perfil do usu\xe1rio no JWT:",e)}return e},session:async({session:e,token:r})=>(e.user&&(e.user.id=r.id||r.sub,e.user.role=r.role||"user",e.user.subscriptionTier=r.subscriptionTier||"free",e.user.preferences=r.preferences||{}),e)},pages:{signIn:"/login",error:"/auth/error",verifyRequest:"/auth/verify-request",newUser:"/register"},session:{strategy:"jwt",maxAge:2592e3},secret:process.env.NEXTAUTH_SECRET||"test-secret",debug:!1}},85662:(e,r,t)=>{"use strict";t.d(r,{pR:()=>c});var s=t(92885);let i=process.env.NEXT_PUBLIC_SUPABASE_URL||"",o=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"",a=process.env.SUPABASE_SERVICE_ROLE_KEY||"",n=null;i&&o?(0,s.createClient)(i,o,{auth:{persistSession:!0,autoRefreshToken:!0,storage:void 0,storageKey:"supabase.auth.token"}}):(0,s.createClient)("https://placeholder.supabase.co","placeholder-key",{auth:{persistSession:!1,autoRefreshToken:!1}});let u=null,c=u=i&&a?(0,s.createClient)(i,a,{auth:{persistSession:!1,autoRefreshToken:!1}}):(0,s.createClient)("https://placeholder.supabase.co","placeholder-service-key",{auth:{persistSession:!1,autoRefreshToken:!1}})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[9276,5972,5326,5135,6608,7248],()=>t(65169));module.exports=s})();