"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4311],{64311:function(e,t,i){i.r(t);var r=i(57437),n=i(2265),l=i(38282),s=i(87295),a=i.n(s),o=i(26245);let u=e=>{let{element:t,isSelected:i,onSelect:s,onChange:a,currentTime:o,isPlaying:u,onTimeUpdate:c}=e,h=(0,n.useRef)(null),f={id:t.id,x:t.x,y:t.y,width:t.width,height:t.height,rotation:t.rotation,scaleX:t.scaleX,scaleY:t.scaleY,draggable:!0,onClick:s,onTap:s,onDragEnd:e=>{a({x:e.target.x(),y:e.target.y()})},onTransformEnd:e=>{let t=e.target,i=t.scaleX(),r=t.scaleY();t.scaleX(1),t.scaleY(1),a({x:t.x(),y:t.y(),width:Math.max(5,t.width()*i),height:Math.max(5,t.height()*r),rotation:t.rotation()})}},g=o>=t.startTime&&o<=t.startTime+t.duration;return"video"===t.type&&t.src?(0,r.jsx)(d,{element:t,commonProps:f,currentTime:o,isPlaying:u,onTimeUpdate:c,isVisible:g}):"text"===t.type?g?(0,r.jsx)(l.xv,{ref:h,...f,text:t.text||"Text",fontSize:24,fill:t.fill||"black"}):null:"shape"===t.type&&g?(0,r.jsx)(l.UL,{ref:h,...f,fill:t.fill||"gray"}):null},d=e=>{let{element:t,commonProps:i,currentTime:s,isPlaying:u,onTimeUpdate:d,isVisible:c}=e,h=(0,n.useRef)(null),[f,g]=(0,n.useState)(null),m=(0,o.E)(e=>e.registerVideoElement),x=(0,o.E)(e=>e.unregisterVideoElement);return((0,n.useEffect)(()=>{if(!t.src)return;let e=document.createElement("video");return e.src=t.src,e.crossOrigin="anonymous",e.muted=!1,g(e),m(t.id,e),()=>{e.pause(),e.src="",e.remove(),x(t.id)}},[t.src,t.id,m,x]),(0,n.useEffect)(()=>{if(!f)return;let e=(s-t.startTime)/1e3;e>=0&&e<=t.duration/1e3?(Math.abs(f.currentTime-e)>.3&&(f.currentTime=e),u?f.play().catch(e=>{}):f.pause()):f.pause()},[s,u,t.startTime,t.duration,f]),(0,n.useEffect)(()=>{if(!f||!h.current)return;let e=new(a()).Animation(()=>{},h.current.getLayer());if(u&&c)e.start();else{var t;e.stop(),null===(t=h.current.getLayer())||void 0===t||t.batchDraw()}return()=>{e.stop()}},[u,c,f]),c)?(0,r.jsx)(n.Fragment,{children:f&&(0,r.jsx)(l.Ee,{ref:h,...i,image:f})}):null},c=e=>{let{selectedId:t}=e,i=(0,n.useRef)(null);return(0,n.useEffect)(()=>{if(t&&i.current){let r=i.current.getStage(),n=null==r?void 0:r.findOne("#"+t);if(n){var e;i.current.nodes([n]),null===(e=i.current.getLayer())||void 0===e||e.batchDraw()}else i.current.nodes([])}else i.current&&i.current.nodes([])},[t]),(0,r.jsx)(l.$T,{ref:i,boundBoxFunc:(e,t)=>t.width<5||t.height<5?e:t})};t.default=e=>{var t,i,s,a;let{stageRef:d}=e,h=(0,n.useRef)(null),[f,g]=(0,n.useState)({width:0,height:0}),m=(0,o.E)(e=>e.elements),x=(0,o.E)(e=>e.selectedId),v=(0,o.E)(e=>e.selectElement),y=(0,o.E)(e=>e.updateElement),w=(0,o.E)(e=>e.addElement),E=(0,o.E)(e=>e.currentTime),p=(0,o.E)(e=>e.isPlaying),T=(0,o.E)(e=>e.setCurrentTime),b=(0,o.E)(e=>e.subtitles).find(e=>E>=e.startTime&&E<=e.endTime);(0,n.useEffect)(()=>{if(h.current){let{offsetWidth:e,offsetHeight:t}=h.current;g({width:e,height:t})}let e=()=>{if(h.current){let{offsetWidth:e,offsetHeight:t}=h.current;g({width:e,height:t})}};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let j=e=>{e.target===e.target.getStage()&&v(null)};return(0,r.jsx)("div",{className:"w-full h-full bg-gray-100",ref:h,onDragOver:e=>{e.preventDefault()},onDrop:e=>{var t,i;e.preventDefault(),null===(t=d.current)||void 0===t||t.setPointersPositions(e);let r=null===(i=d.current)||void 0===i?void 0:i.getPointerPosition();if(!r)return;let n=e.dataTransfer.getData("application/json");if(n){let{type:e,src:t}=JSON.parse(n),i=100,l=100;"video"===e&&(i=320,l=180),"text"===e&&(i=200,l=50),w({id:"".concat(e,"-").concat(Date.now()),type:e,x:r.x-i/2,y:r.y-l/2,width:i,height:l,rotation:0,scaleX:1,scaleY:1,zIndex:m.length+1,fill:"shape"===e?"#FF5733":void 0,text:"text"===e?"Double Click to Edit":void 0,src:t})}},children:(0,r.jsx)(l.Hf,{width:f.width,height:f.height,onMouseDown:j,onTouchStart:j,ref:d,children:(0,r.jsxs)(l.mh,{children:[(0,r.jsx)(l.UL,{x:0,y:0,width:f.width,height:f.height,fill:"#f0f0f0",listening:!1}),m.map(e=>(0,r.jsx)(u,{element:e,isSelected:x===e.id,onSelect:()=>v(e.id),onChange:t=>y(e.id,t),currentTime:E,isPlaying:p,onTimeUpdate:e=>T(e)},e.id)),b&&(0,r.jsx)(l.xv,{text:b.text,fontSize:(null===(t=b.style)||void 0===t?void 0:t.fontSize)||24,fontFamily:(null===(i=b.style)||void 0===i?void 0:i.fontFamily)||"Arial",fill:(null===(s=b.style)||void 0===s?void 0:s.fill)||"white",align:(null===(a=b.style)||void 0===a?void 0:a.align)||"center",width:f.width-100,x:50,y:f.height-100,stroke:"black",strokeWidth:1,shadowColor:"black",shadowBlur:2,shadowOpacity:.8,listening:!1}),(0,r.jsx)(c,{selectedId:x})]})})})}}}]);