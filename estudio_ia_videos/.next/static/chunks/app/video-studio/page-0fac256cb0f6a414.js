(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[784],{37878:function(e,t,a){Promise.resolve().then(a.bind(a,84829))},84829:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return eu},dynamic:function(){return em}});var r=a(57437),s=a(2265),l=a(40521),i=a(10795);let o=()=>({id:crypto.randomUUID(),name:"Untitled Project",duration:3e4,fps:30,resolution:{width:1920,height:1080},currentTime:0,zoomLevel:1,selectedElementIds:[],clipboardElements:[],layers:[{id:"video-layer",name:"Video",type:"video",visible:!0,locked:!1,height:60,color:"#3b82f6",elements:[]},{id:"audio-layer",name:"Audio",type:"audio",visible:!0,locked:!1,height:40,color:"#10b981",elements:[]},{id:"overlay-layer",name:"Overlay",type:"overlay",visible:!0,locked:!1,height:50,color:"#f59e0b",elements:[]}],settings:{backgroundColor:"#000000",audioSampleRate:48e3,videoBitrate:8e3,audioBitrate:320},history:{past:[],present:null,future:[]}});function n(e,t){switch(t.type){case"ADD_ELEMENT":{let a={...e},r=a.layers.findIndex(e=>e.id===t.layerId);return r>=0&&(a.layers[r]={...a.layers[r],elements:[...a.layers[r].elements,t.element]}),a}case"REMOVE_ELEMENT":{let a={...e};return a.layers=a.layers.map(e=>({...e,elements:e.elements.filter(e=>e.id!==t.elementId)})),a.selectedElementIds=(a.selectedElementIds||[]).filter(e=>e!==t.elementId),a}case"UPDATE_ELEMENT":{let a={...e};return a.layers=a.layers.map(e=>({...e,elements:e.elements.map(e=>e.id===t.elementId?{...e,...t.updates}:e)})),a}case"MOVE_ELEMENT":{let a={...e},r=null,s="";if(a.layers=a.layers.map(e=>{let a=e.elements.findIndex(e=>e.id===t.elementId);return a>=0?(r=e.elements[a],s=e.id,{...e,elements:e.elements.filter((e,t)=>t!==a)}):e}),r){let e=t.newLayerId||s,l={...r,start:t.newStartTime};a.layers=a.layers.map(t=>t.id===e?{...t,elements:[...t.elements,l]}:t)}return a}case"RESIZE_ELEMENT":{let a={...e};return a.layers=a.layers.map(e=>({...e,elements:e.elements.map(e=>e.id===t.elementId?{...e,duration:t.newDuration}:e)})),a}case"ADD_KEYFRAME":{let a={...e};return a.layers=a.layers.map(e=>({...e,elements:e.elements.map(e=>e.id===t.elementId?{...e,keyframes:[...e.keyframes||[],t.keyframe]}:e)})),a}case"SET_CURRENT_TIME":return{...e,currentTime:Math.max(0,t.time)};case"SET_ZOOM_LEVEL":return{...e,zoomLevel:Math.max(.1,Math.min(10,t.zoomLevel))};case"SET_SELECTION":return{...e,selectedElementIds:t.selection.elementIds};case"ADD_LAYER":return{...e,layers:[...e.layers,t.layer]};case"REMOVE_LAYER":return{...e,layers:e.layers.filter(e=>e.id!==t.layerId)};case"UPDATE_LAYER":return{...e,layers:e.layers.map(e=>e.id===t.layerId?{...e,...t.updates}:e)};case"COPY_ELEMENTS":{let a=[];return e.layers.forEach(e=>{e.elements.forEach(e=>{t.elementIds.includes(e.id)&&a.push(e)})}),{...e,clipboardElements:a}}case"PASTE_ELEMENTS":{var a;let r={...e};if(r.layers.find(e=>e.id===t.targetLayerId)&&((null===(a=e.clipboardElements)||void 0===a?void 0:a.length)||0)>0){let a=(e.clipboardElements||[]).map((e,a)=>({...e,id:crypto.randomUUID(),start:t.targetTime+100*a,keyframes:(e.keyframes||[]).map(e=>({...e,id:crypto.randomUUID()}))}));r.layers=r.layers.map(e=>e.id===t.targetLayerId?{...e,elements:[...e.elements,...a]}:e)}return r}default:return e}}function d(){let e=(0,s.useMemo)(()=>o(),[]),[t,a]=(0,s.useReducer)(n,e),r=(0,s.useRef)(),l=(0,s.useRef)(!1),i=(0,s.useRef)(0),d=(0,s.useCallback)(()=>{if(!l.current){l.current=!0,i.current=Date.now()-t.currentTime;let e=()=>{if(l.current){let s=Date.now()-i.current;s<=t.duration?(a({type:"SET_CURRENT_TIME",time:s}),r.current=requestAnimationFrame(e)):c()}};r.current=requestAnimationFrame(e)}},[t.currentTime,t.duration]),c=(0,s.useCallback)(()=>{l.current=!1,r.current&&cancelAnimationFrame(r.current)},[]),m=(0,s.useCallback)(()=>{c(),a({type:"SET_CURRENT_TIME",time:0})},[c]),u=(0,s.useCallback)(e=>{a({type:"SET_CURRENT_TIME",time:e})},[]),x=(0,s.useCallback)((e,t)=>{a({type:"ADD_ELEMENT",element:e,layerId:t})},[]),h=(0,s.useCallback)(e=>{a({type:"REMOVE_ELEMENT",elementId:e})},[]),p=(0,s.useCallback)((e,t)=>{a({type:"UPDATE_ELEMENT",elementId:e,updates:t})},[]),g=(0,s.useCallback)((e,t,r)=>{a({type:"MOVE_ELEMENT",elementId:e,newStartTime:t,newLayerId:r})},[]),b=(0,s.useCallback)((e,t)=>{a({type:"RESIZE_ELEMENT",elementId:e,newDuration:t})},[]),y=(0,s.useCallback)((e,t)=>{a({type:"ADD_KEYFRAME",elementId:e,keyframe:t})},[]),v=(0,s.useCallback)(e=>{a({type:"SET_SELECTION",selection:{elementIds:e,startTime:0,endTime:0,layerIds:[]}})},[]),j=(0,s.useCallback)(e=>{v([e])},[v]),f=(0,s.useCallback)(()=>{v([])},[v]),N=(0,s.useCallback)(e=>{a({type:"ADD_LAYER",layer:e})},[]),w=(0,s.useCallback)(e=>{a({type:"REMOVE_LAYER",layerId:e})},[]),E=(0,s.useCallback)((e,t)=>{a({type:"UPDATE_LAYER",layerId:e,updates:t})},[]),k=(0,s.useCallback)(e=>{a({type:"COPY_ELEMENTS",elementIds:e})},[]),T=(0,s.useCallback)((e,t)=>{a({type:"PASTE_ELEMENTS",targetTime:e,targetLayerId:t})},[]),C=(0,s.useCallback)(()=>{a({type:"SET_ZOOM_LEVEL",zoomLevel:1.2*t.zoomLevel})},[t.zoomLevel]),S=(0,s.useCallback)(()=>{a({type:"SET_ZOOM_LEVEL",zoomLevel:t.zoomLevel/1.2})},[t.zoomLevel]),M=(0,s.useCallback)(e=>{a({type:"SET_ZOOM_LEVEL",zoomLevel:e})},[]),z=(0,s.useCallback)(e=>{let a=[];return t.layers.forEach(t=>{t.elements.forEach(t=>{t.start<=e&&e<=t.start+t.duration&&a.push(t)})}),a},[t.layers]),Z=(0,s.useCallback)(()=>{let e=[];return t.layers.forEach(a=>{a.elements.forEach(a=>{(t.selectedElementIds||[]).includes(a.id)&&e.push(a)})}),e},[t.layers,t.selectedElementIds]);return(0,s.useEffect)(()=>()=>{r.current&&cancelAnimationFrame(r.current)},[]),{project:t,isPlaying:l.current,play:d,pause:c,stop:m,seek:u,addElement:x,removeElement:h,updateElement:p,moveElement:g,resizeElement:b,addKeyframe:y,selectElement:j,selectElements:v,clearSelection:f,getSelectedElements:Z,addLayer:N,removeLayer:w,updateLayer:E,copyElements:k,pasteElements:T,zoomIn:C,zoomOut:S,setZoom:M,getElementsAtTime:z,dispatch:a}}let c=(0,a(27695).U)(e=>({currentTime:0,duration:0,isPlaying:!1,zoom:1,volume:1,canUndo:!1,canRedo:!1,project:null,selection:{elementIds:[],layerIds:[],startTime:0,endTime:0},dragData:null,scrollX:0,pixelsPerSecond:50,collaborators:[],isDragging:!1,beatMarkers:[],continuousFlowEnabled:!1,setCurrentTime:t=>e({currentTime:t}),setDuration:t=>e({duration:t}),play:()=>e({isPlaying:!0}),pause:()=>e({isPlaying:!1}),setZoom:t=>e({zoom:t}),setVolume:t=>e({volume:t}),seekTo:t=>e({currentTime:t}),stop:()=>e({isPlaying:!1,currentTime:0}),undo:()=>console.log("Undo not implemented"),redo:()=>console.log("Redo not implemented"),zoomToFit:()=>e({zoom:1}),saveProject:()=>console.log("Save project not implemented"),addRenderJob:e=>console.log("Add render job",e),selectElement:(t,a)=>e(e=>({selection:{...e.selection,elementIds:a?[...e.selection.elementIds,t]:[t]}})),selectLayer:(t,a)=>e(e=>({selection:{...e.selection,layerIds:a?[...e.selection.layerIds,t]:[t]}})),clearSelection:()=>e({selection:{elementIds:[],layerIds:[],startTime:0,endTime:0}}),startDrag:t=>e({dragData:t,isDragging:!0}),endDrag:()=>e({dragData:null,isDragging:!1}),setScrollX:t=>e({scrollX:t}),setPixelsPerSecond:t=>e({pixelsPerSecond:t}),addCollaborator:t=>e(e=>({collaborators:[...e.collaborators,t]})),removeCollaborator:t=>e(e=>({collaborators:e.collaborators.filter(e=>e.id!==t)})),loadProject:t=>e({project:t}),addElement:e=>console.log("Add element not implemented",e),moveElement:(e,t,a)=>console.log("Move element not implemented",e,t,a),updateElement:(e,t)=>console.log("Update element not implemented",e,t),setBeatMarkers:t=>e({beatMarkers:t}),enableContinuousFlow:t=>e({continuousFlowEnabled:t})}));var m=a(45274),u=a(89227),x=a(33276),h=a(61094),p=a(51548),g=a(91723),b=a(81706),y=a(45802),v=a(43391),j=a(47416),f=a(28124),N=a(92735),w=a(68919),E=a(98728);let k=e=>{let{onPlayPause:t,onZoomChange:a,onShowKeyframes:s,showKeyframes:i,readOnly:o=!1}=e,{currentTime:n,isPlaying:d,duration:k,volume:T,zoom:C,canUndo:S,canRedo:M,project:z,setVolume:Z,seekTo:I,stop:L,undo:D,redo:P,zoomToFit:R,saveProject:A,addRenderJob:_}=c(),O=e=>{let t=Math.floor(e%1*((null==z?void 0:z.framerate)||30));return"".concat(Math.floor(e/60).toString().padStart(2,"0"),":").concat(Math.floor(e%60).toString().padStart(2,"0"),":").concat(t.toString().padStart(2,"0"))};return(0,r.jsxs)("div",{className:"timeline-toolbar flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("button",{onClick:()=>I(0),disabled:o,className:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",title:"Go to start",children:(0,r.jsx)(m.Z,{size:16})}),(0,r.jsx)("button",{onClick:t,disabled:o,className:"p-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg disabled:opacity-50 disabled:cursor-not-allowed",title:d?"Pause":"Play",children:d?(0,r.jsx)(u.Z,{size:16}):(0,r.jsx)(x.Z,{size:16})}),(0,r.jsx)("button",{onClick:L,disabled:o,className:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",title:"Stop",children:(0,r.jsx)(h.Z,{size:16})}),(0,r.jsx)("button",{onClick:()=>I(k),disabled:o,className:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",title:"Go to end",children:(0,r.jsx)(p.Z,{size:16})})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2 text-sm font-mono",children:[(0,r.jsx)(g.Z,{size:14,className:"text-gray-500"}),(0,r.jsx)("span",{className:"text-blue-600 dark:text-blue-400",children:O(n)}),(0,r.jsx)("span",{className:"text-gray-500",children:"/"}),(0,r.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:O(k)})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(b.Z,{size:14,className:"text-gray-500"}),(0,r.jsx)("input",{type:"range",min:"0",max:"1",step:"0.1",value:T,onChange:e=>Z(parseFloat(e.target.value)),disabled:o,className:"w-16 h-1 bg-gray-300 rounded-lg appearance-none cursor-pointer disabled:cursor-not-allowed"}),(0,r.jsxs)("span",{className:"text-xs text-gray-500 w-8",children:[Math.round(100*T),"%"]})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("button",{onClick:()=>a(-.2),disabled:o||C<=.1,className:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",title:"Zoom out",children:(0,r.jsx)(y.Z,{size:16})}),(0,r.jsxs)("span",{className:"text-sm font-mono text-gray-600 dark:text-gray-400 min-w-[3rem] text-center",children:[Math.round(100*C),"%"]}),(0,r.jsx)("button",{onClick:()=>a(.2),disabled:o||C>=10,className:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",title:"Zoom in",children:(0,r.jsx)(v.Z,{size:16})}),(0,r.jsx)("button",{onClick:R,disabled:o,className:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",title:"Fit to timeline",children:(0,r.jsx)(j.Z,{size:16})})]}),(0,r.jsx)("div",{className:"flex items-center space-x-2",children:(0,r.jsx)("button",{onClick:s,disabled:o,className:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed ".concat(i?"bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-400":""),title:"Toggle keyframes panel",children:(0,r.jsx)(f.Z,{size:16})})}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("button",{onClick:D,disabled:o||!S,className:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",title:"Undo",children:(0,r.jsx)(l.E.div,{whileHover:{rotate:-15},whileTap:{scale:.9},children:"↶"})}),(0,r.jsx)("button",{onClick:P,disabled:o||!M,className:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",title:"Redo",children:(0,r.jsx)(l.E.div,{whileHover:{rotate:15},whileTap:{scale:.9},children:"↷"})}),(0,r.jsx)("button",{onClick:A,disabled:o,className:"px-3 py-2 bg-green-600 hover:bg-green-700 text-white text-sm rounded-lg disabled:opacity-50 disabled:cursor-not-allowed",title:"Save project",children:"Save"}),(0,r.jsxs)("button",{onClick:()=>{z&&!o&&_({projectId:z.id,settings:{format:"mp4",resolution:z.resolution,framerate:z.framerate,quality:"good",codec:"h264",audio:{codec:"aac",bitrate:128,sampleRate:44100}},status:"queued",progress:0})},disabled:o,className:"px-3 py-2 bg-purple-600 hover:bg-purple-700 text-white text-sm rounded-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-1",title:"Export video",children:[(0,r.jsx)(N.Z,{size:14}),(0,r.jsx)("span",{children:"Export"})]}),(0,r.jsx)("button",{disabled:o,className:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",title:"Share project",children:(0,r.jsx)(w.Z,{size:16})}),(0,r.jsx)("button",{disabled:o,className:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",title:"Timeline settings",children:(0,r.jsx)(E.Z,{size:16})})]})]})};var T=a(93662),C=a(59892),S=a(29374),M=a(22106),z=a(53113),Z=a(75277),I=a(48736),L=a(92369),D=a(11239),P=a(88623),R=a(87769),A=a(66337);let _=e=>{var t,a,i,o,n,d,c;let{element:m,isSelected:u,isDragging:x,zoom:p,pixelsPerSecond:g,onClick:b,readOnly:y=!1,showWaveform:v=!1}=e,{attributes:j,listeners:f,setNodeRef:N,transform:w,transition:E,isDragging:k}=(0,T.nB)({id:m.id,disabled:y||m.locked}),_={transform:C.ux.Transform.toString(w),transition:E},O=(0,s.useMemo)(()=>m.duration*g>80,[m.duration,g]),U=(0,s.useMemo)(()=>m.duration*g>120&&p>.5,[m.duration,g,p]),V=m.duration*g;return(0,r.jsxs)(l.E.div,{ref:N,style:_,...j,...f,className:"\n        timeline-element relative h-full rounded border-2 cursor-pointer select-none overflow-hidden\n        ".concat((()=>{if(x||k)return"bg-blue-100 dark:bg-blue-900/50";if(u)return"bg-blue-50 dark:bg-blue-900/30";switch(m.type){case"video":return"bg-blue-100 dark:bg-blue-900/20";case"audio":return"bg-green-100 dark:bg-green-900/20";case"image":return"bg-purple-100 dark:bg-purple-900/20";case"text":return"bg-yellow-100 dark:bg-yellow-900/20";case"shape":default:return"bg-gray-100 dark:bg-gray-900/20";case"pptx-slide":return"bg-orange-100 dark:bg-orange-900/20";case"avatar-3d":return"bg-pink-100 dark:bg-pink-900/20";case"effect":return"bg-red-100 dark:bg-red-900/20"}})(),"\n        ").concat(u?"border-blue-400 dark:border-blue-500":"border-gray-300 dark:border-gray-600","\n        ").concat(m.locked?"opacity-60":"","\n        ").concat(x||k?"shadow-lg z-50":"","\n        ").concat(u?"shadow-md":"","\n        transition-all duration-150\n      "),onClick:b,whileHover:y||m.locked?{}:{scale:1.02},whileTap:y||m.locked?{}:{scale:.98},children:[(0,r.jsx)("div",{className:"absolute left-0 top-0 bottom-0 w-1 ".concat((()=>{switch(m.type){case"video":return"bg-blue-500";case"audio":return"bg-green-500";case"image":return"bg-purple-500";case"text":return"bg-yellow-500";case"shape":default:return"bg-gray-500";case"pptx-slide":return"bg-orange-500";case"avatar-3d":return"bg-pink-500";case"effect":return"bg-red-500"}})())}),!!(null===(t=m.data)||void 0===t?void 0:t.thumbnail)&&U&&(0,r.jsx)("div",{className:"absolute left-2 top-1 w-8 h-8 rounded overflow-hidden bg-black/20",children:(0,r.jsx)("img",{src:null===(a=m.data)||void 0===a?void 0:a.thumbnail,alt:m.name,className:"w-full h-full object-cover"})}),(0,r.jsxs)("div",{className:"flex items-center h-full px-2 py-1",children:[(0,r.jsx)("div",{className:"flex-shrink-0 text-gray-600 dark:text-gray-400 mr-2",children:(()=>{switch(m.type){case"video":return(0,r.jsx)(S.Z,{size:14});case"audio":return(0,r.jsx)(M.Z,{size:14});case"image":return(0,r.jsx)(z.Z,{size:14});case"text":return(0,r.jsx)(Z.Z,{size:14});case"shape":default:return(0,r.jsx)(h.Z,{size:14});case"pptx-slide":return(0,r.jsx)(I.Z,{size:14});case"avatar-3d":return(0,r.jsx)(L.Z,{size:14});case"effect":return(0,r.jsx)(D.Z,{size:14})}})()}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[O&&(0,r.jsx)("div",{className:"text-xs font-medium text-gray-900 dark:text-gray-100 truncate",children:(d=m.name||"Element",c=V-40,8*d.length<=c?d:d.substring(0,Math.floor(c/8)-3)+"...")}),U&&(0,r.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-500 truncate",children:[m.duration.toFixed(1),"s",m.sourceUrl&&(0,r.jsxs)("span",{className:"ml-1",children:["• ",m.sourceType||"media"]})]})]}),U&&(0,r.jsxs)("div",{className:"flex-shrink-0 flex items-center space-x-1 ml-1",children:[m.muted&&(0,r.jsx)("div",{title:"Muted",children:(0,r.jsx)(P.Z,{size:10,className:"text-red-500"})}),!m.visible&&(0,r.jsx)("div",{title:"Hidden",children:(0,r.jsx)(R.Z,{size:10,className:"text-gray-500"})}),m.locked&&(0,r.jsx)("div",{title:"Locked",children:(0,r.jsx)(A.Z,{size:10,className:"text-yellow-500"})})]})]}),v&&"audio"===m.type&&(0,r.jsx)("div",{className:"absolute inset-0 opacity-30",children:(0,r.jsx)("svg",{className:"w-full h-full",children:Array.from({length:Math.floor(V/4)}).map((e,t)=>{let a=20*Math.random()+5;return(0,r.jsx)("rect",{x:4*t,y:(40-a)/2,width:2,height:a,fill:"currentColor",className:"text-green-400"},t)})})}),u&&!y&&!m.locked&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"absolute left-0 top-0 bottom-0 w-2 cursor-w-resize bg-blue-400 opacity-0 hover:opacity-100 transition-opacity"}),(0,r.jsx)("div",{className:"absolute right-0 top-0 bottom-0 w-2 cursor-e-resize bg-blue-400 opacity-0 hover:opacity-100 transition-opacity"})]}),(null!==(n=null===(i=m.keyframes)||void 0===i?void 0:i.length)&&void 0!==n?n:0)>0&&U&&(0,r.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-gradient-to-r from-yellow-400 to-orange-400"}),(null===(o=m.metadata)||void 0===o?void 0:o.hasError)&&(0,r.jsx)("div",{className:"absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full",title:"Element has errors"})]})},O=()=>null,U=()=>null,V=e=>{let t,{project:a,currentTime:o,zoom:n,scrollX:d,pixelsPerSecond:c,selection:m,onElementClick:u,onTimelineClick:x,showKeyframes:h,readOnly:p=!1}=e,{setNodeRef:g,isOver:b}=(0,i.Zj)({id:"timeline-canvas",data:{type:"timeline",time:o}}),y=(0,s.useMemo)(()=>({startTime:d/c,endTime:(d+1200)/c}),[d,c]),v=(0,s.useMemo)(()=>a.tracks&&a.tracks.length>0?a.tracks:[{id:"default-track",name:"Default Track",type:"default",layers:a.layers}],[a.tracks,a.layers]),j=(0,s.useMemo)(()=>{let e=[];return v.forEach(t=>{t.layers.forEach(a=>{a.elements.forEach(r=>{var s,l;let i=null!==(s=r.startTime)&&void 0!==s?s:r.start;(null!==(l=r.endTime)&&void 0!==l?l:i+r.duration)>=y.startTime&&i<=y.endTime&&e.push({element:r,layerId:a.id,trackId:t.id})})})}),e},[v,y]),f=(0,s.useMemo)(()=>{let e=new Map,t=0;return v.forEach(a=>{a.layers.forEach(a=>{e.set(a.id,{top:t,height:a.height||100}),t+=a.height||100})}),e},[v]),N=(0,s.useCallback)((e,t)=>{t.stopPropagation(),u(e,t)},[u]),w=(0,s.useCallback)(e=>{var t;let a=f.get(e.layerId||"");if(!a)return{};let r=(null!==(t=e.startTime)&&void 0!==t?t:e.start)*c-d,s=e.duration*c;return{left:"".concat(r,"px"),top:"".concat(a.top,"px"),width:"".concat(s,"px"),height:"".concat(a.height-4,"px"),position:"absolute"}},[f,c,d]),E=(0,s.useMemo)(()=>v.reduce((e,t)=>e+t.layers.reduce((e,t)=>e+(t.height||100),0),0)||0,[v]);return(0,r.jsxs)("div",{ref:g,className:"timeline-canvas relative overflow-hidden cursor-crosshair select-none ".concat(b?"bg-blue-50 dark:bg-blue-900/20":""),style:{height:"".concat(E,"px")},onClick:x,children:[(()=>{let e=[];a.duration;let t=Math.floor(y.startTime),s=Math.ceil(y.endTime);for(let a=t;a<=s;a++){let t=a*c-d;t>=-1&&t<=1201&&e.push((0,r.jsx)("div",{className:"absolute top-0 bottom-0 w-px bg-gray-300 dark:bg-gray-600 opacity-30",style:{left:"".concat(t,"px")}},"major-".concat(a)))}if(n>.5&&a.framerate){let l=1/a.framerate;for(let a=t;a<=s;a+=l){let t=a*c-d;t>=-1&&t<=1201&&e.push((0,r.jsx)("div",{className:"absolute top-0 bottom-0 w-px bg-gray-200 dark:bg-gray-700 opacity-20",style:{left:"".concat(t,"px")}},"minor-".concat(a)))}}return e})(),(t=0,v.map((e,a)=>{let s=e.layers.reduce((e,t)=>e+(t.height||100),0),l=(0,r.jsx)("div",{className:"absolute left-0 right-0 ".concat(a%2==0?"bg-gray-50 dark:bg-gray-800":"bg-white dark:bg-gray-900"),style:{top:"".concat(t,"px"),height:"".concat(s,"px")}},e.id);return t+=s,l})),(()=>{let e=[],t=0;return v.forEach(a=>{a.layers.forEach((a,s)=>{s>0&&e.push((0,r.jsx)("div",{className:"absolute left-0 right-0 h-px bg-gray-200 dark:bg-gray-700",style:{top:"".concat(t,"px")}},"separator-".concat(a.id))),t+=a.height||100})}),e})(),(0,r.jsx)(O,{markers:a.markers,pixelsPerSecond:c,scrollX:d,height:E}),j.map(e=>{var t;let{element:a,layerId:s}=e,i=m.elementIds.includes(a.id);return(0,r.jsxs)(l.E.div,{style:w(a),initial:!1,animate:{scale:i?1.02:1,zIndex:i?10:1},transition:{duration:.15},children:[(0,r.jsx)(_,{element:a,isSelected:i,isDragging:!1,zoom:n,pixelsPerSecond:c,onClick:e=>N(a.id,e),readOnly:p,showWaveform:"audio"===a.type&&n>.3}),"audio"===a.type&&n>.3&&(0,r.jsx)(U,{audioUrl:a.sourceUrl||"",startTime:a.startTime,duration:a.duration,pixelsPerSecond:c,height:(null===(t=f.get(s))||void 0===t?void 0:t.height)||60})]},a.id)}),b&&(0,r.jsx)(l.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 border-2 border-blue-400 border-dashed bg-blue-50 dark:bg-blue-900/20 pointer-events-none"})]})};function F(e){let{duration:t,pixelsPerMs:a,zoomLevel:s}=e,l=e=>{let t=Math.floor(e/1e3);return"".concat(Math.floor(t/60),":").concat((t%60).toString().padStart(2,"0"))};return(0,r.jsx)("div",{className:"timeline-ruler relative h-8 bg-gray-850 border-b border-gray-700 overflow-hidden",children:(0,r.jsx)("div",{className:"relative h-full",style:{width:Math.max(t*a,300)+"px"},children:(()=>{let e=[];for(let s=0;s<=t;s+=5e3){let t=s*a;e.push((0,r.jsxs)("div",{className:"absolute top-0 flex flex-col items-center",style:{left:t},children:[(0,r.jsx)("div",{className:"h-4 bg-gray-400 w-px"}),(0,r.jsx)("span",{className:"text-xs text-gray-400 mt-1 font-mono",children:l(s)})]},s))}return e})()})})}function B(e){let{currentTime:t,pixelsPerMs:a,height:s,onSeek:l}=e;return(0,r.jsx)("div",{className:"absolute top-0 z-10 pointer-events-auto",style:{left:t*a,height:s},children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:"w-0.5 h-full bg-red-500 shadow-lg"}),(0,r.jsx)("div",{className:"absolute -top-2 -left-2 w-4 h-4 bg-red-500 rounded-full cursor-pointer shadow-lg"}),(0,r.jsxs)("div",{className:"absolute -top-8 -left-8 bg-red-500 text-white text-xs px-2 py-1 rounded font-mono whitespace-nowrap",children:[Math.floor(t/1e3/60),":",Math.floor(t/1e3%60).toString().padStart(2,"0")]})]})})}var K=a(42208),H=a(49589),Y=a(71533),X=a(2207),Q=a(78867),q=a(18930);function W(e){let{layer:t,onToggleVisibility:a,onToggleLock:i,onRename:o,onDelete:n}=e,[d,c]=(0,s.useState)(!1),[m,u]=(0,s.useState)(t.name),[x,h]=(0,s.useState)(!1),p=()=>{m.trim()&&m!==t.name&&o(t.id,m.trim()),c(!1)};return(0,r.jsxs)(l.E.div,{className:"timeline-layer-header relative flex items-center p-2 border-b border-gray-700 hover:bg-gray-750 transition-colors group",style:{height:t.height},initial:{opacity:0,x:-20},animate:{opacity:1,x:0},children:[(0,r.jsx)("div",{className:"w-1 h-full absolute left-0 top-0",style:{backgroundColor:t.color}}),(0,r.jsxs)("div",{className:"flex-1 ml-2",children:[d?(0,r.jsx)("input",{type:"text",value:m,onChange:e=>u(e.target.value),onBlur:p,onKeyDown:e=>{"Enter"===e.key?p():"Escape"===e.key&&(u(t.name),c(!1))},className:"w-full bg-gray-600 text-white text-sm px-2 py-1 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0}):(0,r.jsx)("div",{className:"text-sm text-gray-200 font-medium cursor-pointer hover:text-white",onClick:()=>c(!0),children:t.name}),(0,r.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:[t.elements.length," element",1!==t.elements.length?"s":""]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-1 opacity-60 group-hover:opacity-100 transition-opacity",children:[(0,r.jsx)("button",{onClick:()=>a(t.id),className:"p-1 rounded hover:bg-gray-600 transition-colors ".concat(t.visible?"text-gray-300 hover:text-white":"text-gray-500"),title:t.visible?"Hide layer":"Show layer",children:t.visible?(0,r.jsx)(K.Z,{size:14}):(0,r.jsx)(R.Z,{size:14})}),(0,r.jsx)("button",{onClick:()=>i(t.id),className:"p-1 rounded hover:bg-gray-600 transition-colors ".concat(t.locked?"text-yellow-400":"text-gray-300 hover:text-white"),title:t.locked?"Unlock layer":"Lock layer",children:t.locked?(0,r.jsx)(A.Z,{size:14}):(0,r.jsx)(H.Z,{size:14})}),"audio"===t.type&&(0,r.jsx)("button",{className:"p-1 rounded hover:bg-gray-600 transition-colors text-gray-300 hover:text-white",title:"Audio settings",children:(0,r.jsx)(b.Z,{size:14})}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("button",{onClick:()=>h(!x),className:"p-1 rounded hover:bg-gray-600 transition-colors text-gray-300 hover:text-white",title:"Layer options",children:(0,r.jsx)(Y.Z,{size:14})}),x&&(0,r.jsxs)(l.E.div,{initial:{opacity:0,scale:.95,y:-10},animate:{opacity:1,scale:1,y:0},className:"absolute right-0 top-8 bg-gray-800 border border-gray-600 rounded-lg shadow-lg z-50 py-1 min-w-36",onMouseLeave:()=>h(!1),children:[(0,r.jsxs)("button",{onClick:()=>{c(!0),h(!1)},className:"w-full px-3 py-1.5 text-left text-sm text-gray-300 hover:text-white hover:bg-gray-700 flex items-center space-x-2",children:[(0,r.jsx)(X.Z,{size:12}),(0,r.jsx)("span",{children:"Rename"})]}),(0,r.jsxs)("button",{onClick:()=>{h(!1)},className:"w-full px-3 py-1.5 text-left text-sm text-gray-300 hover:text-white hover:bg-gray-700 flex items-center space-x-2",children:[(0,r.jsx)(Q.Z,{size:12}),(0,r.jsx)("span",{children:"Duplicate"})]}),(0,r.jsx)("hr",{className:"border-gray-600 my-1"}),(0,r.jsxs)("button",{onClick:()=>{n(t.id),h(!1)},className:"w-full px-3 py-1.5 text-left text-sm text-red-400 hover:text-red-300 hover:bg-gray-700 flex items-center space-x-2",children:[(0,r.jsx)(q.Z,{size:12}),(0,r.jsx)("span",{children:"Delete"})]})]})]})]})]})}var J=a(10306),G=a(50417),$=a(67782);let ee={video:S.Z,audio:J.Z,text:Z.Z,image:z.Z,shape:G.Z,transition:$.Z,effect:G.Z,avatar:L.Z,"avatar-3d":L.Z,"pptx-slide":I.Z},et={video:"bg-blue-600",audio:"bg-green-600",text:"bg-purple-600",image:"bg-yellow-600",shape:"bg-red-600",transition:"bg-gray-600",effect:"bg-pink-600",avatar:"bg-indigo-600","avatar-3d":"bg-indigo-700","pptx-slide":"bg-orange-600"};function ea(e){var t,a,i,o,n,d,c,m,u,x,h;let{element:p,pixelsPerMs:g,isSelected:b,isDragging:y,onSelect:v,onUpdate:j,onMove:f,onResize:N}=e,[w,E]=(0,s.useState)(null),[k,S]=(0,s.useState)(!1);(0,s.useRef)(null);let M=(0,s.useRef)({startX:0,originalDuration:0,originalStartTime:0}),{attributes:z,listeners:Z,setNodeRef:I,transform:L,transition:D,isDragging:_}=(0,T.nB)({id:p.id,data:{type:"timeline-element",element:p}}),O=p.duration*g,U={transform:C.ux.Transform.toString(L),transition:D,width:Math.max(O,20),opacity:y||_?.6:1},V=ee[p.type],F=et[p.type],B=(0,s.useCallback)((e,t)=>{var a;e.stopPropagation(),E(t),M.current={startX:e.clientX,originalDuration:p.duration,originalStartTime:null!==(a=p.startTime)&&void 0!==a?a:p.start};let r=e=>{let a=(e.clientX-M.current.startX)/g;if("right"===t){let e=Math.max(100,M.current.originalDuration+a);null==N||N(e)}else{let e=Math.max(0,M.current.originalStartTime+a),t=Math.max(100,M.current.originalDuration-a);null==f||f(e),null==N||N(t)}},s=()=>{E(null),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",s)};document.addEventListener("mousemove",r),document.addEventListener("mouseup",s)},[p.duration,p.startTime,g,N,f]);return(0,s.useCallback)(e=>{p.properties&&j({properties:{...p.properties,[e]:!p.properties[e]}})},[p.properties,j]),(0,r.jsxs)(l.E.div,{ref:I,style:U,...z,...Z,className:"timeline-element relative rounded-md overflow-hidden cursor-move select-none group\n        ".concat(F," ").concat(b?"ring-2 ring-white ring-opacity-80":"","\n        ").concat((null===(t=p.properties)||void 0===t?void 0:t.locked)?"cursor-not-allowed":"","\n        ").concat((null===(a=p.properties)||void 0===a?void 0:a.visible)?"":"opacity-50","\n        shadow-sm hover:shadow-md transition-all duration-200"),onClick:e=>{e.stopPropagation(),v()},onMouseEnter:()=>S(!0),onMouseLeave:()=>S(!1),children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-black/20 to-transparent"}),(0,r.jsxs)("div",{className:"relative h-full flex items-center px-2 space-x-2",children:[(0,r.jsx)(V,{size:16,className:"text-white/90 flex-shrink-0"}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("div",{className:"text-white/90 text-xs font-medium truncate",children:p.name}),O>80&&(0,r.jsx)("div",{className:"text-white/60 text-xs truncate",children:(e=>{let t=e/1e3;return t<60?"".concat(t.toFixed(1),"s"):"".concat(Math.floor(t/60),":").concat(Math.floor(t%60).toString().padStart(2,"0"))})(p.duration)})]}),(k||b)&&O>60&&(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[!(null===(i=p.properties)||void 0===i?void 0:i.visible)&&(0,r.jsx)(R.Z,{size:12,className:"text-white/60"}),(null===(o=p.properties)||void 0===o?void 0:o.locked)&&(0,r.jsx)(A.Z,{size:12,className:"text-white/60"}),"audio"===p.type&&(null===(n=p.data)||void 0===n?void 0:n.volume)===0&&(0,r.jsx)(P.Z,{size:12,className:"text-white/60"})]})]}),"audio"===p.type&&O>100&&(0,r.jsx)("div",{className:"absolute bottom-1 left-2 right-2 h-3 opacity-30",children:(0,r.jsx)("div",{className:"h-full bg-white/20 rounded-sm flex items-center justify-center",children:(0,r.jsx)("div",{className:"w-full h-1 bg-white/40 rounded-full"})})}),("video"===p.type||"image"===p.type)&&(null===(d=p.data)||void 0===d?void 0:d.imageUrl)&&O>80&&(0,r.jsx)("div",{className:"absolute top-1 right-1 w-8 h-6 rounded overflow-hidden opacity-60",children:(0,r.jsx)("img",{src:p.data.imageUrl,alt:"Thumbnail",className:"w-full h-full object-cover"})}),"pptx-slide"===p.type&&(null===(m=p.data)||void 0===m?void 0:null===(c=m.slideData)||void 0===c?void 0:c.backgroundImage)&&O>100&&(0,r.jsx)("div",{className:"absolute top-1 right-1 w-12 h-8 rounded overflow-hidden opacity-60 border border-white/20",children:(0,r.jsx)("img",{src:p.data.slideData.backgroundImage,alt:"Slide preview",className:"w-full h-full object-cover"})}),(null!==(h=null===(u=p.keyframes)||void 0===u?void 0:u.length)&&void 0!==h?h:0)>0&&O>60&&(0,r.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-yellow-400 to-orange-400 opacity-60"}),!(null===(x=p.properties)||void 0===x?void 0:x.locked)&&(k||b||w)&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"absolute left-0 top-0 bottom-0 w-2 cursor-ew-resize bg-white/20 hover:bg-blue-400 transition-colors opacity-0 group-hover:opacity-100",onMouseDown:e=>B(e,"left")}),(0,r.jsx)("div",{className:"absolute right-0 top-0 bottom-0 w-2 cursor-ew-resize bg-white/20 hover:bg-blue-400 transition-colors opacity-0 group-hover:opacity-100",onMouseDown:e=>B(e,"right")})]}),b&&(0,r.jsx)(l.E.div,{initial:{scale:0},animate:{scale:1},className:"absolute -top-1 -right-1 w-3 h-3 bg-white rounded-full shadow-lg"}),k&&(0,r.jsx)("div",{className:"absolute top-1 left-1",children:(0,r.jsx)("button",{className:"w-4 h-4 bg-black/40 rounded hover:bg-black/60 flex items-center justify-center transition-colors opacity-0 group-hover:opacity-100",onClick:e=>{e.stopPropagation()},children:(0,r.jsx)($.Z,{size:10,className:"text-white"})})})]})}function er(e){let{className:t="",onExport:a,onImport:l,height:o=400,showPreview:n=!0}=e,c=d(),[m,u]=(0,s.useState)(null),[x,h]=(0,s.useState)(null),p=(0,s.useRef)(null),[g,b]=(0,s.useState)(800),y=(g-200)/(c.project.duration*c.project.zoomLevel),v=c.project.duration*y;(0,s.useEffect)(()=>{let e=()=>{p.current&&b(p.current.clientWidth)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let j=(0,s.useCallback)(e=>{let{active:t}=e;u(t.id);let a=null;c.project.layers.forEach(e=>{let r=e.elements.find(e=>e.id===t.id);r&&(a=r)}),h(a)},[c.project.layers]),f=(0,s.useCallback)(e=>{let{active:t,over:a,delta:r}=e;if(!a){u(null),h(null);return}let s=t.id,l=a.id,i=r.x/y,o=null,n="";if(c.project.layers.forEach(e=>{let t=e.elements.find(e=>e.id===s);t&&(o=t,n=e.id)}),o){var d,m;let e=o,t=null!==(m=null!==(d=e.startTime)&&void 0!==d?d:e.start)&&void 0!==m?m:0,a=c.project.layers.find(e=>e.id===l)?l:n;c.moveElement(s,Math.max(0,t+i),a)}u(null),h(null)},[c,y]);(0,s.useEffect)(()=>{let e=e=>{if(!(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement))switch(e.key){case" ":e.preventDefault(),c.isPlaying?c.pause():c.play();break;case"Delete":case"Backspace":e.preventDefault(),(c.project.selectedElementIds||[]).forEach(e=>{c.removeElement(e)});break;case"c":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),c.copyElements(c.project.selectedElementIds||[]));break;case"v":if(e.ctrlKey||e.metaKey){e.preventDefault();let t=c.project.layers[0];t&&c.pasteElements(c.project.currentTime,t.id)}break;case"a":if(e.ctrlKey||e.metaKey){e.preventDefault();let t=[];c.project.layers.forEach(e=>{e.elements.forEach(e=>{t.push(e.id)})}),c.selectElements(t)}break;case"Escape":c.clearSelection();break;case"+":case"=":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),c.zoomIn());break;case"-":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),c.zoomOut())}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[c]);let N=e=>{let t=Math.floor(e/1e3);return"".concat(Math.floor(t/60).toString().padStart(2,"0"),":").concat((t%60).toString().padStart(2,"0"),".").concat(Math.floor(e%1e3/10).toString().padStart(2,"0"))};return(0,r.jsxs)("div",{className:"timeline-editor flex flex-col bg-gray-900 text-white ".concat(t),style:{height:o},children:[(0,r.jsx)(k,{isPlaying:c.isPlaying,currentTime:c.project.currentTime,duration:c.project.duration,zoomLevel:c.project.zoomLevel,showKeyframes:!1,onPlay:c.play,onPause:c.pause,onPlayPause:()=>c.isPlaying?c.pause():c.play(),onStop:c.stop,onSeek:c.seek,onZoomIn:c.zoomIn,onZoomOut:c.zoomOut,onZoomChange:c.setZoom,onShowKeyframes:()=>{},onExport:a,onImport:l}),(0,r.jsxs)("div",{className:"flex-1 flex overflow-hidden",ref:p,children:[(0,r.jsxs)("div",{className:"w-48 bg-gray-800 border-r border-gray-700",children:[(0,r.jsx)("div",{className:"h-8 bg-gray-700 border-b border-gray-600 flex items-center px-3",children:(0,r.jsx)("span",{className:"text-xs font-medium text-gray-300",children:"LAYERS"})}),(0,r.jsx)("div",{className:"overflow-y-auto",style:{height:o-120},children:c.project.layers.map(e=>(0,r.jsx)(W,{layer:e,onToggleVisibility:t=>c.updateLayer(t,{visible:!e.visible}),onToggleLock:t=>c.updateLayer(t,{locked:!e.locked}),onRename:(e,t)=>c.updateLayer(e,{name:t}),onDelete:e=>c.removeLayer(e)},e.id))})]}),(0,r.jsx)("div",{className:"flex-1 overflow-auto bg-gray-850",children:(0,r.jsxs)(i.LB,{collisionDetection:i.pE,onDragStart:j,onDragEnd:f,children:[(0,r.jsx)(F,{duration:c.project.duration,pixelsPerMs:y,zoomLevel:c.project.zoomLevel}),(0,r.jsxs)("div",{className:"relative",style:{width:Math.max(v,g-200)},children:[(0,r.jsx)(B,{currentTime:c.project.currentTime,pixelsPerMs:y,height:60*c.project.layers.length,onSeek:e=>c.seek(e)}),(0,r.jsx)("div",{className:"relative min-h-full",children:(0,r.jsx)(V,{project:c.project,currentTime:c.project.currentTime,zoom:c.project.zoomLevel,scrollX:0,pixelsPerSecond:1e3*y,selection:{elementIds:c.project.selectedElementIds||[],layerIds:[],startTime:0,endTime:0},onElementClick:(e,t)=>c.selectElement(e),onTimelineClick:e=>c.clearSelection(),showKeyframes:!1})}),(0,r.jsx)("div",{className:"h-16 bg-gray-800/50 border-2 border-dashed border-gray-600 rounded-lg m-2 flex items-center justify-center text-gray-400 hover:border-blue-500 hover:text-blue-400 transition-colors",children:(0,r.jsx)("span",{className:"text-sm",children:"Drop media here to create new layer"})})]}),(0,r.jsx)(i.y9,{children:x&&(0,r.jsx)(ea,{element:x,pixelsPerMs:y,isSelected:!1,isDragging:!0,onSelect:()=>{},onUpdate:()=>{}})})]})})]}),(0,r.jsxs)("div",{className:"h-6 bg-gray-800 border-t border-gray-700 flex items-center justify-between px-3 text-xs text-gray-400",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsxs)("span",{children:["Time: ",N(c.project.currentTime)]}),(0,r.jsxs)("span",{children:["Duration: ",N(c.project.duration)]}),(0,r.jsxs)("span",{children:["Zoom: ",Math.round(100*c.project.zoomLevel),"%"]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsxs)("span",{children:[(c.project.selectedElementIds||[]).length," selected"]}),(0,r.jsxs)("span",{children:[c.project.layers.reduce((e,t)=>e+t.elements.length,0)," elements"]}),(0,r.jsxs)("span",{children:[c.project.resolution.width,"x",c.project.resolution.height]}),(0,r.jsxs)("span",{children:[c.project.fps," fps"]})]})]})]})}var es=a(48614),el=a(32489),ei=a(67119);ei.Ry({fps:ei.Rx().default(30),durationInFrames:ei.Rx(),width:ei.Rx().default(1920),height:ei.Rx().default(1080),codec:ei.Z_().default("h264")});let eo={"720p":{name:"HD (720p)",width:1280,height:720,bitrate:"2M",audioBitrate:"128k"},"1080p":{name:"Full HD (1080p)",width:1920,height:1080,bitrate:"5M",audioBitrate:"192k"},"4k":{name:"4K Ultra HD",width:3840,height:2160,bitrate:"15M",audioBitrate:"320k"}},en=e=>{let{isOpen:t,onClose:a}=e,{project:i}=d(),{isRendering:o,progress:n,error:c,startRender:m,clearError:u}=function(){let[e,t]=(0,s.useState)(!1),[a,r]=(0,s.useState)(null),[l,i]=(0,s.useState)(null),[o,n]=(0,s.useState)(null),d=(0,s.useCallback)(()=>{n(null)},[]),c=(0,s.useCallback)(async(e,a)=>{try{t(!0),n(null),i(null);let s=g(e);if(!s.valid)throw Error("Projeto inv\xe1lido: ".concat(s.errors.join(", ")));let l=await fetch("/api/render",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({project:e,settings:a})});if(!l.ok){let e=await l.json();throw Error(e.error||"Erro ao iniciar renderiza\xe7\xe3o")}let{job:o}=await l.json();r(o),m(o.id)}catch(e){n(e instanceof Error?e.message:"Erro desconhecido"),t(!1)}},[]),m=(0,s.useCallback)(e=>{let a=new EventSource("/api/render/progress?jobId=".concat(e));return a.onmessage=e=>{try{let s=JSON.parse(e.data);"progress"===s.type?i(s.progress):"complete"===s.type?(t(!1),r(s.job),a.close()):"error"===s.type&&(n(s.error),t(!1),a.close())}catch(e){console.error("Erro ao processar progresso:",e)}},a.onerror=()=>{n("Erro na conex\xe3o de progresso"),t(!1),a.close()},a},[]),u=(0,s.useCallback)(async()=>{if(a)try{if(!(await fetch("/api/render?action=cancel&jobId=".concat(a.id),{method:"DELETE"})).ok)throw Error("Erro ao cancelar renderiza\xe7\xe3o");t(!1),r(null),i(null)}catch(e){n(e instanceof Error?e.message:"Erro ao cancelar")}},[a]),x=(0,s.useCallback)(async e=>{try{let t=await fetch(e?"/api/render?action=list&status=".concat(e):"/api/render?action=list");if(!t.ok)throw Error("Erro ao buscar jobs");return await t.json()}catch(e){return console.error("Erro ao listar jobs:",e),{jobs:[],stats:{total:0}}}},[]),h=(0,s.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"mp4",a="".concat(e,".").concat(t),r=document.createElement("a");r.href="/api/render/output/".concat(a),r.download=a,document.body.appendChild(r),r.click(),document.body.removeChild(r)},[]),p=(0,s.useCallback)(e=>({low:{name:"Baixa Qualidade",width:854,height:480,fps:24,crf:28,bitrate:"500k",format:"mp4"},medium:{name:"Qualidade M\xe9dia",width:1280,height:720,fps:30,crf:23,bitrate:"2M",format:"mp4"},high:{name:"Alta Qualidade",width:1920,height:1080,fps:30,crf:18,bitrate:"5M",format:"mp4"},ultra:{name:"Ultra Qualidade",width:3840,height:2160,fps:60,crf:15,bitrate:"15M",format:"mp4"}})[e]||null,[]),g=(0,s.useCallback)(e=>{let t=[];return e.layers.some(e=>e.elements.length>0)||t.push("Projeto n\xe3o cont\xe9m elementos"),e.duration<=0&&t.push("Dura\xe7\xe3o do projeto inv\xe1lida"),e.layers.forEach((e,a)=>{e.elements.forEach((a,r)=>{a.id||t.push("Elemento ".concat(r+1," na camada ").concat(e.name," sem ID")),a.start<0&&t.push("Elemento ".concat(r+1," na camada ").concat(e.name," com tempo inicial inv\xe1lido")),a.duration<=0&&t.push("Elemento ".concat(r+1," na camada ").concat(e.name," com dura\xe7\xe3o inv\xe1lida"))})}),{valid:0===t.length,errors:t}},[]);return{isRendering:e,currentJob:a,progress:l,error:o,startRender:c,cancelRender:u,clearError:d,streamProgress:m,listJobs:x,downloadRender:h,getPreset:p,validateProject:g}}(),[x,h]=(0,s.useState)({format:"mp4",quality:8,codec:"h264",audioCodec:"aac",bitrate:"8M",audioBitrate:"192k"}),[p,g]=(0,s.useState)("1080p"),b=async()=>{try{u(),await m(i,x)}catch(e){console.error("Erro ao iniciar exporta\xe7\xe3o:",e)}},y=e=>{let t=eo[e];t&&(g(e),h(e=>({...e,bitrate:t.bitrate,audioBitrate:t.audioBitrate})))},v=[{value:"mp4",label:"MP4 Video",icon:S.Z},{value:"webm",label:"WebM Video",icon:S.Z},{value:"gif",label:"GIF Animation",icon:z.Z},{value:"mp3",label:"MP3 Audio",icon:M.Z},{value:"wav",label:"WAV Audio",icon:M.Z}],j=[1,2,3,4,5,6,7,8,9,10],f=j.map((e,t)=>({value:e,label:"Qualidade ".concat(e).concat(t===j.length-1?" (M\xe1xima)":0===t?" (M\xednima)":"")})),w=[{value:"h264",label:"H.264"},{value:"h265",label:"H.265"},{value:"vp8",label:"VP8"},{value:"vp9",label:"VP9"}],k=w.map(e=>e.value),T=e=>j.includes(e),C=e=>k.includes(e),Z=e=>{h(t=>({...t,format:e}))},I=e=>{let t=Number(e);Number.isFinite(t)&&T(t)&&h(e=>({...e,quality:t}))},L=e=>{C(e)&&h(t=>({...t,codec:e}))};return(0,r.jsx)(es.M,{children:t&&(0,r.jsx)(l.E.div,{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,r.jsxs)(l.E.div,{className:"bg-gray-900 rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)(N.Z,{className:"w-6 h-6 text-blue-400"}),(0,r.jsx)("h2",{className:"text-xl font-bold text-white",children:"Exportar V\xeddeo"})]}),(0,r.jsx)("button",{onClick:a,className:"p-2 hover:bg-gray-800 rounded-lg transition-colors",children:(0,r.jsx)(el.Z,{className:"w-5 h-5 text-gray-400"})})]}),(0,r.jsxs)("div",{className:"mb-6 p-4 bg-gray-800 rounded-lg",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-300 mb-2",children:"Projeto"}),(0,r.jsx)("p",{className:"text-white font-medium",children:i.name}),(0,r.jsxs)("p",{className:"text-sm text-gray-400",children:["Dura\xe7\xe3o: ",Math.round(i.duration/1e3),"s • Elementos: ",i.layers.reduce((e,t)=>e+t.elements.length,0)]})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-3",children:"Formato de Sa\xedda"}),(0,r.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:v.map(e=>(0,r.jsxs)("button",{onClick:()=>Z(e.value),className:"p-3 rounded-lg border-2 transition-all ".concat(x.format===e.value?"border-blue-500 bg-blue-500/10":"border-gray-700 hover:border-gray-600"),children:[(0,r.jsx)(e.icon,{className:"w-5 h-5 mx-auto mb-1 text-gray-400"}),(0,r.jsx)("p",{className:"text-sm font-medium text-white",children:e.label})]},e.value))})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-3",children:"Preset de Qualidade"}),(0,r.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Object.entries(eo).map(e=>{let[t,a]=e;return(0,r.jsxs)("button",{onClick:()=>y(t),className:"p-3 rounded-lg border-2 transition-all ".concat(p===t?"border-blue-500 bg-blue-500/10":"border-gray-700 hover:border-gray-600"),children:[(0,r.jsx)("p",{className:"text-sm font-medium text-white",children:a.name}),(0,r.jsxs)("p",{className:"text-xs text-gray-400",children:[a.width,"x",a.height]})]},t)})})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-3",children:[(0,r.jsx)(E.Z,{className:"w-4 h-4 text-gray-400"}),(0,r.jsx)("label",{className:"text-sm font-medium text-gray-300",children:"Configura\xe7\xf5es Avan\xe7adas"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-gray-400 mb-1",children:"Qualidade"}),(0,r.jsx)("select",{value:String(x.quality),onChange:e=>I(e.target.value),className:"w-full p-2 bg-gray-800 border border-gray-700 rounded text-white text-sm",children:f.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-gray-400 mb-1",children:"Codec"}),(0,r.jsx)("select",{value:x.codec,onChange:e=>L(e.target.value),className:"w-full p-2 bg-gray-800 border border-gray-700 rounded text-white text-sm",children:w.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-gray-400 mb-1",children:"Bitrate V\xeddeo"}),(0,r.jsx)("input",{type:"text",value:x.bitrate,onChange:e=>h(t=>({...t,bitrate:e.target.value})),className:"w-full p-2 bg-gray-800 border border-gray-700 rounded text-white text-sm",placeholder:"8M"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-gray-400 mb-1",children:"Bitrate \xc1udio"}),(0,r.jsx)("input",{type:"text",value:x.audioBitrate,onChange:e=>h(t=>({...t,audioBitrate:e.target.value})),className:"w-full p-2 bg-gray-800 border border-gray-700 rounded text-white text-sm",placeholder:"192k"})]})]})]}),o&&n&&(0,r.jsxs)("div",{className:"mb-6 p-4 bg-gray-800 rounded-lg",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)("span",{className:"text-sm text-gray-300",children:"Renderizando..."}),(0,r.jsxs)("span",{className:"text-sm text-white",children:[n.percentage,"%"]})]}),(0,r.jsx)("div",{className:"w-full bg-gray-700 rounded-full h-2 mb-2",children:(0,r.jsx)("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:"".concat(n.percentage,"%")}})}),(0,r.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-400",children:[(0,r.jsxs)("span",{children:["Frame ",n.frame," de ",n.totalFrames]}),n.estimatedTimeRemaining&&(0,r.jsxs)("span",{children:["~",n.estimatedTimeRemaining,"s restantes"]})]})]}),c&&(0,r.jsx)("div",{className:"mb-6 p-4 bg-red-900/20 border border-red-500/20 rounded-lg",children:(0,r.jsx)("p",{className:"text-red-400 text-sm",children:c})}),(0,r.jsxs)("div",{className:"flex items-center justify-end space-x-3",children:[(0,r.jsx)("button",{onClick:a,disabled:o,className:"px-4 py-2 text-gray-400 hover:text-white transition-colors disabled:opacity-50",children:"Cancelar"}),(0,r.jsx)("button",{onClick:b,disabled:o,className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:o?"Renderizando...":"Iniciar Exporta\xe7\xe3o"})]})]})})})};var ed=a(17689),ec=a(48662);let em="force-dynamic";function eu(){let[e,t]=(0,s.useState)("select"),[a,i]=(0,s.useState)(!1),[o,n]=(0,s.useState)(!1),c=d(),m=[{id:"select",name:"Select",icon:ed.Z},{id:"video",name:"Video",icon:S.Z},{id:"audio",name:"Audio",icon:ec.Z},{id:"text",name:"Text",icon:Z.Z},{id:"image",name:"Image",icon:z.Z},{id:"pptx",name:"PPTX",icon:I.Z},{id:"avatar",name:"Avatar",icon:L.Z}],u=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a={id:crypto.randomUUID(),type:e,layer:0,start:c.project.currentTime,duration:5e3,source:t.url||"",data:t},r="video-layer";"audio"===e&&(r="audio-layer"),("text"===e||"image"===e||"pptx-slide"===e||"avatar"===e)&&(r="overlay-layer"),c.addElement(a,r)},h=e=>{let t=e.type,a="video";t.startsWith("audio/")?a="audio":t.startsWith("image/")?a="image":e.name.endsWith(".pptx")&&(a="pptx-slide"),u(a,{src:URL.createObjectURL(e),filename:e.name,fileSize:e.size})},p=()=>{i(!0)};return(0,r.jsxs)("div",{className:"video-studio min-h-screen bg-gray-900 text-white flex flex-col",children:[(0,r.jsxs)("header",{className:"h-16 bg-gray-800 border-b border-gray-700 flex items-center justify-between px-6",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)("h1",{className:"text-xl font-bold text-white",children:"Video Studio Pro"}),(0,r.jsxs)("div",{className:"text-sm text-gray-400",children:[c.project.name," • ",Math.round(c.project.duration/1e3),"s"]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsxs)("button",{onClick:()=>n(!o),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors flex items-center space-x-2",children:[o?(0,r.jsx)(E.Z,{size:16}):(0,r.jsx)(x.Z,{size:16}),(0,r.jsx)("span",{children:o?"Edit":"Preview"})]}),(0,r.jsxs)("button",{onClick:p,className:"px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg transition-colors flex items-center space-x-2",children:[(0,r.jsx)(N.Z,{size:16}),(0,r.jsx)("span",{children:"Export"})]})]})]}),(0,r.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,r.jsxs)("div",{className:"w-80 bg-gray-800 border-r border-gray-700 flex flex-col",children:[(0,r.jsxs)("div",{className:"p-4 border-b border-gray-700",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-300 mb-3",children:"TOOLS"}),(0,r.jsx)("div",{className:"grid grid-cols-4 gap-2",children:m.map(a=>{let s=a.icon;return(0,r.jsxs)("button",{onClick:()=>t(a.id),className:"p-3 rounded-lg border transition-all ".concat(e===a.id?"bg-blue-600 border-blue-500 text-white":"bg-gray-700 border-gray-600 text-gray-300 hover:bg-gray-600"),title:a.name,children:[(0,r.jsx)(s,{size:20,className:"mx-auto"}),(0,r.jsx)("div",{className:"text-xs mt-1",children:a.name})]},a.id)})})]}),(0,r.jsxs)("div",{className:"flex-1 p-4 overflow-y-auto",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-300",children:"MEDIA LIBRARY"}),(0,r.jsx)("button",{onClick:()=>{let e=document.createElement("input");e.type="file",e.accept="video/*,audio/*,image/*,.pptx",e.onchange=e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];a&&h(a)},e.click()},className:"p-1 text-gray-400 hover:text-white transition-colors",title:"Import media",children:(0,r.jsx)(ed.Z,{size:16})})]}),(0,r.jsx)("div",{className:"space-y-2",children:[{id:"1",type:"video",name:"Intro Video",url:"/sample-video.mp4",thumbnail:"/thumb1.jpg"},{id:"2",type:"audio",name:"Background Music",url:"/sample-audio.mp3",thumbnail:"/audio-thumb.png"},{id:"3",type:"image",name:"Logo",url:"/logo.png",thumbnail:"/logo.png"},{id:"4",type:"pptx-slide",name:"Slide 1",url:"/slide1.png",thumbnail:"/slide1-thumb.png"}].map(e=>(0,r.jsx)(l.E.div,{className:"p-3 bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-600 transition-colors",onClick:()=>u(e.type,{src:e.url,imageUrl:e.thumbnail}),whileHover:{scale:1.02},whileTap:{scale:.98},children:(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"w-12 h-8 bg-gray-600 rounded overflow-hidden flex-shrink-0",children:(0,r.jsx)("img",{src:e.thumbnail,alt:e.name,className:"w-full h-full object-cover",onError:e=>{e.target.style.display="none"}})}),(0,r.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,r.jsx)("div",{className:"text-sm font-medium text-white truncate",children:e.name}),(0,r.jsx)("div",{className:"text-xs text-gray-400 capitalize",children:e.type})]})]})},e.id))}),(0,r.jsxs)("div",{className:"mt-6 pt-4 border-t border-gray-700",children:[(0,r.jsx)("h4",{className:"text-xs font-medium text-gray-400 mb-2",children:"QUICK ADD"}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("button",{onClick:()=>u("text",{text:"Sample Text",fontSize:24,color:"#ffffff"}),className:"w-full p-2 text-left text-sm text-gray-300 hover:text-white hover:bg-gray-700 rounded transition-colors",children:"+ Add Text"}),(0,r.jsx)("button",{onClick:()=>u("shape",{shapeType:"rectangle",color:"#3b82f6"}),className:"w-full p-2 text-left text-sm text-gray-300 hover:text-white hover:bg-gray-700 rounded transition-colors",children:"+ Add Shape"}),(0,r.jsx)("button",{onClick:()=>u("avatar",{modelUrl:"/avatar-sample.glb",voiceId:"pt-BR-Neural2-A"}),className:"w-full p-2 text-left text-sm text-gray-300 hover:text-white hover:bg-gray-700 rounded transition-colors",children:"+ Add Avatar"})]})]})]})]}),(0,r.jsxs)("div",{className:"flex-1 flex flex-col",children:[o&&(0,r.jsx)("div",{className:"h-64 bg-black border-b border-gray-700 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-gray-400",children:[(0,r.jsx)(S.Z,{size:48,className:"mx-auto mb-2"}),(0,r.jsx)("div",{children:"Video Preview"}),(0,r.jsx)("div",{className:"text-sm mt-1",children:"1920x1080 • 30fps"})]})}),(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsx)(er,{height:o?400:600,onExport:p,onImport:h,showPreview:o})})]}),(0,r.jsxs)("div",{className:"w-72 bg-gray-800 border-l border-gray-700 p-4",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-300 mb-4",children:"PROPERTIES"}),c.project.selectedElementIds&&c.project.selectedElementIds.length>0?(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-gray-400 mb-1",children:"Element Name"}),(0,r.jsx)("input",{type:"text",className:"w-full bg-gray-700 text-white text-sm p-2 rounded border border-gray-600 focus:border-blue-500 focus:outline-none",defaultValue:"Selected Element"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-gray-400 mb-1",children:"Opacity"}),(0,r.jsx)("input",{type:"range",min:"0",max:"1",step:"0.1",defaultValue:"1",className:"w-full"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-gray-400 mb-1",children:"X Position"}),(0,r.jsx)("input",{type:"number",className:"w-full bg-gray-700 text-white text-sm p-2 rounded border border-gray-600",defaultValue:"0"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-gray-400 mb-1",children:"Y Position"}),(0,r.jsx)("input",{type:"number",className:"w-full bg-gray-700 text-white text-sm p-2 rounded border border-gray-600",defaultValue:"0"})]})]})]}):(0,r.jsx)("div",{className:"text-sm text-gray-500 text-center py-8",children:"Select an element to edit properties"}),(0,r.jsxs)("div",{className:"mt-8 pt-4 border-t border-gray-700",children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-gray-300 mb-3",children:"PROJECT"}),(0,r.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-400",children:"Duration:"}),(0,r.jsxs)("span",{className:"text-white",children:[Math.round(c.project.duration/1e3),"s"]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-400",children:"Resolution:"}),(0,r.jsxs)("span",{className:"text-white",children:[c.project.resolution.width,"x",c.project.resolution.height]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-400",children:"Frame Rate:"}),(0,r.jsxs)("span",{className:"text-white",children:[c.project.fps," fps"]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-400",children:"Elements:"}),(0,r.jsx)("span",{className:"text-white",children:c.project.layers?c.project.layers.reduce((e,t)=>e+t.elements.length,0):0})]})]})]})]})]}),(0,r.jsx)(en,{isOpen:a,onClose:()=>i(!1)})]})}}},function(e){e.O(0,[9234,3729,3471,9975,2971,2117,1744],function(){return e(e.s=37878)}),_N_E=e.O()}]);