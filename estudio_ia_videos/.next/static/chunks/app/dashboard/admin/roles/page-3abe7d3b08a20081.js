(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7237],{8602:function(e,r,t){Promise.resolve().then(t.bind(t,91645))},41875:function(e,r,t){"use strict";t.d(r,{C:function(){return l}});var n=t(57437);t(2265);var s=t(90535),a=t(22835);let i=(0,s.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:r,variant:t,...s}=e;return(0,n.jsx)("div",{className:(0,a.cn)(i({variant:t}),r),...s})}},92595:function(e,r,t){"use strict";t.d(r,{d:function(){return l},z:function(){return o}});var n=t(57437),s=t(2265),a=t(90535),i=t(22835);let l=(0,a.j)("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=s.forwardRef((e,r)=>{let{className:t,variant:s,size:a,asChild:o=!1,...c}=e;return(0,n.jsx)(o?"span":"button",{className:(0,i.cn)(l({variant:s,size:a,className:t})),ref:r,...c})});o.displayName="Button"},34029:function(e,r,t){"use strict";t.d(r,{Ol:function(){return l},SZ:function(){return c},Zb:function(){return i},aY:function(){return d},eW:function(){return u},ll:function(){return o}});var n=t(57437),s=t(2265),a=t(22835);let i=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,n.jsx)("div",{ref:r,className:(0,a.cn)("rounded-xl border bg-card text-card-foreground shadow",t),...s})});i.displayName="Card";let l=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,n.jsx)("div",{ref:r,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",t),...s})});l.displayName="CardHeader";let o=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,n.jsx)("h3",{ref:r,className:(0,a.cn)("font-semibold leading-none tracking-tight",t),...s})});o.displayName="CardTitle";let c=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,n.jsx)("p",{ref:r,className:(0,a.cn)("text-sm text-muted-foreground",t),...s})});c.displayName="CardDescription";let d=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,n.jsx)("div",{ref:r,className:(0,a.cn)("p-6 pt-0",t),...s})});d.displayName="CardContent";let u=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,n.jsx)("div",{ref:r,className:(0,a.cn)("flex items-center p-6 pt-0",t),...s})});u.displayName="CardFooter"},91645:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return j}});var n=t(57437),s=t(2265),a=t(58113);function i(){return(0,n.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})}function l(e){let{children:r,fallback:t=null,loading:l=(0,n.jsx)(i,{})}=e,{isAdmin:o,loading:c,error:d}=function(){let[e,r]=(0,s.useState)(!1),[t,n]=(0,s.useState)(!0),[i,l]=(0,s.useState)(null);return(0,s.useEffect)(()=>{(async function(){try{let e=(0,a.eI)(),{data:{user:t}}=await e.auth.getUser();if(!t){r(!1),n(!1);return}let{data:s,error:i}=await e.rpc("is_admin");if(i)throw i;r(!0===s)}catch(e){l(e instanceof Error?e:Error("Erro ao verificar admin")),r(!1)}finally{n(!1)}})()},[]),{isAdmin:e,loading:t,error:i}}();return c?(0,n.jsx)(n.Fragment,{children:l}):d||!o?(0,n.jsx)(n.Fragment,{children:t}):(0,n.jsx)(n.Fragment,{children:r})}function o(e){let{label:r="Carregando...",description:t,fullscreen:s}=e,a=(0,n.jsxs)("div",{className:"flex flex-col items-center gap-2 py-6 text-center","aria-busy":"true","data-testid":"loading-state",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-4 border-neutral-300 border-t-primary"}),(0,n.jsx)("p",{className:"font-medium text-sm text-neutral-700",children:r}),t&&(0,n.jsx)("p",{className:"text-xs text-neutral-500 max-w-md",children:t})]});return s?(0,n.jsx)("div",{className:"flex items-center justify-center min-h-[40vh]",children:a}):a}function c(e){let{title:r="Ocorreu um erro",message:t="Tente novamente em alguns instantes.",actionLabel:s="Recarregar",onRetry:a,fullscreen:i}=e,l=(0,n.jsxs)("div",{className:"flex flex-col items-center gap-3 py-6 text-center",role:"alert","data-testid":"error-state",children:[(0,n.jsx)("div",{className:"text-red-600","aria-hidden":!0,children:"⚠️"}),(0,n.jsx)("p",{className:"font-semibold text-sm text-neutral-800",children:r}),t&&(0,n.jsx)("p",{className:"text-xs text-neutral-600 max-w-md",children:t}),a&&(0,n.jsx)("button",{type:"button",onClick:a,className:"px-3 py-1.5 rounded bg-red-600/90 hover:bg-red-600 text-white text-xs font-medium",children:s})]});return i?(0,n.jsx)("div",{className:"flex items-center justify-center min-h-[40vh]",children:l}):l}var d=t(90535),u=t(22835);(0,d.j)("inline-flex items-center justify-center",{variants:{variant:{spinner:"animate-spin rounded-full border-2 border-current border-t-transparent",dots:"space-x-2",pulse:"animate-pulse",skeleton:"bg-muted rounded"},size:{sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12",xl:"h-16 w-16"}},defaultVariants:{variant:"spinner",size:"md"}}),t(76865),t(99388),t(49322),t(82431),(0,d.j)("rounded-lg border p-4 flex flex-col gap-3",{variants:{variant:{default:"bg-background border-destructive/50 text-destructive",destructive:"bg-destructive/10 border-destructive text-destructive",warning:"bg-yellow-50 dark:bg-yellow-900/10 border-yellow-500/50 text-yellow-900 dark:text-yellow-200"},size:{sm:"text-sm",md:"text-base",lg:"text-lg"}},defaultVariants:{variant:"default",size:"md"}}),t(41671),t(32489);var m=t(30401);function f(e){let{message:r,className:t}=e;return(0,n.jsxs)("div",{className:(0,u.cn)("flex items-center gap-2 text-sm text-green-700 dark:text-green-400",t),children:[(0,n.jsx)(m.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{children:r})]})}(0,d.j)("rounded-lg border p-4 flex items-start gap-3",{variants:{variant:{default:"bg-green-50 dark:bg-green-900/10 border-green-500/50 text-green-900 dark:text-green-200",subtle:"bg-background border-green-500/30 text-foreground",celebration:"bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/10 dark:to-emerald-900/10 border-green-500 text-green-900 dark:text-green-200"},size:{sm:"text-sm",md:"text-base",lg:"text-lg"}},defaultVariants:{variant:"default",size:"md"}});var x=t(92595),h=t(34029),p=t(41875),g=t(88906),v=t(18930),y=t(37806);function b(){let[e,r]=(0,s.useState)([]),[t,a]=(0,s.useState)([]),[i,l]=(0,s.useState)(!0),[d,u]=(0,s.useState)(null),[m,b]=(0,s.useState)(null),[j,N]=(0,s.useState)(null),[k,w]=(0,s.useState)(null);async function C(){l(!0),u(null);try{let[e,t]=await Promise.all([fetch("/api/admin/roles"),fetch("/api/admin/users")]);if(!e.ok)throw Error("Falha ao carregar roles");if(!t.ok)throw Error("Falha ao carregar usu\xe1rios");let n=await e.json(),s=await t.json();r(n.roles||[]),a(s.users||[])}catch(e){u(e instanceof Error?e.message:"Erro ao carregar dados")}finally{l(!1)}}async function Z(e,r){u(null),b(null);try{if(!(await fetch("/api/admin/users/".concat(e,"/roles"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({role:r})})).ok)throw Error("Falha ao atribuir role");b('Role "'.concat(r,'" atribu\xedda com sucesso!')),await C(),setTimeout(()=>b(null),3e3)}catch(e){u(e instanceof Error?e.message:"Erro ao atribuir role")}}async function E(e,r){u(null),b(null);try{if(!(await fetch("/api/admin/users/".concat(e,"/roles/").concat(r),{method:"DELETE"})).ok)throw Error("Falha ao remover role");b('Role "'.concat(r,'" removida com sucesso!')),await C(),setTimeout(()=>b(null),3e3)}catch(e){u(e instanceof Error?e.message:"Erro ao remover role")}}return((0,s.useEffect)(()=>{C()},[]),i)?(0,n.jsx)("div",{className:"container mx-auto p-6",children:(0,n.jsx)(o,{label:"Carregando gerenciamento de roles..."})}):d&&!e.length?(0,n.jsx)("div",{className:"container mx-auto p-6",children:(0,n.jsx)(c,{title:"Erro ao carregar dados",message:d,onRetry:C})}):(0,n.jsxs)("div",{className:"container mx-auto p-6 space-y-6",children:[(0,n.jsx)("div",{className:"flex items-center justify-between",children:(0,n.jsxs)("div",{children:[(0,n.jsxs)("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[(0,n.jsx)(g.Z,{className:"w-8 h-8"}),"Gerenciamento de Roles"]}),(0,n.jsx)("p",{className:"text-muted-foreground mt-1",children:"Configure pap\xe9is e permiss\xf5es de usu\xe1rios"})]})}),d&&(0,n.jsx)(c,{title:"Erro",message:d}),m&&(0,n.jsx)(f,{message:m}),(0,n.jsxs)(h.Zb,{children:[(0,n.jsxs)(h.Ol,{children:[(0,n.jsx)(h.ll,{children:"Roles Dispon\xedveis"}),(0,n.jsx)(h.SZ,{children:"Pap\xe9is definidos no sistema e suas descri\xe7\xf5es"})]}),(0,n.jsx)(h.aY,{children:(0,n.jsx)("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-4",children:e.map(e=>(0,n.jsxs)("div",{className:"border rounded-lg p-4 space-y-2 hover:border-primary transition-colors",children:[(0,n.jsx)("div",{className:"flex items-start justify-between",children:(0,n.jsx)(p.C,{variant:"secondary",className:"text-sm",children:e.name})}),e.description&&(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:e.description}),e.permissions&&e.permissions.length>0&&(0,n.jsxs)("div",{className:"pt-2 border-t",children:[(0,n.jsx)("p",{className:"text-xs font-medium mb-1",children:"Permiss\xf5es:"}),(0,n.jsxs)("div",{className:"flex flex-wrap gap-1",children:[e.permissions.slice(0,3).map(e=>(0,n.jsx)(p.C,{variant:"outline",className:"text-xs",children:e},e)),e.permissions.length>3&&(0,n.jsxs)(p.C,{variant:"outline",className:"text-xs",children:["+",e.permissions.length-3]})]})]})]},e.id))})})]}),(0,n.jsxs)(h.Zb,{children:[(0,n.jsxs)(h.Ol,{children:[(0,n.jsx)(h.ll,{children:"Atribui\xe7\xe3o de Roles"}),(0,n.jsx)(h.SZ,{children:"Gerencie os pap\xe9is dos usu\xe1rios cadastrados"})]}),(0,n.jsx)(h.aY,{children:(0,n.jsxs)("div",{className:"space-y-4",children:[t.map(r=>(0,n.jsxs)("div",{className:"border rounded-lg p-4 space-y-3 hover:bg-accent/50 transition-colors",children:[(0,n.jsx)("div",{className:"flex items-start justify-between",children:(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"font-medium",children:r.name||r.email||r.id}),r.email&&r.name&&(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:r.email}),(0,n.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["ID: ",r.id]})]})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm font-medium mb-2",children:"Roles atuais:"}),(0,n.jsx)("div",{className:"flex flex-wrap gap-2",children:r.roles.length>0?r.roles.map(e=>(0,n.jsxs)(p.C,{variant:"default",className:"gap-1",children:[e,(0,n.jsx)("button",{onClick:()=>E(r.id,e),className:"ml-1 hover:text-destructive","aria-label":"Remover role ".concat(e),children:(0,n.jsx)(v.Z,{className:"w-3 h-3"})})]},e)):(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:"Nenhuma role atribu\xedda"})})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm font-medium mb-2",children:"Adicionar role:"}),(0,n.jsx)("div",{className:"flex flex-wrap gap-2",children:e.filter(e=>!r.roles.includes(e.name)).map(e=>(0,n.jsxs)(x.z,{variant:"outline",size:"sm",onClick:()=>Z(r.id,e.name),className:"gap-1",children:[(0,n.jsx)(y.Z,{className:"w-3 h-3"}),e.name]},e.id))})]})]},r.id)),0===t.length&&(0,n.jsx)("p",{className:"text-center text-muted-foreground py-8",children:"Nenhum usu\xe1rio cadastrado no sistema"})]})})]})]})}function j(){return(0,n.jsx)(l,{fallback:(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen p-8",children:[(0,n.jsx)(g.Z,{className:"w-16 h-16 text-red-500 mb-4"}),(0,n.jsx)("h1",{className:"text-2xl font-bold mb-2",children:"Acesso Restrito"}),(0,n.jsx)("p",{className:"text-muted-foreground text-center max-w-md",children:"Esta p\xe1gina \xe9 restrita a administradores do sistema."})]}),loading:(0,n.jsx)(o,{label:"Verificando permiss\xf5es..."}),children:(0,n.jsx)(b,{})})}},27669:function(e,r,t){"use strict";t.d(r,{W:function(){return i}});var n=t(17272);let s=null,a=null;function i(){if(a)return a;let{url:e,anonKey:r}=function(){if(s)return s;let e="https://ofhzrdiadxigrvmrhaiz.supabase.co",r="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ";if(!e||!r)throw Error("Missing NEXT_PUBLIC_SUPABASE_URL or NEXT_PUBLIC_SUPABASE_ANON_KEY environment variables");return s={url:e,anonKey:r}}();return a=(0,n.createBrowserClient)(e,r)}},58113:function(e,r,t){"use strict";t.d(r,{OQ:function(){return s},eI:function(){return a}});var n=t(27669);let s=(0,n.W)(),a=()=>(0,n.W)()},22835:function(e,r,t){"use strict";t.d(r,{cn:function(){return a}});var n=t(61994),s=t(53335);function a(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,s.m6)((0,n.W)(r))}},79205:function(e,r,t){"use strict";t.d(r,{Z:function(){return o}});var n=t(2265);let s=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),a=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return r.filter((e,r,t)=>!!e&&t.indexOf(e)===r).join(" ")};var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,n.forwardRef)((e,r)=>{let{color:t="currentColor",size:s=24,strokeWidth:l=2,absoluteStrokeWidth:o,className:c="",children:d,iconNode:u,...m}=e;return(0,n.createElement)("svg",{ref:r,...i,width:s,height:s,stroke:t,strokeWidth:o?24*Number(l)/Number(s):l,className:a("lucide",c),...m},[...u.map(e=>{let[r,t]=e;return(0,n.createElement)(r,t)}),...Array.isArray(d)?d:[d]])}),o=(e,r)=>{let t=(0,n.forwardRef)((t,i)=>{let{className:o,...c}=t;return(0,n.createElement)(l,{ref:i,iconNode:r,className:a("lucide-".concat(s(e)),o),...c})});return t.displayName="".concat(e),t}},30401:function(e,r,t){"use strict";t.d(r,{Z:function(){return n}});let n=(0,t(79205).Z)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},49322:function(e,r,t){"use strict";t.d(r,{Z:function(){return n}});let n=(0,t(79205).Z)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},41671:function(e,r,t){"use strict";t.d(r,{Z:function(){return n}});let n=(0,t(79205).Z)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},99388:function(e,r,t){"use strict";t.d(r,{Z:function(){return n}});let n=(0,t(79205).Z)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},82431:function(e,r,t){"use strict";t.d(r,{Z:function(){return n}});let n=(0,t(79205).Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},88906:function(e,r,t){"use strict";t.d(r,{Z:function(){return n}});let n=(0,t(79205).Z)("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]])},18930:function(e,r,t){"use strict";t.d(r,{Z:function(){return n}});let n=(0,t(79205).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},76865:function(e,r,t){"use strict";t.d(r,{Z:function(){return n}});let n=(0,t(79205).Z)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},37806:function(e,r,t){"use strict";t.d(r,{Z:function(){return n}});let n=(0,t(79205).Z)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]])},32489:function(e,r,t){"use strict";t.d(r,{Z:function(){return n}});let n=(0,t(79205).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},90535:function(e,r,t){"use strict";t.d(r,{j:function(){return i}});var n=t(61994);let s=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,a=n.W,i=(e,r)=>t=>{var n;if((null==r?void 0:r.variants)==null)return a(e,null==t?void 0:t.class,null==t?void 0:t.className);let{variants:i,defaultVariants:l}=r,o=Object.keys(i).map(e=>{let r=null==t?void 0:t[e],n=null==l?void 0:l[e];if(null===r)return null;let a=s(r)||s(n);return i[e][a]}),c=t&&Object.entries(t).reduce((e,r)=>{let[t,n]=r;return void 0===n||(e[t]=n),e},{});return a(e,o,null==r?void 0:null===(n=r.compoundVariants)||void 0===n?void 0:n.reduce((e,r)=>{let{class:t,className:n,...s}=r;return Object.entries(s).every(e=>{let[r,t]=e;return Array.isArray(t)?t.includes({...l,...c}[r]):({...l,...c})[r]===t})?[...e,t,n]:e},[]),null==t?void 0:t.class,null==t?void 0:t.className)}}},function(e){e.O(0,[6137,4919,7272,2971,2117,1744],function(){return e(e.s=8602)}),_N_E=e.O()}]);