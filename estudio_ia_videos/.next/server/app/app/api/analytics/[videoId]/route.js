"use strict";(()=>{var e={};e.id=4786,e.ids=[4786],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32120:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>h,patchFetch:()=>w,requestAsyncStorage:()=>p,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>g});var r={};a.r(r),a.d(r,{GET:()=>u});var n=a(49303),i=a(88716),s=a(60670),o=a(87070);class c{async trackView(e){let t={id:this.generateId(),startedAt:new Date,...e};return await this.saveView(t),t.id}async updateView(e,t){await this.updateViewRecord(e,t)}async trackEngagement(e,t,a){let r={...a,createdAt:new Date};await this.saveEngagementEvent(e,t,r)}async getVideoAnalytics(e,t){let a=await this.getViews(e,t),r=a.length,n=new Set(a.map(e=>e.userId||e.sessionId)).size,i=a.filter(e=>e.completed).length/r*100,s=a.reduce((e,t)=>e+t.duration,0),o=await this.calculateRetention(a),c=await this.calculateHeatmap(e),l=this.calculateDemographics(a),u=this.calculateTraffic(a),d=await this.getEngagementMetrics(e);return{videoId:e,totalViews:r,uniqueViews:n,avgWatchTime:r>0?s/r:0,avgCompletionRate:i,totalWatchTime:s/60,engagement:d,retention:o,heatmap:c,demographics:l,traffic:u}}async calculateRetention(e){if(0===e.length)return[];let t=Math.ceil(Math.max(...e.map(e=>e.duration))/5),a=[];for(let r=0;r<t;r++){let t=5*r,n=e.filter(e=>e.duration>=t).length,i=n/e.length*100;a.push({timestamp:t,viewersCount:n,retentionRate:i})}return a}async calculateHeatmap(e){let t=await this.getEngagementEvents(e),a=new Map;return t.forEach(e=>{let t=5*Math.floor(e.timestamp/5),r=a.get(t)||{timestamp:t,interactions:0,replays:0,skips:0};r.interactions++,"seek"===e.type&&(e.value<e.timestamp?r.replays++:r.skips++),a.set(t,r)}),Array.from(a.values()).sort((e,t)=>e.timestamp-t.timestamp)}calculateDemographics(e){let t={},a={},r={};return e.forEach(e=>{t[e.device]=(t[e.device]||0)+1,a[e.browser]=(a[e.browser]||0)+1,e.country&&(r[e.country]=(r[e.country]||0)+1)}),{devices:t,browsers:a,countries:r}}calculateTraffic(e){let t={},a=new Map;return e.forEach(e=>{if(!e.referrer){t.direct=(t.direct||0)+1;return}try{let r=new URL(e.referrer).hostname;r.includes("google")?t.google=(t.google||0)+1:r.includes("facebook")?t.facebook=(t.facebook||0)+1:r.includes("youtube")?t.youtube=(t.youtube||0)+1:t.other=(t.other||0)+1,a.set(r,(a.get(r)||0)+1)}catch{t.direct=(t.direct||0)+1}}),{sources:t,topReferrers:Array.from(a.entries()).sort((e,t)=>t[1]-e[1]).slice(0,10).map(([e])=>e)}}async generateReport(e,t){let a=await this.getVideoAnalytics(e);switch(t){case"pdf":return this.generatePDFReport(a);case"csv":return this.generateCSVReport(a);case"json":return JSON.stringify(a,null,2);default:throw Error(`Formato n\xe3o suportado: ${t}`)}}async compareVideos(e){let t={};return await Promise.all(e.map(async e=>{t[e]=await this.getVideoAnalytics(e)})),t}async saveView(e){console.log("Salvando view:",e.id)}async updateViewRecord(e,t){console.log("Atualizando view:",e,t)}async saveEngagementEvent(e,t,a){console.log("Salvando evento:",e,a.type)}async getViews(e,t){return[]}async getEngagementEvents(e){return[]}async getEngagementMetrics(e){return{likes:0,shares:0,comments:0}}async generatePDFReport(e){return"/reports/video-analytics.pdf"}async generateCSVReport(e){return`Metric,Value
Total Views,${e.totalViews}
Unique Views,${e.uniqueViews}
Avg Watch Time,${e.avgWatchTime}s
Completion Rate,${e.avgCompletionRate}%
Total Watch Time,${e.totalWatchTime}m`}generateId(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}}let l=null;async function u(e,{params:t}){try{let a;let{searchParams:r}=new URL(e.url),n=r.get("period")||"30d",i=new Date;switch(n){case"7d":a=new Date(i.getTime()-6048e5);break;case"30d":a=new Date(i.getTime()-2592e6);break;case"90d":a=new Date(i.getTime()-7776e6);break;default:a=new Date(0)}let s=(l||(l=new c),l),u=await s.getVideoAnalytics(t.videoId,{from:a,to:i});return o.NextResponse.json(u)}catch(e){return console.error("Erro ao buscar analytics:",e),o.NextResponse.json({error:"Erro ao buscar analytics do v\xeddeo"},{status:500})}}let d=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/app/api/analytics/[videoId]/route",pathname:"/app/api/analytics/[videoId]",filename:"route",bundlePath:"app/app/api/analytics/[videoId]/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\app\\api\\analytics\\[videoId]\\route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:p,staticGenerationAsyncStorage:g,serverHooks:m}=d,h="/app/api/analytics/[videoId]/route";function w(){return(0,s.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:g})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[1216],()=>a(32120));module.exports=r})();