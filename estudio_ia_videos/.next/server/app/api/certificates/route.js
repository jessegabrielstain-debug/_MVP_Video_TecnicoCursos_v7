"use strict";(()=>{var e={};e.id=2555,e.ids=[2555,3936],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},33159:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>x,requestAsyncStorage:()=>m,routeModule:()=>h,serverHooks:()=>g,staticGenerationAsyncStorage:()=>I});var s={};r.r(s),r.d(s,{POST:()=>d});var i=r(49303),a=r(88716),o=r(60670),n=r(87070),c=r(8261),u=r(61657),p=r(13936),l=r(9576);async function d(e){try{let t,r;let s=e.headers.get("authorization")||e.headers.get("Authorization");if(s){t=(0,u.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ",{auth:{persistSession:!1,autoRefreshToken:!1}});let e=s.startsWith("Bearer ")?s.substring(7):s.startsWith("bearer ")?s.substring(7):s;await t.auth.setSession({access_token:e,refresh_token:"dummy"}),r=(await t.auth.getUser()).data.user}else t=(0,p.getSupabaseForRequest)(e),r=(await t.auth.getUser()).data.user;if(!r)return n.NextResponse.json({error:"Unauthorized"},{status:401});let{projectId:i,courseName:a,studentName:o}=await e.json();if(!i||!a||!o)return n.NextResponse.json({error:"Missing required fields"},{status:400});let d=(0,l.Z)().split("-")[0].toUpperCase();try{let e=await c._.certificate.create({data:{projectId:i,userId:r.id,studentName:o,courseName:a,code:d,certificateUrl:`https://cert.tecnocursos.com.br/${d}`,metadata:{generatedBy:"AI Studio",version:"1.0"}}});return n.NextResponse.json(e,{status:201})}catch(e){if(console.error("Database error creating certificate:",e),"P2010"===e.code||"P2021"===e.code||e.message?.includes("does not exist")||e.message?.includes("Tenant or user not found")){console.warn("Certificate table missing or DB error, using in-memory mock");let e={id:(0,l.Z)(),projectId:i,userId:r.id,studentName:o,courseName:a,code:d,certificateUrl:`https://cert.tecnocursos.com.br/${d}`,issuedAt:new Date().toISOString(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return global.mockCertificates.set(d,e),n.NextResponse.json(e,{status:201})}return n.NextResponse.json({error:"Failed to create certificate",details:e.message},{status:500})}}catch(e){return console.error("Error generating certificate:",e),n.NextResponse.json({error:"Internal server error",details:e.message},{status:500})}}global.mockCertificates||(global.mockCertificates=new Map);let h=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/certificates/route",pathname:"/api/certificates",filename:"route",bundlePath:"app/api/certificates/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\certificates\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:I,serverHooks:g}=h,f="/api/certificates/route";function x(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:I})}},8261:(e,t,r)=>{r.d(t,{_:()=>i});var s=r(53524);let i=global.prisma||new s.PrismaClient({log:["error"]})},13936:(e,t,r)=>{r.d(t,{e:()=>o,getSupabaseForRequest:()=>c,p:()=>n});var s=r(67721),i=r(61657),a=r(71615);let o=()=>{let e=(0,a.cookies)();return(0,s.createServerClient)("https://ofhzrdiadxigrvmrhaiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ",{cookies:{get:t=>e.get(t)?.value,set(t,r,s){try{e.set({name:t,value:r,...s})}catch(e){}},remove(t,r){try{e.set({name:t,value:"",...r})}catch(e){}}}})},n=(0,i.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}});function c(e){let t=e.headers.get("authorization")||e.headers.get("Authorization");return t?(0,i.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ",{global:{headers:{Authorization:t}},auth:{persistSession:!1,autoRefreshToken:!1}}):o()}},9576:(e,t,r)=>{r.d(t,{Z:()=>u});var s=r(84770),i=r.n(s);let a={randomUUID:i().randomUUID},o=new Uint8Array(256),n=o.length,c=[];for(let e=0;e<256;++e)c.push((e+256).toString(16).slice(1));let u=function(e,t,r){if(a.randomUUID&&!t&&!e)return a.randomUUID();let s=(e=e||{}).random||(e.rng||function(){return n>o.length-16&&(i().randomFillSync(o),n=0),o.slice(n,n+=16)})();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=s[e];return t}return function(e,t=0){return c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]}(s)}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972,1657,9702],()=>r(33159));module.exports=s})();