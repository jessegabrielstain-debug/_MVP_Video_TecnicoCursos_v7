"use strict";(()=>{var e={};e.id=9900,e.ids=[9900],e.modules={572934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},554580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},345869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},220399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},430517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},627790:e=>{e.exports=require("assert")},978893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},532615:e=>{e.exports=require("http")},735240:e=>{e.exports=require("https")},986624:e=>{e.exports=require("querystring")},917360:e=>{e.exports=require("url")},521764:e=>{e.exports=require("util")},671568:e=>{e.exports=require("zlib")},983888:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>x,requestAsyncStorage:()=>l,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>d});var o={};r.r(o),r.d(o,{POST:()=>u});var i=r(349303),a=r(88716),s=r(60670),n=r(387070),p=r(95715);async function u(e){try{let t=await (0,p.getServerSession)(Object(function(){var e=Error("Cannot find module '@/lib/auth/auth-config'");throw e.code="MODULE_NOT_FOUND",e}()));if(!t?.user?.id)return n.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let{timelineId:r,clips:o,duration:i,settings:a}=await e.json(),s={};o.forEach(e=>{s[e.trackIndex]||(s[e.trackIndex]=[]),s[e.trackIndex].push(e)}),Object.keys(s).forEach(e=>{s[parseInt(e)].sort((e,t)=>e.startTime-t.startTime)});let u=[],c=[],l=[],d=0;if(s[0]&&(s[0].forEach((e,t)=>{if("image"===e.type||"video"===e.type){u.push(`-loop 1 -t ${e.duration} -i "${e.source}"`);let r=o.find(t=>"transition"===t.type&&t.startTime>=e.startTime&&t.startTime<e.startTime+e.duration);r?c.push(`[${d}:v]fade=t=out:st=${e.duration-r.duration}:d=${r.duration}[v${t}]`):c.push(`[${d}:v]scale=1920:1080[v${t}]`),d++}}),c.length>0)){let e=c.map((e,t)=>`[v${t}]`).join("");c.push(`${e}concat=n=${c.length}:v=1:a=0[outv]`)}if(s[1]&&s[1].forEach(e=>{if("text"===e.type){let t=e.style||{};c.push(`drawtext=text='${e.content}':fontsize=${t.fontSize||24}:fontcolor=${t.color||"white"}:x=(w-text_w)/2:y=${"top"===t.position?"50":"bottom"===t.position?"h-50":"(h-text_h)/2"}:enable='between(t,${e.startTime},${e.startTime+e.duration})'`)}}),s[2]&&(s[2].forEach((e,t)=>{"audio"===e.type&&e.metadata?.provider==="elevenlabs"&&(u.push(`-i "temp_audio_${t}.mp3"`),l.push(`[${d}:a]adelay=${1e3*e.startTime}|${1e3*e.startTime}[a${t}]`),d++)}),l.length>0)){let e=l.map((e,t)=>`[a${t}]`).join("");l.push(`${e}amix=inputs=${l.length}[outa]`)}let m=[u.join(" "),"-filter_complex",`"${[...c,...l].join(";")}"`,'-map "[outv]"',l.length>0?'-map "[outa]"':"",`-c:v libx264 -preset ${"ultra"===a.quality?"slow":"high"===a.quality?"medium":"fast"}`,`-crf ${"ultra"===a.quality?"18":"high"===a.quality?"23":"28"}`,`-r ${a.fps}`,a.audio?"-c:a aac -b:a 192k":"-an",`-t ${i}`,"output.mp4"].filter(Boolean).join(" ");return n.NextResponse.json({success:!0,composition:{command:m,inputs:u.length,filters:c.length,duration:i,settings:a,trackGroups:s}})}catch(e){return console.error("Erro ao preparar composi\xe7\xe3o:",e),n.NextResponse.json({error:"Erro ao preparar composi\xe7\xe3o"},{status:500})}}!function(){var e=Error("Cannot find module '@/lib/auth/auth-config'");throw e.code="MODULE_NOT_FOUND",e}();let c=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/timeline/prepare-composition/route",pathname:"/api/timeline/prepare-composition",filename:"route",bundlePath:"app/api/timeline/prepare-composition/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\timeline\\prepare-composition\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:l,staticGenerationAsyncStorage:d,serverHooks:m}=c,h="/api/timeline/prepare-composition/route";function x(){return(0,s.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:d})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[8948,5972,5715],()=>r(983888));module.exports=o})();