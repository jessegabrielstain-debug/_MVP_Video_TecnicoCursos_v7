"use strict";(()=>{var e={};e.id=2712,e.ids=[2712,3936],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},3e4:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>I,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>h});var a={};r.r(a),r.d(a,{GET:()=>d,dynamic:()=>c});var s=r(49303),o=r(88716),i=r(60670),n=r(87070),u=r(13936);let c="force-dynamic";async function d(e){try{let e=(0,u.e)(),{data:{user:t},error:r}=await e.auth.getUser();if(r||!t)return n.NextResponse.json({error:"Unauthorized"},{status:401});let{count:a,error:s}=await e.from("projects").select("*",{count:"exact",head:!0}).eq("user_id",t.id);if(s)throw s;let{data:o}=await e.from("projects").select("id").eq("user_id",t.id),i=o?.map(e=>e.id)||[],c=0,d=0,p=0;if(i.length>0){let{count:t}=await e.from("render_jobs").select("*",{count:"exact",head:!0}).in("project_id",i).in("status",["queued","processing"]);c=t||0;let r=new Date;r.setHours(0,0,0,0);let{count:a}=await e.from("render_jobs").select("*",{count:"exact",head:!0}).in("project_id",i).eq("status","completed").gte("completed_at",r.toISOString());d=a||0;let{data:s}=await e.from("render_jobs").select("started_at, completed_at").in("project_id",i).eq("status","completed").not("completed_at","is",null).not("started_at","is",null).order("completed_at",{ascending:!1}).limit(10);if(s&&s.length>0){let e=s.reduce((e,t)=>{if(!t.started_at||!t.completed_at)return e;let r=new Date(t.started_at).getTime(),a=new Date(t.completed_at).getTime();return e+(a-r)},0);p=Math.round(e/s.length/1e3/60)}}let{count:l}=await e.from("analytics_events").select("*",{count:"exact",head:!0}).eq("user_id",t.id).eq("event_type","project_view"),h={totalProjects:a||0,activeRenders:c,completedToday:d,totalViews:l||0,avgRenderTime:p,systemHealth:"healthy"};return n.NextResponse.json(h)}catch(e){return console.error("Error fetching dashboard stats:",e),n.NextResponse.json({error:"Internal server error"},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/dashboard/unified-stats/route",pathname:"/api/dashboard/unified-stats",filename:"route",bundlePath:"app/api/dashboard/unified-stats/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\dashboard\\unified-stats\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:l,staticGenerationAsyncStorage:h,serverHooks:m}=p,x="/api/dashboard/unified-stats/route";function I(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:h})}},13936:(e,t,r)=>{r.d(t,{e:()=>i,getSupabaseForRequest:()=>u,p:()=>n});var a=r(67721),s=r(61657),o=r(71615);let i=()=>{let e=(0,o.cookies)();return(0,a.createServerClient)("https://ofhzrdiadxigrvmrhaiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ",{cookies:{get:t=>e.get(t)?.value,set(t,r,a){try{e.set({name:t,value:r,...a})}catch(e){}},remove(t,r){try{e.set({name:t,value:"",...r})}catch(e){}}}})},n=(0,s.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}});function u(e){let t=e.headers.get("authorization")||e.headers.get("Authorization");return t?(0,s.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ",{global:{headers:{Authorization:t}},auth:{persistSession:!1,autoRefreshToken:!1}}):i()}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[8948,5972,1657,9702],()=>r(3e4));module.exports=a})();