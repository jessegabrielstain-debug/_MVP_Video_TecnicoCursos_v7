(()=>{var e={};e.id=2861,e.ids=[2861,3936,4665],e.modules={4665:e=>{function t(e){return Promise.resolve().then(()=>{var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}t.keys=()=>[],t.resolve=t,t.id=4665,e.exports=t},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},78893:e=>{"use strict";e.exports=require("buffer")},61282:e=>{"use strict";e.exports=require("child_process")},84770:e=>{"use strict";e.exports=require("crypto")},80665:e=>{"use strict";e.exports=require("dns")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},85807:e=>{"use strict";e.exports=require("module")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},68621:e=>{"use strict";e.exports=require("punycode")},76162:e=>{"use strict";e.exports=require("stream")},74026:e=>{"use strict";e.exports=require("string_decoder")},82452:e=>{"use strict";e.exports=require("tls")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},6162:e=>{"use strict";e.exports=require("worker_threads")},71568:e=>{"use strict";e.exports=require("zlib")},71460:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>q,patchFetch:()=>y,requestAsyncStorage:()=>g,routeModule:()=>h,serverHooks:()=>b,staticGenerationAsyncStorage:()=>x});var s={};r.r(s),r.d(s,{GET:()=>f,POST:()=>j});var o=r(49303),i=r(88716),a=r(60670),n=r(87070),u=r(13936),c=r(91585),d=r(26033),p=r(315),l=r(84770);let m=c.Ry({project_id:c.Z_().min(1),type:c.Z_().optional().default("video"),priority:c.Km(["low","normal","high"]).optional().default("normal"),composition_id:c.Z_().optional().default("Main"),input_data:c.IM(c._4()).optional(),metadata:c.IM(c._4()).optional(),estimated_duration:c.Rx().optional(),webhook_url:c.Z_().url().optional()}),_=c.Ry({status:c.Z_().optional(),project_id:c.Z_().optional(),limit:c.Z_().transform(e=>parseInt(e)||50).optional(),offset:c.Z_().transform(e=>parseInt(e)||0).optional()});async function f(e){try{let t=(0,u.getSupabaseForRequest)(e),{data:{user:r}}=await t.auth.getUser(),{searchParams:s}=new URL(e.url),o=_.parse(Object.fromEntries(s)),i=t.from("render_jobs").select("id, project_id, status, progress, created_at, completed_at, output_url, error_message, render_settings");if(o.project_id&&(i=i.eq("project_id",o.project_id)),r){let{data:e}=await t.from("projects").select("id").eq("user_id",r.id);e&&e.length>0&&(i=i.in("project_id",e.map(e=>e.id)))}if(o.status){let e=o.status.split(",");i=i.in("status",e)}let{data:a,error:c,count:d}=await i.order("created_at",{ascending:!1}).range(o.offset||0,(o.offset||0)+(o.limit||50)-1);if(c)throw c;let p=(a||[]).map(e=>({id:e.id,projectId:e.project_id,status:e.status,progress:e.progress,createdAt:e.created_at,completedAt:e.completed_at,outputUrl:e.output_url,error:e.error_message,config:e.render_settings}));return n.NextResponse.json({success:!0,jobs:p,pagination:{total:d||0,limit:o.limit||50,offset:o.offset||0},message:"Render jobs retrieved successfully"})}catch(e){return console.error("Get render jobs API error:",e),n.NextResponse.json({success:!1,error:"Failed to retrieve render jobs",jobs:[]},{status:500})}}async function j(e){try{let t=(0,u.getSupabaseForRequest)(e),{data:{user:r}}=await t.auth.getUser();if(!r)return n.NextResponse.json({success:!1,error:"Authentication required"},{status:401});let s=await e.json(),o=m.parse(s),{data:i,error:a}=await t.from("projects").select("id, user_id").eq("id",o.project_id).single();if(a||!i)return n.NextResponse.json({success:!1,error:"Project not found"},{status:404});let c=i.user_id===r.id,d=!1;if(!c){let{data:e}=await t.from("project_collaborators").select("user_id").eq("project_id",o.project_id).eq("user_id",r.id).single();e&&(d=!0)}if(!c&&!d)return n.NextResponse.json({success:!1,error:"Access denied to project"},{status:403});let{data:_}=await t.from("render_jobs").select("id").eq("project_id",o.project_id).in("status",["queued","processing"]).single();if(_)return n.NextResponse.json({success:!1,error:"An active render job already exists for this project"},{status:409});let f={type:o.type,priority:o.priority,input_data:o.input_data,metadata:o.metadata,estimated_duration:o.estimated_duration},{data:j,error:h}=await t.from("render_jobs").insert({id:(0,l.randomUUID)(),project_id:o.project_id,user_id:r.id,status:"queued",progress:0,render_settings:f}).select().single();if(h)throw h;try{await (0,p.fn)({jobId:j.id,projectId:o.project_id,userId:r.id,settings:{resolution:"1920x1080",fps:30,quality:"high",format:"mp4"},webhookUrl:o.webhook_url})}catch(e){throw console.error("Failed to add job to queue:",e),await t.from("render_jobs").update({status:"failed",error_message:"Failed to queue job"}).eq("id",j.id),Error("Failed to queue render job")}try{await t.from("analytics_events").insert({user_id:r.id,event_type:"render_started",event_data:{project_id:o.project_id,job_id:j.id,type:o.type,settings:f}})}catch(e){console.warn("Failed to log project history:",e)}return n.NextResponse.json({success:!0,data:j,message:"Render job created and queued successfully"},{status:201})}catch(e){if(console.error("Create render job API error:",e),e instanceof d.jm)return n.NextResponse.json({success:!1,error:"Invalid job data",details:e.errors},{status:400});return n.NextResponse.json({success:!1,error:e instanceof Error?e.message:"Failed to create render job"},{status:500})}}let h=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/render/jobs/route",pathname:"/api/render/jobs",filename:"route",bundlePath:"app/api/render/jobs/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\render\\jobs\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:x,serverHooks:b}=h,q="/api/render/jobs/route";function y(){return(0,a.patchFetch)({serverHooks:b,staticGenerationAsyncStorage:x})}},315:(e,t,r)=>{"use strict";r.d(t,{fn:()=>p,S9:()=>d,GQ:()=>l});var s=r(26608);let o=null;function i(){if(o)return o;let e=process.env.REDIS_URL,t=process.env.RENDER_QUEUE_NAME??"render-jobs";return e?o={redisUrl:e,queueName:t}:(console.warn("⚠️ REDIS_URL not found. Queue will operate in mock/fallback mode."),o={redisUrl:"redis://mock:6379",queueName:t})}let a={attempts:3,backoff:{type:"exponential",delay:5e3},removeOnComplete:100,removeOnFail:200},n=null;function u(){let{redisUrl:e}=i();if("redis://mock:6379"===e)return{host:"mock",port:6379};let t=new URL(e),r={host:t.hostname,port:Number(t.port||6379),password:t.password||void 0,username:t.username||void 0,db:t.pathname?Number(t.pathname.replace("/","")||"0"):void 0};return"rediss:"===t.protocol&&(r.tls={rejectUnauthorized:!1}),r}function c(e){if(n)return n;let{queueName:t,redisUrl:r}=i();return"redis://mock:6379"===r?(console.warn("⚠️ Using MOCK RenderQueue (No Redis configured)"),n={add:async(e,t)=>{let r=t.jobId||`mock-job-${Date.now()}`;return console.log("MOCK Queue: Adding job",e,r),console.log("MOCK Queue: Job added. Waiting for Postgres Worker to pick it up from DB."),{id:r,name:e,data:{...t,jobId:r},getState:async()=>"active",remove:async()=>{}}},getJob:async e=>null,close:async()=>{}}):n=new s.Queue(t,function(e){let t=u(),r={connection:t,defaultJobOptions:a,...e};return r.connection=r.connection??t,r.defaultJobOptions=r.defaultJobOptions??a,r}(e))}function d(e){let{queueName:t,redisUrl:r}=i();if("redis://mock:6379"===r)return{on:()=>{},close:async()=>{}};let o=u();return new s.Ji(t,{...e,connection:e?.connection??o})}async function p(e){return c().add("render-video",e)}async function l(e){let t=c(),r=await t.getJob(e);return r?await r.getState():null}},13936:(e,t,r)=>{"use strict";r.d(t,{e:()=>a,getSupabaseForRequest:()=>u,p:()=>n});var s=r(67721),o=r(61657),i=r(71615);let a=()=>{let e=(0,i.cookies)();return(0,s.createServerClient)("https://ofhzrdiadxigrvmrhaiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ",{cookies:{get:t=>e.get(t)?.value,set(t,r,s){try{e.set({name:t,value:r,...s})}catch(e){}},remove(t,r){try{e.set({name:t,value:"",...r})}catch(e){}}}})},n=(0,o.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}});function u(e){let t=e.headers.get("authorization")||e.headers.get("Authorization");return t?(0,o.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ",{global:{headers:{Authorization:t}},auth:{persistSession:!1,autoRefreshToken:!1}}):a()}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972,1657,9702,9092,1585,6608],()=>r(71460));module.exports=s})();