(()=>{var e={};e.id=4520,e.ids=[4520,4665],e.modules={4665:e=>{function t(e){return Promise.resolve().then(()=>{var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}t.keys=()=>[],t.resolve=t,t.id=4665,e.exports=t},53524:e=>{"use strict";e.exports=require("@prisma/client")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},78893:e=>{"use strict";e.exports=require("buffer")},61282:e=>{"use strict";e.exports=require("child_process")},84770:e=>{"use strict";e.exports=require("crypto")},80665:e=>{"use strict";e.exports=require("dns")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},85807:e=>{"use strict";e.exports=require("module")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},68621:e=>{"use strict";e.exports=require("punycode")},76162:e=>{"use strict";e.exports=require("stream")},74026:e=>{"use strict";e.exports=require("string_decoder")},82452:e=>{"use strict";e.exports=require("tls")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},6162:e=>{"use strict";e.exports=require("worker_threads")},71568:e=>{"use strict";e.exports=require("zlib")},59475:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>f,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>x,staticGenerationAsyncStorage:()=>m});var s={};r.r(s),r.d(s,{GET:()=>d,POST:()=>c});var o=r(49303),n=r(88716),i=r(60670),u=r(87070),a=r(315);async function c(e){try{let{project_id:t,preset_id:r}=await e.json();if(!t||!r)return u.NextResponse.json({error:"project_id and preset_id are required"},{status:400});let s=`job_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;return u.NextResponse.json({success:!0,job_id:s,status:"queued",project_id:t,preset_id:r,message:"Video pipeline render job created successfully",created_at:new Date().toISOString()})}catch(e){return u.NextResponse.json({error:"Invalid JSON payload"},{status:400})}}async function d(e){try{let{searchParams:t}=new URL(e.url),s=t.get("jobId");if(!s)return u.NextResponse.json({error:"jobId obrigat\xf3rio"},{status:400});console.log(`ðŸ“Š [API] Verificando status do job: ${s}`);try{let{getSupabaseForRequest:t}=await Promise.all([r.e(1657),r.e(9702),r.e(3936)]).then(r.bind(r,13936)),o=t(e),{data:n,error:i}=await o.from("render_jobs").select("id, project_id, status, progress, output_url, error_message, render_settings, created_at, completed_at").eq("id",s).single();if(n&&!i)return u.NextResponse.json({success:!0,jobId:s,status:n.status,progress:n.progress||0,outputUrl:n.output_url,error:n.error_message,config:n.render_settings,createdAt:n.created_at,completedAt:n.completed_at,timestamp:new Date().toISOString()})}catch(e){console.warn("[API] Supabase unavailable, trying Prisma...")}try{let{prisma:e}=await r.e(3474).then(r.bind(r,3474)),t=await e.renderJob.findUnique({where:{id:s},include:{project:{select:{id:!0,title:!0,status:!0,thumbnailUrl:!0,duration:!0}}}});if(t)return u.NextResponse.json({success:!0,jobId:s,status:t.status,progress:t.progress||0,outputUrl:t.outputUrl,error:t.errorMessage,createdAt:t.createdAt?.toISOString(),completedAt:t.completedAt?.toISOString(),timestamp:new Date().toISOString()})}catch(e){console.warn("[API] Prisma unavailable, falling back to queue status")}let o=await (0,a.GQ)(s);if(!o)return u.NextResponse.json({error:"Job n\xe3o encontrado",status:"not_found"},{status:404});return u.NextResponse.json({success:!0,jobId:s,status:o,progress:0,timestamp:new Date().toISOString()})}catch(e){return console.error("[API] Erro ao verificar status:",e),u.NextResponse.json({error:"Erro ao verificar status",details:e instanceof Error?e.message:"Erro desconhecido"},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/render/status/route",pathname:"/api/render/status",filename:"route",bundlePath:"app/api/render/status/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\render\\status\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:l,staticGenerationAsyncStorage:m,serverHooks:x}=p,g="/api/render/status/route";function f(){return(0,i.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:m})}},315:(e,t,r)=>{"use strict";r.d(t,{fn:()=>p,S9:()=>d,GQ:()=>l});var s=r(26608);let o=null;function n(){if(o)return o;let e=process.env.REDIS_URL,t=process.env.RENDER_QUEUE_NAME??"render-jobs";return e?o={redisUrl:e,queueName:t}:(console.warn("âš ï¸ REDIS_URL not found. Queue will operate in mock/fallback mode."),o={redisUrl:"redis://mock:6379",queueName:t})}let i={attempts:3,backoff:{type:"exponential",delay:5e3},removeOnComplete:100,removeOnFail:200},u=null;function a(){let{redisUrl:e}=n();if("redis://mock:6379"===e)return{host:"mock",port:6379};let t=new URL(e),r={host:t.hostname,port:Number(t.port||6379),password:t.password||void 0,username:t.username||void 0,db:t.pathname?Number(t.pathname.replace("/","")||"0"):void 0};return"rediss:"===t.protocol&&(r.tls={rejectUnauthorized:!1}),r}function c(e){if(u)return u;let{queueName:t,redisUrl:r}=n();return"redis://mock:6379"===r?(console.warn("âš ï¸ Using MOCK RenderQueue (No Redis configured)"),u={add:async(e,t)=>{let r=t.jobId||`mock-job-${Date.now()}`;return console.log("MOCK Queue: Adding job",e,r),console.log("MOCK Queue: Job added. Waiting for Postgres Worker to pick it up from DB."),{id:r,name:e,data:{...t,jobId:r},getState:async()=>"active",remove:async()=>{}}},getJob:async e=>null,close:async()=>{}}):u=new s.Queue(t,function(e){let t=a(),r={connection:t,defaultJobOptions:i,...e};return r.connection=r.connection??t,r.defaultJobOptions=r.defaultJobOptions??i,r}(e))}function d(e){let{queueName:t,redisUrl:r}=n();if("redis://mock:6379"===r)return{on:()=>{},close:async()=>{}};let o=a();return new s.Ji(t,{...e,connection:e?.connection??o})}async function p(e){return c().add("render-video",e)}async function l(e){let t=c(),r=await t.getJob(e);return r?await r.getState():null}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972,9092,6608],()=>r(59475));module.exports=s})();