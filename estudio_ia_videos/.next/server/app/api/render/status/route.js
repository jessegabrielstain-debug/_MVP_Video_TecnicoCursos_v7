(()=>{var e={};e.id=4520,e.ids=[4520],e.modules={404665:e=>{function t(e){return Promise.resolve().then(()=>{var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}t.keys=()=>[],t.resolve=t,t.id=404665,e.exports=t},453524:e=>{"use strict";e.exports=require("@prisma/client")},572934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},554580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},345869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},220399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},430517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},627790:e=>{"use strict";e.exports=require("assert")},978893:e=>{"use strict";e.exports=require("buffer")},761282:e=>{"use strict";e.exports=require("child_process")},84770:e=>{"use strict";e.exports=require("crypto")},780665:e=>{"use strict";e.exports=require("dns")},17702:e=>{"use strict";e.exports=require("events")},592048:e=>{"use strict";e.exports=require("fs")},532615:e=>{"use strict";e.exports=require("http")},735240:e=>{"use strict";e.exports=require("https")},885807:e=>{"use strict";e.exports=require("module")},698216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},555315:e=>{"use strict";e.exports=require("path")},986624:e=>{"use strict";e.exports=require("querystring")},276162:e=>{"use strict";e.exports=require("stream")},474026:e=>{"use strict";e.exports=require("string_decoder")},682452:e=>{"use strict";e.exports=require("tls")},774175:e=>{"use strict";e.exports=require("tty")},917360:e=>{"use strict";e.exports=require("url")},521764:e=>{"use strict";e.exports=require("util")},806162:e=>{"use strict";e.exports=require("worker_threads")},671568:e=>{"use strict";e.exports=require("zlib")},259475:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>q,requestAsyncStorage:()=>x,routeModule:()=>l,serverHooks:()=>f,staticGenerationAsyncStorage:()=>m});var s={};r.r(s),r.d(s,{GET:()=>d,POST:()=>p});var o=r(349303),i=r(88716),n=r(60670),u=r(387070),a=r(95715),c=r(600315);async function p(e){try{let{project_id:t,preset_id:r}=await e.json();if(!t||!r)return u.NextResponse.json({error:"project_id and preset_id are required"},{status:400});let s=`job_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;return u.NextResponse.json({success:!0,job_id:s,status:"queued",project_id:t,preset_id:r,message:"Video pipeline render job created successfully",created_at:new Date().toISOString()})}catch(e){return u.NextResponse.json({error:"Invalid JSON payload"},{status:400})}}async function d(e){try{let t=await (0,a.getServerSession)(Object(function(){var e=Error("Cannot find module '@/lib/auth/auth-config'");throw e.code="MODULE_NOT_FOUND",e}()));if(!t?.user?.id)return u.NextResponse.json({error:"N\xe3o autenticado"},{status:401});let{searchParams:s}=new URL(e.url),o=s.get("jobId");if(!o)return u.NextResponse.json({error:"jobId obrigat\xf3rio"},{status:400});console.log(`ðŸ“Š [API] Verificando status do job: ${o}`);let{prisma:i}=await r.e(3474).then(r.bind(r,303474)),n=null;try{n=await i.renderJob.findUnique({where:{id:o},include:{project:{select:{id:!0,title:!0,status:!0,videoUrl:!0,thumbnailUrl:!0,duration:!0,fileSize:!0}}}})}catch(e){console.warn("[API] Database unavailable, falling back to queue status")}if(n)return u.NextResponse.json({success:!0,jobId:o,status:n.status,progress:n.progress||0,result:n.outputData?{success:"completed"===n.status,outputUrl:n.outputData.outputUrl||n.project?.videoUrl,duration:n.outputData.duration||n.project?.duration,fileSize:n.outputData.fileSize||n.project?.fileSize,metadata:n.outputData.metadata}:void 0,error:n.errorMessage,createdAt:n.createdAt?.toISOString(),startedAt:n.startedAt?.toISOString(),completedAt:n.completedAt?.toISOString(),project:n.project,currentStep:n.currentStep,timestamp:new Date().toISOString()});let p=await (0,c.getVideoJobStatus)(o);if(!p)return u.NextResponse.json({error:"Job n\xe3o encontrado"},{status:404});return u.NextResponse.json({success:!0,jobId:o,...p,timestamp:new Date().toISOString()})}catch(e){return console.error("[API] Erro ao verificar status:",e),u.NextResponse.json({error:"Erro ao verificar status",details:e instanceof Error?e.message:"Erro desconhecido"},{status:500})}}!function(){var e=Error("Cannot find module '@/lib/auth/auth-config'");throw e.code="MODULE_NOT_FOUND",e}();let l=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/render/status/route",pathname:"/api/render/status",filename:"route",bundlePath:"app/api/render/status/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\render\\status\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:x,staticGenerationAsyncStorage:m,serverHooks:f}=l,h="/api/render/status/route";function q(){return(0,n.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:m})}},600315:(e,t,r)=>{"use strict";r.d(t,{hw:()=>a});var s=r(826608);let o=null;function i(){if(o)return o;let e=process.env.REDIS_URL,t=process.env.RENDER_QUEUE_NAME??"render-jobs";if(!e)throw Error("Missing REDIS_URL environment variable for render queue");return o={redisUrl:e,queueName:t}}let n={attempts:3,backoff:{type:"exponential",delay:5e3},removeOnComplete:100,removeOnFail:200},u=null;function a(e){if(u)return u;let{queueName:t}=i();return u=new s.ci(t,function(e){let t=function(){let{redisUrl:e}=i(),t=new URL(e),r={host:t.hostname,port:Number(t.port||6379),password:t.password||void 0,username:t.username||void 0,db:t.pathname?Number(t.pathname.replace("/","")||"0"):void 0};return"rediss:"===t.protocol&&(r.tls={rejectUnauthorized:!1}),r}(),r={connection:t,defaultJobOptions:n,...e};return r.connection=r.connection??t,r.defaultJobOptions=r.defaultJobOptions??n,r}(e))}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972,5715,9092,6608],()=>r(259475));module.exports=s})();