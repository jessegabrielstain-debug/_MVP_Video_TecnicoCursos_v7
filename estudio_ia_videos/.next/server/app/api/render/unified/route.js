"use strict";(()=>{var e={};e.id=3050,e.ids=[3050],e.modules={572934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},554580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},345869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},220399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},430517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},627790:e=>{e.exports=require("assert")},978893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},532615:e=>{e.exports=require("http")},735240:e=>{e.exports=require("https")},986624:e=>{e.exports=require("querystring")},917360:e=>{e.exports=require("url")},521764:e=>{e.exports=require("util")},671568:e=>{e.exports=require("zlib")},304759:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>y,requestAsyncStorage:()=>h,routeModule:()=>g,serverHooks:()=>b,staticGenerationAsyncStorage:()=>m});var a={};r.r(a),r.d(a,{GET:()=>p,POST:()=>l});var s=r(349303),o=r(88716),i=r(60670),n=r(387070),d=r(95715);!function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e}();class u{async createRenderJob(e,t){let r=`render_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,a={id:r,projectId:e.projectId,status:"queued",progress:0,currentStage:"Preparando renderiza\xe7\xe3o...",renderConfig:e.renderConfig,createdAt:new Date,estimatedDuration:this.calculateEstimatedDuration(e)};return this.renderJobs.set(r,a),await this.saveRenderJobToDatabase(a,t),this.processRenderJob(r,e).catch(e=>{console.error("Render job failed:",e),this.updateRenderJob(r,{status:"failed",errorMessage:e.message})}),a}calculateEstimatedDuration(e){return Math.ceil(e.slides.reduce((e,t)=>e+t.duration,0)*this.getComplexityFactor(e.renderConfig))}getComplexityFactor(e){let t=1;switch(e.resolution){case"720p":t*=1;break;case"1080p":t*=1.5;break;case"4k":t*=3}switch(e.quality){case"draft":t*=.5;break;case"standard":t*=1;break;case"high":t*=1.5;break;case"ultra":t*=2}return e.avatarSync&&(t*=1.3),"none"!==e.transitionStyle&&(t*=1.2),t}async processRenderJob(e,t){try{await this.updateRenderJob(e,{status:"processing",progress:10,currentStage:"Validando recursos..."}),await this.validateAssets(t.slides),await this.updateRenderJob(e,{progress:25,currentStage:"Criando timeline de composi\xe7\xe3o..."});let r=await this.createComposition(t.slides,t.renderConfig);await this.updateRenderJob(e,{status:"compositing",progress:40,currentStage:"Compondo camadas de v\xeddeo..."});let a=await this.compositeVideoLayers(r,t.renderConfig);await this.updateRenderJob(e,{progress:60,currentStage:"Sincronizando \xe1udio e avatar..."});let s=await this.syncAudioAndAvatar(a,t.slides,t.renderConfig);await this.updateRenderJob(e,{progress:75,currentStage:"Aplicando efeitos e transi\xe7\xf5es..."});let o=await this.addEffectsAndTransitions(s,t.renderConfig);await this.updateRenderJob(e,{status:"encoding",progress:90,currentStage:"Codificando v\xeddeo final..."});let i=await this.encodeVideo(o,t.renderConfig);await this.updateRenderJob(e,{status:"completed",progress:100,currentStage:"Renderiza\xe7\xe3o conclu\xedda!",outputUrl:i.url,completedAt:new Date})}catch(t){throw await this.updateRenderJob(e,{status:"failed",errorMessage:t.message,currentStage:"Erro na renderiza\xe7\xe3o"}),t}}async validateAssets(e){await new Promise(e=>setTimeout(e,1e3));let t={slides:e.length,audioFiles:e.filter(e=>e.audioUrl).length,avatarVideos:e.filter(e=>e.avatarVideoUrl).length,backgroundImages:e.filter(e=>e.backgroundImageUrl).length};return console.log("Assets validated:",t),t}async createComposition(e,t){await new Promise(e=>setTimeout(e,1500));let r=0,a=[];for(let s of e.sort((e,t)=>e.order-t.order)){let e={slideId:s.id,startTime:r,endTime:r+s.duration,layers:[]};(s.backgroundImageUrl||s.thumbnailUrl)&&e.layers.push({type:"background",source:s.backgroundImageUrl||s.thumbnailUrl||"",startTime:r,duration:s.duration,position:{x:0,y:0,width:1920,height:1080}}),s.avatarVideoUrl&&t.avatarSync&&e.layers.push({type:"avatar",source:s.avatarVideoUrl,startTime:r,duration:s.duration,position:{x:1200,y:200,width:600,height:800}}),s.audioUrl&&e.layers.push({type:"audio",source:s.audioUrl,startTime:r,duration:s.duration}),t.includeSubtitles&&s.content&&e.layers.push({type:"subtitle",source:s.content,startTime:r,duration:s.duration,position:{x:100,y:900,width:1720,height:100}}),t.includeWatermark&&e.layers.push({type:"watermark",source:"/assets/watermark.png",startTime:r,duration:s.duration,position:{x:1720,y:50,width:150,height:50},opacity:.7}),a.push(e),r+=s.duration}return a}async compositeVideoLayers(e,t){return await new Promise(e=>setTimeout(e,2e3)),{composition:e,resolution:t.resolution,fps:t.fps,totalDuration:e.reduce((e,t)=>e+(t.endTime-t.startTime),0)}}async syncAudioAndAvatar(e,t,r){return await new Promise(e=>setTimeout(e,1500)),r.avatarSync&&console.log("Syncing avatar with audio..."),{...e,audioSynced:!0,avatarSynced:r.avatarSync}}async addEffectsAndTransitions(e,t){return await new Promise(e=>setTimeout(e,1e3)),{...e,transitions:t.transitionStyle,effects:["color_correction","noise_reduction"]}}async encodeVideo(e,t){await new Promise(e=>setTimeout(e,2e3));let r=`render_${Date.now()}.${t.format}`;return{url:`/api/files/renders/${r}`,size:this.calculateFileSize(e.totalDuration,t)}}calculateFileSize(e,t){return Math.ceil(e*(t.bitrate||this.getDefaultBitrate(t.resolution,t.quality))/8)}getDefaultBitrate(e,t){return({"720p":{draft:1e3,standard:2500,high:4e3,ultra:6e3},"1080p":{draft:2e3,standard:5e3,high:8e3,ultra:12e3},"4k":{draft:8e3,standard:2e4,high:35e3,ultra:5e4}})[e][t]||2500}async updateRenderJob(e,t){let r=this.renderJobs.get(e);r&&(Object.assign(r,t),this.renderJobs.set(e,r),await this.updateRenderJobInDatabase(e,t))}getRenderJob(e){return this.renderJobs.get(e)}async saveRenderJobToDatabase(e,t){console.log("Saving render job to database:",e.id)}async updateRenderJobInDatabase(e,t){console.log("Updating render job in database:",e,t)}constructor(){this.renderJobs=new Map}}let c=new u;async function l(e){try{let t=await (0,d.getServerSession)(Object(function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e}()));if(!t?.user?.id)return n.NextResponse.json({error:"Unauthorized"},{status:401});let r=await e.json();if(!r.projectId||!r.slides||0===r.slides.length)return n.NextResponse.json({error:"Project ID and slides are required"},{status:400});let a=await c.createRenderJob(r,t.user.id);return n.NextResponse.json({success:!0,renderJob:{id:a.id,status:a.status,progress:a.progress,currentStage:a.currentStage,estimatedDuration:a.estimatedDuration}})}catch(e){return console.error("Render API error:",e),n.NextResponse.json({error:"Internal server error",details:e.message},{status:500})}}async function p(e){try{let t=await (0,d.getServerSession)(Object(function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e}()));if(!t?.user?.id)return n.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:r}=new URL(e.url),a=r.get("jobId");if(!a)return n.NextResponse.json({error:"Job ID is required"},{status:400});let s=c.getRenderJob(a);if(!s)return n.NextResponse.json({error:"Render job not found"},{status:404});return n.NextResponse.json({success:!0,renderJob:{id:s.id,projectId:s.projectId,status:s.status,progress:s.progress,currentStage:s.currentStage,outputUrl:s.outputUrl,errorMessage:s.errorMessage,createdAt:s.createdAt,completedAt:s.completedAt,estimatedDuration:s.estimatedDuration}})}catch(e){return console.error("Render status API error:",e),n.NextResponse.json({error:"Internal server error",details:e.message},{status:500})}}let g=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/render/unified/route",pathname:"/api/render/unified",filename:"route",bundlePath:"app/api/render/unified/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\render\\unified\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:h,staticGenerationAsyncStorage:m,serverHooks:b}=g,f="/api/render/unified/route";function y(){return(0,i.patchFetch)({serverHooks:b,staticGenerationAsyncStorage:m})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[8948,5972,5715],()=>r(304759));module.exports=a})();