"use strict";(()=>{var e={};e.id=1324,e.ids=[1324],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},61212:e=>{e.exports=require("async_hooks")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},27920:e=>{e.exports=require("diagnostics_channel")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},20629:e=>{e.exports=require("fs/promises")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},85807:e=>{e.exports=require("module")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},96119:e=>{e.exports=require("perf_hooks")},35816:e=>{e.exports=require("process")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},6162:e=>{e.exports=require("worker_threads")},71568:e=>{e.exports=require("zlib")},17718:e=>{e.exports=require("node:child_process")},65714:e=>{e.exports=require("node:diagnostics_channel")},15673:e=>{e.exports=require("node:events")},87561:e=>{e.exports=require("node:fs")},88849:e=>{e.exports=require("node:http")},22286:e=>{e.exports=require("node:https")},85690:e=>{e.exports=require("node:inspector")},82033:e=>{e.exports=require("node:module")},87503:e=>{e.exports=require("node:net")},70612:e=>{e.exports=require("node:os")},49411:e=>{e.exports=require("node:path")},51747:e=>{e.exports=require("node:readline")},84492:e=>{e.exports=require("node:stream")},31764:e=>{e.exports=require("node:tls")},47261:e=>{e.exports=require("node:util")},24086:e=>{e.exports=require("node:worker_threads")},65628:e=>{e.exports=require("node:zlib")},64581:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>b,patchFetch:()=>f,requestAsyncStorage:()=>h,routeModule:()=>g,serverHooks:()=>_,staticGenerationAsyncStorage:()=>q});var o={};t.r(o),t.d(o,{DELETE:()=>x,GET:()=>m});var s=t(49303),a=t(88716),i=t(60670),n=t(87070),d=t(74037),u=t(20629),p=t.n(u),c=t(55315),l=t.n(c);async function m(e,{params:r}){try{let e=r.filename;if(!e)return n.NextResponse.json({error:"Nome do arquivo \xe9 obrigat\xf3rio"},{status:400});let t=e.split(".")[0],o=await d.N.getJob(t);if(!o||"completed"!==o.status)return n.NextResponse.json({error:"Arquivo n\xe3o dispon\xedvel"},{status:404});let s=l().join(process.cwd(),"public","renders",e);try{await p().access(s);let r=await p().readFile(s),t=function(e){switch(l().extname(e).toLowerCase()){case".mp4":return"video/mp4";case".webm":return"video/webm";case".gif":return"image/gif";case".mp3":return"audio/mpeg";case".wav":return"audio/wav";default:return"application/octet-stream"}}(e);return new n.NextResponse(new Uint8Array(r),{status:200,headers:{"Content-Type":t,"Content-Disposition":`attachment; filename="${e}"`,"Content-Length":r.length.toString(),"Cache-Control":"public, max-age=31536000"}})}catch(e){return n.NextResponse.json({error:"Arquivo n\xe3o encontrado"},{status:404})}}catch(e){return console.error("Erro ao fazer download:",e),n.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function x(e,{params:r}){try{let e=r.filename;if(!e)return n.NextResponse.json({error:"Nome do arquivo \xe9 obrigat\xf3rio"},{status:400});let t=l().join(process.cwd(),"public","renders",e);try{await p().unlink(t);let r=e.split(".")[0];return d.N.removeJob(r),n.NextResponse.json({success:!0,message:"Arquivo deletado com sucesso"})}catch(e){return n.NextResponse.json({error:"Arquivo n\xe3o encontrado"},{status:404})}}catch(e){return console.error("Erro ao deletar arquivo:",e),n.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}let g=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/render/output/[filename]/route",pathname:"/api/render/output/[filename]",filename:"route",bundlePath:"app/api/render/output/[filename]/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\render\\output\\[filename]\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:h,staticGenerationAsyncStorage:q,serverHooks:_}=g,b="/api/render/output/[filename]/route";function f(){return(0,i.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:q})}},74037:(e,r,t)=>{t.d(r,{N:()=>i});var o=t(61657),s=t(80338);class a{constructor(){let e="https://ofhzrdiadxigrvmrhaiz.supabase.co",r=process.env.SUPABASE_SERVICE_ROLE_KEY;e&&r||console.warn("⚠️ Supabase credentials not found in JobManager"),this.supabase=(0,o.eI)(e,r,{auth:{autoRefreshToken:!1,persistSession:!1}})}async getJobContext(e){try{let{data:r,error:t}=await this.supabase.from("render_jobs").select("project_id").eq("id",e).single();if(t||!r)return null;let{data:o,error:s}=await this.supabase.from("projects").select("user_id").eq("id",r.project_id).single();if(s||!o)return null;return{projectId:r.project_id,userId:o.user_id}}catch(e){return console.error("Error fetching job context:",e),null}}async createJob(e,r){let t=new Date(Date.now()-6e4).toISOString(),{data:o}=await this.supabase.from("render_jobs").select("id").eq("project_id",r).eq("status","queued").gt("created_at",t).maybeSingle();if(o)return console.log(`[JobManager] Idempotency: Returning existing queued job ${o.id} for project ${r}`),o.id;let{data:s,error:a}=await this.supabase.from("render_jobs").insert({project_id:r,user_id:e,status:"queued",progress:0,render_settings:{},attempts:0}).select("id").single();if(a)throw Error(`Failed to create job: ${a.message}`);return s.id}async getJob(e){let{data:r,error:t}=await this.supabase.from("render_jobs").select("*").eq("id",e).single();return t||!r?null:{id:r.id,userId:r.user_id,projectId:r.project_id,status:r.status,progress:r.progress,createdAt:new Date(r.created_at),startedAt:r.started_at?new Date(r.started_at):void 0,completedAt:r.completed_at?new Date(r.completed_at):void 0,outputUrl:r.output_url,error:r.error_message}}async updateProgress(e,r){let t={progress:Math.min(100,Math.max(0,r)),updated_at:new Date().toISOString()},{error:o}=await this.supabase.from("render_jobs").update(t).eq("id",e);o&&console.error(`Failed to update progress for job ${e}:`,o)}async startJob(e){let{error:r}=await this.supabase.from("render_jobs").update({status:"processing",started_at:new Date().toISOString(),progress:0}).eq("id",e);if(r)console.error(`Failed to start job ${e}:`,r);else{let r=await this.getJobContext(e);r&&s.DR.renderStarted({jobId:e,projectId:r.projectId,userId:r.userId}).catch(e=>console.error("Webhook trigger failed:",e))}}async completeJob(e,r){let{error:t}=await this.supabase.from("render_jobs").update({status:"completed",progress:100,completed_at:new Date().toISOString(),output_url:r}).eq("id",e);if(t)console.error(`Failed to complete job ${e}:`,t);else{let t=await this.getJobContext(e);t&&s.DR.renderCompleted({jobId:e,projectId:t.projectId,videoUrl:r,duration:0}).catch(e=>console.error("Webhook trigger failed:",e))}}async failJob(e,r){let{error:t}=await this.supabase.from("render_jobs").update({status:"failed",completed_at:new Date().toISOString(),error_message:r}).eq("id",e);if(t)console.error(`Failed to fail job ${e}:`,t);else{let t=await this.getJobContext(e);t&&s.DR.renderFailed({jobId:e,projectId:t.projectId,error:r}).catch(e=>console.error("Webhook trigger failed:",e))}}async listJobs(e,r=100){let t=this.supabase.from("render_jobs").select("*");e&&(t=t.eq("project_id",e));let{data:o,error:s}=await t.order("created_at",{ascending:!1}).limit(r);return s?(console.error("Failed to list jobs:",s),[]):o.map(e=>({id:e.id,userId:e.user_id,projectId:e.project_id,status:e.status,progress:e.progress,createdAt:new Date(e.created_at),startedAt:e.started_at?new Date(e.started_at):void 0,completedAt:e.completed_at?new Date(e.completed_at):void 0,outputUrl:e.output_url,error:e.error_message}))}async removeJob(e){let{error:r}=await this.supabase.from("render_jobs").delete().eq("id",e);r&&console.error(`Failed to remove job ${e}:`,r)}}let i=new a}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[8948,5972,1657,9092,7686,616],()=>t(64581));module.exports=o})();