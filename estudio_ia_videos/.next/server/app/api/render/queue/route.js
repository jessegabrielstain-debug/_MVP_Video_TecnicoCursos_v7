"use strict";(()=>{var e={};e.id=2564,e.ids=[2564,3936],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},14119:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>v,requestAsyncStorage:()=>I,routeModule:()=>g,serverHooks:()=>f,staticGenerationAsyncStorage:()=>q});var a={};r.r(a),r.d(a,{GET:()=>h,dynamic:()=>p});var s=r(49303),i=r(88716),o=r(60670),n=r(87070),u=r(13936),d=r(91585),c=r(26033);let p="force-dynamic",l=d.Ry({status:d.Z_().optional(),project_id:d.Z_().optional(),search:d.Z_().optional(),start_date:d.Z_().optional(),end_date:d.Z_().optional(),limit:d.Z_().transform(e=>parseInt(e)||50).optional(),offset:d.Z_().transform(e=>parseInt(e)||0).optional()});function m(e,t,r){let a=e.from("render_jobs").select("*").eq("user_id",r);if(t.status){let e=t.status.split(",");a=a.in("status",e)}return t.project_id&&(a=a.eq("project_id",t.project_id)),t.start_date&&(a=a.gte("created_at",t.start_date)),t.end_date&&(a=a.lte("created_at",t.end_date)),t.search&&(a=a.or(`id.ilike.%${t.search}%`)),a}async function _(e,t){try{let{data:r}=await e.from("render_jobs").select("status").eq("user_id",t),a=r?.reduce((e,t)=>(e[t.status]=(e[t.status]||0)+1,e),{})||{},{data:s}=await e.from("render_jobs").select("created_at, started_at").eq("user_id",t).eq("status","processing"),i=0;s&&s.length>0&&(i=s.reduce((e,t)=>{if(t.started_at){let r=new Date(t.started_at).getTime()-new Date(t.created_at).getTime();return e+r}return e},0)/s.length/1e3);let o=a.queued||0,n=new Date(Date.now()+o*i*1e3).toISOString();return{total_jobs:r?.length||0,queue_length:o,average_wait_time:Math.round(i),estimated_completion:n}}catch(e){return console.error("Error calculating queue stats:",e),{total_jobs:0,queue_length:0,average_wait_time:0,estimated_completion:new Date().toISOString()}}}async function h(e){try{let t=(0,u.getSupabaseForRequest)(e),{data:{user:r},error:a}=await t.auth.getUser();if(a||!r)return n.NextResponse.json({success:!1,error:"Authentication required"},{status:401});let{searchParams:s}=new URL(e.url),i=l.parse(Object.fromEntries(s)),[o,d,c,p]=await Promise.all([m(t,{...i,status:"queued"},r.id).order("created_at",{ascending:!0}).limit(i.limit||50),m(t,{...i,status:"processing"},r.id).order("started_at",{ascending:!0}).limit(i.limit||50),m(t,{...i,status:"completed"},r.id).order("completed_at",{ascending:!1}).limit(i.limit||50),m(t,{...i,status:"failed"},r.id).order("updated_at",{ascending:!1}).limit(i.limit||50)]);if(o.error)throw o.error;if(d.error)throw d.error;if(c.error)throw c.error;if(p.error)throw p.error;let h=await _(t,r.id),g=e=>{let t=e.render_settings||{};return{...e,priority:t.priority||"normal",type:t.type||"video",input_data:t.input_data||{},metadata:t.metadata||{},render_settings:t}},I={pending:(o.data||[]).map(g),processing:(d.data||[]).map(g),completed:(c.data||[]).map(g),failed:(p.data||[]).map(g),...h};return n.NextResponse.json({success:!0,data:I,message:"Render queue retrieved successfully"})}catch(e){if(console.error("Render queue API error:",e),e instanceof c.jm)return n.NextResponse.json({success:!1,error:"Invalid query parameters",details:e.errors},{status:400});return n.NextResponse.json({success:!1,error:"Failed to retrieve render queue",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}let g=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/render/queue/route",pathname:"/api/render/queue",filename:"route",bundlePath:"app/api/render/queue/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\render\\queue\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:I,staticGenerationAsyncStorage:q,serverHooks:f}=g,x="/api/render/queue/route";function v(){return(0,o.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:q})}},13936:(e,t,r)=>{r.d(t,{e:()=>o,getSupabaseForRequest:()=>u,p:()=>n});var a=r(67721),s=r(61657),i=r(71615);let o=()=>{let e=(0,i.cookies)();return(0,a.createServerClient)("https://ofhzrdiadxigrvmrhaiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ",{cookies:{get:t=>e.get(t)?.value,set(t,r,a){try{e.set({name:t,value:r,...a})}catch(e){}},remove(t,r){try{e.set({name:t,value:"",...r})}catch(e){}}}})},n=(0,s.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}});function u(e){let t=e.headers.get("authorization")||e.headers.get("Authorization");return t?(0,s.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ",{global:{headers:{Authorization:t}},auth:{persistSession:!1,autoRefreshToken:!1}}):o()}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[8948,5972,1657,9702,1585],()=>r(14119));module.exports=a})();