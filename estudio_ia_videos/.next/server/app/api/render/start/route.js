(()=>{var e={};e.id=5577,e.ids=[5577,3936,4665],e.modules={4665:e=>{function t(e){return Promise.resolve().then(()=>{var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}t.keys=()=>[],t.resolve=t,t.id=4665,e.exports=t},53524:e=>{"use strict";e.exports=require("@prisma/client")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},61212:e=>{"use strict";e.exports=require("async_hooks")},78893:e=>{"use strict";e.exports=require("buffer")},61282:e=>{"use strict";e.exports=require("child_process")},84770:e=>{"use strict";e.exports=require("crypto")},27920:e=>{"use strict";e.exports=require("diagnostics_channel")},80665:e=>{"use strict";e.exports=require("dns")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},85807:e=>{"use strict";e.exports=require("module")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},96119:e=>{"use strict";e.exports=require("perf_hooks")},35816:e=>{"use strict";e.exports=require("process")},68621:e=>{"use strict";e.exports=require("punycode")},76162:e=>{"use strict";e.exports=require("stream")},74026:e=>{"use strict";e.exports=require("string_decoder")},82452:e=>{"use strict";e.exports=require("tls")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},6162:e=>{"use strict";e.exports=require("worker_threads")},71568:e=>{"use strict";e.exports=require("zlib")},17718:e=>{"use strict";e.exports=require("node:child_process")},65714:e=>{"use strict";e.exports=require("node:diagnostics_channel")},15673:e=>{"use strict";e.exports=require("node:events")},87561:e=>{"use strict";e.exports=require("node:fs")},88849:e=>{"use strict";e.exports=require("node:http")},22286:e=>{"use strict";e.exports=require("node:https")},85690:e=>{"use strict";e.exports=require("node:inspector")},82033:e=>{"use strict";e.exports=require("node:module")},87503:e=>{"use strict";e.exports=require("node:net")},70612:e=>{"use strict";e.exports=require("node:os")},49411:e=>{"use strict";e.exports=require("node:path")},51747:e=>{"use strict";e.exports=require("node:readline")},84492:e=>{"use strict";e.exports=require("node:stream")},31764:e=>{"use strict";e.exports=require("node:tls")},47261:e=>{"use strict";e.exports=require("node:util")},24086:e=>{"use strict";e.exports=require("node:worker_threads")},65628:e=>{"use strict";e.exports=require("node:zlib")},54484:(e,t,s)=>{"use strict";s.r(t),s.d(t,{originalPathname:()=>R,patchFetch:()=>D,requestAsyncStorage:()=>T,routeModule:()=>L,serverHooks:()=>q,staticGenerationAsyncStorage:()=>E});var i={};s.r(i),s.d(i,{GET:()=>A,POST:()=>F});var r=s(49303),o=s(88716),a=s(60670),n=s(87070),h=s(13936),l=s(315),d=s(74037),c=s(54211);let u="object"==typeof performance&&performance&&"function"==typeof performance.now?performance:Date,p=new Set,f="object"==typeof process&&process?process:{},g=(e,t,s,i)=>{"function"==typeof f.emitWarning?f.emitWarning(e,t,s,i):console.error(`[${s}] ${t}: ${e}`)},m=globalThis.AbortController,v=globalThis.AbortSignal;if(void 0===m){v=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(e,t){this._onabort.push(t)}},m=class{constructor(){t()}signal=new v;abort(e){if(!this.signal.aborted){for(let t of(this.signal.reason=e,this.signal.aborted=!0,this.signal._onabort))t(e);this.signal.onabort?.(e)}}};let e=f.env?.LRU_CACHE_IGNORE_AC_WARNING!=="1",t=()=>{e&&(e=!1,g("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",t))}}let _=e=>!p.has(e);Symbol("type");let b=e=>e&&e===Math.floor(e)&&e>0&&isFinite(e),x=e=>b(e)?e<=256?Uint8Array:e<=65536?Uint16Array:e<=4294967296?Uint32Array:e<=Number.MAX_SAFE_INTEGER?y:null:null;class y extends Array{constructor(e){super(e),this.fill(0)}}class S{heap;length;static #e=!1;static create(e){let t=x(e);if(!t)return[];S.#e=!0;let s=new S(e,t);return S.#e=!1,s}constructor(e,t){if(!S.#e)throw TypeError("instantiate Stack using Stack.create(n)");this.heap=new t(e),this.length=0}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}}class w{#t;#s;#i;#r;#o;#a;#n;#h;get perf(){return this.#h}ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#l;#d;#c;#u;#p;#f;#g;#m;#v;#_;#b;#x;#y;#S;#w;#k;#z;#I;static unsafeExposeInternals(e){return{starts:e.#y,ttls:e.#S,sizes:e.#x,keyMap:e.#c,keyList:e.#u,valList:e.#p,next:e.#f,prev:e.#g,get head(){return e.#m},get tail(){return e.#v},free:e.#_,isBackgroundFetch:t=>e.#j(t),backgroundFetch:(t,s,i,r)=>e.#A(t,s,i,r),moveToTail:t=>e.#F(t),indexes:t=>e.#L(t),rindexes:t=>e.#T(t),isStale:t=>e.#E(t)}}get max(){return this.#t}get maxSize(){return this.#s}get calculatedSize(){return this.#d}get size(){return this.#l}get fetchMethod(){return this.#a}get memoMethod(){return this.#n}get dispose(){return this.#i}get onInsert(){return this.#r}get disposeAfter(){return this.#o}constructor(e){let{max:t=0,ttl:s,ttlResolution:i=1,ttlAutopurge:r,updateAgeOnGet:o,updateAgeOnHas:a,allowStale:n,dispose:h,onInsert:l,disposeAfter:d,noDisposeOnSet:c,noUpdateTTL:f,maxSize:m=0,maxEntrySize:v=0,sizeCalculation:y,fetchMethod:k,memoMethod:z,noDeleteOnFetchRejection:I,noDeleteOnStaleGet:j,allowStaleOnFetchRejection:A,allowStaleOnFetchAbort:F,ignoreFetchAbort:L,perf:T}=e;if(void 0!==T&&"function"!=typeof T?.now)throw TypeError("perf option must have a now() method if specified");if(this.#h=T??u,0!==t&&!b(t))throw TypeError("max option must be a nonnegative integer");let E=t?x(t):Array;if(!E)throw Error("invalid max value: "+t);if(this.#t=t,this.#s=m,this.maxEntrySize=v||this.#s,this.sizeCalculation=y,this.sizeCalculation){if(!this.#s&&!this.maxEntrySize)throw TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if("function"!=typeof this.sizeCalculation)throw TypeError("sizeCalculation set to non-function")}if(void 0!==z&&"function"!=typeof z)throw TypeError("memoMethod must be a function if defined");if(this.#n=z,void 0!==k&&"function"!=typeof k)throw TypeError("fetchMethod must be a function if specified");if(this.#a=k,this.#k=!!k,this.#c=new Map,this.#u=Array(t).fill(void 0),this.#p=Array(t).fill(void 0),this.#f=new E(t),this.#g=new E(t),this.#m=0,this.#v=0,this.#_=S.create(t),this.#l=0,this.#d=0,"function"==typeof h&&(this.#i=h),"function"==typeof l&&(this.#r=l),"function"==typeof d?(this.#o=d,this.#b=[]):(this.#o=void 0,this.#b=void 0),this.#w=!!this.#i,this.#I=!!this.#r,this.#z=!!this.#o,this.noDisposeOnSet=!!c,this.noUpdateTTL=!!f,this.noDeleteOnFetchRejection=!!I,this.allowStaleOnFetchRejection=!!A,this.allowStaleOnFetchAbort=!!F,this.ignoreFetchAbort=!!L,0!==this.maxEntrySize){if(0!==this.#s&&!b(this.#s))throw TypeError("maxSize must be a positive integer if specified");if(!b(this.maxEntrySize))throw TypeError("maxEntrySize must be a positive integer if specified");this.#q()}if(this.allowStale=!!n,this.noDeleteOnStaleGet=!!j,this.updateAgeOnGet=!!o,this.updateAgeOnHas=!!a,this.ttlResolution=b(i)||0===i?i:1,this.ttlAutopurge=!!r,this.ttl=s||0,this.ttl){if(!b(this.ttl))throw TypeError("ttl must be a positive integer if specified");this.#R()}if(0===this.#t&&0===this.ttl&&0===this.#s)throw TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#t&&!this.#s){let e="LRU_CACHE_UNBOUNDED";_(e)&&(p.add(e),g("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",e,w))}}getRemainingTTL(e){return this.#c.has(e)?1/0:0}#R(){let e=new y(this.#t),t=new y(this.#t);this.#S=e,this.#y=t,this.#D=(s,i,r=this.#h.now())=>{if(t[s]=0!==i?r:0,e[s]=i,0!==i&&this.ttlAutopurge){let e=setTimeout(()=>{this.#E(s)&&this.#O(this.#u[s],"expire")},i+1);e.unref&&e.unref()}},this.#C=s=>{t[s]=0!==e[s]?this.#h.now():0},this.#M=(r,o)=>{if(e[o]){let a=e[o],n=t[o];if(!a||!n)return;r.ttl=a,r.start=n,r.now=s||i();let h=r.now-n;r.remainingTTL=a-h}};let s=0,i=()=>{let e=this.#h.now();if(this.ttlResolution>0){s=e;let t=setTimeout(()=>s=0,this.ttlResolution);t.unref&&t.unref()}return e};this.getRemainingTTL=r=>{let o=this.#c.get(r);if(void 0===o)return 0;let a=e[o],n=t[o];return a&&n?a-((s||i())-n):1/0},this.#E=r=>{let o=t[r],a=e[r];return!!a&&!!o&&(s||i())-o>a}}#C=()=>{};#M=()=>{};#D=()=>{};#E=()=>!1;#q(){let e=new y(this.#t);this.#d=0,this.#x=e,this.#N=t=>{this.#d-=e[t],e[t]=0},this.#U=(e,t,s,i)=>{if(this.#j(t))return 0;if(!b(s)){if(i){if("function"!=typeof i)throw TypeError("sizeCalculation must be a function");if(!b(s=i(t,e)))throw TypeError("sizeCalculation return invalid (expect positive integer)")}else throw TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.")}return s},this.#J=(t,s,i)=>{if(e[t]=s,this.#s){let s=this.#s-e[t];for(;this.#d>s;)this.#W(!0)}this.#d+=e[t],i&&(i.entrySize=s,i.totalCalculatedSize=this.#d)}}#N=e=>{};#J=(e,t,s)=>{};#U=(e,t,s,i)=>{if(s||i)throw TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#L({allowStale:e=this.allowStale}={}){if(this.#l)for(let t=this.#v;this.#B(t)&&((e||!this.#E(t))&&(yield t),t!==this.#m);)t=this.#g[t]}*#T({allowStale:e=this.allowStale}={}){if(this.#l)for(let t=this.#m;this.#B(t)&&((e||!this.#E(t))&&(yield t),t!==this.#v);)t=this.#f[t]}#B(e){return void 0!==e&&this.#c.get(this.#u[e])===e}*entries(){for(let e of this.#L())void 0===this.#p[e]||void 0===this.#u[e]||this.#j(this.#p[e])||(yield[this.#u[e],this.#p[e]])}*rentries(){for(let e of this.#T())void 0===this.#p[e]||void 0===this.#u[e]||this.#j(this.#p[e])||(yield[this.#u[e],this.#p[e]])}*keys(){for(let e of this.#L()){let t=this.#u[e];void 0===t||this.#j(this.#p[e])||(yield t)}}*rkeys(){for(let e of this.#T()){let t=this.#u[e];void 0===t||this.#j(this.#p[e])||(yield t)}}*values(){for(let e of this.#L())void 0===this.#p[e]||this.#j(this.#p[e])||(yield this.#p[e])}*rvalues(){for(let e of this.#T())void 0===this.#p[e]||this.#j(this.#p[e])||(yield this.#p[e])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(e,t={}){for(let s of this.#L()){let i=this.#p[s],r=this.#j(i)?i.__staleWhileFetching:i;if(void 0!==r&&e(r,this.#u[s],this))return this.get(this.#u[s],t)}}forEach(e,t=this){for(let s of this.#L()){let i=this.#p[s],r=this.#j(i)?i.__staleWhileFetching:i;void 0!==r&&e.call(t,r,this.#u[s],this)}}rforEach(e,t=this){for(let s of this.#T()){let i=this.#p[s],r=this.#j(i)?i.__staleWhileFetching:i;void 0!==r&&e.call(t,r,this.#u[s],this)}}purgeStale(){let e=!1;for(let t of this.#T({allowStale:!0}))this.#E(t)&&(this.#O(this.#u[t],"expire"),e=!0);return e}info(e){let t=this.#c.get(e);if(void 0===t)return;let s=this.#p[t],i=this.#j(s)?s.__staleWhileFetching:s;if(void 0===i)return;let r={value:i};if(this.#S&&this.#y){let e=this.#S[t],s=this.#y[t];if(e&&s){let t=e-(this.#h.now()-s);r.ttl=t,r.start=Date.now()}}return this.#x&&(r.size=this.#x[t]),r}dump(){let e=[];for(let t of this.#L({allowStale:!0})){let s=this.#u[t],i=this.#p[t],r=this.#j(i)?i.__staleWhileFetching:i;if(void 0===r||void 0===s)continue;let o={value:r};if(this.#S&&this.#y){o.ttl=this.#S[t];let e=this.#h.now()-this.#y[t];o.start=Math.floor(Date.now()-e)}this.#x&&(o.size=this.#x[t]),e.unshift([s,o])}return e}load(e){for(let[t,s]of(this.clear(),e)){if(s.start){let e=Date.now()-s.start;s.start=this.#h.now()-e}this.set(t,s.value,s)}}set(e,t,s={}){if(void 0===t)return this.delete(e),this;let{ttl:i=this.ttl,start:r,noDisposeOnSet:o=this.noDisposeOnSet,sizeCalculation:a=this.sizeCalculation,status:n}=s,{noUpdateTTL:h=this.noUpdateTTL}=s,l=this.#U(e,t,s.size||0,a);if(this.maxEntrySize&&l>this.maxEntrySize)return n&&(n.set="miss",n.maxEntrySizeExceeded=!0),this.#O(e,"set"),this;let d=0===this.#l?void 0:this.#c.get(e);if(void 0===d)d=0===this.#l?this.#v:0!==this.#_.length?this.#_.pop():this.#l===this.#t?this.#W(!1):this.#l,this.#u[d]=e,this.#p[d]=t,this.#c.set(e,d),this.#f[this.#v]=d,this.#g[d]=this.#v,this.#v=d,this.#l++,this.#J(d,l,n),n&&(n.set="add"),h=!1,this.#I&&this.#r?.(t,e,"add");else{this.#F(d);let s=this.#p[d];if(t!==s){if(this.#k&&this.#j(s)){s.__abortController.abort(Error("replaced"));let{__staleWhileFetching:t}=s;void 0!==t&&!o&&(this.#w&&this.#i?.(t,e,"set"),this.#z&&this.#b?.push([t,e,"set"]))}else!o&&(this.#w&&this.#i?.(s,e,"set"),this.#z&&this.#b?.push([s,e,"set"]));if(this.#N(d),this.#J(d,l,n),this.#p[d]=t,n){n.set="replace";let e=s&&this.#j(s)?s.__staleWhileFetching:s;void 0!==e&&(n.oldValue=e)}}else n&&(n.set="update");this.#I&&this.onInsert?.(t,e,t===s?"update":"replace")}if(0===i||this.#S||this.#R(),this.#S&&(h||this.#D(d,i,r),n&&this.#M(n,d)),!o&&this.#z&&this.#b){let e;let t=this.#b;for(;e=t?.shift();)this.#o?.(...e)}return this}pop(){try{for(;this.#l;){let e=this.#p[this.#m];if(this.#W(!0),this.#j(e)){if(e.__staleWhileFetching)return e.__staleWhileFetching}else if(void 0!==e)return e}}finally{if(this.#z&&this.#b){let e;let t=this.#b;for(;e=t?.shift();)this.#o?.(...e)}}}#W(e){let t=this.#m,s=this.#u[t],i=this.#p[t];return this.#k&&this.#j(i)?i.__abortController.abort(Error("evicted")):(this.#w||this.#z)&&(this.#w&&this.#i?.(i,s,"evict"),this.#z&&this.#b?.push([i,s,"evict"])),this.#N(t),e&&(this.#u[t]=void 0,this.#p[t]=void 0,this.#_.push(t)),1===this.#l?(this.#m=this.#v=0,this.#_.length=0):this.#m=this.#f[t],this.#c.delete(s),this.#l--,t}has(e,t={}){let{updateAgeOnHas:s=this.updateAgeOnHas,status:i}=t,r=this.#c.get(e);if(void 0!==r){let e=this.#p[r];if(this.#j(e)&&void 0===e.__staleWhileFetching)return!1;if(!this.#E(r))return s&&this.#C(r),i&&(i.has="hit",this.#M(i,r)),!0;i&&(i.has="stale",this.#M(i,r))}else i&&(i.has="miss");return!1}peek(e,t={}){let{allowStale:s=this.allowStale}=t,i=this.#c.get(e);if(void 0===i||!s&&this.#E(i))return;let r=this.#p[i];return this.#j(r)?r.__staleWhileFetching:r}#A(e,t,s,i){let r=void 0===t?void 0:this.#p[t];if(this.#j(r))return r;let o=new m,{signal:a}=s;a?.addEventListener("abort",()=>o.abort(a.reason),{signal:o.signal});let n={signal:o.signal,options:s,context:i},h=(i,r=!1)=>{let{aborted:a}=o.signal,h=s.ignoreFetchAbort&&void 0!==i;if(s.status&&(a&&!r?(s.status.fetchAborted=!0,s.status.fetchError=o.signal.reason,h&&(s.status.fetchAbortIgnored=!0)):s.status.fetchResolved=!0),a&&!h&&!r)return l(o.signal.reason);let c=this.#p[t];return(c===d||h&&r&&void 0===c)&&(void 0===i?void 0!==d.__staleWhileFetching?this.#p[t]=d.__staleWhileFetching:this.#O(e,"fetch"):(s.status&&(s.status.fetchUpdated=!0),this.set(e,i,n.options))),i},l=i=>{let{aborted:r}=o.signal,a=r&&s.allowStaleOnFetchAbort,n=a||s.allowStaleOnFetchRejection,h=n||s.noDeleteOnFetchRejection;if(this.#p[t]!==d||(h&&void 0!==d.__staleWhileFetching?a||(this.#p[t]=d.__staleWhileFetching):this.#O(e,"fetch")),n)return s.status&&void 0!==d.__staleWhileFetching&&(s.status.returnedStale=!0),d.__staleWhileFetching;if(d.__returned===d)throw i};s.status&&(s.status.fetchDispatched=!0);let d=new Promise((t,i)=>{let a=this.#a?.(e,r,n);a&&a instanceof Promise&&a.then(e=>t(void 0===e?void 0:e),i),o.signal.addEventListener("abort",()=>{(!s.ignoreFetchAbort||s.allowStaleOnFetchAbort)&&(t(void 0),s.allowStaleOnFetchAbort&&(t=e=>h(e,!0)))})}).then(h,e=>(s.status&&(s.status.fetchRejected=!0,s.status.fetchError=e),l(e))),c=Object.assign(d,{__abortController:o,__staleWhileFetching:r,__returned:void 0});return void 0===t?(this.set(e,c,{...n.options,status:void 0}),t=this.#c.get(e)):this.#p[t]=c,c}#j(e){return!!this.#k&&!!e&&e instanceof Promise&&e.hasOwnProperty("__staleWhileFetching")&&e.__abortController instanceof m}async fetch(e,t={}){let{allowStale:s=this.allowStale,updateAgeOnGet:i=this.updateAgeOnGet,noDeleteOnStaleGet:r=this.noDeleteOnStaleGet,ttl:o=this.ttl,noDisposeOnSet:a=this.noDisposeOnSet,size:n=0,sizeCalculation:h=this.sizeCalculation,noUpdateTTL:l=this.noUpdateTTL,noDeleteOnFetchRejection:d=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:c=this.allowStaleOnFetchRejection,ignoreFetchAbort:u=this.ignoreFetchAbort,allowStaleOnFetchAbort:p=this.allowStaleOnFetchAbort,context:f,forceRefresh:g=!1,status:m,signal:v}=t;if(!this.#k)return m&&(m.fetch="get"),this.get(e,{allowStale:s,updateAgeOnGet:i,noDeleteOnStaleGet:r,status:m});let _={allowStale:s,updateAgeOnGet:i,noDeleteOnStaleGet:r,ttl:o,noDisposeOnSet:a,size:n,sizeCalculation:h,noUpdateTTL:l,noDeleteOnFetchRejection:d,allowStaleOnFetchRejection:c,allowStaleOnFetchAbort:p,ignoreFetchAbort:u,status:m,signal:v},b=this.#c.get(e);if(void 0===b){m&&(m.fetch="miss");let t=this.#A(e,b,_,f);return t.__returned=t}{let t=this.#p[b];if(this.#j(t)){let e=s&&void 0!==t.__staleWhileFetching;return m&&(m.fetch="inflight",e&&(m.returnedStale=!0)),e?t.__staleWhileFetching:t.__returned=t}let r=this.#E(b);if(!g&&!r)return m&&(m.fetch="hit"),this.#F(b),i&&this.#C(b),m&&this.#M(m,b),t;let o=this.#A(e,b,_,f),a=void 0!==o.__staleWhileFetching&&s;return m&&(m.fetch=r?"stale":"refresh",a&&r&&(m.returnedStale=!0)),a?o.__staleWhileFetching:o.__returned=o}}async forceFetch(e,t={}){let s=await this.fetch(e,t);if(void 0===s)throw Error("fetch() returned undefined");return s}memo(e,t={}){let s=this.#n;if(!s)throw Error("no memoMethod provided to constructor");let{context:i,forceRefresh:r,...o}=t,a=this.get(e,o);if(!r&&void 0!==a)return a;let n=s(e,a,{options:o,context:i});return this.set(e,n,o),n}get(e,t={}){let{allowStale:s=this.allowStale,updateAgeOnGet:i=this.updateAgeOnGet,noDeleteOnStaleGet:r=this.noDeleteOnStaleGet,status:o}=t,a=this.#c.get(e);if(void 0!==a){let t=this.#p[a],n=this.#j(t);return(o&&this.#M(o,a),this.#E(a))?(o&&(o.get="stale"),n)?(o&&s&&void 0!==t.__staleWhileFetching&&(o.returnedStale=!0),s?t.__staleWhileFetching:void 0):(r||this.#O(e,"expire"),o&&s&&(o.returnedStale=!0),s?t:void 0):(o&&(o.get="hit"),n)?t.__staleWhileFetching:(this.#F(a),i&&this.#C(a),t)}o&&(o.get="miss")}#P(e,t){this.#g[t]=e,this.#f[e]=t}#F(e){e!==this.#v&&(e===this.#m?this.#m=this.#f[e]:this.#P(this.#g[e],this.#f[e]),this.#P(this.#v,e),this.#v=e)}delete(e){return this.#O(e,"delete")}#O(e,t){let s=!1;if(0!==this.#l){let i=this.#c.get(e);if(void 0!==i){if(s=!0,1===this.#l)this.#G(t);else{this.#N(i);let s=this.#p[i];if(this.#j(s)?s.__abortController.abort(Error("deleted")):(this.#w||this.#z)&&(this.#w&&this.#i?.(s,e,t),this.#z&&this.#b?.push([s,e,t])),this.#c.delete(e),this.#u[i]=void 0,this.#p[i]=void 0,i===this.#v)this.#v=this.#g[i];else if(i===this.#m)this.#m=this.#f[i];else{let e=this.#g[i];this.#f[e]=this.#f[i];let t=this.#f[i];this.#g[t]=this.#g[i]}this.#l--,this.#_.push(i)}}}if(this.#z&&this.#b?.length){let e;let t=this.#b;for(;e=t?.shift();)this.#o?.(...e)}return s}clear(){return this.#G("delete")}#G(e){for(let t of this.#T({allowStale:!0})){let s=this.#p[t];if(this.#j(s))s.__abortController.abort(Error("deleted"));else{let i=this.#u[t];this.#w&&this.#i?.(s,i,e),this.#z&&this.#b?.push([s,i,e])}}if(this.#c.clear(),this.#p.fill(void 0),this.#u.fill(void 0),this.#S&&this.#y&&(this.#S.fill(0),this.#y.fill(0)),this.#x&&this.#x.fill(0),this.#m=0,this.#v=0,this.#_.length=0,this.#d=0,this.#l=0,this.#z&&this.#b){let e;let t=this.#b;for(;e=t?.shift();)this.#o?.(...e)}}}class k{constructor(e){this.interval=e?.interval||6e4,this.tokenCache=new w({max:e?.uniqueTokenPerInterval||500,ttl:this.interval})}check(e,t){return new Promise(s=>{let i=Date.now(),r=(this.tokenCache.get(t)||[0]).filter(e=>i-e<this.interval),o=r.length>=e;o||(r.push(i),this.tokenCache.set(t,r)),s(o)})}}let z=new k({interval:6e4,uniqueTokenPerInterval:1e3});var I=s(84770),j=s.n(I);async function A(e){try{let{searchParams:t}=new URL(e.url),s=t.get("action");if("video-pipeline"===s)return n.NextResponse.json({success:!0,message:"Video pipeline endpoint working!",endpoint:"/api/render/start?action=video-pipeline",methods:["GET","POST"],timestamp:new Date().toISOString()});if("video-test"===s)return n.NextResponse.json({success:!0,message:"Video Test API is working!",endpoint:"/api/render/start?action=video-test",timestamp:new Date().toISOString(),status:"operational",pipeline_status:"ready",ffmpeg_available:!0,render_queue_status:"operational"});if("create-video-job"===s){let e=t.get("project_id"),s=t.get("preset_id");if(!e||!s)return n.NextResponse.json({error:"project_id and preset_id are required",usage:"/api/render/start?action=create-video-job&project_id=PROJECT_ID&preset_id=PRESET_ID"},{status:400});{let t=`job_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;return n.NextResponse.json({success:!0,job_id:t,status:"queued",project_id:e,preset_id:s,message:"Video render job created successfully",endpoint:"/api/render/start?action=create-video-job",created_at:new Date().toISOString(),estimated_completion:new Date(Date.now()+6e4).toISOString()})}}return n.NextResponse.json({success:!0,message:"Render start endpoint",available_actions:["video-pipeline","video-test","create-video-job"],usage:{video_pipeline:"/api/render/start?action=video-pipeline",video_test:"/api/render/start?action=video-test",create_video_job:"/api/render/start?action=create-video-job&project_id=PROJECT_ID&preset_id=PRESET_ID"}})}catch(e){return n.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function F(e){try{let t=(0,h.getSupabaseForRequest)(e),{data:{user:s},error:i}=await t.auth.getUser();if(i||!s)return n.NextResponse.json({error:"N\xe3o autenticado"},{status:401});if(await z.check(5,s.id))return c.kg.warn("Rate limit exceeded",{userId:s.id,endpoint:"/api/render/start"}),n.NextResponse.json({error:"Muitas requisi\xe7\xf5es. Tente novamente em 1 minuto."},{status:429});let{projectId:r,slides:o,config:a}=await e.json();if(!r)return n.NextResponse.json({error:"projectId obrigat\xf3rio"},{status:400});if(!o||!Array.isArray(o)||0===o.length)return n.NextResponse.json({error:"slides obrigat\xf3rios (array n\xe3o vazio)"},{status:400});let{data:u,error:p}=await t.from("projects").select("user_id").eq("id",r).single();if(p||!u)return n.NextResponse.json({error:"Projeto n\xe3o encontrado"},{status:404});let f=u.user_id===s.id;if(!f){let{data:e}=await t.from("project_collaborators").select("user_id").eq("project_id",r).eq("user_id",s.id).single();e&&(f=!0)}if(!f)return n.NextResponse.json({error:"Sem permiss\xe3o para renderizar este projeto"},{status:403});let g={width:a?.width||1920,height:a?.height||1080,fps:a?.fps||30,quality:a?.quality||"high",format:a?.format||"mp4",codec:a?.codec||"h264",bitrate:a?.bitrate||"5000k",audioCodec:a?.audioCodec||"aac",audioBitrate:a?.audioBitrate||"128k",test:a?.test},m=o.map((e,t)=>({id:e.id||`slide_${t}`,imageUrl:e.imageUrl||"",audioUrl:e.audioUrl,duration:e.duration||5,transition:e.transition||"fade",transitionDuration:e.transitionDuration||.5,title:e.title,content:e.content,avatar_config:e.avatar_config})),v=j().randomUUID(),_={traceId:v,projectId:r,userId:s.id,slideCount:m.length,config:g};c.kg.info("Iniciando renderiza\xe7\xe3o real",_);let b=await d.N.createJob(s.id,r);return c.kg.info("Job criado no Supabase",{..._,jobId:b}),await (0,l.fn)({jobId:b,projectId:r,slides:m,config:g,userId:s.id}),n.NextResponse.json({success:!0,jobId:b,traceId:v,projectId:r,slidesCount:m.length,config:g,message:"Renderiza\xe7\xe3o real iniciada com sucesso",statusUrl:`/api/render/status?jobId=${b}`})}catch(t){return c.kg.error("Erro ao iniciar render",t,{projectId:e.body?.projectId}),n.NextResponse.json({error:"Erro ao iniciar render",details:t instanceof Error?t.message:"Erro desconhecido"},{status:500})}}let L=new r.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/render/start/route",pathname:"/api/render/start",filename:"route",bundlePath:"app/api/render/start/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\render\\start\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:T,staticGenerationAsyncStorage:E,serverHooks:q}=L,R="/api/render/start/route";function D(){return(0,a.patchFetch)({serverHooks:q,staticGenerationAsyncStorage:E})}},315:(e,t,s)=>{"use strict";s.d(t,{fn:()=>c,S9:()=>d,GQ:()=>u});var i=s(26608);let r=null;function o(){if(r)return r;let e=process.env.REDIS_URL,t=process.env.RENDER_QUEUE_NAME??"render-jobs";return e?r={redisUrl:e,queueName:t}:(console.warn("⚠️ REDIS_URL not found. Queue will operate in mock/fallback mode."),r={redisUrl:"redis://mock:6379",queueName:t})}let a={attempts:3,backoff:{type:"exponential",delay:5e3},removeOnComplete:100,removeOnFail:200},n=null;function h(){let{redisUrl:e}=o();if("redis://mock:6379"===e)return{host:"mock",port:6379};let t=new URL(e),s={host:t.hostname,port:Number(t.port||6379),password:t.password||void 0,username:t.username||void 0,db:t.pathname?Number(t.pathname.replace("/","")||"0"):void 0};return"rediss:"===t.protocol&&(s.tls={rejectUnauthorized:!1}),s}function l(e){if(n)return n;let{queueName:t,redisUrl:s}=o();return"redis://mock:6379"===s?(console.warn("⚠️ Using MOCK RenderQueue (No Redis configured)"),n={add:async(e,t)=>{let s=t.jobId||`mock-job-${Date.now()}`;return console.log("MOCK Queue: Adding job",e,s),console.log("MOCK Queue: Job added. Waiting for Postgres Worker to pick it up from DB."),{id:s,name:e,data:{...t,jobId:s},getState:async()=>"active",remove:async()=>{}}},getJob:async e=>null,close:async()=>{}}):n=new i.Queue(t,function(e){let t=h(),s={connection:t,defaultJobOptions:a,...e};return s.connection=s.connection??t,s.defaultJobOptions=s.defaultJobOptions??a,s}(e))}function d(e){let{queueName:t,redisUrl:s}=o();if("redis://mock:6379"===s)return{on:()=>{},close:async()=>{}};let r=h();return new i.Ji(t,{...e,connection:e?.connection??r})}async function c(e){return l().add("render-video",e)}async function u(e){let t=l(),s=await t.getJob(e);return s?await s.getState():null}},74037:(e,t,s)=>{"use strict";s.d(t,{N:()=>a});var i=s(61657),r=s(80338);class o{constructor(){let e="https://ofhzrdiadxigrvmrhaiz.supabase.co",t=process.env.SUPABASE_SERVICE_ROLE_KEY;e&&t||console.warn("⚠️ Supabase credentials not found in JobManager"),this.supabase=(0,i.eI)(e,t,{auth:{autoRefreshToken:!1,persistSession:!1}})}async getJobContext(e){try{let{data:t,error:s}=await this.supabase.from("render_jobs").select("project_id").eq("id",e).single();if(s||!t)return null;let{data:i,error:r}=await this.supabase.from("projects").select("user_id").eq("id",t.project_id).single();if(r||!i)return null;return{projectId:t.project_id,userId:i.user_id}}catch(e){return console.error("Error fetching job context:",e),null}}async createJob(e,t){let s=new Date(Date.now()-6e4).toISOString(),{data:i}=await this.supabase.from("render_jobs").select("id").eq("project_id",t).eq("status","queued").gt("created_at",s).maybeSingle();if(i)return console.log(`[JobManager] Idempotency: Returning existing queued job ${i.id} for project ${t}`),i.id;let{data:r,error:o}=await this.supabase.from("render_jobs").insert({project_id:t,user_id:e,status:"queued",progress:0,render_settings:{},attempts:0}).select("id").single();if(o)throw Error(`Failed to create job: ${o.message}`);return r.id}async getJob(e){let{data:t,error:s}=await this.supabase.from("render_jobs").select("*").eq("id",e).single();return s||!t?null:{id:t.id,userId:t.user_id,projectId:t.project_id,status:t.status,progress:t.progress,createdAt:new Date(t.created_at),startedAt:t.started_at?new Date(t.started_at):void 0,completedAt:t.completed_at?new Date(t.completed_at):void 0,outputUrl:t.output_url,error:t.error_message}}async updateProgress(e,t){let s={progress:Math.min(100,Math.max(0,t)),updated_at:new Date().toISOString()},{error:i}=await this.supabase.from("render_jobs").update(s).eq("id",e);i&&console.error(`Failed to update progress for job ${e}:`,i)}async startJob(e){let{error:t}=await this.supabase.from("render_jobs").update({status:"processing",started_at:new Date().toISOString(),progress:0}).eq("id",e);if(t)console.error(`Failed to start job ${e}:`,t);else{let t=await this.getJobContext(e);t&&r.DR.renderStarted({jobId:e,projectId:t.projectId,userId:t.userId}).catch(e=>console.error("Webhook trigger failed:",e))}}async completeJob(e,t){let{error:s}=await this.supabase.from("render_jobs").update({status:"completed",progress:100,completed_at:new Date().toISOString(),output_url:t}).eq("id",e);if(s)console.error(`Failed to complete job ${e}:`,s);else{let s=await this.getJobContext(e);s&&r.DR.renderCompleted({jobId:e,projectId:s.projectId,videoUrl:t,duration:0}).catch(e=>console.error("Webhook trigger failed:",e))}}async failJob(e,t){let{error:s}=await this.supabase.from("render_jobs").update({status:"failed",completed_at:new Date().toISOString(),error_message:t}).eq("id",e);if(s)console.error(`Failed to fail job ${e}:`,s);else{let s=await this.getJobContext(e);s&&r.DR.renderFailed({jobId:e,projectId:s.projectId,error:t}).catch(e=>console.error("Webhook trigger failed:",e))}}async listJobs(e,t=100){let s=this.supabase.from("render_jobs").select("*");e&&(s=s.eq("project_id",e));let{data:i,error:r}=await s.order("created_at",{ascending:!1}).limit(t);return r?(console.error("Failed to list jobs:",r),[]):i.map(e=>({id:e.id,userId:e.user_id,projectId:e.project_id,status:e.status,progress:e.progress,createdAt:new Date(e.created_at),startedAt:e.started_at?new Date(e.started_at):void 0,completedAt:e.completed_at?new Date(e.completed_at):void 0,outputUrl:e.output_url,error:e.error_message}))}async removeJob(e){let{error:t}=await this.supabase.from("render_jobs").delete().eq("id",e);t&&console.error(`Failed to remove job ${e}:`,t)}}let a=new o},13936:(e,t,s)=>{"use strict";s.d(t,{e:()=>a,getSupabaseForRequest:()=>h,p:()=>n});var i=s(67721),r=s(61657),o=s(71615);let a=()=>{let e=(0,o.cookies)();return(0,i.createServerClient)("https://ofhzrdiadxigrvmrhaiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ",{cookies:{get:t=>e.get(t)?.value,set(t,s,i){try{e.set({name:t,value:s,...i})}catch(e){}},remove(t,s){try{e.set({name:t,value:"",...s})}catch(e){}}}})},n=(0,r.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}});function h(e){let t=e.headers.get("authorization")||e.headers.get("Authorization");return t?(0,r.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ",{global:{headers:{Authorization:t}},auth:{persistSession:!1,autoRefreshToken:!1}}):a()}}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),i=t.X(0,[8948,5972,1657,9702,9092,7686,6608,616],()=>s(54484));module.exports=i})();