(()=>{var e={};e.id=5577,e.ids=[5577,3474],e.modules={404665:e=>{function t(e){return Promise.resolve().then(()=>{var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}t.keys=()=>[],t.resolve=t,t.id=404665,e.exports=t},453524:e=>{"use strict";e.exports=require("@prisma/client")},220399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},430517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},627790:e=>{"use strict";e.exports=require("assert")},978893:e=>{"use strict";e.exports=require("buffer")},761282:e=>{"use strict";e.exports=require("child_process")},84770:e=>{"use strict";e.exports=require("crypto")},780665:e=>{"use strict";e.exports=require("dns")},17702:e=>{"use strict";e.exports=require("events")},592048:e=>{"use strict";e.exports=require("fs")},885807:e=>{"use strict";e.exports=require("module")},698216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},555315:e=>{"use strict";e.exports=require("path")},276162:e=>{"use strict";e.exports=require("stream")},474026:e=>{"use strict";e.exports=require("string_decoder")},682452:e=>{"use strict";e.exports=require("tls")},774175:e=>{"use strict";e.exports=require("tty")},917360:e=>{"use strict";e.exports=require("url")},521764:e=>{"use strict";e.exports=require("util")},806162:e=>{"use strict";e.exports=require("worker_threads")},612300:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>f,requestAsyncStorage:()=>m,routeModule:()=>l,serverHooks:()=>x,staticGenerationAsyncStorage:()=>v});var s={};r.r(s),r.d(s,{GET:()=>p,POST:()=>c});var i=r(349303),o=r(88716),n=r(60670),a=r(387070),u=r(600315),d=r(303474);async function p(e){try{let{searchParams:t}=new URL(e.url),r=t.get("action");if("video-pipeline"===r)return a.NextResponse.json({success:!0,message:"Video pipeline endpoint working!",endpoint:"/api/render/start?action=video-pipeline",methods:["GET","POST"],timestamp:new Date().toISOString()});if("video-test"===r)return a.NextResponse.json({success:!0,message:"Video Test API is working!",endpoint:"/api/render/start?action=video-test",timestamp:new Date().toISOString(),status:"operational",pipeline_status:"ready",ffmpeg_available:!0,render_queue_status:"operational"});if("create-video-job"===r){let e=t.get("project_id"),r=t.get("preset_id");if(!e||!r)return a.NextResponse.json({error:"project_id and preset_id are required",usage:"/api/render/start?action=create-video-job&project_id=PROJECT_ID&preset_id=PRESET_ID"},{status:400});{let t=`job_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;return a.NextResponse.json({success:!0,job_id:t,status:"queued",project_id:e,preset_id:r,message:"Video render job created successfully",endpoint:"/api/render/start?action=create-video-job",created_at:new Date().toISOString(),estimated_completion:new Date(Date.now()+6e4).toISOString()})}}return a.NextResponse.json({success:!0,message:"Render start endpoint",available_actions:["video-pipeline","video-test","create-video-job"],usage:{video_pipeline:"/api/render/start?action=video-pipeline",video_test:"/api/render/start?action=video-test",create_video_job:"/api/render/start?action=create-video-job&project_id=PROJECT_ID&preset_id=PRESET_ID"}})}catch(e){return a.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function c(e){try{let{projectId:t,slides:r,config:s}=await e.json();if(!t)return a.NextResponse.json({error:"projectId obrigat\xf3rio"},{status:400});if(!r||!Array.isArray(r)||0===r.length)return a.NextResponse.json({error:"slides obrigat\xf3rios (array n\xe3o vazio)"},{status:400});if(!await d.prisma.project.findUnique({where:{id:t,userId:session.user.id}}))return a.NextResponse.json({error:"Projeto n\xe3o encontrado"},{status:404});let i={width:s?.width||1920,height:s?.height||1080,fps:s?.fps||30,quality:s?.quality||"high",format:s?.format||"mp4",codec:s?.codec||"h264",bitrate:s?.bitrate||"5000k",audioCodec:s?.audioCodec||"aac",audioBitrate:s?.audioBitrate||"128k"},o=r.map((e,t)=>({id:e.id||`slide_${t}`,imageUrl:e.imageUrl||"",audioUrl:e.audioUrl,duration:e.duration||5,transition:e.transition||"fade",transitionDuration:e.transitionDuration||.5,title:e.title,content:e.content}));console.log(`ðŸš€ [API] Iniciando renderiza\xe7\xe3o real - Projeto: ${t}, Slides: ${o.length}`);let n=await (0,u.addVideoJob)({projectId:t,slides:o,config:i,userId:session.user.id});return a.NextResponse.json({success:!0,jobId:n,projectId:t,slidesCount:o.length,config:i,message:"Renderiza\xe7\xe3o real iniciada com sucesso",statusUrl:`/api/render/status?jobId=${n}`})}catch(e){return console.error("[API] Erro ao iniciar render:",e),a.NextResponse.json({error:"Erro ao iniciar render",details:e instanceof Error?e.message:"Erro desconhecido"},{status:500})}}let l=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/render/start/route",pathname:"/api/render/start",filename:"route",bundlePath:"app/api/render/start/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\render\\start\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:v,serverHooks:x}=l,g="/api/render/start/route";function f(){return(0,n.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:v})}},303474:(e,t,r)=>{"use strict";r.d(t,{prisma:()=>i});var s=r(453524);let i=global.prisma||new s.PrismaClient({log:["query"]})},600315:(e,t,r)=>{"use strict";r.d(t,{hw:()=>u});var s=r(826608);let i=null;function o(){if(i)return i;let e=process.env.REDIS_URL,t=process.env.RENDER_QUEUE_NAME??"render-jobs";if(!e)throw Error("Missing REDIS_URL environment variable for render queue");return i={redisUrl:e,queueName:t}}let n={attempts:3,backoff:{type:"exponential",delay:5e3},removeOnComplete:100,removeOnFail:200},a=null;function u(e){if(a)return a;let{queueName:t}=o();return a=new s.ci(t,function(e){let t=function(){let{redisUrl:e}=o(),t=new URL(e),r={host:t.hostname,port:Number(t.port||6379),password:t.password||void 0,username:t.username||void 0,db:t.pathname?Number(t.pathname.replace("/","")||"0"):void 0};return"rediss:"===t.protocol&&(r.tls={rejectUnauthorized:!1}),r}(),r={connection:t,defaultJobOptions:n,...e};return r.connection=r.connection??t,r.defaultJobOptions=r.defaultJobOptions??n,r}(e))}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972,9092,6608],()=>r(612300));module.exports=s})();