"use strict";(()=>{var e={};e.id=3483,e.ids=[3483],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},56163:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>y,patchFetch:()=>w,requestAsyncStorage:()=>v,routeModule:()=>g,serverHooks:()=>h,staticGenerationAsyncStorage:()=>f});var o={};a.r(o),a.d(o,{DELETE:()=>m,GET:()=>u,PATCH:()=>c,POST:()=>l});var r=a(49303),s=a(88716),i=a(60670),n=a(87070);class d{async upload(e,t){return console.log("[Upload] Processing file upload"),{id:crypto.randomUUID(),path:"/uploads/placeholder",size:0,mimetype:"application/octet-stream",url:"/uploads/placeholder"}}async uploadChunked(e,t,a){return console.log("[Upload] Processing chunked upload"),this.upload(e,a)}validateFile(e,t){return console.log("[Upload] Validating file"),!0}async uploadFile(e,t,a){let o=crypto.randomUUID(),r={uploadId:o,progress:0,bytesUploaded:0,totalBytes:e.size,status:"pending",startedAt:new Date,updatedAt:new Date};this.activeUploads.set(o,{id:o,fileName:e.name,fileSize:e.size,progress:r,userId:a?.userId});try{r.status="uploading";let t=await this.upload(e);return r.status="completed",r.progress=100,r.bytesUploaded=e.size,r.updatedAt=new Date,t}catch(e){throw r.status="failed",r.updatedAt=new Date,e}finally{setTimeout(()=>{this.activeUploads.delete(o)},6e4)}}getUploadProgress(e){let t=this.activeUploads.get(e);return t?.progress??null}getActiveUploads(e){let t=Array.from(this.activeUploads.values());return e?t.filter(t=>t.userId===e):t}pauseUpload(e){let t=this.activeUploads.get(e);return!!t&&"uploading"===t.progress.status&&(t.progress.status="paused",t.progress.updatedAt=new Date,!0)}resumeUpload(e){let t=this.activeUploads.get(e);return!!t&&"paused"===t.progress.status&&(t.progress.status="uploading",t.progress.updatedAt=new Date,!0)}cancelUpload(e){let t=this.activeUploads.get(e);return!!t&&(t.progress.status="cancelled",t.progress.updatedAt=new Date,this.activeUploads.delete(e),!0)}constructor(){this.defaultOptions={maxSizeMB:100,allowedTypes:["application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.ms-powerpoint","image/jpeg","image/png","audio/mpeg","audio/wav","video/mp4"],chunkSize:1048576},this.activeUploads=new Map}}new d;var p=a(17549);async function l(e){try{let t=await e.formData(),a=t.get("file"),o=t.get("userId"),r=t.get("roomId"),s="true"===t.get("enableNotifications");if(!a)return n.NextResponse.json({error:"Nenhum arquivo fornecido"},{status:400});if(a.size>104857600)return n.NextResponse.json({error:"Arquivo muito grande. M\xe1ximo 100MB permitido."},{status:400});if(!["video/mp4","video/webm","video/quicktime","image/jpeg","image/png","image/gif","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(a.type))return n.NextResponse.json({error:"Tipo de arquivo n\xe3o suportado"},{status:400});let i=p.f.getInstance();s&&o&&r&&(i.getRoom(r)||i.createRoom(r,`Sala de Upload - ${o}`),i.joinRoom(r,o));let l=new d,u=await l.uploadFile(a,"/api/storage/upload",{enableNotifications:s,userId:o,roomId:r,chunkSize:5242880,maxRetries:3,enableCompression:!0,compressionQuality:.8,metadata:{originalName:a.name,uploadedBy:o,uploadedAt:new Date().toISOString(),mimeType:a.type,size:a.size}});return n.NextResponse.json({success:!0,data:u,message:"Upload conclu\xeddo com sucesso"})}catch(e){return console.error("Erro no upload:",e),n.NextResponse.json({error:"Erro interno do servidor",message:e instanceof Error?e.message:"Erro desconhecido"},{status:500})}}async function u(e){try{let{searchParams:t}=new URL(e.url),a=t.get("uploadId");if(!a)return n.NextResponse.json({error:"ID do upload \xe9 obrigat\xf3rio"},{status:400});let o=new d,r=o.getUploadProgress(a),s=o.getActiveUploads();return n.NextResponse.json({success:!0,data:{progress:r,isActive:s.some(e=>e.id===a),activeUploads:s.length}})}catch(e){return console.error("Erro ao buscar progresso:",e),n.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function c(e){try{let{searchParams:t}=new URL(e.url),a=t.get("uploadId"),o=t.get("action");if(!a||!o)return n.NextResponse.json({error:"ID do upload e a\xe7\xe3o s\xe3o obrigat\xf3rios"},{status:400});let r=new d,s=!1;switch(o){case"pause":s=await r.pauseUpload(a);break;case"resume":s=await r.resumeUpload(a);break;case"cancel":s=await r.cancelUpload(a);break;default:return n.NextResponse.json({error:"A\xe7\xe3o inv\xe1lida. Use: pause, resume ou cancel"},{status:400})}if(!s)return n.NextResponse.json({error:"Upload n\xe3o encontrado ou a\xe7\xe3o n\xe3o p\xf4de ser executada"},{status:404});return n.NextResponse.json({success:!0,message:`Upload ${"resume"===o?"retomado":"pause"===o?"pausado":"cancelado"} com sucesso`,data:"object"==typeof s?s:{uploadId:a,action:o}})}catch(e){return console.error("Erro na a\xe7\xe3o do upload:",e),n.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function m(e){try{let{searchParams:t}=new URL(e.url),a=t.get("uploadId");if(!a)return n.NextResponse.json({error:"ID do upload \xe9 obrigat\xf3rio"},{status:400});let o=new d;if(!await o.cancelUpload(a))return n.NextResponse.json({error:"Upload n\xe3o encontrado"},{status:404});return n.NextResponse.json({success:!0,message:"Upload cancelado e removido com sucesso"})}catch(e){return console.error("Erro ao deletar upload:",e),n.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}let g=new r.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/upload-with-notifications/route",pathname:"/api/upload-with-notifications",filename:"route",bundlePath:"app/api/upload-with-notifications/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\upload-with-notifications\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:v,staticGenerationAsyncStorage:f,serverHooks:h}=g,y="/api/upload-with-notifications/route";function w(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:f})}},17549:(e,t,a)=>{a.d(t,{O:()=>s,f:()=>r});var o=a(61657);class r{constructor(){this.rooms=new Map;let e="https://ofhzrdiadxigrvmrhaiz.supabase.co",t=process.env.SUPABASE_SERVICE_ROLE_KEY;e&&t||console.warn("⚠️ Supabase credentials not found in NotificationManager"),this.supabase=(0,o.eI)(e,t,{auth:{autoRefreshToken:!1,persistSession:!1}})}static getInstance(){return r.instance||(r.instance=new r),r.instance}getRoom(e){return this.rooms.get(e)}createRoom(e,t){let a={id:e,name:t,members:new Set,createdAt:new Date};return this.rooms.set(e,a),a}joinRoom(e,t){let a=this.rooms.get(e);return!!a&&(a.members.add(t),!0)}leaveRoom(e,t){let a=this.rooms.get(e);return!!a&&a.members.delete(t)}async create(e){e.userId,e.type,e.title,e.message,e.actionUrl,e.expiresAt?.toISOString(),new Date().toISOString();let{data:t,error:a}=await this.supabase.from("analytics_events").insert({user_id:e.userId,event_type:"notification",event_data:{type:e.type,title:e.title,message:e.message,read:!1,actionUrl:e.actionUrl,expiresAt:e.expiresAt},created_at:new Date().toISOString()}).select().single();if(a)throw console.error("Failed to create notification:",a),a;return{id:t.id,userId:t.user_id,type:t.event_data.type,title:t.event_data.title,message:t.event_data.message,read:t.event_data.read,createdAt:new Date(t.created_at),expiresAt:t.event_data.expiresAt?new Date(t.event_data.expiresAt):void 0,actionUrl:t.event_data.actionUrl}}async getForUser(e,t=!1){let a=this.supabase.from("analytics_events").select("*").eq("user_id",e).eq("event_type","notification").order("created_at",{ascending:!1}),{data:o,error:r}=await a.limit(50);if(r)return[];let s=o.map(e=>({id:e.id,userId:e.user_id,type:e.event_data.type,title:e.event_data.title,message:e.event_data.message,read:e.event_data.read,createdAt:new Date(e.created_at),expiresAt:e.event_data.expiresAt?new Date(e.event_data.expiresAt):void 0,actionUrl:e.event_data.actionUrl}));return t&&(s=s.filter(e=>!e.read)),s}async markAsRead(e){let{data:t}=await this.supabase.from("analytics_events").select("event_data").eq("id",e).single();if(!t)return!1;let a={...t.event_data,read:!0},{error:o}=await this.supabase.from("analytics_events").update({event_data:a}).eq("id",e);return!o}async delete(e){let{error:t}=await this.supabase.from("analytics_events").delete().eq("id",e);return!t}async deleteAllForUser(e){let{count:t,error:a}=await this.supabase.from("analytics_events").delete({count:"exact"}).eq("user_id",e).eq("event_type","notification");return a?0:t||0}async sendToUser(e,t){try{let a=t.data;await this.create({userId:e,type:"error"===t.type||"upload_error"===t.type?"error":"info",title:t.title,message:t.message,actionUrl:a?.uploadId?`/upload/${a.uploadId}`:void 0})}catch(e){console.error("Error sending notification to user:",e)}}async broadcastToRoom(e,t){console.log(`[NotificationManager] Broadcasting to room ${e}:`,t.title)}async sendNotification(e){if(!1!==e.persistent&&e.userId)try{await this.create({userId:e.userId,type:"error"===e.type||"upload_error"===e.type?"error":"info",title:e.title,message:e.message,actionUrl:e.data?.uploadId?`/upload/${e.data.uploadId}`:void 0})}catch(e){console.error("Error persisting notification:",e)}e.roomId&&await this.broadcastToRoom(e.roomId,e),e.userId&&!e.roomId&&console.log(`[NotificationManager] Sending to user ${e.userId}:`,e.title)}}let s=new r}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),o=t.X(0,[8948,5972,1657],()=>a(56163));module.exports=o})();