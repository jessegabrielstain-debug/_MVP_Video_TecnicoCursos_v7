"use strict";(()=>{var e={};e.id=6410,e.ids=[6410,3936],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},87514:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>b,requestAsyncStorage:()=>j,routeModule:()=>m,serverHooks:()=>h,staticGenerationAsyncStorage:()=>f});var s={};r.r(s),r.d(s,{DELETE:()=>x,GET:()=>c,PUT:()=>_});var i=r(49303),o=r(88716),a=r(60670),d=r(87070),n=r(13936),p=r(91585),l=r(26033);let u=p.Ry({slide_number:p.Rx().int().positive().optional(),title:p.Z_().min(1).max(200).optional(),content:p.Z_().max(5e3).optional(),duration:p.Rx().positive().max(300).optional(),transition_type:p.Km(["fade","slide","zoom","flip","none"]).optional(),thumbnail_url:p.Z_().url().optional(),notes:p.Z_().max(2e3).optional(),properties:p.IM(p._4()).optional()});async function c(e,{params:t}){try{let r=(0,n.getSupabaseForRequest)(e),{data:{user:s},error:i}=await r.auth.getUser();if(i||!s)return d.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let o=t.id,{data:a,error:p}=await r.from("pptx_slides").select(`
        *,
        pptx_uploads:upload_id (
          id,
          project_id,
          original_filename,
          status,
          projects:project_id (
            id,
            name,
            user_id,
            is_public
          )
        )
      `).eq("id",o).single();if(p||!a)return d.NextResponse.json({error:"Slide n\xe3o encontrado"},{status:404});let l=a.pptx_uploads.projects,u=l.user_id===s.id||l.is_public;if(!u){let{data:e}=await r.from("project_collaborators").select("role").eq("project_id",l.id).eq("user_id",s.id).in("role",["owner","editor"]).single();e&&(u=!0)}if(!u)return d.NextResponse.json({error:"Sem permiss\xe3o para acessar este slide"},{status:403});return d.NextResponse.json({slide:a})}catch(e){return console.error("Erro ao buscar slide:",e),d.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function _(e,{params:t}){try{let r=(0,n.getSupabaseForRequest)(e),{data:{user:s},error:i}=await r.auth.getUser();if(i||!s)return d.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let o=t.id,a=await e.json(),p=u.parse(a),{data:l}=await r.from("pptx_slides").select(`
        *,
        pptx_uploads:upload_id (
          project_id,
          projects:project_id (
            id,
            user_id
          )
        )
      `).eq("id",o).single();if(!l)return d.NextResponse.json({error:"Slide n\xe3o encontrado"},{status:404});let c=l.pptx_uploads,_=c.projects,x=_.user_id===s.id;if(!x){let{data:e}=await r.from("project_collaborators").select("role").eq("project_id",_.id).eq("user_id",s.id).in("role",["owner","editor"]).single();e&&(x=!0)}if(!x)return d.NextResponse.json({error:"Sem permiss\xe3o para atualizar este slide"},{status:403});if(p.slide_number&&p.slide_number!==l.slide_number){let{data:e}=await r.from("pptx_slides").select("id").eq("upload_id",l.upload_id).eq("slide_number",p.slide_number).neq("id",o).single();if(e)return d.NextResponse.json({error:`J\xe1 existe um slide com n\xfamero ${p.slide_number}`},{status:409})}let m={...p};p.properties&&l.properties&&(m.properties={...l.properties,...p.properties});let{data:j,error:f}=await r.from("pptx_slides").update({...m,properties:m.properties,updated_at:new Date().toISOString()}).eq("id",o).select().single();if(f)return console.error("Erro ao atualizar slide:",f),d.NextResponse.json({error:"Erro ao atualizar slide"},{status:500});return await r.from("project_history").insert({project_id:c.project_id,user_id:s.id,action:"update",entity_type:"pptx_slide",entity_id:o,description:`Slide ${l.slide_number} "${l.title}" atualizado`,changes:p}),d.NextResponse.json({slide:j})}catch(e){if(e instanceof l.jm)return d.NextResponse.json({error:"Dados inv\xe1lidos",details:e.errors},{status:400});return console.error("Erro ao atualizar slide:",e),d.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function x(e,{params:t}){try{let r=(0,n.getSupabaseForRequest)(e),{data:{user:s},error:i}=await r.auth.getUser();if(i||!s)return d.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let o=t.id,{data:a}=await r.from("pptx_slides").select(`
        *,
        pptx_uploads:upload_id (
          id,
          project_id,
          projects:project_id (
            id,
            user_id
          )
        )
      `).eq("id",o).single();if(!a)return d.NextResponse.json({error:"Slide n\xe3o encontrado"},{status:404});let p=a.pptx_uploads,l=p.projects,u=l.user_id===s.id;if(!u){let{data:e}=await r.from("project_collaborators").select("role").eq("project_id",l.id).eq("user_id",s.id).in("role",["owner","editor"]).single();e&&(u=!0)}if(!u)return d.NextResponse.json({error:"Sem permiss\xe3o para excluir este slide"},{status:403});let{error:c}=await r.from("pptx_slides").delete().eq("id",o);if(c)return console.error("Erro ao excluir slide:",c),d.NextResponse.json({error:"Erro ao excluir slide"},{status:500});let{data:_}=await r.from("pptx_slides").select("id",{count:"exact"}).eq("upload_id",a.upload_id);await r.from("pptx_uploads").update({slide_count:_?.length||0}).eq("id",a.upload_id);let{data:x}=await r.from("pptx_slides").select("id, slide_number").eq("upload_id",a.upload_id).gt("slide_number",a.slide_number).order("slide_number");if(x&&x.length>0)for(let e of x)await r.from("pptx_slides").update({slide_number:e.slide_number-1}).eq("id",e.id);return await r.from("project_history").insert({project_id:p.project_id,user_id:s.id,action:"delete",entity_type:"pptx_slide",entity_id:o,description:`Slide ${a.slide_number} "${a.title}" exclu\xeddo`,changes:{deleted_slide:{slide_number:a.slide_number,title:a.title,duration:a.duration}}}),d.NextResponse.json({message:"Slide exclu\xeddo com sucesso"})}catch(e){return console.error("Erro ao excluir slide:",e),d.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}let m=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/pptx/slides/[id]/route",pathname:"/api/pptx/slides/[id]",filename:"route",bundlePath:"app/api/pptx/slides/[id]/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\pptx\\slides\\[id]\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:j,staticGenerationAsyncStorage:f,serverHooks:h}=m,g="/api/pptx/slides/[id]/route";function b(){return(0,a.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:f})}},13936:(e,t,r)=>{r.d(t,{e:()=>a,getSupabaseForRequest:()=>n,p:()=>d});var s=r(67721),i=r(61657),o=r(71615);let a=()=>{let e=(0,o.cookies)();return(0,s.createServerClient)("https://ofhzrdiadxigrvmrhaiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ",{cookies:{get:t=>e.get(t)?.value,set(t,r,s){try{e.set({name:t,value:r,...s})}catch(e){}},remove(t,r){try{e.set({name:t,value:"",...r})}catch(e){}}}})},d=(0,i.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}});function n(e){let t=e.headers.get("authorization")||e.headers.get("Authorization");return t?(0,i.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ",{global:{headers:{Authorization:t}},auth:{persistSession:!1,autoRefreshToken:!1}}):a()}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972,1657,9702,1585],()=>r(87514));module.exports=s})();