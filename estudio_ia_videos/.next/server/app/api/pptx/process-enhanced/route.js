"use strict";(()=>{var e={};e.id=4133,e.ids=[4133],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},17702:e=>{e.exports=require("events")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},49031:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>y,requestAsyncStorage:()=>f,routeModule:()=>h,serverHooks:()=>g,staticGenerationAsyncStorage:()=>m});var s={};r.r(s),r.d(s,{EnhancedPPTXProcessor:()=>d,POST:()=>u});var i=r(49303),a=r(88716),o=r(60670),n=r(87070),p=r(89190),l=r.n(p),c=r(4096);class d{constructor(){this.processingErrors=[],this.warnings=[],this.parser=new c.Z({ignoreAttributes:!1,attributeNamePrefix:"@_",textNodeName:"text",parseAttributeValue:!0,parseTagValue:!0})}async processFile(e,t){let r=Date.now();this.processingErrors=[],this.warnings=[];try{console.log(`[Enhanced PPTX] Starting processing: ${t}`);let s=this.validateFile(e,t);if(!s.valid)return{success:!1,error:s.error,processingTime:Date.now()-r};let i=await l().loadAsync(e),a=await this.extractMetadata(i,t,e.length),o=await this.extractSlides(i),n=o.reduce((e,t)=>e+t.duration,0);return console.log(`[Enhanced PPTX] Processing completed: ${o.length} slides, ${n}s total`),{success:!0,data:{slides:o,metadata:a,totalDuration:n,errors:this.processingErrors,warnings:this.warnings},processingTime:Date.now()-r}}catch(e){return console.error("[Enhanced PPTX] Processing failed:",e),{success:!1,error:e instanceof Error?e.message:"Unknown processing error",processingTime:Date.now()-r}}}validateFile(e,t){if(!t.toLowerCase().endsWith(".pptx"))return{valid:!1,error:"Invalid file extension. Only .pptx files are supported."};if(e.length>52428800)return{valid:!1,error:"File too large. Maximum size is 50MB."};if(e.length<1024)return{valid:!1,error:"File too small. Minimum size is 1KB."};let r=e.slice(0,4);return[Buffer.from([80,75,3,4]),Buffer.from([80,75,5,6]),Buffer.from([80,75,7,8])].some(e=>e.equals(r))?{valid:!0}:{valid:!1,error:"Invalid PPTX file format. File appears to be corrupted."}}async extractMetadata(e,t,r){try{let s=e.file("docProps/core.xml"),i=e.file("docProps/app.xml"),a={title:t.replace(/\.pptx$/i,""),author:"Unknown",subject:"",keywords:[],createdDate:new Date,modifiedDate:new Date,slideCount:0,totalImages:0,hasAnimations:!1,templateInfo:"Custom",fileSize:r,version:"1.0"};if(s){let e=await s.async("text"),t=this.parser.parse(e);if(t["cp:coreProperties"]){let e=t["cp:coreProperties"];a.title=e["dc:title"]||a.title,a.author=e["dc:creator"]||a.author,a.subject=e["dc:subject"]||a.subject,a.keywords=e["cp:keywords"]?e["cp:keywords"].split(/[,;]/).map(e=>e.trim()):[],e["dcterms:created"]&&(a.createdDate=new Date(e["dcterms:created"])),e["dcterms:modified"]&&(a.modifiedDate=new Date(e["dcterms:modified"]))}}if(i){let e=await i.async("text"),t=this.parser.parse(e);if(t.Properties){let e=t.Properties;a.slideCount=parseInt(e.Slides)||0,a.templateInfo=e.Template||"Custom",a.version=e.AppVersion||"1.0"}}return a}catch(e){return this.warnings.push("Could not extract complete metadata from PPTX file"),console.warn("[Enhanced PPTX] Metadata extraction warning:",e),{title:t.replace(/\.pptx$/i,""),author:"Unknown",subject:"",keywords:[],createdDate:new Date,modifiedDate:new Date,slideCount:0,totalImages:0,hasAnimations:!1,templateInfo:"Custom",fileSize:r,version:"1.0"}}}async extractSlides(e){let t=[];try{let r=e.file("ppt/_rels/presentation.xml.rels");if(!r)throw Error("Could not find presentation relationships");let s=await r.async("text"),i=this.parser.parse(s),a=[];if(i.Relationships&&i.Relationships.Relationship)for(let e of Array.isArray(i.Relationships.Relationship)?i.Relationships.Relationship:[i.Relationships.Relationship])e["@_Type"]&&e["@_Type"].includes("slide")&&!e["@_Type"].includes("master")&&a.push({id:e["@_Id"],target:e["@_Target"]});a.sort((e,t)=>{let r=e.target.match(/slide(\d+)\.xml/),s=t.target.match(/slide(\d+)\.xml/);return r&&s?parseInt(r[1])-parseInt(s[1]):0});for(let r=0;r<a.length;r++){let s=a[r];try{let i=await this.processSlide(e,s.target,r);t.push(i)}catch(e){this.processingErrors.push({type:"error",message:`Failed to process slide ${r+1}: ${e instanceof Error?e.message:"Unknown error"}`,slideIndex:r,recoverable:!0}),t.push({id:`slide-${r}`,title:`Slide ${r+1} (Error)`,content:"This slide could not be processed due to an error.",images:[],animations:[],duration:3,order:r,textElements:[],backgroundType:"solid",backgroundColor:"#ffffff"})}}return t}catch(e){throw this.processingErrors.push({type:"critical",message:`Critical error extracting slides: ${e instanceof Error?e.message:"Unknown error"}`,recoverable:!1}),e}}async processSlide(e,t,r){let s=e.file(`ppt/${t}`);if(!s)throw Error(`Slide file not found: ${t}`);let i=await s.async("text"),a=this.parser.parse(i),o={id:`slide-${r}`,title:"",content:"",images:[],animations:[],duration:5,order:r,textElements:[],backgroundType:"solid",backgroundColor:"#ffffff"};if(a["p:sld"]&&a["p:sld"]["p:cSld"]){let e=a["p:sld"]["p:cSld"];if(e["p:spTree"]&&e["p:spTree"]["p:sp"]){let t=Array.isArray(e["p:spTree"]["p:sp"])?e["p:spTree"]["p:sp"]:[e["p:spTree"]["p:sp"]];for(let e=0;e<t.length;e++){let s=t[e];try{await this.processShape(s,o,e)}catch(t){this.warnings.push(`Could not process shape ${e} in slide ${r+1}`)}}}e["p:bg"]&&this.processBackground(e["p:bg"],o)}o.textElements.length>0?o.title=o.textElements[0].content.substring(0,50)+(o.textElements[0].content.length>50?"...":""):o.title=`Slide ${r+1}`,o.content=o.textElements.map(e=>e.content).join(" ");let n=o.content.split(/\s+/).length;return o.duration=Math.max(3,Math.min(15,.5*n)),o}async processShape(e,t,r){if(e["p:txBody"]&&e["p:txBody"]["a:p"]){for(let s of Array.isArray(e["p:txBody"]["a:p"])?e["p:txBody"]["a:p"]:[e["p:txBody"]["a:p"]])if(s["a:r"]&&s["a:r"]["a:t"]){let e=s["a:r"]["a:t"];e&&"string"==typeof e&&e.trim()&&t.textElements.push({id:`text-${t.order}-${r}`,content:e.trim(),fontSize:12,fontFamily:"Arial",color:"#000000",bold:!1,italic:!1,position:{x:0,y:0},width:100,height:20})}}e["p:pic"]&&t.images.push({id:`image-${t.order}-${r}`,name:`slide${t.order}_image${r}`,type:"image/png",base64:"",width:100,height:100,position:{x:0,y:0},alt:"Image from slide"})}processBackground(e,t){if(e["p:bgPr"]){let r=e["p:bgPr"];r["a:solidFill"]?(t.backgroundType="solid",t.backgroundColor="#ffffff"):r["a:gradFill"]?t.backgroundType="gradient":r["a:blipFill"]&&(t.backgroundType="image")}}}async function u(e){try{let t=(await e.formData()).get("file");if(!t)return n.NextResponse.json({success:!1,error:"No file provided"},{status:400});let r=Buffer.from(await t.arrayBuffer()),s=new d,i=await s.processFile(r,t.name);if(i.success)return n.NextResponse.json({success:!0,message:"PPTX processed successfully",data:i.data,processingTime:i.processingTime});return n.NextResponse.json({success:!1,error:i.error},{status:400})}catch(e){return console.error("[Enhanced PPTX API] Error:",e),n.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}let h=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/pptx/process-enhanced/route",pathname:"/api/pptx/process-enhanced",filename:"route",bundlePath:"app/api/pptx/process-enhanced/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\pptx\\process-enhanced\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:m,serverHooks:g}=h,x="/api/pptx/process-enhanced/route";function y(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:m})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972,9190,4096],()=>r(49031));module.exports=s})();