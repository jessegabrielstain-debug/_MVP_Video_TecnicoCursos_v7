"use strict";(()=>{var e={};e.id=7092,e.ids=[7092],e.modules={572934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},554580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},345869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},220399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},430517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},627790:e=>{e.exports=require("assert")},978893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},592048:e=>{e.exports=require("fs")},532615:e=>{e.exports=require("http")},735240:e=>{e.exports=require("https")},555315:e=>{e.exports=require("path")},986624:e=>{e.exports=require("querystring")},917360:e=>{e.exports=require("url")},521764:e=>{e.exports=require("util")},671568:e=>{e.exports=require("zlib")},862382:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>S,patchFetch:()=>N,requestAsyncStorage:()=>O,routeModule:()=>j,serverHooks:()=>y,staticGenerationAsyncStorage:()=>v});var o={};r.r(o),r.d(o,{GET:()=>x,POST:()=>g,PUT:()=>T,maxDuration:()=>m});var a=r(349303),n=r(88716),s=r(60670),i=r(387070),d=r(95715),u=r(396781),c=r(592048),l=r.n(c),p=r(555315),f=r.n(p);(function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e})(),function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}();let m=300;class w{async processPPTX(e,t){try{let e=[{id:"1",title:"Slide 1 - Introdu\xe7\xe3o",content:"Conte\xfado do primeiro slide extra\xeddo do PowerPoint",notes:"Notas do apresentador para este slide",images:[],layout:{width:1920,height:1080,background:"#ffffff",theme:"default"},order:1,duration:5e3,audioText:"Slide 1 - Introdu\xe7\xe3o. Conte\xfado do primeiro slide extra\xeddo do PowerPoint. Notas do apresentador para este slide."},{id:"2",title:"Slide 2 - Desenvolvimento",content:"Conte\xfado do segundo slide com informa\xe7\xf5es importantes",notes:"Notas adicionais para o segundo slide",images:[],layout:{width:1920,height:1080,background:"#ffffff",theme:"default"},order:2,duration:5e3,audioText:"Slide 2 - Desenvolvimento. Conte\xfado do segundo slide com informa\xe7\xf5es importantes. Notas adicionais para o segundo slide."},{id:"3",title:"Slide 3 - Conclus\xe3o",content:"Resumo dos pontos principais e pr\xf3ximos passos",notes:"Encerramento da apresenta\xe7\xe3o",images:[],layout:{width:1920,height:1080,background:"#ffffff",theme:"default"},order:3,duration:5e3,audioText:"Slide 3 - Conclus\xe3o. Resumo dos pontos principais e pr\xf3ximos passos. Encerramento da apresenta\xe7\xe3o."}];return await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).project.update({where:{id:t},data:{metadata:{slides:e,totalSlides:e.length,extractedAt:new Date().toISOString(),autoTTSEnabled:!0}}}),e}catch(e){throw console.error("Error processing PPTX:",e),Error("Failed to process PPTX file")}}async convertSlidesToVideoData(e){return{scenes:e.map((e,t)=>({id:e.id,type:"slide",duration:e.duration||5e3,content:{title:e.title,text:e.content,notes:e.notes,background:e.layout.background,audioText:e.audioText},order:t})),totalDuration:e.reduce((e,t)=>e+(t.duration||5e3),0),resolution:{width:1920,height:1080}}}async generateAutoTTS(e,t){try{console.log("\uD83C\uDFA4 Iniciando gera\xe7\xe3o autom\xe1tica de TTS...");let r={provider:"elevenlabs",voice:"Rachel",speed:1,pitch:1,volume:.8,language:"pt-BR"},o=[];for(let t of e)if(t.audioText){let e={text:t.audioText,voice:r.voice,speed:r.speed,pitch:r.pitch,volume:r.volume},a=await this.callTTSAPI(e,t.id);o.push({slideId:t.id,audioUrl:a.audioUrl,duration:a.duration,status:"completed"})}return await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).project.update({where:{id:t},data:{metadata:{slides:e,totalSlides:e.length,extractedAt:new Date().toISOString(),autoTTSEnabled:!0,ttsJobs:o,ttsConfig:r,ttsGeneratedAt:new Date().toISOString()}}}),console.log("✅ TTS autom\xe1tico gerado com sucesso!"),{success:!0,ttsJobs:o,config:r,totalAudioDuration:o.reduce((e,t)=>e+t.duration,0)}}catch(e){throw console.error("Error generating auto TTS:",e),Error("Failed to generate automatic TTS")}}async callTTSAPI(e,t){return await new Promise(e=>setTimeout(e,1e3)),{audioUrl:`/api/audio/tts/${t}.mp3`,duration:Math.floor(50*e.text.length),format:"mp3",bitrate:"128kbps",sampleRate:"44100Hz"}}async triggerAvatarGeneration(e,t){try{console.log("\uD83D\uDC64 Iniciando gera\xe7\xe3o autom\xe1tica de Avatar...");let e={model:"professional-female",pose:"presentation",expression:"friendly",gestures:!0,eyeContact:.8,quality:"standard"},r=t.map(t=>({slideId:t.id,avatarUrl:`/api/avatars/generated/${t.id}.mp4`,duration:t.duration||5e3,status:"completed",config:e}));return console.log("✅ Avatar autom\xe1tico configurado!"),{success:!0,avatarJobs:r,config:e}}catch(e){throw console.error("Error generating auto avatar:",e),Error("Failed to generate automatic avatar")}}}let h=new w;async function g(e){try{let t=await (0,d.getServerSession)(Object(function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e}()));if(!t?.user?.id)return i.NextResponse.json({error:"Unauthorized"},{status:401});let r=await e.formData(),o=r.get("file"),a=r.get("projectId"),n="true"===r.get("autoTTS"),s="true"===r.get("autoAvatar");if(!o||!a)return i.NextResponse.json({error:"File and project ID required"},{status:400});if(!o.name.endsWith(".pptx"))return i.NextResponse.json({error:"Only PPTX files are supported"},{status:400});if(!await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).project.findFirst({where:{id:a,userId:t.user.id}}))return i.NextResponse.json({error:"Project not found"},{status:404});let c=await o.arrayBuffer(),p=Buffer.from(c),m=f().join(process.cwd(),"uploads","pptx");l().existsSync(m)||l().mkdirSync(m,{recursive:!0});let w=f().join(m,`${a}-${o.name}`);l().writeFileSync(w,p),console.log("\uD83D\uDCC4 Processando PPTX...");let g=await h.processPPTX(w,a),x=await h.convertSlidesToVideoData(g),T=null,j=null;return n&&(console.log("\uD83C\uDFA4 Gerando TTS autom\xe1tico..."),T=await h.generateAutoTTS(g,a),await u.workflowManager.updateWorkflowStep(a,"tts","completed",T)),s&&(console.log("\uD83D\uDC64 Configurando Avatar autom\xe1tico..."),j=await h.triggerAvatarGeneration(a,g),await u.workflowManager.updateWorkflowStep(a,"avatar","completed",j)),await u.workflowManager.updateWorkflowStep(a,"import","completed",{slides:g,videoData:x,originalFile:o.name,autoTTS:n,autoAvatar:s}),l().unlinkSync(w),console.log("✅ PPTX processado com sucesso!"),i.NextResponse.json({success:!0,slides:g,videoData:x,ttsResult:T,avatarResult:j,message:"PPTX processed successfully with integrated workflow",nextSteps:{ttsGenerated:!!T,avatarConfigured:!!j,readyForRender:!!(T&&j)}})}catch(e){return console.error("PPTX API Error:",e),i.NextResponse.json({error:"Internal server error",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function x(e){try{let t=await (0,d.getServerSession)(Object(function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e}()));if(!t?.user?.id)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:r}=new URL(e.url),o=r.get("projectId");if(!o)return i.NextResponse.json({error:"Project ID required"},{status:400});let a=await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).project.findFirst({where:{id:o,userId:t.user.id}});if(!a)return i.NextResponse.json({error:"Project not found"},{status:404});let n=a.metadata;return i.NextResponse.json({slides:n?.slides||[],videoData:n?.videoData||null,ttsJobs:n?.ttsJobs||[],ttsConfig:n?.ttsConfig||null,avatarJobs:n?.avatarJobs||[],autoTTSEnabled:n?.autoTTSEnabled||!1,extractedAt:n?.extractedAt||null,ttsGeneratedAt:n?.ttsGeneratedAt||null})}catch(e){return console.error("PPTX GET Error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function T(e){try{let t=await (0,d.getServerSession)(Object(function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e}()));if(!t?.user?.id)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{projectId:r,slideIds:o,ttsConfig:a}=await e.json();if(!r||!o||!Array.isArray(o))return i.NextResponse.json({error:"Project ID and slide IDs required"},{status:400});let n=await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).project.findFirst({where:{id:r,userId:t.user.id}});if(!n)return i.NextResponse.json({error:"Project not found"},{status:404});let s=n.metadata,u=(s?.slides||[]).filter(e=>o.includes(e.id));if(0===u.length)return i.NextResponse.json({error:"No valid slides found"},{status:400});let c=await h.generateAutoTTS(u,r);return i.NextResponse.json({success:!0,regeneratedSlides:o,ttsResult:c,message:"TTS regenerated successfully for selected slides"})}catch(e){return console.error("PPTX PUT Error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}let j=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/pptx/process/route",pathname:"/api/pptx/process",filename:"route",bundlePath:"app/api/pptx/process/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\pptx\\process\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:O,staticGenerationAsyncStorage:v,serverHooks:y}=j,S="/api/pptx/process/route";function N(){return(0,s.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:v})}},396781:(e,t,r)=>{r.r(t),r.d(t,{DELETE:()=>f,GET:()=>c,POST:()=>l,PUT:()=>p,workflowManager:()=>u});var o=r(387070),a=r(95715);(function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e})(),function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}();var n=r(691585);let s=n.Ry({name:n.Z_().min(1),type:n.Km(["pptx","template-nr","talking-photo","custom"]),source:n.Ry({type:n.Km(["upload","template","blank"]),data:n._4().optional()})}),i=n.Ry({id:n.Z_(),action:n.Km(["edit","render","export","delete"]),data:n._4().optional()});class d{async createWorkflow(e,t){let r={projectId:e,currentStep:"import",steps:{import:{status:"pending"},edit:{status:"pending"},avatar:{status:"pending"},tts:{status:"pending"},render:{status:"pending"},export:{status:"pending"}},metadata:{createdAt:new Date,updatedAt:new Date,userId:t}};return this.workflows.set(e,r),r}async updateWorkflowStep(e,t,r,o){let a=this.workflows.get(e);if(!a)return null;if(a.steps[t]={status:r,data:o},a.metadata.updatedAt=new Date,"completed"===r){let e=["import","edit","avatar","tts","render","export"],r=e.indexOf(t);r<e.length-1?a.currentStep=e[r+1]:a.currentStep="complete"}return this.workflows.set(e,a),a}getWorkflow(e){return this.workflows.get(e)||null}async executeStep(e,t,r){if(!this.workflows.get(e))throw Error("Workflow not found");await this.updateWorkflowStep(e,t,"processing");try{let o;switch(t){case"import":o=await this.executeImport(e,r);break;case"edit":o=await this.executeEdit(e,r);break;case"avatar":o=await this.executeAvatar(e,r);break;case"tts":o=await this.executeTTS(e,r);break;case"render":o=await this.executeRender(e,r);break;case"export":o=await this.executeExport(e,r);break;default:throw Error(`Unknown step: ${t}`)}return await this.updateWorkflowStep(e,t,"completed",o),o}catch(o){let r=o instanceof Error?o.message:"Unknown error";throw await this.updateWorkflowStep(e,t,"error",{error:r}),o}}async executeImport(e,t){if(t&&"string"==typeof t.type&&"pptx"===t.type){let r=await fetch("/api/pptx/process",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e,file:t.file})});return await r.json()}if(t&&"string"==typeof t.type&&"template-nr"===t.type){let r=await fetch("/api/templates/nr/load",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e,template:t.template})});return await r.json()}return{success:!0,message:"Import completed"}}async executeEdit(e,t){let r=await fetch("/api/editor/canvas/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e,editorData:t})});return await r.json()}async executeAvatar(e,t){let r=await fetch("/api/avatars/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e,avatarConfig:t&&"object"==typeof t.avatar?t.avatar:{model:"default"},script:t&&"string"==typeof t.script?t.script:"Texto padr\xe3o"})});return await r.json()}async executeTTS(e,t){let r=await fetch("/api/tts/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e,text:t&&"string"==typeof t.text?t.text:"Texto padr\xe3o",voice:t&&"string"==typeof t.voice?t.voice:"pt-BR-female-1",language:t&&"string"==typeof t.language?t.language:"pt-BR"})});return await r.json()}async executeRender(e,t){let r=await fetch("/api/render/video",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e,renderConfig:t||{resolution:{width:1920,height:1080},fps:30,quality:"high",format:"mp4",codec:"h264"}})});return await r.json()}async executeExport(e,t){let r=await fetch("/api/export/mp4",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e,exportConfig:t||{format:"mp4",quality:"1080p",compression:"medium",includeSubtitles:!1}})});return await r.json()}constructor(){this.workflows=new Map}}let u=new d;async function c(e){try{let t=await (0,a.getServerSession)(Object(function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e}()));if(!t?.user?.id)return o.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:r}=new URL(e.url),n=r.get("projectId");if(!n)return o.NextResponse.json({error:"Project ID required"},{status:400});let s=u.getWorkflow(n);if(!s)return o.NextResponse.json({error:"Workflow not found"},{status:404});return o.NextResponse.json({workflow:s})}catch(e){return console.error("Unified API GET Error:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}async function l(e){try{let t=await (0,a.getServerSession)(Object(function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e}()));if(!t?.user?.id)return o.NextResponse.json({error:"Unauthorized"},{status:401});let r=await e.json(),n=s.parse(r),i=await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).project.create({data:{name:n.name,type:n.type,status:"DRAFT",userId:t.user.id,description:"",organizationId:"",originalFileName:"",fileSize:0,filePath:"",thumbnailUrl:"",duration:0,views:0,likes:0,shares:0,comments:0,downloads:0,isPublic:!1,isTemplate:!1,templateCategory:"",tags:[],customFields:{},version:"1.0",lastEditedBy:t.user.id,collaborators:[],permissions:{},exportFormats:[],renderSettings:{},aiSettings:{},complianceData:{},analyticsData:{}}}),d=await u.createWorkflow(i.id,t.user.id);return n.source.data&&await u.executeStep(i.id,"import",n.source.data),o.NextResponse.json({project:i,workflow:d,message:"Project created and workflow initialized"})}catch(e){return console.error("Unified API POST Error:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}async function p(e){try{let t;let r=await (0,a.getServerSession)(Object(function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e}()));if(!r?.user?.id)return o.NextResponse.json({error:"Unauthorized"},{status:401});let n=await e.json(),s=i.parse(n);if(!await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).project.findFirst({where:{id:s.id,userId:r.user.id}}))return o.NextResponse.json({error:"Project not found"},{status:404});switch(s.action){case"edit":t=await u.executeStep(s.id,"edit",s.data);break;case"render":let d=s.data;await u.executeStep(s.id,"avatar",d?.avatar),await u.executeStep(s.id,"tts",d?.tts),t=await u.executeStep(s.id,"render",d?.render);break;case"export":t=await u.executeStep(s.id,"export",s.data);break;case"delete":return await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).project.delete({where:{id:s.id}}),o.NextResponse.json({message:"Project deleted"});default:return o.NextResponse.json({error:"Invalid action"},{status:400})}let c=u.getWorkflow(s.id);return o.NextResponse.json({result:t,workflow:c,message:`Action ${s.action} completed`})}catch(e){return console.error("Unified API PUT Error:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}async function f(e){try{let t=await (0,a.getServerSession)(Object(function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e}()));if(!t?.user?.id)return o.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:r}=new URL(e.url),n=r.get("projectId");if(!n)return o.NextResponse.json({error:"Project ID required"},{status:400});if(!await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).project.findFirst({where:{id:n,userId:t.user.id}}))return o.NextResponse.json({error:"Project not found"},{status:404});return await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).project.delete({where:{id:n}}),o.NextResponse.json({message:"Project and workflow deleted"})}catch(e){return console.error("Unified API DELETE Error:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[8948,5972,5715,1585],()=>r(862382));module.exports=o})();