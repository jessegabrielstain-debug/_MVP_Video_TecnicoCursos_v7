"use strict";(()=>{var e={};e.id=7092,e.ids=[7092],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},55315:e=>{e.exports=require("path")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},62382:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>A,patchFetch:()=>R,requestAsyncStorage:()=>y,routeModule:()=>P,serverHooks:()=>D,staticGenerationAsyncStorage:()=>j});var o={};r.r(o),r.d(o,{GET:()=>w,POST:()=>S,PUT:()=>v,maxDuration:()=>x});var s=r(49303),a=r(88716),n=r(60670),i=r(87070),d=r(75571),u=r(95306),l=r(8261),c=r(60519),p=r(92048),g=r.n(p),f=r(55315),m=r.n(f);let x=300;class T{async processPPTX(e,t){try{let e=[{id:"1",title:"Slide 1 - Introdu\xe7\xe3o",content:"Conte\xfado do primeiro slide extra\xeddo do PowerPoint",notes:"Notas do apresentador para este slide",images:[],layout:{width:1920,height:1080,background:"#ffffff",theme:"default"},order:1,duration:5e3,audioText:"Slide 1 - Introdu\xe7\xe3o. Conte\xfado do primeiro slide extra\xeddo do PowerPoint. Notas do apresentador para este slide."},{id:"2",title:"Slide 2 - Desenvolvimento",content:"Conte\xfado do segundo slide com informa\xe7\xf5es importantes",notes:"Notas adicionais para o segundo slide",images:[],layout:{width:1920,height:1080,background:"#ffffff",theme:"default"},order:2,duration:5e3,audioText:"Slide 2 - Desenvolvimento. Conte\xfado do segundo slide com informa\xe7\xf5es importantes. Notas adicionais para o segundo slide."},{id:"3",title:"Slide 3 - Conclus\xe3o",content:"Resumo dos pontos principais e pr\xf3ximos passos",notes:"Encerramento da apresenta\xe7\xe3o",images:[],layout:{width:1920,height:1080,background:"#ffffff",theme:"default"},order:3,duration:5e3,audioText:"Slide 3 - Conclus\xe3o. Resumo dos pontos principais e pr\xf3ximos passos. Encerramento da apresenta\xe7\xe3o."}];return await l._.project.update({where:{id:t},data:{metadata:JSON.parse(JSON.stringify({slides:e,totalSlides:e.length,extractedAt:new Date().toISOString(),autoTTSEnabled:!0}))}}),e}catch(e){throw console.error("Error processing PPTX:",e),Error("Failed to process PPTX file")}}async convertSlidesToVideoData(e){return{scenes:e.map((e,t)=>({id:e.id,type:"slide",duration:e.duration||5e3,content:{title:e.title,text:e.content,notes:e.notes,background:e.layout.background,audioText:e.audioText},order:t})),totalDuration:e.reduce((e,t)=>e+(t.duration||5e3),0),resolution:{width:1920,height:1080}}}async generateAutoTTS(e,t){try{console.log("\uD83C\uDFA4 Iniciando gera\xe7\xe3o autom\xe1tica de TTS...");let r={provider:"elevenlabs",voice:"Rachel",speed:1,pitch:1,volume:.8,language:"pt-BR"},o=[];for(let t of e)if(t.audioText){let e={text:t.audioText,voice:r.voice,speed:r.speed,pitch:r.pitch,volume:r.volume},s=await this.callTTSAPI(e,t.id);o.push({slideId:t.id,audioUrl:s.audioUrl,duration:s.duration,status:"completed"})}return await l._.project.update({where:{id:t},data:{metadata:JSON.parse(JSON.stringify({slides:e,totalSlides:e.length,extractedAt:new Date().toISOString(),autoTTSEnabled:!0,ttsJobs:o,ttsConfig:r,ttsGeneratedAt:new Date().toISOString()}))}}),console.log("✅ TTS autom\xe1tico gerado com sucesso!"),{success:!0,ttsJobs:o,config:r,totalAudioDuration:o.reduce((e,t)=>e+t.duration,0)}}catch(e){throw console.error("Error generating auto TTS:",e),Error("Failed to generate automatic TTS")}}async callTTSAPI(e,t){return await new Promise(e=>setTimeout(e,1e3)),{audioUrl:`/api/audio/tts/${t}.mp3`,duration:Math.floor(50*e.text.length),format:"mp3",bitrate:"128kbps",sampleRate:"44100Hz"}}async triggerAvatarGeneration(e,t){try{console.log("\uD83D\uDC64 Iniciando gera\xe7\xe3o autom\xe1tica de Avatar...");let e={model:"professional-female",pose:"presentation",expression:"friendly",gestures:!0,eyeContact:.8,quality:"standard"},r=t.map(t=>({slideId:t.id,avatarUrl:`/api/avatars/generated/${t.id}.mp4`,duration:t.duration||5e3,status:"completed",config:e}));return console.log("✅ Avatar autom\xe1tico configurado!"),{success:!0,avatarJobs:r,config:e}}catch(e){throw console.error("Error generating auto avatar:",e),Error("Failed to generate automatic avatar")}}}let h=new T;async function S(e){try{let t=await (0,d.getServerSession)(u.L);if(!t?.user?.id)return i.NextResponse.json({error:"Unauthorized"},{status:401});let r=await e.formData(),o=r.get("file"),s=r.get("projectId"),a="true"===r.get("autoTTS"),n="true"===r.get("autoAvatar");if(!o||!s)return i.NextResponse.json({error:"File and project ID required"},{status:400});if(!o.name.endsWith(".pptx"))return i.NextResponse.json({error:"Only PPTX files are supported"},{status:400});if(!await l._.project.findFirst({where:{id:s,userId:t.user.id}}))return i.NextResponse.json({error:"Project not found"},{status:404});let p=await o.arrayBuffer(),f=Buffer.from(p),x=m().join(process.cwd(),"uploads","pptx");g().existsSync(x)||g().mkdirSync(x,{recursive:!0});let T=m().join(x,`${s}-${o.name}`);g().writeFileSync(T,f),console.log("\uD83D\uDCC4 Processando PPTX...");let S=await h.processPPTX(T,s),w=await h.convertSlidesToVideoData(S),v=null,P=null;return a&&(console.log("\uD83C\uDFA4 Gerando TTS autom\xe1tico..."),v=await h.generateAutoTTS(S,s),await c.B.updateWorkflowStep(s,"tts","completed",v)),n&&(console.log("\uD83D\uDC64 Configurando Avatar autom\xe1tico..."),P=await h.triggerAvatarGeneration(s,S),await c.B.updateWorkflowStep(s,"avatar","completed",P)),await c.B.updateWorkflowStep(s,"import","completed",{slides:S,videoData:w,originalFile:o.name,autoTTS:a,autoAvatar:n}),g().unlinkSync(T),console.log("✅ PPTX processado com sucesso!"),i.NextResponse.json({success:!0,slides:S,videoData:w,ttsResult:v,avatarResult:P,message:"PPTX processed successfully with integrated workflow",nextSteps:{ttsGenerated:!!v,avatarConfigured:!!P,readyForRender:!!(v&&P)}})}catch(e){return console.error("PPTX API Error:",e),i.NextResponse.json({error:"Internal server error",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function w(e){try{let t=await (0,d.getServerSession)(u.L);if(!t?.user?.id)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:r}=new URL(e.url),o=r.get("projectId");if(!o)return i.NextResponse.json({error:"Project ID required"},{status:400});let s=await l._.project.findFirst({where:{id:o,userId:t.user.id}});if(!s)return i.NextResponse.json({error:"Project not found"},{status:404});let a=s.metadata;return i.NextResponse.json({slides:a?.slides||[],videoData:a?.videoData||null,ttsJobs:a?.ttsJobs||[],ttsConfig:a?.ttsConfig||null,avatarJobs:a?.avatarJobs||[],autoTTSEnabled:a?.autoTTSEnabled||!1,extractedAt:a?.extractedAt||null,ttsGeneratedAt:a?.ttsGeneratedAt||null})}catch(e){return console.error("PPTX GET Error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function v(e){try{let t=await (0,d.getServerSession)(u.L);if(!t?.user?.id)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{projectId:r,slideIds:o,ttsConfig:s}=await e.json();if(!r||!o||!Array.isArray(o))return i.NextResponse.json({error:"Project ID and slide IDs required"},{status:400});let a=await l._.project.findFirst({where:{id:r,userId:t.user.id}});if(!a)return i.NextResponse.json({error:"Project not found"},{status:404});let n=a.metadata,c=(n?.slides||[]).filter(e=>o.includes(e.id));if(0===c.length)return i.NextResponse.json({error:"No valid slides found"},{status:400});let p=await h.generateAutoTTS(c,r);return i.NextResponse.json({success:!0,regeneratedSlides:o,ttsResult:p,message:"TTS regenerated successfully for selected slides"})}catch(e){return console.error("PPTX PUT Error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}let P=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/pptx/process/route",pathname:"/api/pptx/process",filename:"route",bundlePath:"app/api/pptx/process/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\pptx\\process\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:y,staticGenerationAsyncStorage:j,serverHooks:D}=P,A="/api/pptx/process/route";function R(){return(0,n.patchFetch)({serverHooks:D,staticGenerationAsyncStorage:j})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[8948,5972,5571,1145],()=>r(62382));module.exports=o})();