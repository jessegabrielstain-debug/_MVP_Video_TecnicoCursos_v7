"use strict";(()=>{var e={};e.id=7821,e.ids=[7821],e.modules={220399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},430517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},351508:(e,t,o)=>{o.r(t),o.d(t,{originalPathname:()=>h,patchFetch:()=>j,requestAsyncStorage:()=>f,routeModule:()=>g,serverHooks:()=>P,staticGenerationAsyncStorage:()=>x});var r={};o.r(r),o.d(r,{DELETE:()=>p,GET:()=>l,POST:()=>c});var s=o(349303),n=o(88716),a=o(60670),i=o(387070);!function(){var e=Error("Cannot find module '@/lib/pptx/pptx-core-parser'");throw e.code="MODULE_NOT_FOUND",e}();let u=new Map,d=new Map;async function c(e){try{let t=await e.formData(),o=t.get("file"),r=t.get("settings");if(!o)return i.NextResponse.json({error:"Arquivo PPTX n\xe3o fornecido"},{status:400});if(!o.name.toLowerCase().endsWith(".pptx"))return i.NextResponse.json({error:"Formato de arquivo inv\xe1lido. Apenas PPTX \xe9 suportado."},{status:400});let s=Buffer.from(await o.arrayBuffer()),n=`pptx_job_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,a={id:n,documentId:`pptx_doc_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"parse",status:"queued",progress:0,startedAt:new Date,settings:r?JSON.parse(r):{}};return u.set(n,a),console.log(`[PPTX API] Starting parse job ${n} for file: ${o.name}`),m(n,s,o.name).catch(e=>{console.error(`[PPTX API] Error processing ${n}:`,e);let t=u.get(n);t&&(t.status="failed",t.error=e.message,t.completedAt=new Date,u.set(n,t))}),i.NextResponse.json({success:!0,jobId:n,message:"Upload realizado com sucesso. Processamento iniciado.",estimatedTime:"30-60 segundos"})}catch(e){return console.error("[PPTX API] Upload error:",e),i.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function l(e){try{let{searchParams:t}=new URL(e.url),o=t.get("action"),r=t.get("jobId"),s=t.get("documentId");if("status"===o&&r){let e=u.get(r);if(!e)return i.NextResponse.json({error:"Job n\xe3o encontrado"},{status:404});return i.NextResponse.json({job:e,document:"completed"===e.status?d.get(e.documentId):null})}if("document"===o&&s){let e=d.get(s);if(!e)return i.NextResponse.json({error:"Documento n\xe3o encontrado"},{status:404});return i.NextResponse.json({document:e})}if("list"===o){let e=t.get("status"),o=Array.from(u.values());e&&(o=o.filter(t=>t.status===e)),o.sort((e,t)=>t.startedAt.getTime()-e.startedAt.getTime());let r={total:u.size,queued:o.filter(e=>"queued"===e.status).length,processing:o.filter(e=>"processing"===e.status).length,completed:o.filter(e=>"completed"===e.status).length,failed:o.filter(e=>"failed"===e.status).length};return i.NextResponse.json({jobs:o,stats:r})}if("preview"===o&&r){let e=u.get(r);if(!e||"completed"!==e.status)return i.NextResponse.json({error:"Job n\xe3o encontrado ou n\xe3o completado"},{status:404});let t=d.get(e.documentId);if(!t)return i.NextResponse.json({error:"Documento n\xe3o encontrado"},{status:404});let o={id:t.id,title:t.title,slideCount:t.slides.length,author:t.author,createdAt:t.metadata.createdAt,slides:t.slides.slice(0,5).map(e=>({slideNumber:e.slideNumber,title:e.title,contentPreview:e.content.filter(e=>"text"===e.type).map(e=>"string"==typeof e.content?e.content.substring(0,100):"").join(" ").substring(0,200)+"..."}))};return i.NextResponse.json({preview:o})}return i.NextResponse.json({error:"A\xe7\xe3o n\xe3o especificada ou inv\xe1lida"},{status:400})}catch(e){return console.error("[PPTX API] GET error:",e),i.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function p(e){try{let{searchParams:t}=new URL(e.url),o=t.get("jobId"),r=t.get("documentId");if(o){let e=u.get(o);if(!e)return i.NextResponse.json({error:"Job n\xe3o encontrado"},{status:404});return"processing"===e.status?(e.status="cancelled",e.completedAt=new Date,u.set(o,e)):u.delete(o),console.log(`[PPTX API] Job ${o} cancelled/removed`),i.NextResponse.json({success:!0,message:"Job removido"})}if(r){if(!d.get(r))return i.NextResponse.json({error:"Documento n\xe3o encontrado"},{status:404});return d.delete(r),console.log(`[PPTX API] Document ${r} removed`),i.NextResponse.json({success:!0,message:"Documento removido"})}return i.NextResponse.json({error:"ID do job ou documento n\xe3o fornecido"},{status:400})}catch(e){return console.error("[PPTX API] DELETE error:",e),i.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function m(e,t,o){let r=u.get(e);if(!r)throw Error("Job n\xe3o encontrado");try{r.status="processing",r.progress=10,u.set(e,r);let s=Object(function(){var e=Error("Cannot find module '@/lib/pptx/pptx-core-parser'");throw e.code="MODULE_NOT_FOUND",e}())(e),n=await s.parseFile(t,o,t=>{r.progress=Math.round(10+80*t),u.set(e,r)});d.set(r.documentId,n),r.status="completed",r.progress=100,r.completedAt=new Date,r.result={outputUrl:`/api/pptx/document/${r.documentId}`,metadata:{slideCount:n.slides.length,title:n.title,author:n.author},stats:{slideCount:n.slides.length,elementCount:n.slides.reduce((e,t)=>e+t.content.length,0),imageCount:n.slides.reduce((e,t)=>e+t.content.filter(e=>"image"===e.type).length,0),animationCount:0,processingTime:Date.now()-r.startedAt.getTime(),outputSize:0}},u.set(e,r),console.log(`[PPTX API] Job ${e} completed successfully`)}catch(t){throw console.error(`[PPTX API] Processing error for job ${e}:`,t),r.status="failed",r.error=t.message,r.completedAt=new Date,u.set(e,r),t}}let g=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/pptx/route",pathname:"/api/pptx",filename:"route",bundlePath:"app/api/pptx/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\pptx\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:f,staticGenerationAsyncStorage:x,serverHooks:P}=g,h="/api/pptx/route";function j(){return(0,a.patchFetch)({serverHooks:P,staticGenerationAsyncStorage:x})}}};var t=require("../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),r=t.X(0,[8948,5972],()=>o(351508));module.exports=r})();