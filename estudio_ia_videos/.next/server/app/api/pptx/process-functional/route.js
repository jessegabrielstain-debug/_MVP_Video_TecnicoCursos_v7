"use strict";(()=>{var e={};e.id=6279,e.ids=[6279],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},20629:e=>{e.exports=require("fs/promises")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},72338:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>P,patchFetch:()=>v,requestAsyncStorage:()=>x,routeModule:()=>f,serverHooks:()=>y,staticGenerationAsyncStorage:()=>g});var s={};r.r(s),r.d(s,{GET:()=>h,POST:()=>m});var i=r(49303),a=r(88716),o=r(60670),n=r(87070),l=r(20629),d=r(92048),p=r(55315),u=r.n(p),c=r(73004);async function m(e){try{let{fileId:t,fileName:r}=await e.json();if(!t||!r)return n.NextResponse.json({error:"ID do arquivo e nome s\xe3o obrigat\xf3rios"},{status:400});let s=u().join(process.cwd(),"uploads","pptx"),i=u().join(s,r);if(!(0,d.existsSync)(i))return n.NextResponse.json({error:"Arquivo n\xe3o encontrado"},{status:404});let a=await (0,l.readFile)(i),o=new File([new Uint8Array(a)],r,{type:"application/vnd.openxmlformats-officedocument.presentationml.presentation"}),p=new c.R,m=await p.parseFile(o),h=p.convertToTimelineData(m),f={id:t,document:{title:m.title,author:m.author,slideCount:m.slideCount,totalDuration:m.totalDuration,createdDate:m.createdDate,theme:m.theme},slides:m.slides.map(e=>({id:e.id,slideNumber:e.slideNumber,title:e.title,content:e.content,duration:e.duration,imageCount:e.images.length,shapeCount:e.shapes.length,animationCount:e.animations.length})),timeline:h,statistics:{totalSlides:m.slideCount,totalDuration:m.totalDuration,averageSlideDuration:m.totalDuration/m.slideCount,totalWords:m.slides.reduce((e,t)=>e+t.content.join(" ").split(/\s+/).length,0),totalImages:m.slides.reduce((e,t)=>e+t.images.length,0),totalShapes:m.slides.reduce((e,t)=>e+t.shapes.length,0)},processedAt:new Date().toISOString()};return n.NextResponse.json({success:!0,message:"PPTX processado com sucesso",data:f})}catch(e){return console.error("Erro no processamento PPTX:",e),n.NextResponse.json({error:"Erro ao processar PPTX",details:e instanceof Error?e.message:String(e),stack:void 0},{status:500})}}async function h(){return n.NextResponse.json({message:"API de Processamento PPTX",description:"Processa arquivos PPTX e extrai conte\xfado para timeline",usage:{method:"POST",body:{fileId:"ID do arquivo",fileName:"Nome do arquivo salvo"}},features:["Extra\xe7\xe3o de slides e conte\xfado","An\xe1lise de texto e imagens","Gera\xe7\xe3o de timeline autom\xe1tica","C\xe1lculo de dura\xe7\xe3o estimada","Extra\xe7\xe3o de metadados"]})}let f=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/pptx/process-functional/route",pathname:"/api/pptx/process-functional",filename:"route",bundlePath:"app/api/pptx/process-functional/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\pptx\\process-functional\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:x,staticGenerationAsyncStorage:g,serverHooks:y}=f,P="/api/pptx/process-functional/route";function v(){return(0,o.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:g})}},73004:(e,t,r)=>{r.d(t,{R:()=>n});var s=r(89190),i=r.n(s),a=r(4096);let o={title:"Untitled Presentation",author:"Unknown"};class n{constructor(){this.xmlParser=new a.Z({ignoreAttributes:!1,attributeNamePrefix:"@_",allowBooleanAttributes:!0,parseAttributeValue:!0,trimValues:!0,cdataPropName:"__cdata"})}static async validatePPTX(e){try{let t=(await i().loadAsync(e)).file(/ppt\/presentation.xml/);if(!t||0===t.length)return!1;return!0}catch(e){return!1}}async parsePPTX(e){let t;let r=await i().loadAsync(e),s=r.file("docProps/core.xml"),a=o.title,n=o.author;if(s){let e=await s.async("string"),r=this.xmlParser.parse(e)["cp:coreProperties"];r&&(a=r["dc:title"]||a,n=r["dc:creator"]||n,t=r["dc:subject"])}let l=r.file(/ppt\/presentation.xml/)[0];if(!l)throw Error("presentation.xml not found in ppt/ directory");let d=await l.async("string"),p=this.xmlParser.parse(d),u=p["p:presentation"]?.["p:sldIdLst"]??p["p:presentation"]?.["p:slideIdLst"],c=(this.isRecord(u)?u["p:sldId"]??u["p:slideId"]:void 0)||[],m=this.toArray(c),h=[];if(m.length>0)for(let[e]of m.entries()){let t=e+1,s=`ppt/slides/slide${t}.xml`,i=r.file(s);if(i)try{let e=await i.async("string"),r=this.xmlParser.parse(e),s=this.extractText(r);h.push({title:s[0]||`Slide ${t}`,content:s.slice(1).join("\n"),notes:""})}catch(e){console.warn(`Failed to parse slide ${t}:`,e)}}return{metadata:{title:a,author:n,subject:t,slideCount:h.length},slides:h}}async parseFile(e){let t=Buffer.from(await e.arrayBuffer()),r=await this.parsePPTX(t);return{title:r.metadata.title,author:r.metadata.author,slideCount:r.metadata.slideCount,totalDuration:5*r.metadata.slideCount,createdDate:new Date,theme:"default",slides:r.slides.map((e,t)=>({id:`slide-${t+1}`,slideNumber:t+1,title:e.title,content:e.content?[e.content]:[],duration:5,images:[],shapes:[],animations:[]}))}}convertToTimelineData(e){return{tracks:[{id:"track-1",type:"video",clips:e.slides.map((e,t)=>({id:`clip-${e.id}`,start:5*t,duration:5,content:e}))}]}}extractText(e){let t=[];if(!this.isRecord(e))return t;let r=this.getNested(e,["p:sld","p:cSld","p:spTree"]);if(!this.isRecord(r))return t;for(let e of this.toArray(r["p:sp"])){if(!this.isRecord(e))continue;let r=this.isRecord(e["p:txBody"])?e["p:txBody"]:void 0;if(r){for(let e of this.toArray(r["a:p"]))if(this.isRecord(e))for(let r of this.toArray(e["a:r"])){if(!this.isRecord(r))continue;let e=r["a:t"];"string"==typeof e||"number"==typeof e?t.push(String(e)):this.isRecord(e)&&"string"==typeof e.__cdata&&t.push(e.__cdata)}}}return t}isRecord(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}toArray(e){return void 0===e?[]:Array.isArray(e)?e:[e]}getNested(e,t){return t.reduce((e,t)=>{if(this.isRecord(e))return e[t]},e)}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972,9190,4096],()=>r(72338));module.exports=s})();