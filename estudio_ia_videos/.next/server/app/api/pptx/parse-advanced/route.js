"use strict";(()=>{var e={};e.id=2646,e.ids=[2646,3474],e.modules={453524:e=>{e.exports=require("@prisma/client")},572934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},554580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},345869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},220399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},430517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},627790:e=>{e.exports=require("assert")},978893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},532615:e=>{e.exports=require("http")},735240:e=>{e.exports=require("https")},986624:e=>{e.exports=require("querystring")},917360:e=>{e.exports=require("url")},521764:e=>{e.exports=require("util")},671568:e=>{e.exports=require("zlib")},339901:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>v,patchFetch:()=>O,requestAsyncStorage:()=>x,routeModule:()=>g,serverHooks:()=>f,staticGenerationAsyncStorage:()=>h});var a={};r.r(a),r.d(a,{GET:()=>m,POST:()=>c});var o=r(349303),s=r(88716),i=r(60670),n=r(387070),d=r(95715),u=r(303474);let l=require("sharp");var p=r.n(l);async function c(e){try{let t=await (0,d.getServerSession)(Object(function(){var e=Error("Cannot find module '@/lib/auth/auth-config'");throw e.code="MODULE_NOT_FOUND",e}()));if(!t?.user?.id)return n.NextResponse.json({error:"N\xe3o autenticado"},{status:401});let r=(await e.formData()).get("file");if(!r)return n.NextResponse.json({error:"Arquivo n\xe3o enviado"},{status:400});if(!r.name.endsWith(".pptx"))return n.NextResponse.json({error:"Arquivo deve ser .pptx"},{status:400});let a=await r.arrayBuffer(),o=Buffer.from(a);console.log(`ðŸ” Iniciando parsing avan\xe7ado de: ${r.name} (${o.length} bytes)`);let s=await Object(function(){var e=Error("Cannot find module '@/lib/pptx-parser-advanced'");throw e.code="MODULE_NOT_FOUND",e}())(o);console.log(`âœ… Parsing conclu\xeddo: ${s.slides.length} slides, ${s.images.length} imagens`);let i=process.env.AWS_FOLDER_PREFIX||"",l=`${i}pptx/${Date.now()}-${r.name}`,c=await Object(function(){var e=Error("Cannot find module '@/lib/s3'");throw e.code="MODULE_NOT_FOUND",e}())(o,l),m={slides:s.slides.map(e=>({slideNumber:e.slideNumber,title:e.title,content:e.content,notes:e.notes,layout:e.layout,imageCount:e.images.length})),metadata:{title:s.metadata.title,author:s.metadata.author,subject:s.metadata.subject,created:s.metadata.created,modified:s.metadata.modified,slideCount:s.metadata.slideCount},parsedAt:new Date().toISOString()},g=await u.prisma.project.create({data:{name:s.metadata.title||r.name,description:s.metadata.subject||"",userId:t.user.id,type:"presentation",status:"DRAFT",pptxUrl:c,originalFileName:r.name,totalSlides:s.slides.length,slidesData:m}}),x={},h=[];for(let e of s.images)try{let t=await p()(e.data).resize(1920,1080,{fit:"inside",withoutEnlargement:!0}).jpeg({quality:85,progressive:!0}).toBuffer(),r=`${i}pptx-images/${g.id}/${e.name}`,a=await Object(function(){var e=Error("Cannot find module '@/lib/s3'");throw e.code="MODULE_NOT_FOUND",e}())(t,r,"image/jpeg"),o=await p()(t).metadata();x[e.id]=a,h.push({id:e.id,name:e.name,url:a,width:o.width||0,height:o.height||0,size:t.length}),console.log(`âœ… Imagem otimizada: ${e.name} -> ${a}`)}catch(a){console.error(`âŒ Erro ao processar imagem ${e.name}:`,a);let t=`${i}pptx-images/${g.id}/${e.name}`,r=await Object(function(){var e=Error("Cannot find module '@/lib/s3'");throw e.code="MODULE_NOT_FOUND",e}())(e.data,t);x[e.id]=r}return n.NextResponse.json({success:!0,projectId:g.id,metadata:s.metadata,slides:s.slides.map(e=>({slideNumber:e.slideNumber,title:e.title,content:e.content,notes:e.notes,layout:e.layout,imageCount:e.images.length})),imageUrls:x,processedImages:h,s3Url:c,stats:{totalSlides:s.slides.length,totalImages:s.images.length,processedImages:h.length,fileSize:o.length}})}catch(e){return console.error("[API] Erro ao parsear PPTX:",e),n.NextResponse.json({error:"Erro ao processar PPTX",details:e instanceof Error?e.message:"Erro desconhecido"},{status:500})}}async function m(e){try{let t=await (0,d.getServerSession)(Object(function(){var e=Error("Cannot find module '@/lib/auth/auth-config'");throw e.code="MODULE_NOT_FOUND",e}()));if(!t?.user?.id)return n.NextResponse.json({error:"N\xe3o autenticado"},{status:401});let{searchParams:r}=new URL(e.url),a=r.get("projectId");if(!a)return n.NextResponse.json({error:"projectId obrigat\xf3rio"},{status:400});let o=await u.prisma.project.findUnique({where:{id:a,userId:t.user.id}});if(!o)return n.NextResponse.json({error:"Projeto n\xe3o encontrado"},{status:404});return n.NextResponse.json({success:!0,project:{id:o.id,name:o.name,description:o.description,slidesData:o.slidesData,totalSlides:o.totalSlides,pptxUrl:o.pptxUrl,originalFileName:o.originalFileName,createdAt:o.createdAt}})}catch(e){return console.error("[API] Erro ao buscar projeto:",e),n.NextResponse.json({error:"Erro ao buscar projeto"},{status:500})}}(function(){var e=Error("Cannot find module '@/lib/auth/auth-config'");throw e.code="MODULE_NOT_FOUND",e})(),function(){var e=Error("Cannot find module '@/lib/pptx-parser-advanced'");throw e.code="MODULE_NOT_FOUND",e}(),function(){var e=Error("Cannot find module '@/lib/s3'");throw e.code="MODULE_NOT_FOUND",e}();let g=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/pptx/parse-advanced/route",pathname:"/api/pptx/parse-advanced",filename:"route",bundlePath:"app/api/pptx/parse-advanced/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\pptx\\parse-advanced\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:x,staticGenerationAsyncStorage:h,serverHooks:f}=g,v="/api/pptx/parse-advanced/route";function O(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:h})}},303474:(e,t,r)=>{r.d(t,{prisma:()=>o});var a=r(453524);let o=global.prisma||new a.PrismaClient({log:["query"]})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[8948,5972,5715],()=>r(339901));module.exports=a})();