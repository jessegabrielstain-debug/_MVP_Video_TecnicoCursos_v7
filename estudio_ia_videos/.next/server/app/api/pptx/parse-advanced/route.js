"use strict";(()=>{var e={};e.id=2646,e.ids=[2646,3936],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},57441:e=>{e.exports=require("sharp")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},9326:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>S,patchFetch:()=>N,requestAsyncStorage:()=>j,routeModule:()=>f,serverHooks:()=>y,staticGenerationAsyncStorage:()=>v});var r={};a.r(r),a.d(r,{GET:()=>I,POST:()=>x});var s=a(49303),o=a(88716),i=a(60670),n=a(87070),l=a(13936),d=a(39953);class p{async upload(e){let{bucket:t,key:a}=e;return console.log(`[S3] Uploading to ${t}/${a}`),`https://storage.example.com/${t}/${a}`}async download(e,t){return console.log(`[S3] Downloading from ${e}/${t}`),Buffer.from("")}async delete(e,t){return console.log(`[S3] Deleting ${e}/${t}`),!0}async exists(e,t){return!1}}let u=new p;async function c(e,t,a,r){return u.upload({bucket:e,key:t,body:a,contentType:r})}var m=a(57441),g=a.n(m);let h=process.env.S3_BUCKET_NAME||"pptx-uploads";async function x(e){try{let t=(0,l.getSupabaseForRequest)(e),{data:{user:a},error:r}=await t.auth.getUser();if(r||!a)return n.NextResponse.json({error:"N\xe3o autenticado"},{status:401});let s=(await e.formData()).get("file");if(!s)return n.NextResponse.json({error:"Arquivo n\xe3o enviado"},{status:400});if(!s.name.endsWith(".pptx"))return n.NextResponse.json({error:"Arquivo deve ser .pptx"},{status:400});let o=await s.arrayBuffer(),i=Buffer.from(o);console.log(`ðŸ” Iniciando parsing avan\xe7ado de: ${s.name} (${i.length} bytes)`);let p=await (0,d.o9)(i);console.log(`âœ… Parsing conclu\xeddo: ${p.slides.length} slides, ${p.images.length} imagens`);let u=process.env.AWS_FOLDER_PREFIX||"",m=`${u}pptx/${Date.now()}-${s.name}`,x=await c(h,m,i),I={slides:p.slides.map(e=>({slideNumber:e.slideNumber,title:e.title,content:e.content,notes:e.notes,layout:e.layout,imageCount:e.images.length})),metadata:{title:p.metadata.title,author:p.metadata.author,subject:p.metadata.subject,created:p.metadata.created?new Date(p.metadata.created).toISOString():null,modified:p.metadata.modified?new Date(p.metadata.modified).toISOString():null,slideCount:p.metadata.slideCount},parsedAt:new Date().toISOString()},{data:f,error:j}=await t.from("projects").insert({name:p.metadata.title||s.name,description:p.metadata.subject||"",user_id:a.id,type:"pptx",status:"draft",metadata:{pptxUrl:x,originalFileName:s.name,totalSlides:p.slides.length,slidesData:I}}).select().single();if(j||!f)throw Error(`Erro ao criar projeto: ${j?.message}`);let v={},y=[];for(let e of p.images)try{let t=await g()(e.data).resize(1920,1080,{fit:"inside",withoutEnlargement:!0}).jpeg({quality:85,progressive:!0}).toBuffer(),a=`${u}pptx-images/${f.id}/${e.name}`,r=await c(h,a,t,"image/jpeg"),s=await g()(t).metadata();v[e.id]=r,y.push({id:e.id,name:e.name,url:r,width:s.width||0,height:s.height||0,size:t.length}),console.log(`âœ… Imagem otimizada: ${e.name} -> ${r}`)}catch(r){console.error(`âŒ Erro ao processar imagem ${e.name}:`,r);let t=`${u}pptx-images/${f.id}/${e.name}`,a=await c(h,t,e.data);v[e.id]=a}return n.NextResponse.json({success:!0,projectId:f.id,metadata:p.metadata,slides:p.slides.map(e=>({slideNumber:e.slideNumber,title:e.title,content:e.content,notes:e.notes,layout:e.layout,imageCount:e.images.length})),imageUrls:v,processedImages:y,s3Url:x,stats:{totalSlides:p.slides.length,totalImages:p.images.length,processedImages:y.length,fileSize:i.length}})}catch(e){return console.error("[API] Erro ao parsear PPTX:",e),n.NextResponse.json({error:"Erro ao processar PPTX",details:e instanceof Error?e.message:"Erro desconhecido"},{status:500})}}async function I(e){try{let t=(0,l.getSupabaseForRequest)(e),{data:{user:a},error:r}=await t.auth.getUser();if(r||!a)return n.NextResponse.json({error:"N\xe3o autenticado"},{status:401});let{searchParams:s}=new URL(e.url),o=s.get("projectId");if(!o)return n.NextResponse.json({error:"projectId obrigat\xf3rio"},{status:400});let{data:i,error:d}=await t.from("projects").select("*").eq("id",o).eq("user_id",a.id).single();if(d||!i)return n.NextResponse.json({error:"Projeto n\xe3o encontrado"},{status:404});let p=i.metadata;return n.NextResponse.json({success:!0,project:{id:i.id,name:i.name,description:i.description,slidesData:p?.slidesData,totalSlides:p?.totalSlides,pptxUrl:p?.pptxUrl,originalFileName:p?.originalFileName,createdAt:i.created_at}})}catch(e){return console.error("[API] Erro ao buscar projeto:",e),n.NextResponse.json({error:"Erro ao buscar projeto"},{status:500})}}let f=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/pptx/parse-advanced/route",pathname:"/api/pptx/parse-advanced",filename:"route",bundlePath:"app/api/pptx/parse-advanced/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\pptx\\parse-advanced\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:j,staticGenerationAsyncStorage:v,serverHooks:y}=f,S="/api/pptx/parse-advanced/route";function N(){return(0,i.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:v})}},39953:(e,t,a)=>{a.d(t,{h$:()=>r,o9:()=>o});class r{async parse(e){return console.log("[PPTX Parser] Parsing presentation"),{slides:[],metadata:{slideCount:0},images:[]}}async extractImages(e){return[]}}let s=new r;async function o(e){return s.parse(e)}},13936:(e,t,a)=>{a.d(t,{e:()=>i,getSupabaseForRequest:()=>l,p:()=>n});var r=a(67721),s=a(61657),o=a(71615);let i=()=>{let e=(0,o.cookies)();return(0,r.createServerClient)("https://ofhzrdiadxigrvmrhaiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ",{cookies:{get:t=>e.get(t)?.value,set(t,a,r){try{e.set({name:t,value:a,...r})}catch(e){}},remove(t,a){try{e.set({name:t,value:"",...a})}catch(e){}}}})},n=(0,s.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}});function l(e){let t=e.headers.get("authorization")||e.headers.get("Authorization");return t?(0,s.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ",{global:{headers:{Authorization:t}},auth:{persistSession:!1,autoRefreshToken:!1}}):i()}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[8948,5972,1657,9702],()=>a(9326));module.exports=r})();