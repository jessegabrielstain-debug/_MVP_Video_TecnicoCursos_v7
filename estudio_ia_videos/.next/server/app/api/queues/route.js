"use strict";(()=>{var e={};e.id=4077,e.ids=[4077],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},46513:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>q,requestAsyncStorage:()=>h,routeModule:()=>f,serverHooks:()=>_,staticGenerationAsyncStorage:()=>x});var a={};r.r(a),r.d(a,{GET:()=>l,dynamic:()=>d,revalidate:()=>p});var s=r(49303),o=r(88716),i=r(60670),n=r(87070),u=r(61657);let d="force-dynamic",p=0,c=process.env.SUPABASE_SERVICE_ROLE_KEY;async function l(e){try{let t=e.headers.get("authorization");if(!t)return n.NextResponse.json({error:"Unauthorized"},{status:401});let r=(0,u.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co",c,{global:{headers:{Authorization:t}}}),{data:{user:a}}=await r.auth.getUser();if(!a)return n.NextResponse.json({error:"Unauthorized"},{status:401});let{data:s}=await r.from("user_roles").select("role:roles(name)").eq("user_id",a.id).single();if(!s||"admin"!==s.role.name)return n.NextResponse.json({error:"Forbidden"},{status:403});let{count:o}=await r.from("render_jobs").select("*",{count:"exact",head:!0}).eq("status","queued"),{count:i}=await r.from("render_jobs").select("*",{count:"exact",head:!0}).eq("status","processing"),{count:d}=await r.from("render_jobs").select("*",{count:"exact",head:!0}).eq("status","completed"),{count:p}=await r.from("render_jobs").select("*",{count:"exact",head:!0}).eq("status","failed"),{data:l}=await r.from("render_jobs").select("*").order("created_at",{ascending:!1}).limit(50),f=l?.filter(e=>"queued"===e.status)||[],h=l?.filter(e=>"processing"===e.status)||[],x=l?.filter(e=>"completed"===e.status)||[],_=l?.filter(e=>"failed"===e.status)||[];return n.NextResponse.json({stats:{waiting:o||0,active:i||0,completed:d||0,failed:p||0,delayed:0,total:(o||0)+(i||0)+(d||0)+(p||0)},jobs:{waiting:f.map(m),active:h.map(m),completed:x.map(m),failed:_.map(m)}})}catch(e){return console.error("Error fetching queue data:",e),n.NextResponse.json({error:"Internal Server Error"},{status:500})}}function m(e){return{id:e.id,name:"render-video",data:{projectId:e.project_id,userId:e.user_id},progress:e.progress,attemptsMade:e.attempts||0,timestamp:new Date(e.created_at).getTime(),processedOn:e.started_at?new Date(e.started_at).getTime():void 0,finishedOn:e.completed_at?new Date(e.completed_at).getTime():void 0,failedReason:e.error_message}}let f=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/queues/route",pathname:"/api/queues",filename:"route",bundlePath:"app/api/queues/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\queues\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:h,staticGenerationAsyncStorage:x,serverHooks:_}=f,g="/api/queues/route";function q(){return(0,i.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:x})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[8948,5972,1657],()=>r(46513));module.exports=a})();