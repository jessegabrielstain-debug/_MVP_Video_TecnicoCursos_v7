(()=>{var e={};e.id=2603,e.ids=[2603],e.modules={150673:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=150673,e.exports=t},636372:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=636372,e.exports=t},367696:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=367696,e.exports=t},768626:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=768626,e.exports=t},220399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},430517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},532615:e=>{"use strict";e.exports=require("http")},735240:e=>{"use strict";e.exports=require("https")},768621:e=>{"use strict";e.exports=require("punycode")},276162:e=>{"use strict";e.exports=require("stream")},917360:e=>{"use strict";e.exports=require("url")},671568:e=>{"use strict";e.exports=require("zlib")},559816:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>E,patchFetch:()=>D,requestAsyncStorage:()=>v,routeModule:()=>O,serverHooks:()=>y,staticGenerationAsyncStorage:()=>x});var o={};r.r(o),r.d(o,{GET:()=>g,POST:()=>m});var i=r(349303),n=r(88716),a=r(60670),s=r(387070),u=r(691585),l=r(326033),c=r(366763);(function(){var e=Error("Cannot find module '@/lib/pipeline/integrated-pipeline'");throw e.code="MODULE_NOT_FOUND",e})(),function(){var e=Error("Cannot find module '@/lib/logger'");throw e.code="MODULE_NOT_FOUND",e}();let d=Object(function(){var e=Error("Cannot find module '@/lib/logger'");throw e.code="MODULE_NOT_FOUND",e}())("PipelineAPI"),p=u.Ry({text:u.Z_().min(1).max(1e4),voice_config:u.Ry({engine:u.Km(["elevenlabs","google","azure","aws"]),voice_id:u.Z_(),settings:u.IM(u.Yj()).optional()}),avatar_config:u.Ry({model_url:u.Z_().url(),animations:u.IX(u.Z_()).optional(),materials:u.IX(u.Yj()).optional(),lighting:u.Yj().optional(),camera:u.Yj().optional(),environment:u.Yj().optional()}),render_settings:u.Ry({width:u.Rx().min(480).max(4096),height:u.Rx().min(360).max(2160),fps:u.Rx().min(15).max(60),quality:u.Km(["low","medium","high","ultra"]),format:u.Km(["webm","mp4","gif"]),duration_limit:u.Rx().optional()}),options:u.Ry({cache_enabled:u.O7().optional(),priority_processing:u.O7().optional(),quality_optimization:u.O7().optional(),real_time_preview:u.O7().optional()}).optional()}),_=u.Km(["low","normal","high","urgent"]);async function m(e){try{let t=(0,c.createClient)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.SUPABASE_SERVICE_ROLE_KEY),r=e.headers.get("authorization");if(!r?.startsWith("Bearer "))return s.NextResponse.json({error:"Token de autoriza\xe7\xe3o necess\xe1rio"},{status:401});let o=r.split(" ")[1],{data:{user:i},error:n}=await t.auth.getUser(o);if(n||!i)return s.NextResponse.json({error:"Token inv\xe1lido"},{status:401});let a=await e.json(),u=p.parse(a.input),l=a.priority?_.parse(a.priority):"normal",m=await h(i.id,t);if(!m.canProcess)return s.NextResponse.json({error:"Limite de processamento atingido",details:m},{status:429});let g=await Object(function(){var e=Error("Cannot find module '@/lib/pipeline/integrated-pipeline'");throw e.code="MODULE_NOT_FOUND",e}()).createJob(i.id,u,l);return d.info("Pipeline job created via API",{jobId:g,userId:i.id,priority:l,textLength:u.text.length,engine:u.voice_config.engine,quality:u.render_settings.quality}),await t.from("api_logs").insert({endpoint:"/api/pipeline",method:"POST",user_id:i.id,request_data:{job_id:g,text_length:u.text.length,engine:u.voice_config.engine,priority:l},response_status:201,created_at:new Date().toISOString()}),s.NextResponse.json({success:!0,job_id:g,status:"queued",message:"Job criado com sucesso no pipeline",estimated_completion:new Date(Date.now()+3e4).toISOString(),queue_position:Object(function(){var e=Error("Cannot find module '@/lib/pipeline/integrated-pipeline'");throw e.code="MODULE_NOT_FOUND",e}()).getQueueStatus().queued_jobs},{status:201})}catch(e){if(d.error("Pipeline creation failed",{error:e}),e instanceof l.jm)return s.NextResponse.json({error:"Dados de entrada inv\xe1lidos",details:e.errors},{status:400});return s.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function g(e){try{let t=(0,c.createClient)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.SUPABASE_SERVICE_ROLE_KEY),r=e.headers.get("authorization");if(!r?.startsWith("Bearer "))return s.NextResponse.json({error:"Token de autoriza\xe7\xe3o necess\xe1rio"},{status:401});let o=r.split(" ")[1],{data:{user:i},error:n}=await t.auth.getUser(o);if(n||!i)return s.NextResponse.json({error:"Token inv\xe1lido"},{status:401});let a=Object(function(){var e=Error("Cannot find module '@/lib/pipeline/integrated-pipeline'");throw e.code="MODULE_NOT_FOUND",e}()).getQueueStatus(),u=await b(i.id,t),l=await j(i.id,t)?await w(t):null;return s.NextResponse.json({success:!0,queue_status:a,user_stats:u,general_stats:l,timestamp:new Date().toISOString()})}catch(e){return d.error("Failed to get pipeline status",{error:e}),s.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function h(e,t){try{let{data:r}=await t.from("pipeline_jobs").select("job_id").eq("user_id",e).in("status",["queued","processing"]),o=new Date(Date.now()-864e5).toISOString(),{data:i}=await t.from("pipeline_jobs").select("job_id").eq("user_id",e).gte("created_at",o),{data:n}=await t.from("user_profiles").select("plan, limits").eq("user_id",e).single(),a=n?.plan||"free",s=n?.limits||f(a);return{canProcess:(r?.length||0)<s.concurrent_jobs&&(i?.length||0)<s.daily_jobs,activeJobs:r?.length||0,recentJobs:i?.length||0,limits:s,plan:a}}catch(t){return d.error("Failed to check user limits",{userId:e,error:t}),{canProcess:!0,activeJobs:0,recentJobs:0,limits:f("free"),plan:"free"}}}function f(e){let t={free:{concurrent_jobs:1,daily_jobs:10,max_duration:60},basic:{concurrent_jobs:2,daily_jobs:50,max_duration:300},pro:{concurrent_jobs:5,daily_jobs:200,max_duration:1800},enterprise:{concurrent_jobs:10,daily_jobs:1e3,max_duration:3600}};return t[e]||t.free}async function b(e,t){try{let r=new Date(Date.now()-864e5).toISOString(),o=new Date(Date.now()-6048e5).toISOString(),{data:i}=await t.from("pipeline_jobs").select("status").eq("user_id",e),{data:n}=await t.from("pipeline_jobs").select("*").eq("user_id",e).gte("created_at",r).order("created_at",{ascending:!1}).limit(10),{data:a}=await t.from("pipeline_jobs").select("created_at, completed_at").eq("user_id",e).eq("status","completed").gte("created_at",o),s=a?.length?a.reduce((e,t)=>{let r=new Date(t.created_at).getTime(),o=new Date(t.completed_at).getTime();return e+(o-r)},0)/a.length:0,u=i?.reduce((e,t)=>(e[t.status]=(e[t.status]||0)+1,e),{})||{};return{total_jobs:i?.length||0,jobs_by_status:u,recent_jobs:n||[],average_processing_time:Math.round(s),success_rate:u.completed?u.completed/(i?.length||1)*100:0}}catch(t){return d.error("Failed to get user stats",{userId:e,error:t}),{total_jobs:0,jobs_by_status:{},recent_jobs:[],average_processing_time:0,success_rate:0}}}async function j(e,t){try{let{data:r}=await t.from("user_profiles").select("role").eq("user_id",e).single();return r?.role==="admin"}catch{return!1}}async function w(e){try{let t=new Date(Date.now()-864e5).toISOString(),{count:r}=await e.from("pipeline_jobs").select("*",{count:"exact",head:!0}),{count:o}=await e.from("pipeline_jobs").select("*",{count:"exact",head:!0}).gte("created_at",t),{data:i}=await e.from("pipeline_jobs").select("input_data").gte("created_at",t),n=i?.reduce((e,t)=>{let r=t.input_data?.voice_config?.engine||"unknown";return e[r]=(e[r]||0)+1,e},{})||{},{data:a}=await e.from("pipeline_jobs").select("output_data").eq("status","completed").gte("created_at",t),s=a?.length?a.reduce((e,t)=>e+(t.output_data?.processing_stats?.total_time||0),0)/a.length:0;return{total_jobs:r||0,recent_jobs:o||0,jobs_by_engine:n,average_performance:Math.round(s),system_health:"healthy"}}catch(e){return d.error("Failed to get general stats",{error:e}),{total_jobs:0,recent_jobs:0,jobs_by_engine:{},average_performance:0,system_health:"unknown"}}}let O=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/pipeline/route",pathname:"/api/pipeline",filename:"route",bundlePath:"app/api/pipeline/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\pipeline\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:v,staticGenerationAsyncStorage:x,serverHooks:y}=O,E="/api/pipeline/route";function D(){return(0,a.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:x})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[8948,5972,6763,1585],()=>r(559816));module.exports=o})();