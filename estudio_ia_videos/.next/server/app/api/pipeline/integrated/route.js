"use strict";(()=>{var e={};e.id=1537,e.ids=[1537],e.modules={220399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},430517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},431176:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>h,patchFetch:()=>x,requestAsyncStorage:()=>m,routeModule:()=>g,serverHooks:()=>j,staticGenerationAsyncStorage:()=>b});var r={};s.r(r),s.d(r,{GET:()=>l,POST:()=>p,PUT:()=>d});var o=s(349303),a=s(88716),n=s(60670),i=s(387070);class u{static getInstance(){return this.instance||(this.instance=new u),this.instance}logEvent(e,t){console.log(`ðŸ“Š [${e}]`,t)}}class c{static getInstance(){return this.instance||(this.instance=new c),this.instance}async createJob(e,t,s){let r=`job_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o={id:r,userId:e,text:t,config:s,status:"queued",progress:0,results:null,error:null,createdAt:new Date,updatedAt:new Date,estimatedDuration:3e4,actualDuration:null};return this.jobs.set(r,o),r}async processJob(e){let t=this.jobs.get(e);if(!t)throw Error("Job not found");return t.status="processing",t.progress=50,t.updatedAt=new Date,await new Promise(e=>setTimeout(e,2e3)),t.status="completed",t.progress=100,t.results={audioUrl:`/api/audio/generated/${e}.mp3`,videoUrl:`/api/video/generated/${e}.mp4`,duration:5e3},t.actualDuration=2e3,t.updatedAt=new Date,t.results}getJob(e){return this.jobs.get(e)||null}getJobsByUser(e){return Array.from(this.jobs.values()).filter(t=>t.userId===e)}getStats(){let e=Array.from(this.jobs.values());return{totalJobs:e.length,completedJobs:e.filter(e=>"completed"===e.status).length,failedJobs:e.filter(e=>"failed"===e.status).length,queuedJobs:e.filter(e=>"queued"===e.status).length,processingJobs:e.filter(e=>"processing"===e.status).length,averageProcessingTime:25e3}}constructor(){this.jobs=new Map}}async function p(e){let t=u.getInstance(),s=Date.now();try{let{text:r,config:o={},userId:a,processImmediately:n=!1}=await e.json();if(!r||"string"!=typeof r)return i.NextResponse.json({error:"Texto \xe9 obrigat\xf3rio e deve ser uma string"},{status:400});if(!a)return i.NextResponse.json({error:"userId \xe9 obrigat\xf3rio"},{status:400});t.logEvent("pipeline_integrated_request",{userId:a,textLength:r.length,processImmediately:n,config:o});let u=c.getInstance(),p=await u.createJob(a,r,o);if(!n)return i.NextResponse.json({success:!0,data:{jobId:p,status:"queued",message:"Job criado e adicionado \xe0 fila de processamento"}});try{let e=await u.processJob(p);return t.logEvent("pipeline_integrated_success",{userId:a,jobId:p,processingTime:Date.now()-s,results:e}),i.NextResponse.json({success:!0,data:{jobId:p,status:"completed",results:e,processingTime:Date.now()-s}})}catch(e){return t.logEvent("pipeline_integrated_processing_error",{userId:a,jobId:p,error:e.message,processingTime:Date.now()-s}),i.NextResponse.json({error:"Erro no processamento do pipeline",message:e.message,jobId:p,code:"PIPELINE_PROCESSING_ERROR"},{status:500})}}catch(e){return t.logEvent("pipeline_integrated_error",{error:e.message,stack:e.stack,processingTime:Date.now()-s}),console.error("Erro no pipeline integrado:",e),i.NextResponse.json({error:"Erro interno do servidor",message:e.message,code:"PIPELINE_INTEGRATED_ERROR"},{status:500})}}async function l(e){try{let{searchParams:t}=new URL(e.url),s=t.get("action"),r=t.get("jobId"),o=t.get("userId"),a=c.getInstance();switch(s){case"status":if(!r)return i.NextResponse.json({error:"jobId \xe9 obrigat\xf3rio para consultar status"},{status:400});let n=a.getJob(r);if(!n)return i.NextResponse.json({error:"Job n\xe3o encontrado"},{status:404});return i.NextResponse.json({success:!0,data:{jobId:n.id,status:n.status,progress:n.progress,results:n.results,error:n.error,createdAt:n.createdAt,updatedAt:n.updatedAt,estimatedDuration:n.estimatedDuration,actualDuration:n.actualDuration}});case"user-jobs":if(!o)return i.NextResponse.json({error:"userId \xe9 obrigat\xf3rio para consultar jobs do usu\xe1rio"},{status:400});let u=a.getJobsByUser(o);return i.NextResponse.json({success:!0,data:{jobs:u,total:u.length}});case"stats":let p=a.getStats();return i.NextResponse.json({success:!0,data:p});default:return i.NextResponse.json({error:"A\xe7\xe3o n\xe3o reconhecida. Use: status, user-jobs, ou stats"},{status:400})}}catch(e){return console.error("Erro ao consultar pipeline:",e),i.NextResponse.json({error:"Erro ao consultar pipeline",message:e.message},{status:500})}}async function d(e){try{let{jobId:t,action:s}=await e.json();if(!t)return i.NextResponse.json({error:"jobId \xe9 obrigat\xf3rio"},{status:400});let r=c.getInstance();switch(s){case"process":try{let e=await r.processJob(t);return i.NextResponse.json({success:!0,data:{jobId:t,status:"completed",results:e}})}catch(e){return i.NextResponse.json({error:"Erro no processamento",message:e.message,jobId:t},{status:500})}case"cancel":if(!await r.cancelJob(t))return i.NextResponse.json({error:"Job n\xe3o pode ser cancelado ou n\xe3o foi encontrado"},{status:400});return i.NextResponse.json({success:!0,data:{jobId:t,status:"cancelled",message:"Job cancelado com sucesso"}});default:return i.NextResponse.json({error:"A\xe7\xe3o n\xe3o reconhecida. Use: process ou cancel"},{status:400})}}catch(e){return console.error("Erro ao atualizar job:",e),i.NextResponse.json({error:"Erro ao atualizar job",message:e.message},{status:500})}}let g=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/pipeline/integrated/route",pathname:"/api/pipeline/integrated",filename:"route",bundlePath:"app/api/pipeline/integrated/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\pipeline\\integrated\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:b,serverHooks:j}=g,h="/api/pipeline/integrated/route";function x(){return(0,n.patchFetch)({serverHooks:j,staticGenerationAsyncStorage:b})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[8948,5972],()=>s(431176));module.exports=r})();