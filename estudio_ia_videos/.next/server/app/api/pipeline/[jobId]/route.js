(()=>{var e={};e.id=4438,e.ids=[4438],e.modules={150673:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=150673,e.exports=t},636372:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=636372,e.exports=t},367696:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=367696,e.exports=t},768626:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=768626,e.exports=t},220399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},430517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},532615:e=>{"use strict";e.exports=require("http")},735240:e=>{"use strict";e.exports=require("https")},768621:e=>{"use strict";e.exports=require("punycode")},276162:e=>{"use strict";e.exports=require("stream")},917360:e=>{"use strict";e.exports=require("url")},671568:e=>{"use strict";e.exports=require("zlib")},866506:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>E,patchFetch:()=>b,requestAsyncStorage:()=>m,routeModule:()=>_,serverHooks:()=>f,staticGenerationAsyncStorage:()=>g});var o={};r.r(o),r.d(o,{DELETE:()=>l,GET:()=>p,PATCH:()=>c});var s=r(349303),i=r(88716),a=r(60670),n=r(387070),d=r(366763);(function(){var e=Error("Cannot find module '@/lib/pipeline/integrated-pipeline'");throw e.code="MODULE_NOT_FOUND",e})(),function(){var e=Error("Cannot find module '@/lib/logger'");throw e.code="MODULE_NOT_FOUND",e}();let u=Object(function(){var e=Error("Cannot find module '@/lib/logger'");throw e.code="MODULE_NOT_FOUND",e}())("PipelineJobAPI");async function p(e,{params:t}){try{let r=(0,d.createClient)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.SUPABASE_SERVICE_ROLE_KEY),o=e.headers.get("authorization");if(!o?.startsWith("Bearer "))return n.NextResponse.json({error:"Token de autoriza\xe7\xe3o necess\xe1rio"},{status:401});let s=o.split(" ")[1],{data:{user:i},error:a}=await r.auth.getUser(s);if(a||!i)return n.NextResponse.json({error:"Token inv\xe1lido"},{status:401});let{jobId:p}=t,l=await Object(function(){var e=Error("Cannot find module '@/lib/pipeline/integrated-pipeline'");throw e.code="MODULE_NOT_FOUND",e}()).getJobStatus(p);if(!l)return n.NextResponse.json({error:"Job n\xe3o encontrado"},{status:404});if(l.user_id!==i.id){let{data:e}=await r.from("user_profiles").select("role").eq("user_id",i.id).single();if(e?.role!=="admin")return n.NextResponse.json({error:"Acesso negado"},{status:403})}let c={success:!0,job:{id:l.id,status:l.status,priority:l.priority,progress:l.progress,created_at:l.created_at,started_at:l.started_at,completed_at:l.completed_at,error:l.error,metadata:{text_length:l.metadata.text_length,estimated_duration:l.metadata.estimated_duration,complexity_score:l.metadata.complexity_score,performance_target:l.metadata.performance_target}},output:l.output?{audio_url:l.output.audio_url,video_url:l.output.video_url,thumbnail_url:l.output.thumbnail_url,duration:l.output.duration,file_sizes:l.output.file_sizes,quality_metrics:l.output.quality_metrics,processing_stats:l.output.processing_stats}:null,timeline:function(e){let t=[];return t.push({stage:"created",timestamp:e.created_at,status:"completed",description:"Job criado e adicionado \xe0 fila"}),e.started_at&&t.push({stage:"started",timestamp:e.started_at,status:"completed",description:"Processamento iniciado"}),[{name:"tts",description:"Gera\xe7\xe3o de \xe1udio (TTS)"},{name:"lip_sync",description:"Processamento de sincroniza\xe7\xe3o labial"},{name:"avatar_render",description:"Renderiza\xe7\xe3o do avatar"},{name:"finalization",description:"Finaliza\xe7\xe3o e upload"}].forEach(r=>{let o=e.progress.stages_completed.includes(r.name),s=e.progress.stage===r.name;t.push({stage:r.name,timestamp:o?new Date().toISOString():null,status:o?"completed":s?"processing":"pending",description:r.description})}),e.completed_at&&t.push({stage:"completed",timestamp:e.completed_at,status:"completed"===e.status?"completed":"failed",description:"completed"===e.status?"Processamento conclu\xeddo com sucesso":`Processamento falhou: ${e.error}`}),t}(l),estimated_completion:"processing"===l.status?new Date(Date.now()+l.progress.estimated_remaining).toISOString():null};return u.info("Job status retrieved",{jobId:p,userId:i.id,status:l.status,progress:l.progress.percentage}),n.NextResponse.json(c)}catch(e){return u.error("Failed to get job status",{jobId:t.jobId,error:e}),n.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function l(e,{params:t}){try{let r=(0,d.createClient)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.SUPABASE_SERVICE_ROLE_KEY),o=e.headers.get("authorization");if(!o?.startsWith("Bearer "))return n.NextResponse.json({error:"Token de autoriza\xe7\xe3o necess\xe1rio"},{status:401});let s=o.split(" ")[1],{data:{user:i},error:a}=await r.auth.getUser(s);if(a||!i)return n.NextResponse.json({error:"Token inv\xe1lido"},{status:401});let{jobId:p}=t,l=await Object(function(){var e=Error("Cannot find module '@/lib/pipeline/integrated-pipeline'");throw e.code="MODULE_NOT_FOUND",e}()).getJobStatus(p);if(!l)return n.NextResponse.json({error:"Job n\xe3o encontrado"},{status:404});if(l.user_id!==i.id){let{data:e}=await r.from("user_profiles").select("role").eq("user_id",i.id).single();if(e?.role!=="admin")return n.NextResponse.json({error:"Acesso negado"},{status:403})}if(!["queued","processing"].includes(l.status))return n.NextResponse.json({error:"Job n\xe3o pode ser cancelado",details:`Status atual: ${l.status}`},{status:400});if(!await Object(function(){var e=Error("Cannot find module '@/lib/pipeline/integrated-pipeline'");throw e.code="MODULE_NOT_FOUND",e}()).cancelJob(p))return n.NextResponse.json({error:"Falha ao cancelar job"},{status:500});return u.info("Job cancelled",{jobId:p,userId:i.id,cancelledBy:i.id,previousStatus:l.status,stage:l.progress.stage}),await r.from("api_logs").insert({endpoint:`/api/pipeline/${p}`,method:"DELETE",user_id:i.id,request_data:{job_id:p,action:"cancel",previous_status:l.status},response_status:200,created_at:new Date().toISOString()}),n.NextResponse.json({success:!0,message:"Job cancelado com sucesso",job_id:p,previous_status:l.status,cancelled_at:new Date().toISOString()})}catch(e){return u.error("Failed to cancel job",{jobId:t.jobId,error:e}),n.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function c(e,{params:t}){try{let r=(0,d.createClient)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.SUPABASE_SERVICE_ROLE_KEY),o=e.headers.get("authorization");if(!o?.startsWith("Bearer "))return n.NextResponse.json({error:"Token de autoriza\xe7\xe3o necess\xe1rio"},{status:401});let s=o.split(" ")[1],{data:{user:i},error:a}=await r.auth.getUser(s);if(a||!i)return n.NextResponse.json({error:"Token inv\xe1lido"},{status:401});let{jobId:p}=t,l=await e.json();if(!l.priority||!["low","normal","high","urgent"].includes(l.priority))return n.NextResponse.json({error:"Prioridade inv\xe1lida"},{status:400});let c=await Object(function(){var e=Error("Cannot find module '@/lib/pipeline/integrated-pipeline'");throw e.code="MODULE_NOT_FOUND",e}()).getJobStatus(p);if(!c)return n.NextResponse.json({error:"Job n\xe3o encontrado"},{status:404});if(c.user_id!==i.id){let{data:e}=await r.from("user_profiles").select("role").eq("user_id",i.id).single();if(e?.role!=="admin")return n.NextResponse.json({error:"Acesso negado"},{status:403})}if("queued"!==c.status)return n.NextResponse.json({error:"Prioridade s\xf3 pode ser alterada para jobs em fila",details:`Status atual: ${c.status}`},{status:400});return await r.from("pipeline_jobs").update({priority:l.priority,updated_at:new Date().toISOString()}).eq("job_id",p),u.info("Job priority updated",{jobId:p,userId:i.id,oldPriority:c.priority,newPriority:l.priority}),n.NextResponse.json({success:!0,message:"Prioridade atualizada com sucesso",job_id:p,old_priority:c.priority,new_priority:l.priority,updated_at:new Date().toISOString()})}catch(e){return u.error("Failed to update job priority",{jobId:t.jobId,error:e}),n.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}let _=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/pipeline/[jobId]/route",pathname:"/api/pipeline/[jobId]",filename:"route",bundlePath:"app/api/pipeline/[jobId]/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\pipeline\\[jobId]\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:f}=_,E="/api/pipeline/[jobId]/route";function b(){return(0,a.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:g})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[8948,5972,6763],()=>r(866506));module.exports=o})();