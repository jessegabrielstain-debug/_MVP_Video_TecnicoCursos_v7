"use strict";(()=>{var e={};e.id=4871,e.ids=[4871,3936],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},709:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>j,requestAsyncStorage:()=>g,routeModule:()=>m,serverHooks:()=>x,staticGenerationAsyncStorage:()=>I});var s={};r.r(s),r.d(s,{GET:()=>l,POST:()=>h});var a=r(49303),o=r(88716),i=r(60670),n=r(87070),u=r(91585),p=r(13936),c=r(61657);let d=u.Ry({name:u.Z_().min(1,"Nome \xe9 obrigat\xf3rio").max(255,"Nome muito longo"),description:u.Z_().optional(),type:u.Km(["pptx","template-nr","talking-photo","custom","ai-generated"]).default("custom"),metadata:u.Ry({priority:u.Km(["low","medium","high","urgent"]).optional(),tags:u.IX(u.Z_()).optional(),category:u.Z_().optional()}).optional(),settings:u.Ry({width:u.Rx().default(1920),height:u.Rx().default(1080),fps:u.Rx().default(30),duration:u.Rx().optional(),quality:u.Km(["low","medium","high"]).default("high"),format:u.Km(["mp4","mov","avi"]).default("mp4")}).optional()});async function l(e){try{let t,r,s;let a=e.headers.get("authorization")||e.headers.get("Authorization");if(a){t=(0,c.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ",{auth:{persistSession:!1,autoRefreshToken:!1}});let e=a.startsWith("Bearer ")?a.substring(7):a.startsWith("bearer ")?a.substring(7):a,{error:o}=await t.auth.setSession({access_token:e,refresh_token:"dummy"});if(o)return console.error("DEBUG: setSession error:",o),n.NextResponse.json({error:"Unauthorized",debug_error:"Session set failed",debug_details:o},{status:401});let i=await t.auth.getUser();r=i.data.user,s=i.error}else{t=(0,p.getSupabaseForRequest)(e);let a=await t.auth.getUser();r=a.data.user,s=a.error}if(s&&console.error("Projects API Auth Error:",s),!r)return n.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:o}=new URL(e.url),i=parseInt(o.get("page")||"1"),u=parseInt(o.get("limit")||"10"),d=o.get("status"),l=o.get("type"),h=o.get("search"),m=t.from("projects").select("*",{count:"exact"}).eq("user_id",r.id).order("updated_at",{ascending:!1});d&&(m=m.eq("status",d)),l&&["pptx","template-nr","talking-photo","custom","ai-generated"].includes(l)&&(m=m.eq("type",l)),h&&(m=m.ilike("name",`%${h}%`));let g=(i-1)*u,{data:I,count:x,error:f}=await m.range(g,g+u-1);if(f)throw f;let j={success:!0,data:I,pagination:{page:i,limit:u,total:x||0,pages:Math.ceil((x||0)/u)},filters:{status:d,type:l,search:h},timestamp:new Date().toISOString()};return n.NextResponse.json(j)}catch(e){return console.error("\uD83D\uDCA5 [PROJECTS-API] Erro ao listar projetos:",e),n.NextResponse.json({success:!1,error:"Erro interno do servidor",details:e instanceof Error?e.message:"Erro desconhecido",timestamp:new Date().toISOString()},{status:500})}}async function h(e){try{let t=(0,p.getSupabaseForRequest)(e),r=e.headers.get("authorization")||e.headers.get("Authorization"),s=r?.startsWith("Bearer ")?r.substring(7):r?.startsWith("bearer ")?r.substring(7):null;s&&await t.auth.setSession({access_token:s,refresh_token:"dummy"});let{data:{user:a}}=await t.auth.getUser();if(!a)return n.NextResponse.json({error:"Unauthorized"},{status:401});let o=await e.json(),i=d.safeParse(o);if(!i.success)return n.NextResponse.json({success:!1,error:"Dados inv\xe1lidos",details:i.error.errors,timestamp:new Date().toISOString()},{status:400});let u=i.data,{data:c,error:l}=await t.from("projects").insert({name:u.name,description:u.description||"",type:u.type,status:"draft",user_id:a.id,metadata:u.metadata||{},is_public:!1}).select("id, name, type, status").single();if(l){console.error("Error creating project:",l);let e=l.message||"Erro ao criar projeto";return n.NextResponse.json({success:!1,error:e,details:l},{status:400})}return n.NextResponse.json({success:!0,message:"Projeto criado com sucesso!",data:c,timestamp:new Date().toISOString()},{status:201})}catch(e){return console.error("\uD83D\uDCA5 [PROJECTS-API] Erro ao criar projeto:",e),n.NextResponse.json({success:!1,error:"Erro interno do servidor",details:e instanceof Error?e.message:"Erro desconhecido",timestamp:new Date().toISOString()},{status:500})}}let m=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/projects/route",pathname:"/api/projects",filename:"route",bundlePath:"app/api/projects/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\projects\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:I,serverHooks:x}=m,f="/api/projects/route";function j(){return(0,i.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:I})}},13936:(e,t,r)=>{r.d(t,{e:()=>i,getSupabaseForRequest:()=>u,p:()=>n});var s=r(67721),a=r(61657),o=r(71615);let i=()=>{let e=(0,o.cookies)();return(0,s.createServerClient)("https://ofhzrdiadxigrvmrhaiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ",{cookies:{get:t=>e.get(t)?.value,set(t,r,s){try{e.set({name:t,value:r,...s})}catch(e){}},remove(t,r){try{e.set({name:t,value:"",...r})}catch(e){}}}})},n=(0,a.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}});function u(e){let t=e.headers.get("authorization")||e.headers.get("Authorization");return t?(0,a.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ",{global:{headers:{Authorization:t}},auth:{persistSession:!1,autoRefreshToken:!1}}):i()}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972,1657,9702,1585],()=>r(709));module.exports=s})();