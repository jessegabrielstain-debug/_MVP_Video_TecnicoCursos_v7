(()=>{var e={};e.id=1403,e.ids=[1403],e.modules={150673:e=>{function r(e){var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}r.keys=()=>[],r.resolve=r,r.id=150673,e.exports=r},636372:e=>{function r(e){var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}r.keys=()=>[],r.resolve=r,r.id=636372,e.exports=r},367696:e=>{function r(e){var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}r.keys=()=>[],r.resolve=r,r.id=367696,e.exports=r},768626:e=>{function r(e){var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}r.keys=()=>[],r.resolve=r,r.id=768626,e.exports=r},572934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},554580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},345869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},220399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},430517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},532615:e=>{"use strict";e.exports=require("http")},735240:e=>{"use strict";e.exports=require("https")},768621:e=>{"use strict";e.exports=require("punycode")},276162:e=>{"use strict";e.exports=require("stream")},917360:e=>{"use strict";e.exports=require("url")},671568:e=>{"use strict";e.exports=require("zlib")},517291:(e,r,t)=>{"use strict";t.r(r),t.d(r,{originalPathname:()=>j,patchFetch:()=>g,requestAsyncStorage:()=>m,routeModule:()=>b,serverHooks:()=>_,staticGenerationAsyncStorage:()=>h});var o={};t.r(o),t.d(o,{DELETE:()=>y,GET:()=>p,POST:()=>f});var s=t(349303),a=t(88716),n=t(60670),i=t(387070),d=t(113936),l=t(691585),c=t(326033);let u=l.Ry({email:l.Z_().email("Email inv\xe1lido")});async function p(e,{params:r}){try{let e=(0,d.createClient)(),{data:{user:t},error:o}=await e.auth.getUser();if(o||!t)return i.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let s=r.id,{data:a}=await e.from("projects").select("owner_id, collaborators").eq("id",s).single();if(!a)return i.NextResponse.json({error:"Projeto n\xe3o encontrado"},{status:404});if(!(a.owner_id===t.id||a.collaborators?.includes(t.id)))return i.NextResponse.json({error:"Sem permiss\xe3o para acessar este projeto"},{status:403});let n=a.collaborators||[],l=[a.owner_id,...n],{data:c,error:u}=await e.from("auth.users").select("id, email, user_metadata").in("id",l);if(u)return console.error("Erro ao buscar colaboradores:",u),i.NextResponse.json({error:"Erro ao buscar colaboradores"},{status:500});let p=c?.map(e=>({id:e.id,email:e.email,name:e.user_metadata?.name||e.email,avatar:e.user_metadata?.avatar_url,role:e.id===a.owner_id?"owner":"collaborator",joined_at:e.id===a.owner_id?null:new Date().toISOString()}))||[];return i.NextResponse.json({collaborators:p})}catch(e){return console.error("Erro na API de colaboradores:",e),i.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function f(e,{params:r}){try{let t=(0,d.createClient)(),{data:{user:o},error:s}=await t.auth.getUser();if(s||!o)return i.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let a=r.id,n=await e.json(),{email:l}=u.parse(n),{data:c}=await t.from("projects").select("owner_id, collaborators, name").eq("id",a).single();if(!c)return i.NextResponse.json({error:"Projeto n\xe3o encontrado"},{status:404});if(c.owner_id!==o.id)return i.NextResponse.json({error:"Apenas o dono pode adicionar colaboradores"},{status:403});let{data:p,error:f}=await t.from("auth.users").select("id, email").eq("email",l).single();if(f||!p)return i.NextResponse.json({error:"Usu\xe1rio n\xe3o encontrado"},{status:404});let y=c.collaborators||[];if(y.includes(p.id)||p.id===c.owner_id)return i.NextResponse.json({error:"Usu\xe1rio j\xe1 \xe9 colaborador deste projeto"},{status:400});let b=[...y,p.id],{data:m,error:h}=await t.from("projects").update({collaborators:b}).eq("id",a).select().single();if(h)return console.error("Erro ao adicionar colaborador:",h),i.NextResponse.json({error:"Erro ao adicionar colaborador"},{status:500});return await t.from("project_history").insert({project_id:a,user_id:o.id,action:"create",entity_type:"collaborator",entity_id:p.id,description:`Colaborador ${l} adicionado ao projeto`,changes:{added_collaborator:{id:p.id,email:p.email}}}),i.NextResponse.json({message:"Colaborador adicionado com sucesso",collaborator:{id:p.id,email:p.email,role:"collaborator"}})}catch(e){if(e instanceof c.jm)return i.NextResponse.json({error:"Dados inv\xe1lidos",details:e.errors},{status:400});return console.error("Erro ao adicionar colaborador:",e),i.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function y(e,{params:r}){try{let t=(0,d.createClient)(),{data:{user:o},error:s}=await t.auth.getUser();if(s||!o)return i.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let a=r.id,{searchParams:n}=new URL(e.url),l=n.get("user_id");if(!l)return i.NextResponse.json({error:"ID do colaborador \xe9 obrigat\xf3rio"},{status:400});let{data:c}=await t.from("projects").select("owner_id, collaborators").eq("id",a).single();if(!c)return i.NextResponse.json({error:"Projeto n\xe3o encontrado"},{status:404});if(!(c.owner_id===o.id||l===o.id))return i.NextResponse.json({error:"Sem permiss\xe3o para remover este colaborador"},{status:403});if(l===c.owner_id)return i.NextResponse.json({error:"N\xe3o \xe9 poss\xedvel remover o dono do projeto"},{status:400});let u=(c.collaborators||[]).filter(e=>e!==l),{error:p}=await t.from("projects").update({collaborators:u}).eq("id",a);if(p)return console.error("Erro ao remover colaborador:",p),i.NextResponse.json({error:"Erro ao remover colaborador"},{status:500});return await t.from("collaboration_sessions").update({status:"disconnected"}).eq("project_id",a).eq("user_id",l),await t.from("project_history").insert({project_id:a,user_id:o.id,action:"delete",entity_type:"collaborator",entity_id:l,description:"Colaborador removido do projeto",changes:{removed_collaborator:l}}),i.NextResponse.json({message:"Colaborador removido com sucesso"})}catch(e){return console.error("Erro ao remover colaborador:",e),i.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}l.Ry({user_id:l.Z_().uuid("ID de usu\xe1rio inv\xe1lido")});let b=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/projects/[id]/collaborators/route",pathname:"/api/projects/[id]/collaborators",filename:"route",bundlePath:"app/api/projects/[id]/collaborators/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\projects\\[id]\\collaborators\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:_}=b,j="/api/projects/[id]/collaborators/route";function g(){return(0,n.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:h})}},113936:(e,r,t)=>{"use strict";t.d(r,{f:()=>a});var o=t(366763),s=t(671615);let a=()=>{let e=(0,s.cookies)();return(0,o.createClient)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,{auth:{persistSession:!1,autoRefreshToken:!1},cookies:{get:r=>e.get(r)?.value}})};(0,o.createClient)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})},671615:(e,r,t)=>{"use strict";t.r(r);var o=t(888757),s={};for(let e in o)"default"!==e&&(s[e]=()=>o[e]);t.d(r,s)},633085:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"DraftMode",{enumerable:!0,get:function(){return a}});let o=t(345869),s=t(206278);class a{get isEnabled(){return this._provider.isEnabled}enable(){let e=o.staticGenerationAsyncStorage.getStore();return e&&(0,s.trackDynamicDataAccessed)(e,"draftMode().enable()"),this._provider.enable()}disable(){let e=o.staticGenerationAsyncStorage.getStore();return e&&(0,s.trackDynamicDataAccessed)(e,"draftMode().disable()"),this._provider.disable()}constructor(e){this._provider=e}}("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),e.exports=r.default)},888757:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),function(e,r){for(var t in r)Object.defineProperty(e,t,{enumerable:!0,get:r[t]})}(r,{cookies:function(){return p},draftMode:function(){return f},headers:function(){return u}});let o=t(768996),s=t(153047),a=t(392044),n=t(572934),i=t(633085),d=t(206278),l=t(345869),c=t(554580);function u(){let e="headers",r=l.staticGenerationAsyncStorage.getStore();if(r){if(r.forceStatic)return s.HeadersAdapter.seal(new Headers({}));(0,d.trackDynamicDataAccessed)(r,e)}return(0,c.getExpectedRequestStore)(e).headers}function p(){let e="cookies",r=l.staticGenerationAsyncStorage.getStore();if(r){if(r.forceStatic)return o.RequestCookiesAdapter.seal(new a.RequestCookies(new Headers({})));(0,d.trackDynamicDataAccessed)(r,e)}let t=(0,c.getExpectedRequestStore)(e),s=n.actionAsyncStorage.getStore();return(null==s?void 0:s.isAction)||(null==s?void 0:s.isAppRoute)?t.mutableCookies:t.cookies}function f(){let e=(0,c.getExpectedRequestStore)("draftMode");return new i.DraftMode(e.draftMode)}("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),e.exports=r.default)},153047:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),function(e,r){for(var t in r)Object.defineProperty(e,t,{enumerable:!0,get:r[t]})}(r,{HeadersAdapter:function(){return a},ReadonlyHeadersError:function(){return s}});let o=t(838238);class s extends Error{constructor(){super("Headers cannot be modified. Read more: https://nextjs.org/docs/app/api-reference/functions/headers")}static callable(){throw new s}}class a extends Headers{constructor(e){super(),this.headers=new Proxy(e,{get(r,t,s){if("symbol"==typeof t)return o.ReflectAdapter.get(r,t,s);let a=t.toLowerCase(),n=Object.keys(e).find(e=>e.toLowerCase()===a);if(void 0!==n)return o.ReflectAdapter.get(r,n,s)},set(r,t,s,a){if("symbol"==typeof t)return o.ReflectAdapter.set(r,t,s,a);let n=t.toLowerCase(),i=Object.keys(e).find(e=>e.toLowerCase()===n);return o.ReflectAdapter.set(r,i??t,s,a)},has(r,t){if("symbol"==typeof t)return o.ReflectAdapter.has(r,t);let s=t.toLowerCase(),a=Object.keys(e).find(e=>e.toLowerCase()===s);return void 0!==a&&o.ReflectAdapter.has(r,a)},deleteProperty(r,t){if("symbol"==typeof t)return o.ReflectAdapter.deleteProperty(r,t);let s=t.toLowerCase(),a=Object.keys(e).find(e=>e.toLowerCase()===s);return void 0===a||o.ReflectAdapter.deleteProperty(r,a)}})}static seal(e){return new Proxy(e,{get(e,r,t){switch(r){case"append":case"delete":case"set":return s.callable;default:return o.ReflectAdapter.get(e,r,t)}}})}merge(e){return Array.isArray(e)?e.join(", "):e}static from(e){return e instanceof Headers?e:new a(e)}append(e,r){let t=this.headers[e];"string"==typeof t?this.headers[e]=[t,r]:Array.isArray(t)?t.push(r):this.headers[e]=r}delete(e){delete this.headers[e]}get(e){let r=this.headers[e];return void 0!==r?this.merge(r):null}has(e){return void 0!==this.headers[e]}set(e,r){this.headers[e]=r}forEach(e,r){for(let[t,o]of this.entries())e.call(r,o,t,this)}*entries(){for(let e of Object.keys(this.headers)){let r=e.toLowerCase(),t=this.get(r);yield[r,t]}}*keys(){for(let e of Object.keys(this.headers)){let r=e.toLowerCase();yield r}}*values(){for(let e of Object.keys(this.headers)){let r=this.get(e);yield r}}[Symbol.iterator](){return this.entries()}}},768996:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),function(e,r){for(var t in r)Object.defineProperty(e,t,{enumerable:!0,get:r[t]})}(r,{MutableRequestCookiesAdapter:function(){return u},ReadonlyRequestCookiesError:function(){return n},RequestCookiesAdapter:function(){return i},appendMutableCookies:function(){return c},getModifiedCookieValues:function(){return l}});let o=t(392044),s=t(838238),a=t(345869);class n extends Error{constructor(){super("Cookies can only be modified in a Server Action or Route Handler. Read more: https://nextjs.org/docs/app/api-reference/functions/cookies#cookiessetname-value-options")}static callable(){throw new n}}class i{static seal(e){return new Proxy(e,{get(e,r,t){switch(r){case"clear":case"delete":case"set":return n.callable;default:return s.ReflectAdapter.get(e,r,t)}}})}}let d=Symbol.for("next.mutated.cookies");function l(e){let r=e[d];return r&&Array.isArray(r)&&0!==r.length?r:[]}function c(e,r){let t=l(r);if(0===t.length)return!1;let s=new o.ResponseCookies(e),a=s.getAll();for(let e of t)s.set(e);for(let e of a)s.set(e);return!0}class u{static wrap(e,r){let t=new o.ResponseCookies(new Headers);for(let r of e.getAll())t.set(r);let n=[],i=new Set,l=()=>{let e=a.staticGenerationAsyncStorage.getStore();if(e&&(e.pathWasRevalidated=!0),n=t.getAll().filter(e=>i.has(e.name)),r){let e=[];for(let r of n){let t=new o.ResponseCookies(new Headers);t.set(r),e.push(t.toString())}r(e)}};return new Proxy(t,{get(e,r,t){switch(r){case d:return n;case"delete":return function(...r){i.add("string"==typeof r[0]?r[0]:r[0].name);try{e.delete(...r)}finally{l()}};case"set":return function(...r){i.add("string"==typeof r[0]?r[0]:r[0].name);try{return e.set(...r)}finally{l()}};default:return s.ReflectAdapter.get(e,r,t)}}})}}}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[8948,5972,6763,1585],()=>t(517291));module.exports=o})();