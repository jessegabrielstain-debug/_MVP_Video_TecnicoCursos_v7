"use strict";(()=>{var e={};e.id=1403,e.ids=[1403,3936],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},17291:(e,r,o)=>{o.r(r),o.d(r,{originalPathname:()=>f,patchFetch:()=>v,requestAsyncStorage:()=>b,routeModule:()=>_,serverHooks:()=>x,staticGenerationAsyncStorage:()=>h});var t={};o.r(t),o.d(t,{DELETE:()=>j,GET:()=>p,POST:()=>m});var a=o(49303),s=o(88716),i=o(60670),n=o(87070),d=o(13936),l=o(91585),c=o(26033);let u=l.Ry({email:l.Z_().email("Email inv\xe1lido")});async function p(e,{params:r}){try{let o=(0,d.getSupabaseForRequest)(e),{data:{user:t},error:a}=await o.auth.getUser();if(a||!t)return n.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let s=r.id,{data:i}=await o.from("projects").select("user_id").eq("id",s).single();if(!i)return n.NextResponse.json({error:"Projeto n\xe3o encontrado"},{status:404});let l=i.user_id,c=l===t.id,{data:u}=await o.from("project_collaborators").select("id").eq("project_id",s).eq("user_id",t.id).single();if(!c&&!u)return n.NextResponse.json({error:"Sem permiss\xe3o para acessar este projeto"},{status:403});let{data:p,error:m}=await o.from("project_collaborators").select(`
        id,
        user_id,
        role,
        joined_at
      `).eq("project_id",s);if(m)return console.error("Erro ao buscar colaboradores:",m),n.NextResponse.json({error:"Erro ao buscar colaboradores"},{status:500});let j=p?.map(e=>e.user_id)||[],_={};if(j.length>0){let{data:e}=await o.from("users").select("id, email, name, avatar_url").in("id",j);e&&(_=e.reduce((e,r)=>(e[r.id]=r,e),{}))}let{data:b}=await o.from("users").select("id, email, name, avatar_url").eq("id",l).single(),h=[...b?[{id:b.id,email:b.email,name:b.name||b.email,avatar:b.avatar_url,role:"owner",joined_at:null}]:[],...p?.map(e=>{let r=_[e.user_id]||{};return{id:r.id||e.user_id,email:r.email,name:r.name||r.email,avatar:r.avatar_url,role:e.role||"collaborator",joined_at:e.joined_at}})||[]];return n.NextResponse.json({collaborators:h})}catch(e){return console.error("Erro na API de colaboradores:",e),n.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function m(e,{params:r}){try{let o=(0,d.getSupabaseForRequest)(e),{data:{user:t},error:a}=await o.auth.getUser();if(a||!t)return n.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let s=r.id,i=await e.json(),{email:l}=u.parse(i),{data:c}=await o.from("projects").select("user_id, name").eq("id",s).single();if(!c)return n.NextResponse.json({error:"Projeto n\xe3o encontrado"},{status:404});if(c.user_id!==t.id)return n.NextResponse.json({error:"Apenas o dono pode adicionar colaboradores"},{status:403});let{data:p,error:m}=await o.from("users").select("id, email").eq("email",l).single();if(m||!p)return n.NextResponse.json({error:"Usu\xe1rio n\xe3o encontrado"},{status:404});let{data:j}=await o.from("project_collaborators").select("id").eq("project_id",s).eq("user_id",p.id).single();if(j||p.id===c.user_id)return n.NextResponse.json({error:"Usu\xe1rio j\xe1 \xe9 colaborador deste projeto"},{status:400});let{error:_}=await o.from("project_collaborators").insert({project_id:s,user_id:p.id,role:"editor",invited_by:t.id,permissions:["read","write"]});if(_)return console.error("Erro ao adicionar colaborador:",_),n.NextResponse.json({error:"Erro ao adicionar colaborador"},{status:500});return await o.from("project_history").insert({project_id:s,user_id:t.id,action:"create",entity_type:"collaborator",entity_id:p.id,description:`Colaborador ${l} adicionado ao projeto`,changes:{added_collaborator:{id:p.id,email:p.email}}}),n.NextResponse.json({message:"Colaborador adicionado com sucesso",collaborator:{id:p.id,email:p.email,role:"editor"}})}catch(e){if(e instanceof c.jm)return n.NextResponse.json({error:"Dados inv\xe1lidos",details:e.errors},{status:400});return console.error("Erro ao adicionar colaborador:",e),n.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function j(e,{params:r}){try{let o=(0,d.getSupabaseForRequest)(e),{data:{user:t},error:a}=await o.auth.getUser();if(a||!t)return n.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let s=r.id,{searchParams:i}=new URL(e.url),l=i.get("user_id");if(!l)return n.NextResponse.json({error:"ID do colaborador \xe9 obrigat\xf3rio"},{status:400});let{data:c}=await o.from("projects").select("user_id").eq("id",s).single();if(!c)return n.NextResponse.json({error:"Projeto n\xe3o encontrado"},{status:404});if(!(c.user_id===t.id||l===t.id))return n.NextResponse.json({error:"Sem permiss\xe3o para remover este colaborador"},{status:403});if(l===c.user_id)return n.NextResponse.json({error:"N\xe3o \xe9 poss\xedvel remover o dono do projeto"},{status:400});let{error:u}=await o.from("project_collaborators").delete().eq("project_id",s).eq("user_id",l);if(u)return console.error("Erro ao remover colaborador:",u),n.NextResponse.json({error:"Erro ao remover colaborador"},{status:500});return await o.from("project_history").insert({project_id:s,user_id:t.id,action:"delete",entity_type:"collaborator",entity_id:l,description:"Colaborador removido do projeto",changes:{removed_collaborator:l}}),n.NextResponse.json({message:"Colaborador removido com sucesso"})}catch(e){return console.error("Erro ao remover colaborador:",e),n.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}let _=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/projects/[id]/collaborators/route",pathname:"/api/projects/[id]/collaborators",filename:"route",bundlePath:"app/api/projects/[id]/collaborators/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\projects\\[id]\\collaborators\\route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:b,staticGenerationAsyncStorage:h,serverHooks:x}=_,f="/api/projects/[id]/collaborators/route";function v(){return(0,i.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:h})}},13936:(e,r,o)=>{o.d(r,{e:()=>i,getSupabaseForRequest:()=>d,p:()=>n});var t=o(67721),a=o(61657),s=o(71615);let i=()=>{let e=(0,s.cookies)();return(0,t.createServerClient)("https://ofhzrdiadxigrvmrhaiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ",{cookies:{get:r=>e.get(r)?.value,set(r,o,t){try{e.set({name:r,value:o,...t})}catch(e){}},remove(r,o){try{e.set({name:r,value:"",...o})}catch(e){}}}})},n=(0,a.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}});function d(e){let r=e.headers.get("authorization")||e.headers.get("Authorization");return r?(0,a.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ",{global:{headers:{Authorization:r}},auth:{persistSession:!1,autoRefreshToken:!1}}):i()}}};var r=require("../../../../../webpack-runtime.js");r.C(e);var o=e=>r(r.s=e),t=r.X(0,[8948,5972,1657,9702,1585],()=>o(17291));module.exports=t})();