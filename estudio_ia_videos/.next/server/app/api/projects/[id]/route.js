"use strict";(()=>{var e={};e.id=7361,e.ids=[7361,3936],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},11941:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>I,patchFetch:()=>f,requestAsyncStorage:()=>g,routeModule:()=>h,serverHooks:()=>j,staticGenerationAsyncStorage:()=>x});var s={};r.r(s),r.d(s,{DELETE:()=>m,GET:()=>d,PUT:()=>l});var o=r(49303),i=r(88716),a=r(60670),n=r(87070),p=r(91585),u=r(13936);let c=p.Ry({name:p.Z_().min(1,"Nome \xe9 obrigat\xf3rio").max(255,"Nome muito longo").optional(),description:p.Z_().optional(),type:p.Km(["pptx","template-nr","talking-photo","custom","ai-generated"]).optional(),status:p.Km(["draft","in-progress","review","completed","archived","error"]).optional(),settings:p.Ry({width:p.Rx().optional(),height:p.Rx().optional(),fps:p.Rx().optional(),duration:p.Rx().optional(),quality:p.Km(["low","medium","high"]).optional(),format:p.Km(["mp4","mov","avi"]).optional()}).optional(),is_public:p.O7().optional()});async function d(e,{params:t}){try{let r=(0,u.getSupabaseForRequest)(e),{data:{user:s}}=await r.auth.getUser();if(!s)return n.NextResponse.json({error:"Unauthorized"},{status:401});let{data:o,error:i}=await r.from("projects").select("*").eq("id",t.id).single();if(i||!o)return n.NextResponse.json({success:!1,error:"Projeto n\xe3o encontrado",timestamp:new Date().toISOString()},{status:404});let a=o.user_id===s.id||o.is_public;if(!a){let{data:e}=await r.from("project_collaborators").select("user_id").eq("project_id",t.id).eq("user_id",s.id).single();e&&(a=!0)}if(!a)return n.NextResponse.json({error:"Unauthorized"},{status:403});return n.NextResponse.json({success:!0,data:o,timestamp:new Date().toISOString()})}catch(e){return console.error(`ðŸ’¥ [PROJECT-API] Erro ao buscar projeto ${t.id}:`,e),n.NextResponse.json({success:!1,error:"Erro interno do servidor",details:e instanceof Error?e.message:"Erro desconhecido",timestamp:new Date().toISOString()},{status:500})}}async function l(e,{params:t}){try{let r=(0,u.getSupabaseForRequest)(e),{data:{user:s}}=await r.auth.getUser();if(!s)return n.NextResponse.json({error:"Unauthorized"},{status:401});let o=await e.json(),i=c.safeParse(o);if(!i.success)return n.NextResponse.json({success:!1,error:"Dados inv\xe1lidos",details:i.error.errors,timestamp:new Date().toISOString()},{status:400});let a=i.data,{data:p}=await r.from("projects").select("user_id").eq("id",t.id).single();if(!p)return n.NextResponse.json({success:!1,error:"Projeto n\xe3o encontrado",timestamp:new Date().toISOString()},{status:404});let d=p.user_id===s.id;if(!d){let{data:e}=await r.from("project_collaborators").select("permissions").eq("project_id",t.id).eq("user_id",s.id).single();e&&e.permissions?.can_edit&&(d=!0)}if(!d)return n.NextResponse.json({error:"Unauthorized"},{status:403});let l={updated_at:new Date().toISOString()};if(a.name&&(l.name=a.name),void 0!==a.description&&(l.description=a.description),a.type&&(l.type=a.type),a.status&&(l.status=a.status),void 0!==a.is_public&&(l.is_public=a.is_public),a.settings){let{data:e}=await r.from("projects").select("render_settings").eq("id",t.id).single(),s="object"==typeof e?.render_settings&&e?.render_settings!==null?e.render_settings:{};l.render_settings={...s,...a.settings}}let{data:m,error:h}=await r.from("projects").update(l).eq("id",t.id).select().single();if(h)throw h;return n.NextResponse.json({success:!0,message:"Projeto atualizado com sucesso!",data:m,timestamp:new Date().toISOString()})}catch(e){return console.error(`ðŸ’¥ [PROJECT-API] Erro ao atualizar projeto ${t.id}:`,e),n.NextResponse.json({success:!1,error:"Erro interno do servidor",details:e instanceof Error?e.message:"Erro desconhecido",timestamp:new Date().toISOString()},{status:500})}}async function m(e,{params:t}){try{let r=(0,u.getSupabaseForRequest)(e),{data:{user:s}}=await r.auth.getUser();if(!s)return n.NextResponse.json({error:"Unauthorized"},{status:401});let{error:o}=await r.from("projects").delete().eq("id",t.id).eq("user_id",s.id);if(o)throw o;return n.NextResponse.json({success:!0,message:"Projeto exclu\xeddo com sucesso!",data:{id:t.id},timestamp:new Date().toISOString()})}catch(e){return console.error(`ðŸ’¥ [PROJECT-API] Erro ao excluir projeto ${t.id}:`,e),n.NextResponse.json({success:!1,error:"Erro interno do servidor",details:e instanceof Error?e.message:"Erro desconhecido",timestamp:new Date().toISOString()},{status:500})}}let h=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/projects/[id]/route",pathname:"/api/projects/[id]",filename:"route",bundlePath:"app/api/projects/[id]/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\projects\\[id]\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:x,serverHooks:j}=h,I="/api/projects/[id]/route";function f(){return(0,a.patchFetch)({serverHooks:j,staticGenerationAsyncStorage:x})}},13936:(e,t,r)=>{r.d(t,{e:()=>a,getSupabaseForRequest:()=>p,p:()=>n});var s=r(67721),o=r(61657),i=r(71615);let a=()=>{let e=(0,i.cookies)();return(0,s.createServerClient)("https://ofhzrdiadxigrvmrhaiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ",{cookies:{get:t=>e.get(t)?.value,set(t,r,s){try{e.set({name:t,value:r,...s})}catch(e){}},remove(t,r){try{e.set({name:t,value:"",...r})}catch(e){}}}})},n=(0,o.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}});function p(e){let t=e.headers.get("authorization")||e.headers.get("Authorization");return t?(0,o.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ",{global:{headers:{Authorization:t}},auth:{persistSession:!1,autoRefreshToken:!1}}):a()}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972,1657,9702,1585],()=>r(11941));module.exports=s})();