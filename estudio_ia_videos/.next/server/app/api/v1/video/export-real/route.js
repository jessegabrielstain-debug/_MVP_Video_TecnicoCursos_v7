(()=>{var e={};e.id=8007,e.ids=[8007,7153],e.modules={14464:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=14464,e.exports=t},8541:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=8541,e.exports=t},12308:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=12308,e.exports=t},53524:e=>{"use strict";e.exports=require("@prisma/client")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},61212:e=>{"use strict";e.exports=require("async_hooks")},61282:e=>{"use strict";e.exports=require("child_process")},84770:e=>{"use strict";e.exports=require("crypto")},27920:e=>{"use strict";e.exports=require("diagnostics_channel")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},85807:e=>{"use strict";e.exports=require("module")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},96119:e=>{"use strict";e.exports=require("perf_hooks")},35816:e=>{"use strict";e.exports=require("process")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},6162:e=>{"use strict";e.exports=require("worker_threads")},17718:e=>{"use strict";e.exports=require("node:child_process")},65714:e=>{"use strict";e.exports=require("node:diagnostics_channel")},15673:e=>{"use strict";e.exports=require("node:events")},87561:e=>{"use strict";e.exports=require("node:fs")},88849:e=>{"use strict";e.exports=require("node:http")},22286:e=>{"use strict";e.exports=require("node:https")},85690:e=>{"use strict";e.exports=require("node:inspector")},82033:e=>{"use strict";e.exports=require("node:module")},87503:e=>{"use strict";e.exports=require("node:net")},70612:e=>{"use strict";e.exports=require("node:os")},49411:e=>{"use strict";e.exports=require("node:path")},51747:e=>{"use strict";e.exports=require("node:readline")},84492:e=>{"use strict";e.exports=require("node:stream")},31764:e=>{"use strict";e.exports=require("node:tls")},47261:e=>{"use strict";e.exports=require("node:util")},24086:e=>{"use strict";e.exports=require("node:worker_threads")},65628:e=>{"use strict";e.exports=require("node:zlib")},75539:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>R,patchFetch:()=>_,requestAsyncStorage:()=>k,routeModule:()=>N,serverHooks:()=>I,staticGenerationAsyncStorage:()=>D});var s={};r.r(s),r.d(s,{DELETE:()=>E,GET:()=>q,POST:()=>w,dynamic:()=>j});var o=r(49303),i=r(88716),n=r(60670),a=r(87070),u=r(84770),l=r(54211),p=r(8261);let d={sd:"1280x720",hd:"1920x1080",fhd:"1920x1080","4k":"3840x2160"},c={low:3,normal:5,high:8,urgent:10},h={sd:.8,hd:1,fhd:1.2,"4k":1.6},f={h264:1,h265:1.1,vp9:1.25,av1:1.4},v=new Set(["completed","error","cancelled"]);async function g(e,t,r){try{var s,o;let i=await p._.project.findUnique({where:{id:e},select:{id:!0,userId:!0,totalSlides:!0,duration:!0,status:!0}});if(!i)return l.kg.warn("video-export: project not found",{projectId:e}),{success:!1,error:"Projeto n\xe3o encontrado"};let n=new Date,a=(0,u.randomUUID)(),v=r?.requestId??a,g=(s=r?.priority,o=i.status,s?c[s]:o&&"APPROVED"===o.toUpperCase()?c.high:c.normal),m=d[t.quality]??d.hd,x=function(e){let t={format:e.format,quality:e.quality,fps:e.fps,codec:e.codec,includeAudio:e.includeAudio};return e.bitrate&&(t.bitrate=e.bitrate),e.preset&&(t.preset=e.preset),t}(t),y={startedAt:n.toISOString(),trigger:r?.trigger??"manual",requestId:v,options:x,events:[{at:n.toISOString(),status:"queued",message:"Job registrado na fila de exporta\xe7\xe3o",progress:0}]};await p._.$transaction(async s=>{await s.videoExport.create({data:{id:a,projectId:e,userId:r?.userId??i.userId,format:t.format,quality:t.quality,resolution:m,fps:t.fps,status:"queued",progress:0,processingLog:y,updatedAt:n}});let o={videoExportId:a,projectId:e,options:x,trigger:r?.trigger??"manual",requestId:v};await s.processingQueue.create({data:{id:(0,u.randomUUID)(),jobType:"video_export",jobData:o,status:"pending",priority:g,scheduledFor:n,progress:0,currentStep:"waiting_worker",maxAttempts:3,createdAt:n,updatedAt:n}})});let b=function(e,t,r){let s=60===r.fps?1.2:24===r.fps?.9:1,o=r.includeAudio?1.05:.9;return Math.max(2,Math.round((t>0?t:Math.max(8*e,60))*h[r.quality]*f[r.codec]*s*o/60))}(i.totalSlides??0,i.duration??0,t);return l.kg.info("video-export: job enqueued",{jobId:a,projectId:e,queuePriority:g}),{success:!0,jobId:a,queuedAt:n,estimatedCompletionMinutes:b,queuePriority:g}}catch(t){return l.kg.error("video-export: failed to enqueue job",t instanceof Error?t:Error(String(t)),{projectId:e}),{success:!1,error:t instanceof Error?t.message:"Erro ao iniciar exporta\xe7\xe3o"}}}async function m(e){try{let t=await p._.videoExport.findUnique({where:{id:e}});if(!t)return{error:"Job n\xe3o encontrado"};return{job:function(e){let t=b(e.processingLog),r=b(t?.options),s=y(t,"startedAt")??e.createdAt,o=v.has(x(e.status))?y(t,"completedAt")??e.updatedAt:null;return{id:e.id,projectId:e.projectId,status:x(e.status),progress:e.progress??0,outputUrl:e.videoUrl??e.fileUrl??null,error:e.errorMessage??null,startedAt:s,completedAt:o,metadata:function(e,t,r){let s="bigint"==typeof e.fileSize?Number(e.fileSize):e.fileSize,o="boolean"!=typeof t?.includeAudio||t?.includeAudio,i="string"==typeof t?.codec?t?.codec:e.format,n="string"==typeof t?.preset?t?.preset:null,a="string"==typeof t?.bitrate?t?.bitrate:null;return{format:e.format,quality:e.quality,resolution:e.resolution,fps:e.fps,duration:e.duration??null,fileName:e.fileName??null,fileSize:s??null,includeAudio:o,codec:i,preset:n,bitrate:a,updatedAt:e.updatedAt,options:t,processingLog:r,outputUrl:e.videoUrl??e.fileUrl??null}}(e,r,t)}}(t)}}catch(t){return l.kg.error("video-export: failed to load status",t instanceof Error?t:Error(String(t)),{jobId:e}),{error:"Erro ao consultar job"}}}function x(e){let t=e.toLowerCase();return["pending","queued","waiting"].includes(t)?"queued":["processing","running","rendering"].includes(t)?"processing":["completed","done","finished","success"].includes(t)?"completed":["failed","error"].includes(t)?"error":["cancelled","canceled","aborted"].includes(t)?"cancelled":"processing"}function y(e,t){if(!e)return null;let r=e[t];if("string"==typeof r){let e=new Date(r);if(!Number.isNaN(e.getTime()))return e}let s=e.events,o=Array.isArray(s)?s:[],i="startedAt"===t?"processing":"completed",n=o.find(e=>e.status===i&&"string"==typeof e.at);if(n&&"string"==typeof n.at){let e=new Date(n.at);if(!Number.isNaN(e.getTime()))return e}return null}function b(e){return e?"object"!=typeof e||Array.isArray(e)?null:e:null}let j="force-dynamic";async function w(e){try{let t=await e.json();console.log("DEBUG: Body received:",JSON.stringify(t));let{projectId:r,options:s}=t;if(!r)return a.NextResponse.json({error:"Project ID \xe9 obrigat\xf3rio"},{status:400});let o=function(e){let t=e||{},r={format:t.format||A.format,quality:t.quality||A.quality,fps:[24,30,60].includes(t.fps)?t.fps:A.fps,codec:t.codec||A.codec,includeAudio:"boolean"==typeof t.includeAudio?t.includeAudio:A.includeAudio,bitrate:function(e){if(null!=e){if("number"==typeof e&&isFinite(e)&&e>0)return`${Math.round(e)}k`;if("string"==typeof e){let t=e.trim().toLowerCase();if(/^\d+$/.test(t))return`${t}k`;if(/^\d+(k|m|kbps|mbps)$/.test(t))return t.replace("kbps","k").replace("mbps","m")}}}(t.bitrate),preset:t.preset};if("webm"===r.format&&!["vp9","av1"].includes(r.codec))return a.NextResponse.json({error:"Formato webm requer codec vp9 ou av1"},{status:400});if(("mp4"===r.format||"mov"===r.format)&&!["h264","h265"].includes(r.codec))return a.NextResponse.json({error:`${r.format} requer codec h264 ou h265`},{status:400});if("4k"===r.quality&&!["h265","vp9","av1"].includes(r.codec))return a.NextResponse.json({error:"4K requer codec h265, vp9 ou av1"},{status:400});if(r.preset){let e=r.preset;if(["h264","h265"].includes(r.codec)){if(!["ultrafast","superfast","veryfast","faster","fast","medium","slow","slower","veryslow"].includes(e))return a.NextResponse.json({error:`Preset inv\xe1lido para ${r.codec}`},{status:400})}else if(["vp9","av1"].includes(r.codec)&&!["good","best"].includes(e))return a.NextResponse.json({error:`Preset inv\xe1lido para ${r.codec}`},{status:400})}else["vp9","av1"].includes(r.codec)?r.preset="good":["h264","h265"].includes(r.codec)&&(r.preset="4k"===r.quality?"slow":A.preset);return r}(s);if(o instanceof a.NextResponse||"status"in o&&"function"==typeof o.json)return o;console.log("\uD83C\uDFAC Iniciando exporta\xe7\xe3o de v\xeddeo para projeto:",r);let i=await g(r,o);if(!i.success)return a.NextResponse.json({error:i.error||"Erro na exporta\xe7\xe3o"},{status:500});return a.NextResponse.json({success:!0,jobId:i.jobId,message:"Exporta\xe7\xe3o de v\xeddeo iniciada! Use o jobId para verificar o progresso.",status:"queued",options:o})}catch(e){return console.error("❌ Erro na API de exporta\xe7\xe3o de v\xeddeo:",e),a.NextResponse.json({error:"Erro na exporta\xe7\xe3o de v\xeddeo",details:e instanceof Error?e.message:"Erro desconhecido"},{status:500})}}async function q(e){try{let{searchParams:t}=new URL(e.url),r=t.get("jobId"),s=t.get("projectId"),o=t.get("status"),i=Math.min(parseInt(t.get("limit")||"20",10)||20,100),n=parseInt(t.get("offset")||"0",10)||0;if(!r){if(s){let e={projectId:s};o&&["queued","processing","completed","error"].includes(o)&&(e.status=o);let t=await p._.videoExport.count({where:e}),r=await p._.videoExport.findMany({where:e,orderBy:{createdAt:"desc"},take:i,skip:n});return a.NextResponse.json({success:!0,history:r.map(e=>({id:e.id,status:e.status,progress:e.progress,outputUrl:e.videoUrl,error:e.errorMessage,createdAt:e.createdAt,updatedAt:e.updatedAt})),page:{total:t,offset:n,limit:i,count:r.length,hasNext:n+r.length<t}})}return a.NextResponse.json({message:"API de Exporta\xe7\xe3o de V\xeddeo Real",usage:{"POST /export-real":"Iniciar exporta\xe7\xe3o { projectId, options }","GET /export-real?jobId=":"Verificar status do job","GET /export-real?projectId=":"Listar jobs recentes do projeto","GET /export-real?projectId=&status=&limit=&offset=":"Hist\xf3rico com filtros e pagina\xe7\xe3o"},supportedFormats:["mp4","webm","mov"],supportedQualities:["sd","hd","fhd","4k"],supportedCodecs:["h264","h265","vp9","av1"],defaults:A},{status:200})}let u=await m(r);if(!u.job)return a.NextResponse.json({error:u.error||"Job n\xe3o encontrado"},{status:404});return a.NextResponse.json({success:!0,job:{id:u.job.id,projectId:u.job.projectId,status:u.job.status,progress:u.job.progress,outputUrl:u.job.outputUrl,error:u.job.error,startedAt:u.job.startedAt,completedAt:u.job.completedAt,metadata:u.job.metadata},message:`Status do job: ${u.job.status} (${u.job.progress}%)`})}catch(e){return console.error("❌ Erro ao verificar status do job:",e),a.NextResponse.json({error:"Erro ao verificar status",details:e instanceof Error?e.message:"Erro desconhecido"},{status:500})}}async function E(e){try{let{searchParams:t}=new URL(e.url),r=t.get("jobId");if(!r)return a.NextResponse.json({error:"Job ID \xe9 obrigat\xf3rio"},{status:400});return console.log("\uD83D\uDED1 Cancelando job de exporta\xe7\xe3o:",r),a.NextResponse.json({success:!0,message:`Job ${r} cancelado`,jobId:r})}catch(e){return console.error("❌ Erro ao cancelar job:",e),a.NextResponse.json({error:"Erro ao cancelar job",details:e instanceof Error?e.message:"Erro desconhecido"},{status:500})}}let A={format:"mp4",quality:"hd",fps:30,codec:"h264",includeAudio:!0,preset:"medium"},N=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/v1/video/export-real/route",pathname:"/api/v1/video/export-real",filename:"route",bundlePath:"app/api/v1/video/export-real/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\v1\\video\\export-real\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:k,staticGenerationAsyncStorage:D,serverHooks:I}=N,R="/api/v1/video/export-real/route";function _(){return(0,n.patchFetch)({serverHooks:I,staticGenerationAsyncStorage:D})}},54211:(e,t,r)=>{"use strict";r.d(t,{Yd:()=>o,kg:()=>i});var s=r(77686);class o{constructor(e){this.isDevelopment=!1,this.minLevel=process.env.LOG_LEVEL||"info",this.namespace=null,this.levels={debug:0,info:1,warn:2,error:3},e&&(this.namespace=e)}shouldLog(e){return this.levels[e]>=this.levels[this.minLevel]}formatMessage(e){if(!this.isDevelopment)return JSON.stringify({level:e.level,message:e.message,timestamp:e.timestamp,...this.namespace?{namespace:this.namespace}:{},...e.context,...e.error?{error:{message:e.error.message,stack:e.error.stack,name:e.error.name}}:{}});let t=[`${{debug:"\uD83D\uDD0D",info:"ℹ️",warn:"⚠️",error:"❌"}[e.level]} [${e.level.toUpperCase()}]`,e.timestamp];return this.namespace&&t.push(`[${this.namespace}]`),t.push(e.message),e.context&&t.push(JSON.stringify(e.context,null,2)),e.error&&(t.push(`
Error: ${e.error.message}`),this.isDevelopment&&e.error.stack&&t.push(`
Stack: ${e.error.stack}`)),t.join(" ")}log(e,t,r,o){if(!this.shouldLog(e))return;let i={level:e,message:t,timestamp:new Date().toISOString(),context:r,error:o},n=this.formatMessage(i);switch(this.isDevelopment||("error"===e&&o?s.captureException(o,{extra:{...r,message:t}}):("error"===e||"warn"===e)&&s.captureMessage(t,{level:"warn"===e?"warning":"error",extra:r})),e){case"debug":this.isDevelopment&&console.debug(n);break;case"info":console.info(n);break;case"warn":console.warn(n);break;case"error":console.error(n)}}debug(e,t){this.log("debug",e,t)}info(e,t){this.log("info",e,t)}warn(e,t){this.log("warn",e,t)}error(e,t,r){this.log("error",e,r,t)}withContext(e){let t=new o(this.namespace||void 0),r=t.log.bind(t);return t.log=(t,s,o,i)=>{r(t,s,{...e,...o},i)},t}}let i=new o},8261:(e,t,r)=>{"use strict";r.d(t,{_:()=>o});var s=r(53524);let o=global.prisma||new s.PrismaClient({log:["error"]})},83988:e=>{"use strict";e.exports=function(e){e.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}},10949:(e,t,r)=>{"use strict";function s(e){var t=this;if(t instanceof s||(t=new s),t.tail=null,t.head=null,t.length=0,e&&"function"==typeof e.forEach)e.forEach(function(e){t.push(e)});else if(arguments.length>0)for(var r=0,o=arguments.length;r<o;r++)t.push(arguments[r]);return t}function o(e,t,r,s){if(!(this instanceof o))return new o(e,t,r,s);this.list=s,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,r?(r.prev=this,this.next=r):this.next=null}e.exports=s,s.Node=o,s.create=s,s.prototype.removeNode=function(e){if(e.list!==this)throw Error("removing node which does not belong to this list");var t=e.next,r=e.prev;return t&&(t.prev=r),r&&(r.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=r),e.list.length--,e.next=null,e.prev=null,e.list=null,t},s.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},s.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},s.prototype.push=function(){for(var e,t=0,r=arguments.length;t<r;t++)e=arguments[t],this.tail=new o(e,this.tail,null,this),this.head||(this.head=this.tail),this.length++;return this.length},s.prototype.unshift=function(){for(var e,t=0,r=arguments.length;t<r;t++)e=arguments[t],this.head=new o(e,null,this.head,this),this.tail||(this.tail=this.head),this.length++;return this.length},s.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},s.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},s.prototype.forEach=function(e,t){t=t||this;for(var r=this.head,s=0;null!==r;s++)e.call(t,r.value,s,this),r=r.next},s.prototype.forEachReverse=function(e,t){t=t||this;for(var r=this.tail,s=this.length-1;null!==r;s--)e.call(t,r.value,s,this),r=r.prev},s.prototype.get=function(e){for(var t=0,r=this.head;null!==r&&t<e;t++)r=r.next;if(t===e&&null!==r)return r.value},s.prototype.getReverse=function(e){for(var t=0,r=this.tail;null!==r&&t<e;t++)r=r.prev;if(t===e&&null!==r)return r.value},s.prototype.map=function(e,t){t=t||this;for(var r=new s,o=this.head;null!==o;)r.push(e.call(t,o.value,this)),o=o.next;return r},s.prototype.mapReverse=function(e,t){t=t||this;for(var r=new s,o=this.tail;null!==o;)r.push(e.call(t,o.value,this)),o=o.prev;return r},s.prototype.reduce=function(e,t){var r,s=this.head;if(arguments.length>1)r=t;else if(this.head)s=this.head.next,r=this.head.value;else throw TypeError("Reduce of empty list with no initial value");for(var o=0;null!==s;o++)r=e(r,s.value,o),s=s.next;return r},s.prototype.reduceReverse=function(e,t){var r,s=this.tail;if(arguments.length>1)r=t;else if(this.tail)s=this.tail.prev,r=this.tail.value;else throw TypeError("Reduce of empty list with no initial value");for(var o=this.length-1;null!==s;o--)r=e(r,s.value,o),s=s.prev;return r},s.prototype.toArray=function(){for(var e=Array(this.length),t=0,r=this.head;null!==r;t++)e[t]=r.value,r=r.next;return e},s.prototype.toArrayReverse=function(){for(var e=Array(this.length),t=0,r=this.tail;null!==r;t++)e[t]=r.value,r=r.prev;return e},s.prototype.slice=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var r=new s;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var o=0,i=this.head;null!==i&&o<e;o++)i=i.next;for(;null!==i&&o<t;o++,i=i.next)r.push(i.value);return r},s.prototype.sliceReverse=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var r=new s;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var o=this.length,i=this.tail;null!==i&&o>t;o--)i=i.prev;for(;null!==i&&o>e;o--,i=i.prev)r.push(i.value);return r},s.prototype.splice=function(e,t,...r){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var s=0,i=this.head;null!==i&&s<e;s++)i=i.next;for(var n=[],s=0;i&&s<t;s++)n.push(i.value),i=this.removeNode(i);null===i&&(i=this.tail),i!==this.head&&i!==this.tail&&(i=i.prev);for(var s=0;s<r.length;s++)i=function(e,t,r){var s=t===e.head?new o(r,null,t,e):new o(r,t,t.next,e);return null===s.next&&(e.tail=s),null===s.prev&&(e.head=s),e.length++,s}(this,i,r[s]);return n},s.prototype.reverse=function(){for(var e=this.head,t=this.tail,r=e;null!==r;r=r.prev){var s=r.prev;r.prev=r.next,r.next=s}return this.head=t,this.tail=e,this};try{r(83988)(s)}catch(e){}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972,9092,7686],()=>r(75539));module.exports=s})();