"use strict";(()=>{var e={};e.id=7983,e.ids=[7983],e.modules={572934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},554580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},345869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},220399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},430517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},627790:e=>{e.exports=require("assert")},978893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},532615:e=>{e.exports=require("http")},735240:e=>{e.exports=require("https")},986624:e=>{e.exports=require("querystring")},917360:e=>{e.exports=require("url")},521764:e=>{e.exports=require("util")},671568:e=>{e.exports=require("zlib")},751750:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>x,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>d});var s={};r.r(s),r.d(s,{POST:()=>u});var i=r(349303),o=r(88716),a=r(60670),n=r(387070),c=r(95715);async function u(e){try{let t=await (0,c.getServerSession)(Object(function(){var e=Error("Cannot find module '@/lib/auth/auth-config'");throw e.code="MODULE_NOT_FOUND",e}()));if(!t?.user)return n.NextResponse.json({success:!1,message:"N\xe3o autorizado"},{status:401});let{projectId:r,operation:s,targets:i,data:o}=await e.json();if(!r||!s||!i)return n.NextResponse.json({success:!1,message:"projectId, operation e targets s\xe3o obrigat\xf3rios"},{status:400});if(console.log(`⚡ Executando opera\xe7\xe3o em lote: ${s}...`),!await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).project.findFirst({where:{id:r,userId:t.user.id}}))return n.NextResponse.json({success:!1,message:"Projeto n\xe3o encontrado"},{status:404});let a=await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).timeline.findUnique({where:{projectId:r}});if(!a)return n.NextResponse.json({success:!1,message:"Timeline n\xe3o encontrada"},{status:404});let u={},l=a.tracks;switch(s){case"delete_tracks":let p=i.trackIds||[];l=l.filter(e=>!p.includes(e.id)),u={deletedCount:p.length,remainingCount:l.length};break;case"delete_clips":let d=i.clipIds||[];l=l.map(e=>({...e,clips:e.clips?.filter(e=>!d.includes(e.id))||[]}));let m=a.tracks;u={deletedCount:d.length,tracksAffected:l.filter(e=>e.clips?.length!==m.find(t=>t.id===e.id)?.clips?.length).length};break;case"duplicate_clips":let f=i.clipIds||[],x=o?.timeOffset||5;l=l.map(e=>{let t=[];return e.clips?.forEach(e=>{f.includes(e.id)&&t.push({...e,id:`${e.id}_copy_${Date.now()}`,startTime:e.startTime+x})}),{...e,clips:[...e.clips||[],...t]}}),u={duplicatedCount:f.length,timeOffset:x};break;case"move_clips":let g=i.clipIds||[],h=o?.targetTrackId;if(!h)return n.NextResponse.json({success:!1,message:"targetTrackId \xe9 obrigat\xf3rio para move_clips"},{status:400});let O=[];l=(l=l.map(e=>{let t=e.clips?.filter(e=>!g.includes(e.id)||(O.push(e),!1))||[];return{...e,clips:t}})).map(e=>e.id===h?{...e,clips:[...e.clips||[],...O]}:e),u={movedCount:O.length,targetTrackId:h};break;case"update_settings":let v=i.trackIds||[],k=o?.settings||{};l=l.map(e=>v.includes(e.id)?{...e,...k}:e),u={updatedCount:v.length,settings:k};break;case"apply_effect":let _=i.clipIds||[],b=o?.effect;if(!b)return n.NextResponse.json({success:!1,message:"effect \xe9 obrigat\xf3rio para apply_effect"},{status:400});l=l.map(e=>({...e,clips:e.clips?.map(e=>_.includes(e.id)?{...e,effects:[...e.effects||[],b]}:e)||[]})),u={affectedClips:_.length,effect:b.type};break;default:return n.NextResponse.json({success:!1,message:`Opera\xe7\xe3o desconhecida: ${s}`},{status:400})}let j=await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).timeline.update({where:{projectId:r},data:{tracks:l,version:{increment:1},updatedAt:new Date}});return console.log(`✅ Opera\xe7\xe3o em lote conclu\xedda: ${s}`),n.NextResponse.json({success:!0,data:{operation:s,result:u,timeline:{id:j.id,version:j.version,tracksCount:l.length,updatedAt:j.updatedAt.toISOString()}},message:`Opera\xe7\xe3o ${s} executada com sucesso`})}catch(t){console.error("❌ Erro em opera\xe7\xe3o em lote:",t);let e=t instanceof Error?t.message:"Erro desconhecido";return n.NextResponse.json({success:!1,message:"Erro ao executar opera\xe7\xe3o em lote",error:e},{status:500})}}(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e})(),function(){var e=Error("Cannot find module '@/lib/auth/auth-config'");throw e.code="MODULE_NOT_FOUND",e}();let l=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/v1/timeline/multi-track/bulk/route",pathname:"/api/v1/timeline/multi-track/bulk",filename:"route",bundlePath:"app/api/v1/timeline/multi-track/bulk/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\v1\\timeline\\multi-track\\bulk\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:p,staticGenerationAsyncStorage:d,serverHooks:m}=l,f="/api/v1/timeline/multi-track/bulk/route";function x(){return(0,a.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:d})}}};var t=require("../../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972,5715],()=>r(751750));module.exports=s})();