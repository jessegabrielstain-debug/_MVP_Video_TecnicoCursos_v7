"use strict";(()=>{var e={};e.id=2217,e.ids=[2217,3936],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},28263:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>x,patchFetch:()=>R,requestAsyncStorage:()=>j,routeModule:()=>h,serverHooks:()=>_,staticGenerationAsyncStorage:()=>v});var r={};s.r(r),s.d(r,{DELETE:()=>g,GET:()=>p,PATCH:()=>f,POST:()=>u,PUT:()=>m});var o=s(49303),a=s(88716),i=s(60670),n=s(87070),c=s(13936),l=s(95532);async function u(e){try{let t;let s=(0,c.getSupabaseForRequest)(e),{data:{user:r},error:o}=await s.auth.getUser();if(o||!r)return n.NextResponse.json({success:!1,message:"N\xe3o autorizado"},{status:401});let{projectId:a,tracks:i,totalDuration:u,exportSettings:p}=await e.json();if(!a)return n.NextResponse.json({success:!1,message:"projectId \xe9 obrigat\xf3rio"},{status:400});console.log(`ðŸŽ¬ Salvando timeline para projeto ${a}...`);let{data:m,error:g}=await s.from("projects").select("id, user_id").eq("id",a).single();if(g||!m)return n.NextResponse.json({success:!1,message:"Projeto n\xe3o encontrado"},{status:404});let f=m.user_id===r.id;if(!f){let{data:e}=await s.from("project_collaborators").select("role").eq("project_id",a).eq("user_id",r.id).single();e&&["owner","editor"].includes(e.role)&&(f=!0)}if(!f)return n.NextResponse.json({success:!1,message:"Sem permiss\xe3o para editar este projeto"},{status:403});let h={fps:p?.fps||30,resolution:p?.resolution||"1920x1080",format:p?.format||"mp4",quality:p?.quality||"hd",zoom:p?.zoom||10,snapToGrid:p?.snapToGrid!==!1,autoSave:p?.autoSave!==!1},{data:j}=await s.from("timelines").select("id, version").eq("project_id",a).single();if(j){let{data:e,error:r}=await s.from("timelines").update({tracks:i,settings:h,total_duration:Math.ceil(u||0),version:j.version+1,updated_at:new Date().toISOString()}).eq("project_id",a).select().single();if(r)throw r;t=e}else{let{data:e,error:r}=await s.from("timelines").insert({project_id:a,tracks:i,settings:h,total_duration:Math.ceil(u||0),version:1}).select().single();if(r)throw r;t=e}console.log(`âœ… Timeline salva: ${t.id} (v${t.version})`),await l.k.trackTimelineEdit({userId:r.id,projectId:a,action:"update",trackCount:i?.length||0,totalDuration:u||0});let v=i||[],_={tracksCount:v.length,keyframesCount:v.reduce((e,t)=>e+(t.keyframes?.length||0),0),avgTrackDuration:v.length>0?v.reduce((e,t)=>e+(t.duration||0),0)/v.length:0,complexity:d(v)};return n.NextResponse.json({success:!0,data:{id:t.id,projectId:t.project_id,version:t.version,totalDuration:t.total_duration,tracks:t.tracks,settings:t.settings,updatedAt:t.updated_at,analytics:_},message:"Timeline salva com sucesso"})}catch(t){console.error("âŒ Erro ao salvar timeline:",t);let e=t instanceof Error?t.message:"Erro desconhecido";return n.NextResponse.json({success:!1,message:"Erro ao processar timeline",error:e},{status:500})}}function d(e){let t=e.reduce((e,t)=>e+(t.keyframes?.length||0),0);return t>50||e.length>10?"high":t>20||e.length>5?"medium":"low"}async function p(e){try{let t=(0,c.getSupabaseForRequest)(e),{data:{user:s},error:r}=await t.auth.getUser();if(r||!s)return n.NextResponse.json({success:!1,message:"N\xe3o autorizado"},{status:401});let{searchParams:o}=new URL(e.url),a=o.get("projectId");if(!a)return n.NextResponse.json({success:!1,message:"projectId \xe9 obrigat\xf3rio"},{status:400});console.log(`ðŸŽ¬ Carregando timeline do projeto ${a}...`);let{data:i,error:l}=await t.from("timelines").select(`
        *,
        projects:project_id (
            id,
            name,
            status,
            user_id
        )
      `).eq("project_id",a).single();if(l||!i)return n.NextResponse.json({success:!1,message:"Timeline n\xe3o encontrada"},{status:404});let u=i.projects,d=u.user_id===s.id;if(!d){let{data:e}=await t.from("project_collaborators").select("role").eq("project_id",a).eq("user_id",s.id).single();e&&["owner","editor"].includes(e.role)&&(d=!0)}if(!d)return n.NextResponse.json({success:!1,message:"Acesso negado"},{status:403});return console.log(`âœ… Timeline carregada: ${i.id} (v${i.version})`),n.NextResponse.json({success:!0,data:{id:i.id,projectId:i.project_id,projectName:u.name,tracks:i.tracks,settings:i.settings,totalDuration:i.total_duration,version:i.version,createdAt:i.created_at,updatedAt:i.updated_at},message:"Timeline carregada com sucesso"})}catch(t){console.error("âŒ Erro ao carregar timeline:",t);let e=t instanceof Error?t.message:"Erro desconhecido";return n.NextResponse.json({success:!1,message:"Erro ao carregar timeline",error:e},{status:500})}}async function m(e){return u(e)}async function g(e){try{let t=(0,c.getSupabaseForRequest)(e),{data:{user:s},error:r}=await t.auth.getUser();if(r||!s)return n.NextResponse.json({success:!1,message:"N\xe3o autorizado"},{status:401});let{searchParams:o}=new URL(e.url),a=o.get("projectId");if(!a)return n.NextResponse.json({success:!1,message:"projectId \xe9 obrigat\xf3rio"},{status:400});console.log(`ðŸ—‘ï¸ Deletando timeline do projeto ${a}...`);let{data:i}=await t.from("projects").select("id, user_id").eq("id",a).single();if(!i)return n.NextResponse.json({success:!1,message:"Projeto n\xe3o encontrado"},{status:404});let l=i.user_id===s.id;if(!l){let{data:e}=await t.from("project_collaborators").select("role").eq("project_id",a).eq("user_id",s.id).single();e&&["owner","editor"].includes(e.role)&&(l=!0)}if(!l)return n.NextResponse.json({success:!1,message:"Sem permiss\xe3o para deletar timeline"},{status:403});let{error:u}=await t.from("timelines").delete().eq("project_id",a);if(u)throw u;return console.log(`âœ… Timeline deletada para projeto: ${a}`),n.NextResponse.json({success:!0,message:"Timeline deletada com sucesso",data:{projectId:a}})}catch(t){console.error("âŒ Erro ao deletar timeline:",t);let e=t instanceof Error?t.message:"Erro desconhecido";return n.NextResponse.json({success:!1,message:"Erro ao deletar timeline",error:e},{status:500})}}async function f(e){try{let t=(0,c.getSupabaseForRequest)(e),{data:{user:s},error:r}=await t.auth.getUser();if(r||!s)return n.NextResponse.json({success:!1,message:"N\xe3o autorizado"},{status:401});let{projectId:o,tracks:a,settings:i,totalDuration:u}=await e.json();if(!o)return n.NextResponse.json({success:!1,message:"projectId \xe9 obrigat\xf3rio"},{status:400});console.log(`ðŸ”§ Atualizando parcialmente timeline do projeto ${o}...`);let{data:p}=await t.from("projects").select("id, user_id").eq("id",o).single();if(!p)return n.NextResponse.json({success:!1,message:"Projeto n\xe3o encontrado"},{status:404});let m=p.user_id===s.id;if(!m){let{data:e}=await t.from("project_collaborators").select("role").eq("project_id",o).eq("user_id",s.id).single();e&&["owner","editor"].includes(e.role)&&(m=!0)}if(!m)return n.NextResponse.json({success:!1,message:"Sem permiss\xe3o para editar este projeto"},{status:403});let g={updated_at:new Date().toISOString()};void 0!==a&&(g.tracks=a),void 0!==i&&(g.settings=i),void 0!==u&&(g.total_duration=Math.ceil(u));let{data:f}=await t.from("timelines").select("version").eq("project_id",o).single();f&&(g.version=(f.version||0)+1);let{data:h,error:j}=await t.from("timelines").update(g).eq("project_id",o).select().single();if(j)throw j;console.log(`âœ… Timeline parcialmente atualizada: ${h.id} (v${h.version})`),await l.k.trackTimelineEdit({userId:s.id,projectId:o,action:"partial_update",trackCount:a?.length||0,totalDuration:h.total_duration});let v=h.tracks||[],_={tracksCount:v.length,keyframesCount:v.reduce((e,t)=>e+(t.keyframes?.length||0),0),avgTrackDuration:v.length>0?v.reduce((e,t)=>e+(t.duration||0),0)/v.length:0,complexity:d(v)};return n.NextResponse.json({success:!0,data:{id:h.id,projectId:h.project_id,version:h.version,totalDuration:h.total_duration,tracks:h.tracks,settings:h.settings,updatedAt:h.updated_at,analytics:_},message:"Timeline atualizada parcialmente com sucesso"})}catch(t){console.error("âŒ Erro ao atualizar parcialmente timeline:",t);let e=t instanceof Error?t.message:"Erro desconhecido";return n.NextResponse.json({success:!1,message:"Erro ao processar atualiza\xe7\xe3o parcial",error:e},{status:500})}}let h=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/v1/timeline/multi-track/route",pathname:"/api/v1/timeline/multi-track",filename:"route",bundlePath:"app/api/v1/timeline/multi-track/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\v1\\timeline\\multi-track\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:j,staticGenerationAsyncStorage:v,serverHooks:_}=h,x="/api/v1/timeline/multi-track/route";function R(){return(0,i.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:v})}},95532:(e,t,s)=>{s.d(t,{k:()=>r});class r{track(e,t,s){console.log("[Analytics] Track event:",e,t),this.buffer.push({event:e,userId:s,properties:t,timestamp:new Date})}async flush(){console.log("[Analytics] Flushing",this.buffer.length,"events"),this.buffer=[]}pageView(e,t){this.track("page_view",{path:e},t)}identify(e,t){console.log("[Analytics] Identify user:",e,t)}static async trackTimelineEdit(e){console.log("[Analytics] Timeline Edit:",e)}static async getFunnelAnalysis(e){return{funnel:[{stage:"upload",count:100,dropoff:0},{stage:"edit",count:85,dropoff:15},{stage:"tts",count:70,dropoff:15},{stage:"render",count:60,dropoff:10},{stage:"download",count:55,dropoff:5}],conversionRates:{upload_to_edit:.85,edit_to_tts:.82,tts_to_render:.86,render_to_download:.92,overall:.55}}}static async getProviderPerformance(e){return"tts"===e.category?[{provider:"elevenlabs",totalRequests:100,successRate:98,errorRate:2,avgLatency:1200},{provider:"azure",totalRequests:50,successRate:99,errorRate:1,avgLatency:800},{provider:"google",totalRequests:30,successRate:97,errorRate:3,avgLatency:600}]:[{provider:"local",totalRequests:200,successRate:95,errorRate:5,avgLatency:3e4}]}static async getSummary(e){return{totalEvents:500,avgDuration:45e3,successRate:92,errorRate:8}}constructor(){this.buffer=[]}}new r},13936:(e,t,s)=>{s.d(t,{e:()=>i,getSupabaseForRequest:()=>c,p:()=>n});var r=s(67721),o=s(61657),a=s(71615);let i=()=>{let e=(0,a.cookies)();return(0,r.createServerClient)("https://ofhzrdiadxigrvmrhaiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ",{cookies:{get:t=>e.get(t)?.value,set(t,s,r){try{e.set({name:t,value:s,...r})}catch(e){}},remove(t,s){try{e.set({name:t,value:"",...s})}catch(e){}}}})},n=(0,o.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}});function c(e){let t=e.headers.get("authorization")||e.headers.get("Authorization");return t?(0,o.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ",{global:{headers:{Authorization:t}},auth:{persistSession:!1,autoRefreshToken:!1}}):i()}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[8948,5972,1657,9702],()=>s(28263));module.exports=r})();