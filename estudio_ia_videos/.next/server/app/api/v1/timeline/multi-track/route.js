"use strict";(()=>{var e={};e.id=2217,e.ids=[2217],e.modules={572934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},554580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},345869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},220399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},430517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},627790:e=>{e.exports=require("assert")},978893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},532615:e=>{e.exports=require("http")},735240:e=>{e.exports=require("https")},986624:e=>{e.exports=require("querystring")},917360:e=>{e.exports=require("url")},521764:e=>{e.exports=require("util")},671568:e=>{e.exports=require("zlib")},528263:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>v,requestAsyncStorage:()=>f,routeModule:()=>g,serverHooks:()=>O,staticGenerationAsyncStorage:()=>j});var o={};r.r(o),r.d(o,{DELETE:()=>p,GET:()=>d,PATCH:()=>m,POST:()=>u,PUT:()=>l});var s=r(349303),n=r(88716),a=r(60670),i=r(387070),c=r(95715);async function u(e){try{let t=await (0,c.getServerSession)(Object(function(){var e=Error("Cannot find module '@/lib/auth/auth-config'");throw e.code="MODULE_NOT_FOUND",e}()));if(!t?.user)return i.NextResponse.json({success:!1,message:"N\xe3o autorizado"},{status:401});let{projectId:r,tracks:o,totalDuration:s,exportSettings:n}=await e.json();if(!r)return i.NextResponse.json({success:!1,message:"projectId \xe9 obrigat\xf3rio"},{status:400});if(console.log(`ðŸŽ¬ Salvando timeline para projeto ${r}...`),!await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).project.findFirst({where:{id:r,userId:t.user.id}}))return i.NextResponse.json({success:!1,message:"Projeto n\xe3o encontrado"},{status:404});let a={fps:n?.fps||30,resolution:n?.resolution||"1920x1080",format:n?.format||"mp4",quality:n?.quality||"hd",zoom:n?.zoom||10,snapToGrid:n?.snapToGrid!==!1,autoSave:n?.autoSave!==!1},u=await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).timeline.upsert({where:{projectId:r},create:{projectId:r,tracks:o,settings:a,totalDuration:Math.ceil(s||0),version:1},update:{tracks:o,settings:a,totalDuration:Math.ceil(s||0),version:{increment:1},updatedAt:new Date}});console.log(`âœ… Timeline salva: ${u.id} (v${u.version})`);let d=t.user,l=d.organizationId||d.currentOrgId||void 0;await Object(function(){var e=Error("Cannot find module '@/lib/analytics/analytics-tracker'");throw e.code="MODULE_NOT_FOUND",e}()).trackTimelineEdit({userId:t.user.id,organizationId:l,projectId:r,action:"update",trackCount:o?.length||0,totalDuration:s||0});let p=o||[],m={tracksCount:p.length,keyframesCount:p.reduce((e,t)=>e+(t.keyframes?.length||0),0),avgTrackDuration:p.length>0?p.reduce((e,t)=>e+(t.duration||0),0)/p.length:0,complexity:function(e){let t=e.reduce((e,t)=>e+(t.keyframes?.length||0),0);return t>50||e.length>10?"high":t>20||e.length>5?"medium":"low"}(p)};return i.NextResponse.json({success:!0,data:{id:u.id,projectId:u.projectId,version:u.version,totalDuration:u.totalDuration,tracks:u.tracks,settings:u.settings,updatedAt:u.updatedAt.toISOString(),analytics:m},message:"Timeline salva com sucesso"})}catch(t){console.error("âŒ Erro ao salvar timeline:",t);let e=t instanceof Error?t.message:"Erro desconhecido";return i.NextResponse.json({success:!1,message:"Erro ao processar timeline",error:e},{status:500})}}async function d(e){try{let t=await (0,c.getServerSession)(Object(function(){var e=Error("Cannot find module '@/lib/auth/auth-config'");throw e.code="MODULE_NOT_FOUND",e}()));if(!t?.user)return i.NextResponse.json({success:!1,message:"N\xe3o autorizado"},{status:401});let{searchParams:r}=new URL(e.url),o=r.get("projectId");if(!o)return i.NextResponse.json({success:!1,message:"projectId \xe9 obrigat\xf3rio"},{status:400});console.log(`ðŸŽ¬ Carregando timeline do projeto ${o}...`);let s=await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).timeline.findUnique({where:{projectId:o},include:{project:{select:{id:!0,name:!0,status:!0,userId:!0}}}});if(!s)return i.NextResponse.json({success:!1,message:"Timeline n\xe3o encontrada"},{status:404});if(s.project.userId!==t.user.id)return i.NextResponse.json({success:!1,message:"Acesso negado"},{status:403});return console.log(`âœ… Timeline carregada: ${s.id} (v${s.version})`),i.NextResponse.json({success:!0,data:{id:s.id,projectId:s.projectId,projectName:s.project.name,tracks:s.tracks,settings:s.settings,totalDuration:s.totalDuration,version:s.version,createdAt:s.createdAt.toISOString(),updatedAt:s.updatedAt.toISOString()},message:"Timeline carregada com sucesso"})}catch(t){console.error("âŒ Erro ao carregar timeline:",t);let e=t instanceof Error?t.message:"Erro desconhecido";return i.NextResponse.json({success:!1,message:"Erro ao carregar timeline",error:e},{status:500})}}async function l(e){try{let{timelineId:t,tracks:r,settings:o}=await e.json(),s={id:t,tracks:r,settings:o,lastModified:new Date().toISOString(),version:Math.floor(Date.now()/1e3),changeLog:[{timestamp:new Date().toISOString(),action:"timeline_updated",user:"current_user",changes:["tracks_modified","settings_updated"]}]};return i.NextResponse.json({success:!0,data:s,message:"Timeline atualizada com sucesso"})}catch(e){return console.error("Update timeline error:",e),i.NextResponse.json({success:!1,message:"Erro ao atualizar timeline"},{status:500})}}async function p(e){try{let t=await (0,c.getServerSession)(Object(function(){var e=Error("Cannot find module '@/lib/auth/auth-config'");throw e.code="MODULE_NOT_FOUND",e}()));if(!t?.user)return i.NextResponse.json({success:!1,message:"N\xe3o autorizado"},{status:401});let{searchParams:r}=new URL(e.url),o=r.get("projectId");if(!o)return i.NextResponse.json({success:!1,message:"projectId \xe9 obrigat\xf3rio"},{status:400});if(console.log(`ðŸ—‘ï¸ Deletando timeline do projeto ${o}...`),!await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).project.findFirst({where:{id:o,userId:t.user.id}}))return i.NextResponse.json({success:!1,message:"Projeto n\xe3o encontrado"},{status:404});let s=await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).timeline.delete({where:{projectId:o}});return console.log(`âœ… Timeline deletada: ${s.id}`),i.NextResponse.json({success:!0,message:"Timeline deletada com sucesso",data:{id:s.id,projectId:s.projectId}})}catch(t){if(t&&"object"==typeof t&&"code"in t&&"P2025"===t.code)return i.NextResponse.json({success:!1,message:"Timeline n\xe3o encontrada"},{status:404});console.error("âŒ Erro ao deletar timeline:",t);let e=t instanceof Error?t.message:"Erro desconhecido";return i.NextResponse.json({success:!1,message:"Erro ao deletar timeline",error:e},{status:500})}}async function m(e){try{let t=await (0,c.getServerSession)(Object(function(){var e=Error("Cannot find module '@/lib/auth/auth-config'");throw e.code="MODULE_NOT_FOUND",e}()));if(!t?.user)return i.NextResponse.json({success:!1,message:"N\xe3o autorizado"},{status:401});let{projectId:r,tracks:o,settings:s,totalDuration:n}=await e.json();if(!r)return i.NextResponse.json({success:!1,message:"projectId \xe9 obrigat\xf3rio"},{status:400});if(console.log(`ðŸ”§ Atualizando parcialmente timeline do projeto ${r}...`),!await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).project.findFirst({where:{id:r,userId:t.user.id}}))return i.NextResponse.json({success:!1,message:"Projeto n\xe3o encontrado"},{status:404});let a={version:{increment:1},updatedAt:new Date};void 0!==o&&(a.tracks=o),void 0!==s&&(a.settings=s),void 0!==n&&(a.totalDuration=Math.ceil(n));let u=await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).timeline.update({where:{projectId:r},data:a});console.log(`âœ… Timeline parcialmente atualizada: ${u.id} (v${u.version})`);let d=t.user,l=d.organizationId||d.currentOrgId||void 0;return await Object(function(){var e=Error("Cannot find module '@/lib/analytics/analytics-tracker'");throw e.code="MODULE_NOT_FOUND",e}()).trackTimelineEdit({userId:t.user.id,organizationId:l,projectId:r,action:"partial_update",trackCount:o?.length||0,totalDuration:u.totalDuration}),i.NextResponse.json({success:!0,data:{id:u.id,projectId:u.projectId,version:u.version,totalDuration:u.totalDuration,tracks:u.tracks,settings:u.settings,updatedAt:u.updatedAt.toISOString()},message:"Timeline atualizada parcialmente com sucesso"})}catch(t){if(t&&"object"==typeof t&&"code"in t&&"P2025"===t.code)return i.NextResponse.json({success:!1,message:"Timeline n\xe3o encontrada"},{status:404});console.error("âŒ Erro ao atualizar parcialmente timeline:",t);let e=t instanceof Error?t.message:"Erro desconhecido";return i.NextResponse.json({success:!1,message:"Erro ao processar atualiza\xe7\xe3o parcial",error:e},{status:500})}}(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e})(),function(){var e=Error("Cannot find module '@/lib/auth/auth-config'");throw e.code="MODULE_NOT_FOUND",e}(),function(){var e=Error("Cannot find module '@/lib/analytics/analytics-tracker'");throw e.code="MODULE_NOT_FOUND",e}();let g=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/v1/timeline/multi-track/route",pathname:"/api/v1/timeline/multi-track",filename:"route",bundlePath:"app/api/v1/timeline/multi-track/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\v1\\timeline\\multi-track\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:f,staticGenerationAsyncStorage:j,serverHooks:O}=g,h="/api/v1/timeline/multi-track/route";function v(){return(0,a.patchFetch)({serverHooks:O,staticGenerationAsyncStorage:j})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[8948,5972,5715],()=>r(528263));module.exports=o})();