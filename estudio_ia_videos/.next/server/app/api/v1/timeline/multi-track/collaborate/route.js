"use strict";(()=>{var e={};e.id=1658,e.ids=[1658],e.modules={572934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},554580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},345869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},220399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},430517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},627790:e=>{e.exports=require("assert")},978893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},532615:e=>{e.exports=require("http")},735240:e=>{e.exports=require("https")},986624:e=>{e.exports=require("querystring")},917360:e=>{e.exports=require("url")},521764:e=>{e.exports=require("util")},671568:e=>{e.exports=require("zlib")},4960:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>f,patchFetch:()=>k,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>O,staticGenerationAsyncStorage:()=>g});var s={};t.r(s),t.d(s,{GET:()=>d,POST:()=>c,PUT:()=>l});var o=t(349303),a=t(88716),n=t(60670),i=t(387070),u=t(95715);async function c(e){try{let r=await (0,u.getServerSession)(Object(function(){var e=Error("Cannot find module '@/lib/auth/auth-config'");throw e.code="MODULE_NOT_FOUND",e}()));if(!r?.user)return i.NextResponse.json({success:!1,message:"N\xe3o autorizado"},{status:401});let{projectId:t,trackId:s,action:o}=await e.json();if(!t||!s||!o)return i.NextResponse.json({success:!1,message:"projectId, trackId e action s\xe3o obrigat\xf3rios"},{status:400});if(!["lock","unlock"].includes(o))return i.NextResponse.json({success:!1,message:'action deve ser "lock" ou "unlock"'},{status:400});if(console.log(`ðŸ”’ ${o.toUpperCase()} track ${s} no projeto ${t}...`),!await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).project.findFirst({where:{id:t,userId:r.user.id}}))return i.NextResponse.json({success:!1,message:"Projeto n\xe3o encontrado"},{status:404});if("lock"!==o)return await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).timelineTrackLock.deleteMany({where:{projectId:t,trackId:s,userId:r.user.id}}),console.log(`âœ… Track desbloqueada: ${s}`),i.NextResponse.json({success:!0,data:{trackId:s,userId:r.user.id,unlockedAt:new Date().toISOString()},message:"Track desbloqueada com sucesso"});{let e=await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).timelineTrackLock.findFirst({where:{projectId:t,trackId:s,userId:{not:r.user.id}}});if(e)return i.NextResponse.json({success:!1,message:"Track j\xe1 est\xe1 bloqueada por outro usu\xe1rio",lockedBy:e.userId,lockedAt:e.createdAt},{status:409});let o=await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).timelineTrackLock.upsert({where:{projectId_trackId_userId:{projectId:t,trackId:s,userId:r.user.id}},create:{projectId:t,trackId:s,userId:r.user.id},update:{updatedAt:new Date}});return console.log(`âœ… Track bloqueada: ${o.id}`),i.NextResponse.json({success:!0,data:{id:o.id,trackId:o.trackId,userId:o.userId,lockedAt:o.createdAt.toISOString()},message:"Track bloqueada com sucesso"})}}catch(e){return console.error("âŒ Erro ao gerenciar lock:",e),i.NextResponse.json({success:!1,message:"Erro ao processar lock",error:e.message},{status:500})}}async function d(e){try{let r=await (0,u.getServerSession)(Object(function(){var e=Error("Cannot find module '@/lib/auth/auth-config'");throw e.code="MODULE_NOT_FOUND",e}()));if(!r?.user)return i.NextResponse.json({success:!1,message:"N\xe3o autorizado"},{status:401});let{searchParams:t}=new URL(e.url),s=t.get("projectId");if(!s)return i.NextResponse.json({success:!1,message:"projectId \xe9 obrigat\xf3rio"},{status:400});let o=await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).timelineTrackLock.findMany({where:{projectId:s},include:{user:{select:{id:!0,name:!0,email:!0,image:!0}}}}),a=await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).timelinePresence.findMany({where:{projectId:s,lastSeenAt:{gte:new Date(Date.now()-3e5)}},include:{user:{select:{id:!0,name:!0,email:!0,image:!0}}}});return i.NextResponse.json({success:!0,data:{locks:o.map(e=>({id:e.id,trackId:e.trackId,userId:e.userId,userName:e.user.name,userImage:e.user.image,lockedAt:e.createdAt.toISOString()})),activeUsers:a.map(e=>({userId:e.userId,userName:e.user.name,userImage:e.user.image,lastSeenAt:e.lastSeenAt.toISOString(),currentTrackId:e.currentTrackId}))}})}catch(e){return console.error("âŒ Erro ao buscar locks:",e),i.NextResponse.json({success:!1,message:"Erro ao buscar informa\xe7\xf5es de colabora\xe7\xe3o",error:e.message},{status:500})}}async function l(e){try{let r=await (0,u.getServerSession)(Object(function(){var e=Error("Cannot find module '@/lib/auth/auth-config'");throw e.code="MODULE_NOT_FOUND",e}()));if(!r?.user)return i.NextResponse.json({success:!1,message:"N\xe3o autorizado"},{status:401});let{projectId:t,currentTrackId:s}=await e.json();if(!t)return i.NextResponse.json({success:!1,message:"projectId \xe9 obrigat\xf3rio"},{status:400});let o=await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).timelinePresence.upsert({where:{projectId_userId:{projectId:t,userId:r.user.id}},create:{projectId:t,userId:r.user.id,currentTrackId:s||null,lastSeenAt:new Date},update:{currentTrackId:s||null,lastSeenAt:new Date}});return i.NextResponse.json({success:!0,data:{userId:o.userId,lastSeenAt:o.lastSeenAt.toISOString()},message:"Presen\xe7a atualizada"})}catch(e){return console.error("âŒ Erro ao atualizar presen\xe7a:",e),i.NextResponse.json({success:!1,message:"Erro ao atualizar presen\xe7a",error:e.message},{status:500})}}(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e})(),function(){var e=Error("Cannot find module '@/lib/auth/auth-config'");throw e.code="MODULE_NOT_FOUND",e}();let p=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/v1/timeline/multi-track/collaborate/route",pathname:"/api/v1/timeline/multi-track/collaborate",filename:"route",bundlePath:"app/api/v1/timeline/multi-track/collaborate/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\v1\\timeline\\multi-track\\collaborate\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:O}=p,f="/api/v1/timeline/multi-track/collaborate/route";function k(){return(0,n.patchFetch)({serverHooks:O,staticGenerationAsyncStorage:g})}}};var r=require("../../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[8948,5972,5715],()=>t(4960));module.exports=s})();