"use strict";(()=>{var e={};e.id=9439,e.ids=[9439],e.modules={572934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},554580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},345869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},220399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},430517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},627790:e=>{e.exports=require("assert")},978893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},532615:e=>{e.exports=require("http")},735240:e=>{e.exports=require("https")},986624:e=>{e.exports=require("querystring")},917360:e=>{e.exports=require("url")},521764:e=>{e.exports=require("util")},671568:e=>{e.exports=require("zlib")},204241:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>N,patchFetch:()=>j,requestAsyncStorage:()=>g,routeModule:()=>p,serverHooks:()=>f,staticGenerationAsyncStorage:()=>O});var s={};r.r(s),r.d(s,{DELETE:()=>m,GET:()=>d,POST:()=>u,PUT:()=>l});var a=r(349303),o=r(88716),n=r(60670),i=r(387070),c=r(95715);async function u(e){try{let t=await (0,c.getServerSession)(Object(function(){var e=Error("Cannot find module '@/lib/auth/auth-config'");throw e.code="MODULE_NOT_FOUND",e}()));if(!t?.user)return i.NextResponse.json({success:!1,message:"N\xe3o autorizado"},{status:401});let{projectId:r,name:s,description:a,category:o,isPublic:n}=await e.json();if(!r||!s)return i.NextResponse.json({success:!1,message:"projectId e name s\xe3o obrigat\xf3rios"},{status:400});console.log(`ðŸ“‹ Criando template "${s}" do projeto ${r}...`);let u=await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).timeline.findUnique({where:{projectId:r}});if(!u)return i.NextResponse.json({success:!1,message:"Timeline n\xe3o encontrada"},{status:404});let d=await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).timelineTemplate.create({data:{name:s,description:a||"",category:o||"custom",isPublic:n||!1,createdBy:t.user.id,tracks:u.tracks,settings:u.settings,totalDuration:u.totalDuration,metadata:{originalProjectId:r,tracksCount:Array.isArray(u.tracks)?u.tracks.length:0,version:u.version}}});return console.log(`âœ… Template criado: ${d.id}`),i.NextResponse.json({success:!0,data:{id:d.id,name:d.name,description:d.description,category:d.category,isPublic:d.isPublic,tracksCount:d.metadata?.tracksCount||0,totalDuration:d.totalDuration,createdAt:d.createdAt.toISOString()},message:"Template criado com sucesso"})}catch(e){return console.error("âŒ Erro ao criar template:",e),i.NextResponse.json({success:!1,message:"Erro ao criar template",error:e.message},{status:500})}}async function d(e){try{let t=await (0,c.getServerSession)(Object(function(){var e=Error("Cannot find module '@/lib/auth/auth-config'");throw e.code="MODULE_NOT_FOUND",e}()));if(!t?.user)return i.NextResponse.json({success:!1,message:"N\xe3o autorizado"},{status:401});let{searchParams:r}=new URL(e.url),s=r.get("templateId"),a=r.get("category"),o=r.get("search"),n=parseInt(r.get("limit")||"20",10),u=parseInt(r.get("offset")||"0",10);if(s){let e=await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).timelineTemplate.findUnique({where:{id:s},include:{creator:{select:{id:!0,name:!0,image:!0}}}});if(!e)return i.NextResponse.json({success:!1,message:"Template n\xe3o encontrado"},{status:404});if(!e.isPublic&&e.createdBy!==t.user.id)return i.NextResponse.json({success:!1,message:"Acesso negado"},{status:403});return i.NextResponse.json({success:!0,data:{id:e.id,name:e.name,description:e.description,category:e.category,isPublic:e.isPublic,tracks:e.tracks,settings:e.settings,totalDuration:e.totalDuration,metadata:e.metadata,creator:{id:e.creator.id,name:e.creator.name,image:e.creator.image},createdAt:e.createdAt.toISOString(),usageCount:e.usageCount}})}let d={OR:[{isPublic:!0},{createdBy:t.user.id}]};a&&(d.category=a),o&&(d.OR=[{name:{contains:o,mode:"insensitive"}},{description:{contains:o,mode:"insensitive"}}]);let l=await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).timelineTemplate.findMany({where:d,include:{creator:{select:{id:!0,name:!0,image:!0}}},orderBy:[{usageCount:"desc"},{createdAt:"desc"}],take:n,skip:u}),m=await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).timelineTemplate.count({where:d});return i.NextResponse.json({success:!0,data:{templates:l.map(e=>({id:e.id,name:e.name,description:e.description,category:e.category,isPublic:e.isPublic,tracksCount:e.metadata?.tracksCount||0,totalDuration:e.totalDuration,usageCount:e.usageCount,creator:{id:e.creator.id,name:e.creator.name,image:e.creator.image},createdAt:e.createdAt.toISOString()})),pagination:{total:m,limit:n,offset:u,hasMore:u+l.length<m}}})}catch(e){return console.error("âŒ Erro ao buscar templates:",e),i.NextResponse.json({success:!1,message:"Erro ao buscar templates",error:e.message},{status:500})}}async function l(e){try{let t=await (0,c.getServerSession)(Object(function(){var e=Error("Cannot find module '@/lib/auth/auth-config'");throw e.code="MODULE_NOT_FOUND",e}()));if(!t?.user)return i.NextResponse.json({success:!1,message:"N\xe3o autorizado"},{status:401});let{templateId:r,projectId:s}=await e.json();if(!r||!s)return i.NextResponse.json({success:!1,message:"templateId e projectId s\xe3o obrigat\xf3rios"},{status:400});console.log(`ðŸ“‹ Aplicando template ${r} ao projeto ${s}...`);let a=await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).timelineTemplate.findUnique({where:{id:r}});if(!a)return i.NextResponse.json({success:!1,message:"Template n\xe3o encontrado"},{status:404});if(!a.isPublic&&a.createdBy!==t.user.id)return i.NextResponse.json({success:!1,message:"Acesso negado"},{status:403});if(!await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).project.findFirst({where:{id:s,userId:t.user.id}}))return i.NextResponse.json({success:!1,message:"Projeto n\xe3o encontrado"},{status:404});let o=await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).timeline.upsert({where:{projectId:s},create:{projectId:s,tracks:a.tracks,settings:a.settings,totalDuration:a.totalDuration,version:1},update:{tracks:a.tracks,settings:a.settings,totalDuration:a.totalDuration,version:{increment:1},updatedAt:new Date}});return await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).timelineTemplate.update({where:{id:r},data:{usageCount:{increment:1}}}),console.log(`âœ… Template aplicado \xe0 timeline ${o.id}`),i.NextResponse.json({success:!0,data:{id:o.id,projectId:o.projectId,version:o.version,tracks:o.tracks,settings:o.settings,totalDuration:o.totalDuration,updatedAt:o.updatedAt.toISOString()},message:"Template aplicado com sucesso"})}catch(e){return console.error("âŒ Erro ao aplicar template:",e),i.NextResponse.json({success:!1,message:"Erro ao aplicar template",error:e.message},{status:500})}}async function m(e){try{let t=await (0,c.getServerSession)(Object(function(){var e=Error("Cannot find module '@/lib/auth/auth-config'");throw e.code="MODULE_NOT_FOUND",e}()));if(!t?.user)return i.NextResponse.json({success:!1,message:"N\xe3o autorizado"},{status:401});let{searchParams:r}=new URL(e.url),s=r.get("templateId");if(!s)return i.NextResponse.json({success:!1,message:"templateId \xe9 obrigat\xf3rio"},{status:400});let a=await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).timelineTemplate.findUnique({where:{id:s}});if(!a)return i.NextResponse.json({success:!1,message:"Template n\xe3o encontrado"},{status:404});if(a.createdBy!==t.user.id)return i.NextResponse.json({success:!1,message:"Acesso negado - apenas o criador pode deletar"},{status:403});return await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).timelineTemplate.delete({where:{id:s}}),console.log(`âœ… Template deletado: ${s}`),i.NextResponse.json({success:!0,message:"Template deletado com sucesso"})}catch(e){return console.error("âŒ Erro ao deletar template:",e),i.NextResponse.json({success:!1,message:"Erro ao deletar template",error:e.message},{status:500})}}(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e})(),function(){var e=Error("Cannot find module '@/lib/auth/auth-config'");throw e.code="MODULE_NOT_FOUND",e}();let p=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/v1/timeline/multi-track/templates/route",pathname:"/api/v1/timeline/multi-track/templates",filename:"route",bundlePath:"app/api/v1/timeline/multi-track/templates/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\v1\\timeline\\multi-track\\templates\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:O,serverHooks:f}=p,N="/api/v1/timeline/multi-track/templates/route";function j(){return(0,n.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:O})}}};var t=require("../../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972,5715],()=>r(204241));module.exports=s})();