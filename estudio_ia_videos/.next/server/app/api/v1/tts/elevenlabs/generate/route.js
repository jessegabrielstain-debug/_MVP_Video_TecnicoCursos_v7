"use strict";(()=>{var t={};t.id=4654,t.ids=[4654],t.modules={220399:t=>{t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},430517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},978893:t=>{t.exports=require("buffer")},17702:t=>{t.exports=require("events")},592048:t=>{t.exports=require("fs")},19801:t=>{t.exports=require("os")},555315:t=>{t.exports=require("path")},276162:t=>{t.exports=require("stream")},607163:(t,e,r)=>{r.r(e),r.d(e,{originalPathname:()=>tv,patchFetch:()=>tP,requestAsyncStorage:()=>tb,routeModule:()=>ty,serverHooks:()=>tw,staticGenerationAsyncStorage:()=>tC});var a,o={};r.r(o),r.d(o,{POST:()=>tg});var s=r(349303),i=r(88716),n=r(60670),l=r(387070);let u=require("@aws-sdk/client-s3");class AbortSignal{onabort=null;_aborted=!1;constructor(){Object.defineProperty(this,"_aborted",{value:!1,writable:!0})}get aborted(){return this._aborted}abort(){this._aborted=!0,this.onabort&&(this.onabort(this),this.onabort=null)}}class d{signal=new AbortSignal;abort(){this.signal.abort()}}let c=t=>{let e;if("string"==typeof t)return c(new URL(t));let{hostname:r,pathname:a,port:o,protocol:s,search:i}=t;return i&&(e=function(t){let e={};if(t=t.replace(/^\?/,""))for(let r of t.split("&")){let[t,a=null]=r.split("=");t=decodeURIComponent(t),a&&(a=decodeURIComponent(a)),t in e?Array.isArray(e[t])?e[t].push(a):e[t]=[e[t],a]:e[t]=a}return e}(i)),{hostname:r,port:o?parseInt(o):void 0,protocol:s,path:a,query:e}},p=t=>"object"==typeof t?"url"in t?c(t.url):t:c(t),h=async t=>{let e=t?.Bucket||"";if("string"==typeof t.Bucket&&(t.Bucket=e.replace(/#/g,encodeURIComponent("#")).replace(/\?/g,encodeURIComponent("?"))),b(e)){if(!0===t.ForcePathStyle)throw Error("Path-style addressing cannot be used with ARN buckets")}else y(e)&&(-1===e.indexOf(".")||String(t.Endpoint).startsWith("http:"))&&e.toLowerCase()===e&&!(e.length<3)||(t.ForcePathStyle=!0);return t.DisableMultiRegionAccessPoints&&(t.disableMultiRegionAccessPoints=!0,t.DisableMRAP=!0),t},f=/^[a-z0-9][a-z0-9\.\-]{1,61}[a-z0-9]$/,m=/(\d+\.){3}\d+/,g=/\.\./,y=t=>f.test(t)&&!m.test(t)&&!g.test(t),b=t=>{let[e,r,a,,,o]=t.split(":"),s="arn"===e&&t.split(":").length>=6,i=!!(s&&r&&a&&o);if(s&&!i)throw Error(`Invalid ARN: ${t} was an invalid ARN.`);return i},C=(t,e,r)=>{let a=async()=>{let a=r[t]??r[e];return"function"==typeof a?a():a};return"credentialScope"===t||"CredentialScope"===e?async()=>{let t="function"==typeof r.credentials?await r.credentials():r.credentials;return t?.credentialScope??t?.CredentialScope}:"accountId"===t||"AccountId"===e?async()=>{let t="function"==typeof r.credentials?await r.credentials():r.credentials;return t?.accountId??t?.AccountId}:"endpoint"===t||"endpoint"===e?async()=>{if(!1===r.isCustomEndpoint)return;let t=await a();if(t&&"object"==typeof t){if("url"in t)return t.url.href;if("hostname"in t){let{protocol:e,hostname:r,port:a,path:o}=t;return`${e}//${r}${a?":"+a:""}${o}`}}return t}:a},w=(t,e,r)=>{let a,o,s;let i=!1,n=async()=>{o||(o=t());try{a=await o,s=!0,i=!1}finally{o=void 0}return a};return void 0===e?async t=>((!s||t?.forceRefresh)&&(a=await n()),a):async t=>((!s||t?.forceRefresh)&&(a=await n()),i||(r&&!r(a)?i=!0:e(a)&&await n()),a)};class v extends Error{name="ProviderError";tryNextLink;constructor(t,e=!0){let r;let a=!0;"boolean"==typeof e?(r=void 0,a=e):null!=e&&"object"==typeof e&&(r=e.logger,a=e.tryNextLink??!0),super(t),this.tryNextLink=a,Object.setPrototypeOf(this,v.prototype),r?.debug?.(`@smithy/property-provider ${a?"->":"(!)"} ${t}`)}static from(t,e=!0){return Object.assign(new this(t.message,e),t)}}let P=(...t)=>async()=>{let e;if(0===t.length)throw new v("No providers in chain");for(let r of t)try{return await r()}catch(t){if(e=t,t?.tryNextLink)continue;throw t}throw e};class _ extends v{name="CredentialsProviderError";constructor(t,e=!0){super(t,e),Object.setPrototypeOf(this,_.prototype)}}function E(t){try{let e=new Set(Array.from(t.match(/([A-Z_]){3,}/g)??[]));return e.delete("CONFIG"),e.delete("CONFIG_PREFIX_SEPARATOR"),e.delete("ENV"),[...e].join(", ")}catch(e){return t}}let S=(t,e)=>async()=>{try{let r=t(process.env,e);if(void 0===r)throw Error();return r}catch(r){throw new _(r.message||`Not found in ENV: ${E(t.toString())}`,{logger:e?.logger})}},k=t=>t.profile||process.env.AWS_PROFILE||"default";var A=r(555315);!function(t){t.PROFILE="profile",t.SSO_SESSION="sso-session",t.SERVICES="services"}(a||(a={}));let U=t=>Object.entries(t).filter(([t])=>{let e=t.indexOf(W);return -1!==e&&Object.values(a).includes(t.substring(0,e))}).reduce((t,[e,r])=>{let o=e.indexOf(W);return t[e.substring(0,o)===a.PROFILE?e.substring(o+1):e]=r,t},{...t.default&&{default:t.default}});var R=r(19801);let I={},B=()=>process&&process.geteuid?`${process.geteuid()}`:"DEFAULT",x=()=>{let{HOME:t,USERPROFILE:e,HOMEPATH:r,HOMEDRIVE:a=`C:${A.sep}`}=process.env;if(t)return t;if(e)return e;if(r)return`${a}${r}`;let o=B();return I[o]||(I[o]=(0,R.homedir)()),I[o]},$=()=>process.env.AWS_CONFIG_FILE||(0,A.join)(x(),".aws","config"),N=()=>process.env.AWS_SHARED_CREDENTIALS_FILE||(0,A.join)(x(),".aws","credentials"),O=/^([\w-]+)\s(["'])?([\w-@\+\.%:/]+)\2$/,M=["__proto__","profile __proto__"],j=t=>{let e,r;let o={};for(let s of t.split(/\r?\n/)){let t=s.split(/(^|\s)[;#]/)[0].trim();if("["===t[0]&&"]"===t[t.length-1]){e=void 0,r=void 0;let o=t.substring(1,t.length-1),s=O.exec(o);if(s){let[,t,,r]=s;Object.values(a).includes(t)&&(e=[t,r].join(W))}else e=o;if(M.includes(o))throw Error(`Found invalid profile name "${o}"`)}else if(e){let a=t.indexOf("=");if(![0,-1].includes(a)){let[i,n]=[t.substring(0,a).trim(),t.substring(a+1).trim()];if(""===n)r=i;else{r&&s.trimStart()===s&&(r=void 0),o[e]=o[e]||{};let t=r?[r,i].join(W):i;o[e][t]=n}}}}return o};var T=r(592048);let{readFile:L}=T.promises,F={},q={},z=(t,e)=>void 0!==q[t]?q[t]:((!F[t]||e?.ignoreCache)&&(F[t]=L(t,"utf8")),F[t]),K=()=>({}),W=".",D=async(t={})=>{let{filepath:e=N(),configFilepath:r=$()}=t,a=x(),o=e;e.startsWith("~/")&&(o=(0,A.join)(a,e.slice(2)));let s=r;r.startsWith("~/")&&(s=(0,A.join)(a,r.slice(2)));let i=await Promise.all([z(s,{ignoreCache:t.ignoreCache}).then(j).then(U).catch(K),z(o,{ignoreCache:t.ignoreCache}).then(j).catch(K)]);return{configFile:i[0],credentialsFile:i[1]}},H=(t,{preferredFile:e="config",...r}={})=>async()=>{let a=k(r),{configFile:o,credentialsFile:s}=await D(r),i=s[a]||{},n=o[a]||{},l="config"===e?{...i,...n}:{...n,...i};try{let r=t(l,"config"===e?o:s);if(void 0===r)throw Error();return r}catch(e){throw new _(e.message||`Not found in config files w/ profile [${a}]: ${E(t.toString())}`,{logger:r.logger})}},V=t=>()=>Promise.resolve(t),G=t=>"function"==typeof t,X=t=>G(t)?async()=>await t():V(t),Z=({environmentVariableSelector:t,configFileSelector:e,default:r},a={})=>{let{signingName:o,logger:s}=a;return w(P(S(t,{signingName:o,logger:s}),H(e,a),X(r)))},J="AWS_ENDPOINT_URL",Y="endpoint_url",Q=t=>({environmentVariableSelector:e=>{let r=e[[J,...t.split(" ").map(t=>t.toUpperCase())].join("_")];if(r)return r;let a=e[J];if(a)return a},configFileSelector:(e,r)=>{if(r&&e.services){let a=r[["services",e.services].join(W)];if(a){let e=a[[t.split(" ").map(t=>t.toLowerCase()).join("_"),Y].join(W)];if(e)return e}}let a=e[Y];if(a)return a},default:void 0}),tt=async t=>Z(Q(t??""))(),te=async(t,e,r,a)=>{if(!r.isCustomEndpoint){let t;(t=r.serviceConfiguredEndpoint?await r.serviceConfiguredEndpoint():await tt(r.serviceId))&&(r.endpoint=()=>Promise.resolve(p(t)),r.isCustomEndpoint=!0)}let o=await tr(t,e,r);if("function"!=typeof r.endpointProvider)throw Error("config.endpointProvider is not set.");return r.endpointProvider(o,a)},tr=async(t,e,r)=>{let a={},o=e?.getEndpointParameterInstructions?.()||{};for(let[e,s]of Object.entries(o))switch(s.type){case"staticContextParams":a[e]=s.value;break;case"contextParams":a[e]=t[s.name];break;case"clientContextParams":case"builtInParams":a[e]=await C(s.name,e,r)();break;case"operationContextParams":a[e]=s.get(t);break;default:throw Error("Unrecognized endpoint parameter instruction: "+JSON.stringify(s))}return 0===Object.keys(o).length&&Object.assign(a,r),"s3"===String(r.serviceId).toLowerCase()&&await h(a),a};function ta(t){return encodeURIComponent(t).replace(/[!'()*]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})}var to=r(17702),ts=r(978893);let ti={lstatSync:()=>{},runtime:"node",lstatSync:T.lstatSync},tn=t=>{if(null==t)return 0;if("string"==typeof t)return ts.Buffer.byteLength(t);if("number"==typeof t.byteLength)return t.byteLength;if("number"==typeof t.length)return t.length;if("number"==typeof t.size)return t.size;if("string"==typeof t.path)try{return ti.lstatSync(t.path).size}catch(t){}};var tl=r(276162);async function*tu(t,e,r){let a=1,o={chunks:[],length:0};for await(let s of r(t))for(o.chunks.push(s),o.length+=s.byteLength;o.length>e;){let t=o.chunks.length>1?ts.Buffer.concat(o.chunks):o.chunks[0];yield{partNumber:a,data:t.subarray(0,e)},o.chunks=[t.subarray(e)],o.length=o.chunks[0].byteLength,a+=1}yield{partNumber:a,data:1!==o.chunks.length?ts.Buffer.concat(o.chunks):o.chunks[0],lastPart:!0}}async function*td(t,e){let r=1,a=0,o=e;for(;o<t.byteLength;)yield{partNumber:r,data:t.subarray(a,o)},r+=1,o=(a=o)+e;yield{partNumber:r,data:t.subarray(a),lastPart:!0}}async function*tc(t){for await(let e of t)ts.Buffer.isBuffer(e)||e instanceof Uint8Array?yield e:yield ts.Buffer.from(e)}async function*tp(t){let e=t.getReader();try{for(;;){let{done:t,value:r}=await e.read();if(t)return;ts.Buffer.isBuffer(r)||r instanceof Uint8Array?yield r:yield ts.Buffer.from(r)}}catch(t){throw t}finally{e.releaseLock()}}let th=(t,e)=>{if(t instanceof Uint8Array)return td(t,e);if(t instanceof tl.Readable)return tu(t,e,tc);if(t instanceof String||"string"==typeof t)return td(ts.Buffer.from(t),e);if("function"==typeof t.stream)return tu(t.stream(),e,tp);if(t instanceof ReadableStream)return tu(t,e,tp);throw Error("Body Data is unsupported format, expected data to be one of: string | Uint8Array | Buffer | Readable | ReadableStream | Blob;.")};class tf extends to.EventEmitter{static MIN_PART_SIZE=5242880;MAX_PARTS=1e4;queueSize=4;partSize=tf.MIN_PART_SIZE;leavePartsOnError=!1;tags=[];client;params;totalBytes;bytesUploadedSoFar;abortController;concurrentUploaders=[];createMultiPartPromise;abortMultipartUploadCommand=null;uploadedParts=[];uploadEnqueuedPartsCount=0;uploadId;uploadEvent;isMultiPart=!0;singleUploadResult;sent=!1;constructor(t){super(),this.queueSize=t.queueSize||this.queueSize,this.partSize=t.partSize||this.partSize,this.leavePartsOnError=t.leavePartsOnError||this.leavePartsOnError,this.tags=t.tags||this.tags,this.client=t.client,this.params=t.params,this.__validateInput(),this.totalBytes=tn(this.params.Body),this.bytesUploadedSoFar=0,this.abortController=t.abortController??new d}async abort(){this.abortController.abort()}async done(){if(this.sent)throw Error("@aws-sdk/lib-storage: this instance of Upload has already executed .done(). Create a new instance.");return this.sent=!0,await Promise.race([this.__doMultipartUpload(),this.__abortTimeout(this.abortController.signal)])}on(t,e){return this.uploadEvent=t,super.on(t,e)}async __uploadUsingPut(t){this.isMultiPart=!1;let e={...this.params,Body:t.data},r=this.client.config,a=r.requestHandler,o=a instanceof to.EventEmitter?a:null,s=e=>{this.bytesUploadedSoFar=e.loaded,this.totalBytes=e.total,this.__notifyProgress({loaded:this.bytesUploadedSoFar,total:this.totalBytes,part:t.partNumber,Key:this.params.Key,Bucket:this.params.Bucket})};null!==o&&o.on("xhr.upload.progress",s);let i=await Promise.all([this.client.send(new u.PutObjectCommand(e)),r?.endpoint?.()]),n=i[0],l=i[1];if(l||(l=p(await te(e,u.PutObjectCommand,{...r}))),!l)throw Error('Could not resolve endpoint from S3 "client.config.endpoint()" nor EndpointsV2.');null!==o&&o.off("xhr.upload.progress",s);let d=this.params.Key.split("/").map(t=>ta(t)).join("/"),c=ta(this.params.Bucket),h=(()=>{let t=l.hostname.startsWith(`${c}.`),e=this.client.config.forcePathStyle,r=l.port?`:${l.port}`:"";return e?`${l.protocol}//${l.hostname}${r}/${c}/${d}`:t?`${l.protocol}//${l.hostname}${r}/${d}`:`${l.protocol}//${c}.${l.hostname}${r}/${d}`})();this.singleUploadResult={...n,Bucket:this.params.Bucket,Key:this.params.Key,Location:h};let f=tn(t.data);this.__notifyProgress({loaded:f,total:f,part:1,Key:this.params.Key,Bucket:this.params.Bucket})}async __createMultipartUpload(){let t=await this.client.config.requestChecksumCalculation();if(!this.createMultiPartPromise){let e={...this.params,Body:void 0};"WHEN_SUPPORTED"===t&&(e.ChecksumAlgorithm=this.params.ChecksumAlgorithm||u.ChecksumAlgorithm.CRC32),this.createMultiPartPromise=this.client.send(new u.CreateMultipartUploadCommand(e)).then(t=>(this.abortMultipartUploadCommand=new u.AbortMultipartUploadCommand({Bucket:this.params.Bucket,Key:this.params.Key,UploadId:t.UploadId}),t))}return this.createMultiPartPromise}async __doConcurrentUpload(t){for await(let e of t){if(this.uploadEnqueuedPartsCount>this.MAX_PARTS)throw Error(`Exceeded ${this.MAX_PARTS} parts in multipart upload to Bucket: ${this.params.Bucket} Key: ${this.params.Key}.`);if(this.abortController.signal.aborted)return;if(1===e.partNumber&&e.lastPart)return await this.__uploadUsingPut(e);if(!this.uploadId){let{UploadId:t}=await this.__createMultipartUpload();if(this.uploadId=t,this.abortController.signal.aborted)return}let t=tn(e.data)||0,r=this.client.config.requestHandler,a=r instanceof to.EventEmitter?r:null,o=0,s=(r,a)=>{(Number(a.query.partNumber)||-1)===e.partNumber&&(r.total&&t&&(this.bytesUploadedSoFar+=r.loaded-o,o=r.loaded),this.__notifyProgress({loaded:this.bytesUploadedSoFar,total:this.totalBytes,part:e.partNumber,Key:this.params.Key,Bucket:this.params.Bucket}))};null!==a&&a.on("xhr.upload.progress",s),this.uploadEnqueuedPartsCount+=1;let i=await this.client.send(new u.UploadPartCommand({...this.params,ContentLength:void 0,UploadId:this.uploadId,Body:e.data,PartNumber:e.partNumber}));if(null!==a&&a.off("xhr.upload.progress",s),this.abortController.signal.aborted)return;if(!i.ETag)throw Error(`Part ${e.partNumber} is missing ETag in UploadPart response. Missing Bucket CORS configuration for ETag header?`);this.uploadedParts.push({PartNumber:e.partNumber,ETag:i.ETag,...i.ChecksumCRC32&&{ChecksumCRC32:i.ChecksumCRC32},...i.ChecksumCRC32C&&{ChecksumCRC32C:i.ChecksumCRC32C},...i.ChecksumSHA1&&{ChecksumSHA1:i.ChecksumSHA1},...i.ChecksumSHA256&&{ChecksumSHA256:i.ChecksumSHA256}}),null===a&&(this.bytesUploadedSoFar+=t),this.__notifyProgress({loaded:this.bytesUploadedSoFar,total:this.totalBytes,part:e.partNumber,Key:this.params.Key,Bucket:this.params.Bucket})}}async __doMultipartUpload(){let t;let e=th(this.params.Body,this.partSize),r=[];for(let t=0;t<this.queueSize;t++){let t=this.__doConcurrentUpload(e).catch(t=>{r.push(t)});this.concurrentUploaders.push(t)}if(await Promise.all(this.concurrentUploaders),r.length>=1)throw await this.markUploadAsAborted(),r[0];if(this.abortController.signal.aborted)throw await this.markUploadAsAborted(),Object.assign(Error("Upload aborted."),{name:"AbortError"});if(this.isMultiPart){this.uploadedParts.sort((t,e)=>t.PartNumber-e.PartNumber);let e={...this.params,Body:void 0,UploadId:this.uploadId,MultipartUpload:{Parts:this.uploadedParts}};t=await this.client.send(new u.CompleteMultipartUploadCommand(e)),"string"==typeof t?.Location&&t.Location.includes("%2F")&&(t.Location=t.Location.replace(/%2F/g,"/"))}else t=this.singleUploadResult;return this.abortMultipartUploadCommand=null,this.tags.length&&await this.client.send(new u.PutObjectTaggingCommand({...this.params,Tagging:{TagSet:this.tags}})),t}async markUploadAsAborted(){this.uploadId&&!this.leavePartsOnError&&null!==this.abortMultipartUploadCommand&&(await this.client.send(this.abortMultipartUploadCommand),this.abortMultipartUploadCommand=null)}__notifyProgress(t){this.uploadEvent&&this.emit(this.uploadEvent,t)}async __abortTimeout(t){return new Promise((e,r)=>{t.onabort=()=>{let t=Error("Upload aborted.");t.name="AbortError",r(t)}})}__validateInput(){if(!this.params)throw Error("InputError: Upload requires params to be passed to upload.");if(!this.client)throw Error("InputError: Upload requires a AWS client to do uploads with.");if(this.partSize<tf.MIN_PART_SIZE)throw Error(`EntityTooSmall: Your proposed upload partsize [${this.partSize}] is smaller than the minimum allowed size [${tf.MIN_PART_SIZE}] (5MB)`);if(this.queueSize<1)throw Error("Queue size: Must have at least one uploading queue.")}}let tm=new u.S3Client({region:process.env.AWS_REGION||"us-west-2"});async function tg(t){try{let{text:e,voice_id:r,voice_settings:a,model_id:o="eleven_multilingual_v2"}=await t.json();if(!e||!r)return l.NextResponse.json({error:"Text and voice_id are required"},{status:400});let s=process.env.ELEVENLABS_API_KEY;if(!s)return l.NextResponse.json({error:"ElevenLabs API key not configured"},{status:500});let i=await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${r}`,{method:"POST",headers:{"xi-api-key":s,"Content-Type":"application/json"},body:JSON.stringify({text:e,model_id:o,voice_settings:a||{stability:.5,similarity_boost:.8,style:.2,use_speaker_boost:!0}})});if(!i.ok){let t=await i.text();throw Error(`ElevenLabs API error: ${i.status} - ${t}`)}let n=await i.arrayBuffer(),u=Buffer.from(n),d=`${process.env.AWS_FOLDER_PREFIX}tts-audio/${Date.now()}-${r}.mp3`,c=new tf({client:tm,params:{Bucket:process.env.AWS_S3_BUCKET,Key:d,Body:u,ContentType:"audio/mpeg"}});await c.done();let p=`https://${process.env.AWS_S3_BUCKET}.s3.${process.env.AWS_REGION}.amazonaws.com/${d}`,h=Math.max(1,Math.floor(.08*e.length));return l.NextResponse.json({audio_url:p,duration:h,text:e,voice_id:r,voice_settings:a,model_id:o,filename:d,file_size:u.length,created_at:new Date().toISOString()})}catch(t){return console.error("Error generating TTS:",t),l.NextResponse.json({error:"Failed to generate speech",details:t instanceof Error?t.message:"Unknown error"},{status:500})}}let ty=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/v1/tts/elevenlabs/generate/route",pathname:"/api/v1/tts/elevenlabs/generate",filename:"route",bundlePath:"app/api/v1/tts/elevenlabs/generate/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\v1\\tts\\elevenlabs\\generate\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:tb,staticGenerationAsyncStorage:tC,serverHooks:tw}=ty,tv="/api/v1/tts/elevenlabs/generate/route";function tP(){return(0,n.patchFetch)({serverHooks:tw,staticGenerationAsyncStorage:tC})}}};var e=require("../../../../../../webpack-runtime.js");e.C(t);var r=t=>e(e.s=t),a=e.X(0,[8948,5972],()=>r(607163));module.exports=a})();