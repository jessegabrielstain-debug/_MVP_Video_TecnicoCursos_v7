"use strict";(()=>{var e={};e.id=503,e.ids=[503],e.modules={220399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},430517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},592048:e=>{e.exports=require("fs")},532615:e=>{e.exports=require("http")},735240:e=>{e.exports=require("https")},555315:e=>{e.exports=require("path")},768621:e=>{e.exports=require("punycode")},276162:e=>{e.exports=require("stream")},917360:e=>{e.exports=require("url")},671568:e=>{e.exports=require("zlib")},487561:e=>{e.exports=require("node:fs")},770084:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>b,patchFetch:()=>y,requestAsyncStorage:()=>g,routeModule:()=>j,serverHooks:()=>x,staticGenerationAsyncStorage:()=>R});var o={};s.r(o),s.d(o,{GET:()=>f,POST:()=>v});var r=s(349303),a=s(88716),n=s(60670),i=s(387070),d=s(895412),u=s(5213),l=s(831006),p=s(840594),c=s(351842);let m=p.G0([p.Ry({id:p.Z_().uuid()}),c.kB]).transform(e=>"id"in e?{id:e.id}:{id:e.jobId});var _=s(848588);async function v(e){try{var t,s;let o=(0,d.s)(e),{data:r,error:a}=await o.auth.getUser();if(a||!r.user)return i.NextResponse.json({code:"UNAUTHORIZED",message:"Usu\xe1rio n\xe3o autenticado"},{status:401});let n=(0,u.D)(`cancel:${r.user.id}`,20,6e4);if(!n.allowed)return(0,l.g7)(),new i.NextResponse(JSON.stringify({code:"RATE_LIMITED",message:"Muitas requisi\xe7\xf5es de cancelamento. Tente novamente em breve."}),{status:429,headers:{"content-type":"application/json","Retry-After":String(n.retryAfterSec)}});let p=(t=await e.json(),m.safeParse(t));if(!p.success)return s=p.error.issues,i.NextResponse.json({code:"VALIDATION_ERROR",message:"Payload inv\xe1lido",details:s},{status:400});let{id:c}=p.data,{data:v,error:f}=await o.from("render_jobs").select("id,status,user_id").eq("id",c).single();if(f||!v)return i.NextResponse.json({code:"NOT_FOUND",message:"Job n\xe3o encontrado"},{status:404});if(v.user_id&&v.user_id!==r.user.id)return i.NextResponse.json({code:"FORBIDDEN",message:"Sem permiss\xe3o para cancelar este job"},{status:403});if(!["queued","processing"].includes(v.status))return i.NextResponse.json({code:"CONFLICT",message:"Job n\xe3o pode ser cancelado neste status"},{status:409});let{data:j,error:g}=await o.from("render_jobs").update({status:"cancelled"}).eq("id",c).select("id,status,project_id,created_at,progress,render_settings,attempts,duration_ms").single();if(g||!j)return(0,l.vJ)("DB_ERROR"),_.k.error("video-jobs-cancel","db-update-failed",g),i.NextResponse.json({code:"DB_ERROR",message:"Falha ao cancelar job",details:g?.message},{status:500});let R={id:j.id,status:j.status,project_id:j.project_id,created_at:j.created_at,progress:j.progress,attempts:j.attempts,duration_ms:j.duration_ms??null,settings:j.render_settings};return i.NextResponse.json({job:R})}catch(e){return(0,l.vJ)("UNEXPECTED"),_.k.error("video-jobs-cancel","unexpected-error",e),i.NextResponse.json({code:"UNEXPECTED",message:"Erro inesperado",details:e.message},{status:500})}}function f(){return i.NextResponse.json({code:"METHOD_NOT_ALLOWED",message:"Use POST para cancelar job"},{status:405})}let j=new r.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/v1/video-jobs/cancel/route",pathname:"/api/v1/video-jobs/cancel",filename:"route",bundlePath:"app/api/v1/video-jobs/cancel/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\v1\\video-jobs\\cancel\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:g,staticGenerationAsyncStorage:R,serverHooks:x}=j,b="/api/v1/video-jobs/cancel/route";function y(){return(0,n.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:R})}},351842:(e,t,s)=>{s.d(t,{GJ:()=>n,LL:()=>d,kB:()=>i,l_:()=>a});var o=s(840594);let r=o.Ry({title:o.Z_().min(1),content:o.Z_().min(1),order_index:o.Rx().int().nonnegative()}),a=o.Ry({project_id:o.Z_().uuid(),slides:o.IX(r).min(1),tts_voice:o.Z_().optional(),quality:o.Km(["low","medium","high"]).default("medium")});o.Ry({startDate:o.oQ.date().optional(),endDate:o.oQ.date().optional(),projectId:o.Z_().uuid().optional(),groupBy:o.Km(["day","week","month"]).default("day"),includeDetails:o.oQ.boolean().default(!1)});let n=o.Ry({period:o.Km(["24h","7d","30d","all"]).default("7d"),includeErrors:o.oQ.boolean().default(!0),includePerformance:o.oQ.boolean().default(!0)});o.Ry({eventType:o.Km(["slide_reordered","video_exported","project_created","render_started","render_completed","render_failed","user_login","user_logout"]),eventData:o.IM(o._4()),userId:o.Z_().uuid().optional(),sessionId:o.Z_().optional(),timestamp:o.oQ.date().default(()=>new Date)}),o.Ry({startDate:o.oQ.date(),endDate:o.oQ.date(),eventTypes:o.IX(o.Z_()).optional(),userId:o.Z_().uuid().optional(),limit:o.oQ.number().int().positive().max(1e3).default(100),offset:o.oQ.number().int().nonnegative().default(0)});let i=o.Ry({jobId:o.Z_().uuid("ID de job inv\xe1lido"),reason:o.Z_().max(500).optional()}),d=o.Ry({jobId:o.Z_().uuid("ID de job inv\xe1lido"),force:o.oQ.boolean().default(!1)})}};var t=require("../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),o=t.X(0,[8948,5972,8355,3105,2694],()=>s(770084));module.exports=o})();