"use strict";(()=>{var e={};e.id=503,e.ids=[503],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},61212:e=>{e.exports=require("async_hooks")},78893:e=>{e.exports=require("buffer")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},27920:e=>{e.exports=require("diagnostics_channel")},80665:e=>{e.exports=require("dns")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},85807:e=>{e.exports=require("module")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},96119:e=>{e.exports=require("perf_hooks")},35816:e=>{e.exports=require("process")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},74026:e=>{e.exports=require("string_decoder")},82452:e=>{e.exports=require("tls")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},6162:e=>{e.exports=require("worker_threads")},71568:e=>{e.exports=require("zlib")},17718:e=>{e.exports=require("node:child_process")},65714:e=>{e.exports=require("node:diagnostics_channel")},15673:e=>{e.exports=require("node:events")},87561:e=>{e.exports=require("node:fs")},88849:e=>{e.exports=require("node:http")},22286:e=>{e.exports=require("node:https")},85690:e=>{e.exports=require("node:inspector")},82033:e=>{e.exports=require("node:module")},87503:e=>{e.exports=require("node:net")},70612:e=>{e.exports=require("node:os")},49411:e=>{e.exports=require("node:path")},51747:e=>{e.exports=require("node:readline")},84492:e=>{e.exports=require("node:stream")},31764:e=>{e.exports=require("node:tls")},47261:e=>{e.exports=require("node:util")},24086:e=>{e.exports=require("node:worker_threads")},65628:e=>{e.exports=require("node:zlib")},70084:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>b,patchFetch:()=>v,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>g,staticGenerationAsyncStorage:()=>x});var o={};r.r(o),r.d(o,{GET:()=>_,POST:()=>c});var i=r(49303),s=r(88716),n=r(60670),a=r(87070),d=r(60354),u=r(5213),l=r(31006);let p=r(51842).kB.transform(e=>({id:e.jobId,reason:e.reason}));async function c(e){try{var t,r;let o=(0,d.sR)(e),{data:i,error:s}=await o.auth.getUser();if(s||!i.user)return a.NextResponse.json({code:"UNAUTHORIZED",message:"Usu\xe1rio n\xe3o autenticado"},{status:401});let n=(0,u.D)(`cancel:${i.user.id}`,20,6e4);if(!n.allowed)return(0,l.g7)(),new a.NextResponse(JSON.stringify({code:"RATE_LIMITED",message:"Muitas requisi\xe7\xf5es de cancelamento. Tente novamente em breve."}),{status:429,headers:{"content-type":"application/json","Retry-After":String(n.retryAfterSec)}});let c=(t=await e.json(),p.safeParse(t));if(!c.success)return r=c.error.issues,a.NextResponse.json({code:"VALIDATION_ERROR",message:"Payload inv\xe1lido",details:r},{status:400});let{id:_,reason:m}=c.data;m&&d.kg.info("video-jobs-cancel","cancel-reason",{jobId:_,userId:i.user.id,reason:m});let{data:f,error:x}=await o.from("render_jobs").select("id,status,user_id").eq("id",_).single();if(x||!f)return a.NextResponse.json({code:"NOT_FOUND",message:"Job n\xe3o encontrado"},{status:404});if(f.user_id&&f.user_id!==i.user.id)return a.NextResponse.json({code:"FORBIDDEN",message:"Sem permiss\xe3o para cancelar este job"},{status:403});if(!["queued","processing"].includes(f.status))return a.NextResponse.json({code:"CONFLICT",message:"Job n\xe3o pode ser cancelado neste status"},{status:409});let{data:g,error:b}=await o.from("render_jobs").update({status:"cancelled"}).eq("id",_).select("id,status,project_id,created_at,progress,render_settings,attempts,duration_ms").single();if(b||!g)return(0,l.vJ)("DB_ERROR"),d.kg.error("video-jobs-cancel","db-update-failed",b),a.NextResponse.json({code:"DB_ERROR",message:"Falha ao cancelar job",details:b?.message},{status:500});let v={id:g.id,status:g.status,project_id:g.project_id,created_at:g.created_at,progress:g.progress,attempts:g.attempts,duration_ms:g.duration_ms??null,settings:g.render_settings};return a.NextResponse.json({job:v})}catch(e){return(0,l.vJ)("UNEXPECTED"),d.kg.error("video-jobs-cancel","unexpected-error",e),a.NextResponse.json({code:"UNEXPECTED",message:"Erro inesperado",details:e.message},{status:500})}}function _(){return a.NextResponse.json({code:"METHOD_NOT_ALLOWED",message:"Use POST para cancelar job"},{status:405})}let m=new i.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/v1/video-jobs/cancel/route",pathname:"/api/v1/video-jobs/cancel",filename:"route",bundlePath:"app/api/v1/video-jobs/cancel/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\v1\\video-jobs\\cancel\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:f,staticGenerationAsyncStorage:x,serverHooks:g}=m,b="/api/v1/video-jobs/cancel/route";function v(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:x})}},5213:(e,t,r)=>{r.d(t,{D:()=>n,U:()=>a});var o=r(87561);let i=e=>{let t=process.env.RATE_LIMIT_DEBUG_LOG;if(t)try{(0,o.appendFileSync)(t,`${JSON.stringify({ts:Date.now(),...e})}
`,{encoding:"utf-8"})}catch(e){"true"===process.env.DEBUG_RATE_LIMIT&&console.error("[rate-limit] debug log failed",e)}},s=()=>{let e=globalThis.process;if(e)return e.__app_rate_limit_store__||(e.__app_rate_limit_store__=new Map),e.__app_rate_limit_store__;let t=globalThis;return t.__app_rate_limit_store__||(t.__app_rate_limit_store__=new Map),t.__app_rate_limit_store__};function n(e,t,r){let o=s(),n=Date.now(),a=o.get(e),d=a?n-a.lastRequest:0;if(!a||d>=r&&n>=(a.blockedUntil||0))return o.set(e,{windowStart:n,lastRequest:n,count:1,blockedUntil:0}),"true"===process.env.DEBUG_RATE_LIMIT&&console.info("[rate-limit] reset",{key:e,limit:t,windowMs:r,idle:d}),i({type:"reset",key:e,limit:t,windowMs:r,idle:d}),{allowed:!0,retryAfterSec:0};if((a=o.get(e)).blockedUntil&&n<a.blockedUntil){let r=Math.max(0,Math.ceil((a.blockedUntil-n)/1e3));return"true"===process.env.DEBUG_RATE_LIMIT&&console.info("[rate-limit] still-blocked",{key:e,retryAfterSec:r}),i({type:"blocked",key:e,count:a.count,limit:t,retryAfterSec:r}),a.lastRequest=n,{allowed:!1,retryAfterSec:r}}if(a.count>=t){a.blockedUntil=a.windowStart+r,a.blockedUntil<=n&&(a.blockedUntil=n+r);let o=Math.max(0,Math.ceil((a.blockedUntil-n)/1e3));return"true"===process.env.DEBUG_RATE_LIMIT&&console.info("[rate-limit] blocked",{key:e,count:a.count,limit:t,retryAfterSec:o}),i({type:"blocked",key:e,count:a.count,limit:t,retryAfterSec:o}),a.lastRequest=n,{allowed:!1,retryAfterSec:o}}return a.count+=1,a.lastRequest=n,"true"===process.env.DEBUG_RATE_LIMIT&&console.info("[rate-limit] allowed",{key:e,count:a.count,limit:t,idle:d}),i({type:"allowed",key:e,count:a.count,limit:t,idle:d}),{allowed:!0,retryAfterSec:0}}function a(e){return s().get(e)}},31006:(e,t,r)=>{r.d(t,{g7:()=>i,vJ:()=>s});let o=()=>{let e=globalThis;return e.__metrics||(e.__metrics={rate_limit_hits:0,errors:{},startTime:Date.now()}),e.__metrics};function i(){let e=o();e.rate_limit_hits+=1}function s(e){let t=o();t.errors[e]=(t.errors[e]||0)+1}},51842:(e,t,r)=>{r.d(t,{FR:()=>c,N8:()=>p,SV:()=>f,gG:()=>_,kB:()=>m,l_:()=>l,xV:()=>x});var o=r(40594);let i=o.dj(e=>{if("string"==typeof e){let t=e.trim().toLowerCase();if(["true","1","yes","y"].includes(t))return!0;if(["false","0","no","n"].includes(t))return!1}return e},o.O7()),s=o.dj(e=>{if(e instanceof Date)return e;if("string"==typeof e||"number"==typeof e){let t=new Date(e);return Number.isNaN(t.getTime())?void 0:t}return e},o.hT()),n=o.Km(["1h","24h","7d","30d","all"]),a=o.Km(["1h","24h","7d","30d","90d"]),d=o.Km(["all","completed","failed","processing","pending"]),u=o.Ry({title:o.Z_().min(1,"T\xedtulo \xe9 obrigat\xf3rio"),content:o.Z_().min(1,"Conte\xfado \xe9 obrigat\xf3rio"),order_index:o.Rx().int().nonnegative()}),l=o.Ry({project_id:o.Z_().uuid("ID de projeto inv\xe1lido"),slides:o.IX(u).min(1,"Pelo menos um slide \xe9 necess\xe1rio"),tts_voice:o.Z_().optional(),quality:o.Km(["low","medium","high"]).default("medium"),flow:o.Ry({enabled:o.O7().default(!1),bpmSource:o.Km(["auto","manual"]).default("auto"),bpmManual:o.Rx().positive().optional(),beatToleranceMs:o.Rx().int().positive().max(200).default(25),crossfadeRatio:o.Rx().min(.2).max(.6).default(.35),sidechain:o.Ry({threshold:o.Rx().min(0).default(.015),ratio:o.Rx().min(1).max(10).default(4)}).optional()}).optional()}),p=o.Km(["queued","processing","completed","failed","cancelled"]),c=o.Ry({jobId:o.Z_().uuid("ID de job inv\xe1lido"),progress:o.Rx().min(0).max(100),status:p,currentStep:o.Z_().optional(),estimatedTimeRemaining:o.Rx().nonnegative().optional()});o.Ry({id:o.Z_().uuid("ID de job inv\xe1lido"),jobId:o.Z_().uuid("ID de job inv\xe1lido").optional()}),o.Ry({startDate:s.optional(),endDate:s.optional(),projectId:o.Z_().uuid("ID de projeto inv\xe1lido").optional(),groupBy:o.Km(["hour","day","week","month"]).default("day"),includeDetails:i.optional().default(!1)}).refine(e=>!e.startDate||!e.endDate||e.startDate.getTime()<=e.endDate.getTime(),{message:"startDate deve ser anterior ao endDate",path:["endDate"]});let _=o.Ry({period:o.dj(e=>"string"==typeof e?e.toLowerCase():e,n).default("7d"),includeErrors:i.optional().default(!0),includePerformance:i.optional().default(!0),limit:o.oQ.number().int().positive().max(5e3).default(5e3)}).extend({status:p.optional(),projectId:o.Z_().uuid("ID de projeto inv\xe1lido").optional()});o.Ry({eventType:o.Km(["slide_reordered","video_exported","project_created","render_started","render_completed","render_failed","user_login","user_logout"]),eventData:o.IM(o._4()),userId:o.Z_().uuid("ID de usu\xe1rio inv\xe1lido").optional(),sessionId:o.Z_().optional(),timestamp:o.oQ.date().default(()=>new Date)}),o.Ry({startDate:o.oQ.date(),endDate:o.oQ.date(),eventTypes:o.IX(o.Z_()).optional(),userId:o.Z_().uuid("ID de usu\xe1rio inv\xe1lido").optional(),limit:o.oQ.number().int().positive().max(1e3).default(100),offset:o.oQ.number().int().nonnegative().default(0)}),o.Ry({timeRange:o.dj(e=>"string"==typeof e?e.toLowerCase():e,a).default("24h"),userId:o.Z_().uuid("ID de usu\xe1rio inv\xe1lido").optional(),projectType:o.Z_().min(1).optional(),status:o.dj(e=>"string"==typeof e?e.toLowerCase():e,d).default("all"),includeErrors:i.optional().default(!0),includePerformance:i.optional().default(!0)});let m=o.dj(e=>{if("object"==typeof e&&null!==e&&!("jobId"in e)){if(e.id)return{...e,jobId:e.id};if(e.job_id)return{...e,jobId:e.job_id}}return e},o.Ry({jobId:o.Z_().uuid("ID de job inv\xe1lido"),reason:o.Z_().max(500).optional()}));o.Ry({jobId:o.Z_().uuid("ID de job inv\xe1lido"),force:i.optional().default(!1)});let f=o.Ry({jobId:o.Z_().uuid("ID de job inv\xe1lido"),priority:o.Km(["low","normal","high"]).default("normal"),resetProgress:i.optional().default(!1)}),x=o.Ry({status:p.optional(),projectId:o.Z_().uuid("ID de projeto inv\xe1lido").optional(),limit:o.oQ.number().int().positive().max(100).default(20),offset:o.oQ.number().int().nonnegative().default(0),sortBy:o.Km(["created_at","updated_at","status"]).default("created_at"),sortOrder:o.Km(["asc","desc"]).default("desc")});o.Ry({id:o.Z_().uuid(),user_id:o.Z_().uuid(),project_id:o.Z_().uuid().nullable(),status:p,progress:o.Rx().min(0).max(100),attempts:o.Rx().int().nonnegative(),created_at:o.Z_().datetime(),updated_at:o.Z_().datetime().optional(),completed_at:o.Z_().datetime().nullable(),duration_ms:o.Rx().nonnegative().nullable(),render_settings:o.IM(o._4()).nullable(),error_message:o.Z_().nullable()})}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[8948,5972,1657,9702,9092,7686,6608,1080,3595],()=>r(70084));module.exports=o})();