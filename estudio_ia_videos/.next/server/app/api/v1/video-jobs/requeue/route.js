"use strict";(()=>{var e={};e.id=1413,e.ids=[1413],e.modules={220399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},430517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},592048:e=>{e.exports=require("fs")},532615:e=>{e.exports=require("http")},735240:e=>{e.exports=require("https")},555315:e=>{e.exports=require("path")},768621:e=>{e.exports=require("punycode")},276162:e=>{e.exports=require("stream")},917360:e=>{e.exports=require("url")},671568:e=>{e.exports=require("zlib")},487561:e=>{e.exports=require("node:fs")},765185:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>b,patchFetch:()=>q,requestAsyncStorage:()=>j,routeModule:()=>g,serverHooks:()=>x,staticGenerationAsyncStorage:()=>R});var s={};r.r(s),r.d(s,{GET:()=>v,POST:()=>f});var o=r(349303),a=r(88716),i=r(60670),d=r(387070),n=r(895412),u=r(5213),p=r(831006),l=r(840594),m=r(351842);let c=l.G0([l.Ry({id:l.Z_().uuid()}),m.LL]).transform(e=>"id"in e?{id:e.id}:{id:e.jobId});var _=r(848588);async function f(e){try{var t,r;let s=(0,n.s)(e),{data:o,error:a}=await s.auth.getUser();if(a||!o.user)return d.NextResponse.json({code:"UNAUTHORIZED",message:"Usu\xe1rio n\xe3o autenticado"},{status:401});let i=(0,u.D)(`requeue:${o.user.id}`,20,6e4);if(!i.allowed)return(0,p.g7)(),new d.NextResponse(JSON.stringify({code:"RATE_LIMITED",message:"Muitas requisi\xe7\xf5es de requeue. Tente novamente em breve."}),{status:429,headers:{"content-type":"application/json","Retry-After":String(i.retryAfterSec)}});let l=(t=await e.json(),c.safeParse(t));if(!l.success)return r=l.error.issues,d.NextResponse.json({code:"VALIDATION_ERROR",message:"Payload inv\xe1lido",details:r},{status:400});let{id:m}=l.data,{data:f,error:v}=await s.from("render_jobs").select("id,status,user_id").eq("id",m).single();if(v||!f)return d.NextResponse.json({code:"NOT_FOUND",message:"Job n\xe3o encontrado"},{status:404});if(f.user_id&&f.user_id!==o.user.id)return d.NextResponse.json({code:"FORBIDDEN",message:"Sem permiss\xe3o"},{status:403});if(!["failed","cancelled"].includes(f.status))return d.NextResponse.json({code:"CONFLICT",message:"Somente jobs failed/cancelled podem ser reenfileirados"},{status:409});if("number"==typeof f.attempts&&f.attempts>=5)return d.NextResponse.json({code:"MAX_ATTEMPTS_REACHED",message:"Limite de tentativas atingido (5)."},{status:409});let{data:g,error:j}=await s.from("render_jobs").update({status:"queued",progress:0,attempts:f.attempts?f.attempts+1:2,started_at:null,completed_at:null,duration_ms:null,error_message:null}).eq("id",m).select("id,status,project_id,created_at,progress,render_settings,attempts,duration_ms").single();if(j||!g)return(0,p.vJ)("DB_ERROR"),_.k.error("video-jobs-requeue","db-update-failed",j),d.NextResponse.json({code:"DB_ERROR",message:"Falha ao reenfileirar job",details:j?.message},{status:500});let R={id:g.id,status:g.status,project_id:g.project_id,created_at:g.created_at,progress:g.progress,attempts:g.attempts,duration_ms:g.duration_ms??null,settings:g.render_settings};return d.NextResponse.json({job:R})}catch(e){return(0,p.vJ)("UNEXPECTED"),_.k.error("video-jobs-requeue","unexpected-error",e),d.NextResponse.json({code:"UNEXPECTED",message:"Erro inesperado",details:e.message},{status:500})}}function v(){return d.NextResponse.json({code:"METHOD_NOT_ALLOWED",message:"Use POST para reenfileirar job"},{status:405})}let g=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/v1/video-jobs/requeue/route",pathname:"/api/v1/video-jobs/requeue",filename:"route",bundlePath:"app/api/v1/video-jobs/requeue/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\v1\\video-jobs\\requeue\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:j,staticGenerationAsyncStorage:R,serverHooks:x}=g,b="/api/v1/video-jobs/requeue/route";function q(){return(0,i.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:R})}},351842:(e,t,r)=>{r.d(t,{GJ:()=>i,LL:()=>n,kB:()=>d,l_:()=>a});var s=r(840594);let o=s.Ry({title:s.Z_().min(1),content:s.Z_().min(1),order_index:s.Rx().int().nonnegative()}),a=s.Ry({project_id:s.Z_().uuid(),slides:s.IX(o).min(1),tts_voice:s.Z_().optional(),quality:s.Km(["low","medium","high"]).default("medium")});s.Ry({startDate:s.oQ.date().optional(),endDate:s.oQ.date().optional(),projectId:s.Z_().uuid().optional(),groupBy:s.Km(["day","week","month"]).default("day"),includeDetails:s.oQ.boolean().default(!1)});let i=s.Ry({period:s.Km(["24h","7d","30d","all"]).default("7d"),includeErrors:s.oQ.boolean().default(!0),includePerformance:s.oQ.boolean().default(!0)});s.Ry({eventType:s.Km(["slide_reordered","video_exported","project_created","render_started","render_completed","render_failed","user_login","user_logout"]),eventData:s.IM(s._4()),userId:s.Z_().uuid().optional(),sessionId:s.Z_().optional(),timestamp:s.oQ.date().default(()=>new Date)}),s.Ry({startDate:s.oQ.date(),endDate:s.oQ.date(),eventTypes:s.IX(s.Z_()).optional(),userId:s.Z_().uuid().optional(),limit:s.oQ.number().int().positive().max(1e3).default(100),offset:s.oQ.number().int().nonnegative().default(0)});let d=s.Ry({jobId:s.Z_().uuid("ID de job inv\xe1lido"),reason:s.Z_().max(500).optional()}),n=s.Ry({jobId:s.Z_().uuid("ID de job inv\xe1lido"),force:s.oQ.boolean().default(!1)})}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972,8355,3105,2694],()=>r(765185));module.exports=s})();