"use strict";(()=>{var e={};e.id=5131,e.ids=[5131],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},61212:e=>{e.exports=require("async_hooks")},78893:e=>{e.exports=require("buffer")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},27920:e=>{e.exports=require("diagnostics_channel")},80665:e=>{e.exports=require("dns")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},85807:e=>{e.exports=require("module")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},96119:e=>{e.exports=require("perf_hooks")},35816:e=>{e.exports=require("process")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},74026:e=>{e.exports=require("string_decoder")},82452:e=>{e.exports=require("tls")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},6162:e=>{e.exports=require("worker_threads")},71568:e=>{e.exports=require("zlib")},17718:e=>{e.exports=require("node:child_process")},65714:e=>{e.exports=require("node:diagnostics_channel")},15673:e=>{e.exports=require("node:events")},87561:e=>{e.exports=require("node:fs")},88849:e=>{e.exports=require("node:http")},22286:e=>{e.exports=require("node:https")},85690:e=>{e.exports=require("node:inspector")},82033:e=>{e.exports=require("node:module")},87503:e=>{e.exports=require("node:net")},70612:e=>{e.exports=require("node:os")},49411:e=>{e.exports=require("node:path")},51747:e=>{e.exports=require("node:readline")},84492:e=>{e.exports=require("node:stream")},31764:e=>{e.exports=require("node:tls")},47261:e=>{e.exports=require("node:util")},24086:e=>{e.exports=require("node:worker_threads")},65628:e=>{e.exports=require("node:zlib")},3252:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>j,requestAsyncStorage:()=>g,routeModule:()=>_,serverHooks:()=>x,staticGenerationAsyncStorage:()=>f});var o={};r.r(o),r.d(o,{GET:()=>m});var s=r(49303),a=r(88716),i=r(60670),n=r(87070),d=r(60354),u=r(40981),l=r(51842);let p=new Map;function c(e,t){p.set(e,{expiresAt:Date.now()+3e4,payload:t})}async function m(e){let t="false"!==process.env.ALLOW_RENDER_JOBS_FALLBACK,r=null,o="",s=null;try{let a=(e.headers.get("authorization")??e.headers.get("Authorization")??"").trim(),i=(a.toLowerCase().startsWith("bearer ")?a.slice(7).trim():a).length>0,m=(0,u.Z2)()||!i,_=null;if(m)o=(0,u.fR)(e);else{_=(0,d.sR)(e);let{data:t,error:r}=await _.auth.getUser();if(r||!t?.user)return n.NextResponse.json({code:"UNAUTHORIZED",message:"Usu\xe1rio n\xe3o autenticado"},{status:401});o=t.user.id}let g=new URL(e.url),f={};g.searchParams.forEach((e,t)=>{f[t]=e});let x=l.gG.safeParse(f);if(!x.success)return n.NextResponse.json({code:"VALIDATION_ERROR",message:"Par\xe2metros inv\xe1lidos",details:x.error.issues},{status:400});let{period:h,status:j,projectId:q,limit:b,includeErrors:y,includePerformance:v}=s=x.data,I=`stats:${o}:${h}:${j||"all"}:${q||"all"}:${b}:${y?1:0}:${v?1:0}`,R=(e="MISS")=>{let t=(0,u.$L)(o);return c(I,t),new n.NextResponse(JSON.stringify({...t,metadata:{cache:e,ttl_ms:3e4,source:"mock"}}),{status:200,headers:{"content-type":"application/json","X-Cache":e}})};r=()=>R("MISS");let D=function(e){let t=p.get(e);return t?Date.now()>t.expiresAt?(p.delete(e),null):t.payload:null}(I);if(D)return new n.NextResponse(JSON.stringify({...D,metadata:{...D.metadata,cache:"HIT",ttl_ms:3e4}}),{status:200,headers:{"content-type":"application/json","X-Cache":"HIT"}});if(m)return R("MISS");if(!_)throw Error("Supabase client n\xe3o inicializado");if(!s)throw Error("Par\xe2metros de stats n\xe3o inicializados");let w=(()=>{switch(h){case"24h":return 864e5;case"7d":return 6048e5;case"30d":return 2592e6;case"all":return 31536e6;default:return 36e5}})(),S=new Date(Date.now()-w).toISOString(),Z=_.from("render_jobs").select("*",{count:"exact",head:!0}).eq("user_id",o);s.status&&(Z=Z.eq("status",s.status)),s.projectId&&(Z=Z.eq("project_id",s.projectId));let O=(await Z).count??0,M=_.from("render_jobs").select("status").eq("user_id",o).limit(s.limit);s.status&&(M=M.eq("status",s.status)),s.projectId&&(M=M.eq("project_id",s.projectId));let{data:N,error:E}=await M;if(E){if(d.kg.warn("video-jobs-stats","fallback: status query error",{message:E.message}),t&&r)return r();return n.NextResponse.json({code:"DB_ERROR",message:"Falha ao obter contagem por status",details:E.message},{status:500})}let k={};for(let e of N||[]){let t=e.status;k[t]=(k[t]||0)+1}let T={queued:k.queued||0,processing:k.processing||0,completed:k.completed||0,failed:k.failed||0,cancelled:k.cancelled||0,other:Object.entries(k).reduce((e,[t,r])=>["queued","processing","completed","failed","cancelled"].includes(t)?e:e+r,0)},C=_.from("render_jobs").select("id",{count:"exact"}).eq("user_id",o).eq("status","completed").gte("completed_at",S);s.projectId&&(C=C.eq("project_id",s.projectId));let P=await C,A=P.count||(P.data?.length??0),K=Number(((A||0)/60).toFixed(3)),L=_.from("render_jobs").select("duration_ms").eq("user_id",o).eq("status","completed").limit(s.limit);s.projectId&&(L=L.eq("project_id",s.projectId));let{data:U,error:B}=await L;if(B){if(d.kg.warn("video-jobs-stats","fallback: duration query error",{message:B.message}),t&&r)return r();return n.NextResponse.json({code:"DB_ERROR",message:"Falha ao obter m\xe9tricas de dura\xe7\xe3o",details:B.message},{status:500})}let F=(U||[]).map(e=>"number"==typeof e.duration_ms?e.duration_ms:null).filter(e=>"number"==typeof e),$=F.length?Math.round(F.reduce((e,t)=>e+t,0)/F.length):0,Q=F.slice().sort((e,t)=>e-t),X=e=>{if(!Q.length)return 0;let t=Math.min(Q.length-1,Math.floor(e*(Q.length-1)));return Q[t]},z=X(.5),J=X(.9),V=X(.95),G={totals:{total_jobs:O},by_status:T,throughput:{window_minutes:Math.round(w/6e4),jobs_completed_last_60m:A,jobs_per_min:K},performance:{avg_duration_ms:$,p50_ms:z,p90_ms:J,p95_ms:V},metadata:{cache:"MISS",ttl_ms:3e4,period:s.period,include_errors:s.includeErrors,include_performance:s.includePerformance,limit:s.limit,filters:{status:s.status??null,projectId:s.projectId??null}}};return c(I,G),new n.NextResponse(JSON.stringify(G),{status:200,headers:{"content-type":"application/json","X-Cache":"MISS"}})}catch(e){if(d.kg.error("video-jobs-stats","unexpected-error",e),t&&r)return r();return n.NextResponse.json({code:"UNEXPECTED",message:"Erro inesperado",details:e.message},{status:500})}}let _=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/v1/video-jobs/stats/route",pathname:"/api/v1/video-jobs/stats",filename:"route",bundlePath:"app/api/v1/video-jobs/stats/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\v1\\video-jobs\\stats\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:g,staticGenerationAsyncStorage:f,serverHooks:x}=_,h="/api/v1/video-jobs/stats/route";function j(){return(0,i.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:f})}},40981:(e,t,r)=>{r.d(t,{$L:()=>_,fR:()=>n,OY:()=>c,Rx:()=>m,Z2:()=>i});let o=require("node:crypto"),s=()=>{let e=globalThis;return e.__mock_render_jobs__||(e.__mock_render_jobs__=new Map),e.__mock_render_jobs__},a=()=>!0,i=()=>"true"===process.env.USE_MOCK_RENDER_JOBS||!a(),n=e=>{let t=e?.headers.get("x-mock-user")?.trim();return t&&t.length>0?t:"mock-user"},d=(e,t)=>{let r=new Date().toISOString();return{id:(0,o.randomUUID)(),user_id:e,project_id:t.project_id??(0,o.randomUUID)(),status:t.status??"queued",progress:t.progress??0,attempts:t.attempts??1,duration_ms:t.duration_ms??("completed"===t.status?42e3:null),render_settings:t.render_settings??{slides:4,quality:"medium",tts_voice:"br-Female"},created_at:t.created_at??r,updated_at:t.updated_at??r,completed_at:t.completed_at??("completed"===t.status?r:null)}},u=e=>{let t=Date.now();return[d(e,{status:"completed",progress:100,duration_ms:38e3,created_at:new Date(t-18e5).toISOString(),completed_at:new Date(t-15e5).toISOString(),render_settings:{slides:12,quality:"high",tts_voice:"br-Male"}}),d(e,{status:"completed",progress:100,duration_ms:52e3,created_at:new Date(t-54e5).toISOString(),completed_at:new Date(t-528e4).toISOString(),render_settings:{slides:9,quality:"medium"}}),d(e,{status:"processing",progress:65,duration_ms:null,created_at:new Date(t-3e5).toISOString(),render_settings:{slides:6,quality:"medium"}}),d(e,{status:"queued",progress:0,duration_ms:null,created_at:new Date(t-12e4).toISOString(),render_settings:{slides:3,quality:"low"}}),d(e,{status:"failed",progress:35,duration_ms:null,created_at:new Date(t-108e5).toISOString(),render_settings:{slides:8,quality:"high"}})]},l=e=>{let t=s();return t.has(e)||t.set(e,u(e)),t.get(e)},p=e=>({id:e.id,status:e.status,project_id:e.project_id,created_at:e.created_at,progress:e.progress,attempts:e.attempts,duration_ms:e.duration_ms,settings:e.render_settings}),c=(e,t)=>{let r=l(e),o=d(e,{project_id:t.project_id,status:"queued",progress:0,attempts:1,duration_ms:null,render_settings:{slides:t.slides.length,quality:t.quality??"medium",tts_voice:t.tts_voice??"br-Female"}});return r.unshift(o),p(o)},m=(e,t)=>{let r=l(e),o=t.status?r.filter(e=>e.status===t.status):r;return t.projectId&&(o=o.filter(e=>e.project_id===t.projectId)),o.slice().sort((e,r)=>{let o="asc"===t.sortOrder?1:-1;return"status"===t.sortBy?e.status.localeCompare(r.status)*o:"updated_at"===t.sortBy?e.updated_at.localeCompare(r.updated_at)*o:e.created_at.localeCompare(r.created_at)*o}).slice(t.offset,t.offset+t.limit).map(p)},_=e=>{let t=l(e),r=t.reduce((e,t)=>(e[t.status]=(e[t.status]||0)+1,e),{}),o=t.filter(e=>"completed"===e.status),s=Date.now(),a=o.filter(e=>!!e.completed_at&&s-new Date(e.completed_at).getTime()<=36e5).length,i=o.map(e=>e.duration_ms??0),n=i.length?Math.round(i.reduce((e,t)=>e+t,0)/i.length):0,d=i.slice().sort((e,t)=>e-t),u=e=>{if(!d.length)return 0;let t=Math.min(d.length-1,Math.floor(e*(d.length-1)));return d[t]};return{totals:{total_jobs:t.length},by_status:{queued:r.queued||0,processing:r.processing||0,completed:r.completed||0,failed:r.failed||0,cancelled:r.cancelled||0,other:0},throughput:{window_minutes:60,jobs_completed_last_60m:a,jobs_per_min:Number(((a||0)/60).toFixed(3))},performance:{avg_duration_ms:n,p50_ms:u(.5),p90_ms:u(.9),p95_ms:u(.95)}}}},51842:(e,t,r)=>{r.d(t,{FR:()=>c,N8:()=>p,SV:()=>g,gG:()=>m,kB:()=>_,l_:()=>l,xV:()=>f});var o=r(40594);let s=o.dj(e=>{if("string"==typeof e){let t=e.trim().toLowerCase();if(["true","1","yes","y"].includes(t))return!0;if(["false","0","no","n"].includes(t))return!1}return e},o.O7()),a=o.dj(e=>{if(e instanceof Date)return e;if("string"==typeof e||"number"==typeof e){let t=new Date(e);return Number.isNaN(t.getTime())?void 0:t}return e},o.hT()),i=o.Km(["1h","24h","7d","30d","all"]),n=o.Km(["1h","24h","7d","30d","90d"]),d=o.Km(["all","completed","failed","processing","pending"]),u=o.Ry({title:o.Z_().min(1,"T\xedtulo \xe9 obrigat\xf3rio"),content:o.Z_().min(1,"Conte\xfado \xe9 obrigat\xf3rio"),order_index:o.Rx().int().nonnegative()}),l=o.Ry({project_id:o.Z_().uuid("ID de projeto inv\xe1lido"),slides:o.IX(u).min(1,"Pelo menos um slide \xe9 necess\xe1rio"),tts_voice:o.Z_().optional(),quality:o.Km(["low","medium","high"]).default("medium"),flow:o.Ry({enabled:o.O7().default(!1),bpmSource:o.Km(["auto","manual"]).default("auto"),bpmManual:o.Rx().positive().optional(),beatToleranceMs:o.Rx().int().positive().max(200).default(25),crossfadeRatio:o.Rx().min(.2).max(.6).default(.35),sidechain:o.Ry({threshold:o.Rx().min(0).default(.015),ratio:o.Rx().min(1).max(10).default(4)}).optional()}).optional()}),p=o.Km(["queued","processing","completed","failed","cancelled"]),c=o.Ry({jobId:o.Z_().uuid("ID de job inv\xe1lido"),progress:o.Rx().min(0).max(100),status:p,currentStep:o.Z_().optional(),estimatedTimeRemaining:o.Rx().nonnegative().optional()});o.Ry({id:o.Z_().uuid("ID de job inv\xe1lido"),jobId:o.Z_().uuid("ID de job inv\xe1lido").optional()}),o.Ry({startDate:a.optional(),endDate:a.optional(),projectId:o.Z_().uuid("ID de projeto inv\xe1lido").optional(),groupBy:o.Km(["hour","day","week","month"]).default("day"),includeDetails:s.optional().default(!1)}).refine(e=>!e.startDate||!e.endDate||e.startDate.getTime()<=e.endDate.getTime(),{message:"startDate deve ser anterior ao endDate",path:["endDate"]});let m=o.Ry({period:o.dj(e=>"string"==typeof e?e.toLowerCase():e,i).default("7d"),includeErrors:s.optional().default(!0),includePerformance:s.optional().default(!0),limit:o.oQ.number().int().positive().max(5e3).default(5e3)}).extend({status:p.optional(),projectId:o.Z_().uuid("ID de projeto inv\xe1lido").optional()});o.Ry({eventType:o.Km(["slide_reordered","video_exported","project_created","render_started","render_completed","render_failed","user_login","user_logout"]),eventData:o.IM(o._4()),userId:o.Z_().uuid("ID de usu\xe1rio inv\xe1lido").optional(),sessionId:o.Z_().optional(),timestamp:o.oQ.date().default(()=>new Date)}),o.Ry({startDate:o.oQ.date(),endDate:o.oQ.date(),eventTypes:o.IX(o.Z_()).optional(),userId:o.Z_().uuid("ID de usu\xe1rio inv\xe1lido").optional(),limit:o.oQ.number().int().positive().max(1e3).default(100),offset:o.oQ.number().int().nonnegative().default(0)}),o.Ry({timeRange:o.dj(e=>"string"==typeof e?e.toLowerCase():e,n).default("24h"),userId:o.Z_().uuid("ID de usu\xe1rio inv\xe1lido").optional(),projectType:o.Z_().min(1).optional(),status:o.dj(e=>"string"==typeof e?e.toLowerCase():e,d).default("all"),includeErrors:s.optional().default(!0),includePerformance:s.optional().default(!0)});let _=o.dj(e=>{if("object"==typeof e&&null!==e&&!("jobId"in e)){if(e.id)return{...e,jobId:e.id};if(e.job_id)return{...e,jobId:e.job_id}}return e},o.Ry({jobId:o.Z_().uuid("ID de job inv\xe1lido"),reason:o.Z_().max(500).optional()}));o.Ry({jobId:o.Z_().uuid("ID de job inv\xe1lido"),force:s.optional().default(!1)});let g=o.Ry({jobId:o.Z_().uuid("ID de job inv\xe1lido"),priority:o.Km(["low","normal","high"]).default("normal"),resetProgress:s.optional().default(!1)}),f=o.Ry({status:p.optional(),projectId:o.Z_().uuid("ID de projeto inv\xe1lido").optional(),limit:o.oQ.number().int().positive().max(100).default(20),offset:o.oQ.number().int().nonnegative().default(0),sortBy:o.Km(["created_at","updated_at","status"]).default("created_at"),sortOrder:o.Km(["asc","desc"]).default("desc")});o.Ry({id:o.Z_().uuid(),user_id:o.Z_().uuid(),project_id:o.Z_().uuid().nullable(),status:p,progress:o.Rx().min(0).max(100),attempts:o.Rx().int().nonnegative(),created_at:o.Z_().datetime(),updated_at:o.Z_().datetime().optional(),completed_at:o.Z_().datetime().nullable(),duration_ms:o.Rx().nonnegative().nullable(),render_settings:o.IM(o._4()).nullable(),error_message:o.Z_().nullable()})}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[8948,5972,1657,9702,9092,7686,6608,1080,3595],()=>r(3252));module.exports=o})();