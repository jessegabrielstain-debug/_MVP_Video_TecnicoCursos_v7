(()=>{var e={};e.id=5131,e.ids=[5131],e.modules={788751:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=788751,e.exports=t},318993:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=318993,e.exports=t},745773:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=745773,e.exports=t},991254:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=991254,e.exports=t},220399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},430517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},592048:e=>{"use strict";e.exports=require("fs")},532615:e=>{"use strict";e.exports=require("http")},735240:e=>{"use strict";e.exports=require("https")},555315:e=>{"use strict";e.exports=require("path")},768621:e=>{"use strict";e.exports=require("punycode")},276162:e=>{"use strict";e.exports=require("stream")},917360:e=>{"use strict";e.exports=require("url")},671568:e=>{"use strict";e.exports=require("zlib")},906005:e=>{"use strict";e.exports=require("node:crypto")},703252:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>v,patchFetch:()=>D,requestAsyncStorage:()=>h,routeModule:()=>_,serverHooks:()=>S,staticGenerationAsyncStorage:()=>f});var s={};r.r(s),r.d(s,{GET:()=>g});var o=r(349303),n=r(88716),a=r(60670),i=r(387070),l=r(895412),u=r(40817),d=r(848588),c=r(351842);let m=new Map;function p(e,t){m.set(e,{expiresAt:Date.now()+3e4,payload:t})}async function g(e){let t="false"!==process.env.ALLOW_RENDER_JOBS_FALLBACK,r=null,s="";try{let o=(e.headers.get("authorization")??e.headers.get("Authorization")??"").trim(),n=(o.toLowerCase().startsWith("bearer ")?o.slice(7).trim():o).length>0,a=(0,u.Z2)()||!n,g=null;if(a)s=(0,u.fR)(e);else{g=(0,l.s)(e);let{data:t,error:r}=await g.auth.getUser();if(r||!t?.user)return i.NextResponse.json({code:"UNAUTHORIZED",message:"Usu\xe1rio n\xe3o autenticado"},{status:401});s=t.user.id}let _=new URL(e.url),h={};_.searchParams.forEach((e,t)=>{h[t]=e});let f=c.GJ.safeParse(h),S=f.success?f.data.period:void 0,v=`stats:${s}:${S??"default"}`,D=(e="MISS")=>{let t=(0,u.$L)(s);return p(v,t),new i.NextResponse(JSON.stringify({...t,metadata:{cache:e,ttl_ms:3e4,source:"mock"}}),{status:200,headers:{"content-type":"application/json","X-Cache":e}})};r=()=>D("MISS");let y=function(e){let t=m.get(e);return t?Date.now()>t.expiresAt?(m.delete(e),null):t.payload:null}(v);if(y)return new i.NextResponse(JSON.stringify({...y,metadata:{cache:"HIT",ttl_ms:3e4}}),{status:200,headers:{"content-type":"application/json","X-Cache":"HIT"}});if(a)return D("MISS");if(!g)throw Error("Supabase client n\xe3o inicializado");let R=(()=>{switch(S){case"24h":return 864e5;case"7d":return 6048e5;case"30d":return 2592e6;case"all":return 31536e6;default:return 36e5}})(),E=new Date(Date.now()-R).toISOString(),b=(await g.from("render_jobs").select("*",{count:"exact",head:!0}).eq("user_id",s)).count??0,{data:O,error:x}=await g.from("render_jobs").select("status").eq("user_id",s).limit(5e3);if(x){if(d.k.warn("video-jobs-stats","fallback: status query error",{message:x.message}),t&&r)return r();return i.NextResponse.json({code:"DB_ERROR",message:"Falha ao obter contagem por status",details:x.message},{status:500})}let w={};for(let e of O||[]){let t=e.status;w[t]=(w[t]||0)+1}let A={queued:w.queued||0,processing:w.processing||0,completed:w.completed||0,failed:w.failed||0,cancelled:w.cancelled||0,other:Object.entries(w).reduce((e,[t,r])=>["queued","processing","completed","failed","cancelled"].includes(t)?e:e+r,0)},N=await g.from("render_jobs").select("id",{count:"exact"}).eq("user_id",s).eq("status","completed").gte("completed_at",E),L=N.count||(N.data?.length??0),F=Number(((L||0)/60).toFixed(3)),{data:j,error:I}=await g.from("render_jobs").select("duration_ms").eq("user_id",s).eq("status","completed").limit(5e3);if(I){if(d.k.warn("video-jobs-stats","fallback: duration query error",{message:I.message}),t&&r)return r();return i.NextResponse.json({code:"DB_ERROR",message:"Falha ao obter m\xe9tricas de dura\xe7\xe3o",details:I.message},{status:500})}let $=(j||[]).map(e=>"number"==typeof e.duration_ms?e.duration_ms:null).filter(e=>"number"==typeof e),q=$.length?Math.round($.reduce((e,t)=>e+t,0)/$.length):0,U=$.slice().sort((e,t)=>e-t),T=e=>{if(!U.length)return 0;let t=Math.min(U.length-1,Math.floor(e*(U.length-1)));return U[t]},C=T(.5),k=T(.9),M=T(.95),B={totals:{total_jobs:b},by_status:A,throughput:{window_minutes:Math.round(R/6e4),jobs_completed_last_60m:L,jobs_per_min:F},performance:{avg_duration_ms:q,p50_ms:C,p90_ms:k,p95_ms:M}};return p(v,B),new i.NextResponse(JSON.stringify({...B,metadata:{cache:"MISS",ttl_ms:3e4,period:S??"default"}}),{status:200,headers:{"content-type":"application/json","X-Cache":"MISS"}})}catch(e){if(d.k.error("video-jobs-stats","unexpected-error",e),t&&r)return r();return i.NextResponse.json({code:"UNEXPECTED",message:"Erro inesperado",details:e.message},{status:500})}}let _=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/v1/video-jobs/stats/route",pathname:"/api/v1/video-jobs/stats",filename:"route",bundlePath:"app/api/v1/video-jobs/stats/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\v1\\video-jobs\\stats\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:f,serverHooks:S}=_,v="/api/v1/video-jobs/stats/route";function D(){return(0,a.patchFetch)({serverHooks:S,staticGenerationAsyncStorage:f})}},40817:(e,t,r)=>{"use strict";r.d(t,{$L:()=>g,OY:()=>m,Rx:()=>p,Z2:()=>a,fR:()=>i});var s=r(906005);let o=()=>{let e=globalThis;return e.__mock_render_jobs__||(e.__mock_render_jobs__=new Map),e.__mock_render_jobs__},n=()=>!!(process.env.NEXT_PUBLIC_SUPABASE_URL&&process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY),a=()=>"true"===process.env.USE_MOCK_RENDER_JOBS||!n(),i=e=>{let t=e?.headers.get("x-mock-user")?.trim();return t&&t.length>0?t:"mock-user"},l=(e,t)=>{let r=new Date().toISOString();return{id:(0,s.randomUUID)(),user_id:e,project_id:t.project_id??(0,s.randomUUID)(),status:t.status??"queued",progress:t.progress??0,attempts:t.attempts??1,duration_ms:t.duration_ms??("completed"===t.status?42e3:null),render_settings:t.render_settings??{slides:4,quality:"medium",tts_voice:"br-Female"},created_at:t.created_at??r,updated_at:t.updated_at??r,completed_at:t.completed_at??("completed"===t.status?r:null)}},u=e=>{let t=Date.now();return[l(e,{status:"completed",progress:100,duration_ms:38e3,created_at:new Date(t-18e5).toISOString(),completed_at:new Date(t-15e5).toISOString(),render_settings:{slides:12,quality:"high",tts_voice:"br-Male"}}),l(e,{status:"completed",progress:100,duration_ms:52e3,created_at:new Date(t-54e5).toISOString(),completed_at:new Date(t-528e4).toISOString(),render_settings:{slides:9,quality:"medium"}}),l(e,{status:"processing",progress:65,duration_ms:null,created_at:new Date(t-3e5).toISOString(),render_settings:{slides:6,quality:"medium"}}),l(e,{status:"queued",progress:0,duration_ms:null,created_at:new Date(t-12e4).toISOString(),render_settings:{slides:3,quality:"low"}}),l(e,{status:"failed",progress:35,duration_ms:null,created_at:new Date(t-108e5).toISOString(),render_settings:{slides:8,quality:"high"}})]},d=e=>{let t=o();return t.has(e)||t.set(e,u(e)),t.get(e)},c=e=>({id:e.id,status:e.status,project_id:e.project_id,created_at:e.created_at,progress:e.progress,attempts:e.attempts,duration_ms:e.duration_ms,settings:e.render_settings}),m=(e,t)=>{let r=d(e),s=l(e,{project_id:t.project_id,status:"queued",progress:0,attempts:1,duration_ms:null,render_settings:{slides:t.slides.length,quality:t.quality??"medium",tts_voice:t.tts_voice??"br-Female"}});return r.unshift(s),c(s)},p=(e,t)=>{let r=d(e);return(t.status?r.filter(e=>e.status===t.status):r).slice(0,t.limit).map(c)},g=e=>{let t=d(e),r=t.reduce((e,t)=>(e[t.status]=(e[t.status]||0)+1,e),{}),s=t.filter(e=>"completed"===e.status),o=Date.now(),n=s.filter(e=>!!e.completed_at&&o-new Date(e.completed_at).getTime()<=36e5).length,a=s.map(e=>e.duration_ms??0),i=a.length?Math.round(a.reduce((e,t)=>e+t,0)/a.length):0,l=a.slice().sort((e,t)=>e-t),u=e=>{if(!l.length)return 0;let t=Math.min(l.length-1,Math.floor(e*(l.length-1)));return l[t]};return{totals:{total_jobs:t.length},by_status:{queued:r.queued||0,processing:r.processing||0,completed:r.completed||0,failed:r.failed||0,cancelled:r.cancelled||0,other:0},throughput:{window_minutes:60,jobs_completed_last_60m:n,jobs_per_min:Number(((n||0)/60).toFixed(3))},performance:{avg_duration_ms:i,p50_ms:u(.5),p90_ms:u(.9),p95_ms:u(.95)}}}},848588:(e,t,r)=>{"use strict";r.d(t,{k:()=>l});var s=r(592048),o=r.n(s),n=r(555315),a=r.n(n);class i{constructor(){this.maxFileSize=10485760,this.maxFiles=5,this.logDir=a().join(process.cwd(),"..","logs"),o().existsSync(this.logDir)||o().mkdirSync(this.logDir,{recursive:!0}),this.currentLogFile=a().join(this.logDir,`app-${this.getDateString()}.log`)}static getInstance(){return i.instance||(i.instance=new i),i.instance}getDateString(){let e=new Date;return`${e.getFullYear()}${String(e.getMonth()+1).padStart(2,"0")}${String(e.getDate()).padStart(2,"0")}`}getTimestamp(){return new Date().toISOString()}formatConsole(e){let t={DEBUG:"\x1b[36m",INFO:"\x1b[37m",WARN:"\x1b[33m",ERROR:"\x1b[31m",FATAL:"\x1b[35m",RESET:"\x1b[0m"},r=t[e.level],s={DEBUG:"\uD83D\uDD0D",INFO:"â„¹ï¸",WARN:"âš ï¸",ERROR:"âŒ",FATAL:"\uD83D\uDC80"}[e.level],o=`${r}[${e.timestamp}] ${s} ${e.level} [${e.component}] ${e.message}${t.RESET}`;return e.data&&(o+=`
${r}   Data: ${JSON.stringify(e.data,null,2)}${t.RESET}`),e.stack&&(o+=`
${r}   Stack: ${e.stack}${t.RESET}`),o}writeToFile(e){try{this.rotateIfNeeded();let t=JSON.stringify(e)+"\n";o().appendFileSync(this.currentLogFile,t,"utf-8")}catch(e){console.error("Erro ao escrever log:",e)}}rotateIfNeeded(){try{if(o().existsSync(this.currentLogFile)&&o().statSync(this.currentLogFile).size>=this.maxFileSize){let e=Date.now(),t=this.currentLogFile.replace(".log",`-${e}.log`);o().renameSync(this.currentLogFile,t),this.cleanOldLogs()}}catch(e){console.error("Erro ao rotacionar logs:",e)}}cleanOldLogs(){try{let e=o().readdirSync(this.logDir).filter(e=>e.endsWith(".log")).map(e=>({name:e,path:a().join(this.logDir,e),time:o().statSync(a().join(this.logDir,e)).mtime.getTime()})).sort((e,t)=>t.time-e.time);e.length>this.maxFiles&&e.slice(this.maxFiles).forEach(e=>{o().unlinkSync(e.path)})}catch(e){console.error("Erro ao limpar logs antigos:",e)}}log(e,t,r,s,o){let n={timestamp:this.getTimestamp(),level:e,component:t,message:r,data:s};o&&(n.stack=o.stack),console.log(this.formatConsole(n)),this.writeToFile(n)}debug(e,t,r){this.log("DEBUG",e,t,r)}info(e,t,r){this.log("INFO",e,t,r)}warn(e,t,r){this.log("WARN",e,t,r)}error(e,t,r,s){this.log("ERROR",e,t,s,r)}fatal(e,t,r,s){this.log("FATAL",e,t,s,r)}analyzeLogs(e){let t=e||this.currentLogFile;if(!o().existsSync(t))throw Error(`Arquivo de log n\xe3o encontrado: ${t}`);let r=o().readFileSync(t,"utf-8").split("\n").filter(e=>e.trim()).map(e=>{try{return JSON.parse(e)}catch{return null}}).filter(e=>null!==e),s={totalLogs:r.length,byLevel:{DEBUG:r.filter(e=>"DEBUG"===e.level).length,INFO:r.filter(e=>"INFO"===e.level).length,WARN:r.filter(e=>"WARN"===e.level).length,ERROR:r.filter(e=>"ERROR"===e.level).length,FATAL:r.filter(e=>"FATAL"===e.level).length},byComponent:{},errors:r.filter(e=>"ERROR"===e.level||"FATAL"===e.level),warnings:r.filter(e=>"WARN"===e.level),timeRange:{start:r[0]?.timestamp||"",end:r[r.length-1]?.timestamp||""}};return r.forEach(e=>{s.byComponent[e.component]||(s.byComponent[e.component]=0),s.byComponent[e.component]++}),s}searchLogs(e,t,r,s){let n=s||this.currentLogFile;return o().existsSync(n)?o().readFileSync(n,"utf-8").split("\n").filter(e=>e.trim()).map(e=>{try{return JSON.parse(e)}catch{return null}}).filter(e=>null!==e).filter(s=>(!t||s.level===t)&&(!r||s.component===r)&&(!e||JSON.stringify(s).toLowerCase().includes(e.toLowerCase()))):[]}printAnalysis(e){console.log("\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"),console.log("â•‘                    \uD83D\uDCCA AN\xc1LISE DE LOGS                            â•‘"),console.log("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n"),console.log(`ðŸ“‹ Total de Logs: ${e.totalLogs}`),console.log(`â° Per\xedodo: ${e.timeRange.start} â†’ ${e.timeRange.end}
`),console.log("\uD83D\uDCCA Por N\xedvel:"),console.log(`   ðŸ” DEBUG: ${e.byLevel.DEBUG}`),console.log(`   â„¹ï¸  INFO:  ${e.byLevel.INFO}`),console.log(`   âš ï¸  WARN:  ${e.byLevel.WARN}`),console.log(`   âŒ ERROR: ${e.byLevel.ERROR}`),console.log(`   ðŸ’€ FATAL: ${e.byLevel.FATAL}
`),console.log("\uD83D\uDCE6 Por Componente:"),Object.entries(e.byComponent).sort(([,e],[,t])=>t-e).forEach(([e,t])=>{console.log(`   - ${e}: ${t}`)}),e.errors.length>0&&(console.log(`
âŒ Erros Recentes (${e.errors.length}):`),e.errors.slice(-5).forEach(e=>{console.log(`   [${e.timestamp}] ${e.component}: ${e.message}`)})),e.warnings.length>0&&(console.log(`
âš ï¸  Avisos Recentes (${e.warnings.length}):`),e.warnings.slice(-5).forEach(e=>{console.log(`   [${e.timestamp}] ${e.component}: ${e.message}`)})),console.log("\n")}getLogFiles(){return o().readdirSync(this.logDir).filter(e=>e.endsWith(".log")).map(e=>a().join(this.logDir,e))}clearLogs(){let e=this.getLogFiles();e.forEach(e=>o().unlinkSync(e)),console.log(`âœ… ${e.length} arquivos de log removidos`)}}let l=i.getInstance()},895412:(e,t,r)=>{"use strict";r.d(t,{s:()=>o});var s=r(868355);function o(e){let t=process.env.NEXT_PUBLIC_SUPABASE_URL||process.env.SUPABASE_URL||"",r=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||process.env.SUPABASE_ANON_KEY||"",o=(e.headers.get("authorization")||e.headers.get("Authorization"))??"",n={};return o&&(n.Authorization=o),(0,s.createClient)(t,r,{global:{headers:n},auth:{persistSession:!1,autoRefreshToken:!0}})}},351842:(e,t,r)=>{"use strict";r.d(t,{GJ:()=>a,LL:()=>l,kB:()=>i,l_:()=>n});var s=r(840594);let o=s.Ry({title:s.Z_().min(1),content:s.Z_().min(1),order_index:s.Rx().int().nonnegative()}),n=s.Ry({project_id:s.Z_().uuid(),slides:s.IX(o).min(1),tts_voice:s.Z_().optional(),quality:s.Km(["low","medium","high"]).default("medium")});s.Ry({startDate:s.oQ.date().optional(),endDate:s.oQ.date().optional(),projectId:s.Z_().uuid().optional(),groupBy:s.Km(["day","week","month"]).default("day"),includeDetails:s.oQ.boolean().default(!1)});let a=s.Ry({period:s.Km(["24h","7d","30d","all"]).default("7d"),includeErrors:s.oQ.boolean().default(!0),includePerformance:s.oQ.boolean().default(!0)});s.Ry({eventType:s.Km(["slide_reordered","video_exported","project_created","render_started","render_completed","render_failed","user_login","user_logout"]),eventData:s.IM(s._4()),userId:s.Z_().uuid().optional(),sessionId:s.Z_().optional(),timestamp:s.oQ.date().default(()=>new Date)}),s.Ry({startDate:s.oQ.date(),endDate:s.oQ.date(),eventTypes:s.IX(s.Z_()).optional(),userId:s.Z_().uuid().optional(),limit:s.oQ.number().int().positive().max(1e3).default(100),offset:s.oQ.number().int().nonnegative().default(0)});let i=s.Ry({jobId:s.Z_().uuid("ID de job inv\xe1lido"),reason:s.Z_().max(500).optional()}),l=s.Ry({jobId:s.Z_().uuid("ID de job inv\xe1lido"),force:s.oQ.boolean().default(!1)})}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972,8355,3105],()=>r(703252));module.exports=s})();