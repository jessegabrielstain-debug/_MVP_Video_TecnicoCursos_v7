"use strict";(()=>{var e={};e.id=5899,e.ids=[5899],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},37355:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>j,patchFetch:()=>y,requestAsyncStorage:()=>h,routeModule:()=>m,serverHooks:()=>f,staticGenerationAsyncStorage:()=>b});var r={};s.r(r),s.d(r,{DELETE:()=>p,GET:()=>g,POST:()=>c});var o=s(49303),n=s(88716),a=s(60670),i=s(87070);class l{async render(e,t,s,r){console.log("[RenderEngine] Starting render:",{inputPath:e,outputPath:t,options:s}),r&&(r({stage:"encoding",percent:0}),r({stage:"encoding",percent:50}),r({stage:"encoding",percent:100}))}async validateInput(e){return console.log("[RenderEngine] Validating input:",e),!0}getDefaultOptions(){return{width:1920,height:1080,fps:30,codec:"h264",bitrate:5e6}}async createTimelineFromSlides(e,t){return console.log("[RenderEngine] Creating timeline from",e.length,"slides"),{timelineId:`timeline_${Date.now()}`,totalDuration:e.reduce((e,t)=>e+(t.duration||5),0)}}async startRender(e,t,s){console.log("[RenderEngine] Starting render with slides:",e.length);let r=`job_${Date.now()}`;return this.jobs.set(r,{id:r,status:"processing",progress:0,startTime:new Date().toISOString(),settings:s}),setTimeout(()=>{let e=this.jobs.get(r);e&&(e.status="completed",e.progress=100,e.endTime=new Date().toISOString(),e.outputPath=`/output/${r}.mp4`,this.jobs.set(r,e))},5e3),r}async getAllJobs(e){return console.log("[RenderEngine] Getting all jobs for user:",e),Array.from(this.jobs.values())}async getJobStatus(e){return console.log("[RenderEngine] Getting job status:",e),this.jobs.get(e)||null}async cancelJob(e){console.log("[RenderEngine] Cancelling job:",e);let t=this.jobs.get(e);return!!t&&(t.status="cancelled",t.endTime=new Date().toISOString(),!0)}async cleanupJob(e){return console.log("[RenderEngine] Cleaning up job:",e),this.jobs.delete(e)}constructor(){this.jobs=new Map}}new l;var u=s(84080);let d=new l;async function c(e){console.log("\uD83C\uDFAC Iniciando renderiza\xe7\xe3o de v\xeddeo...");try{let{s3Key:t,slides:s,timeline:r,settings:o={width:1920,height:1080,fps:30,bitrate:"5000k",format:"mp4",quality:"high",audioQuality:192,enableAudio:!0}}=await e.json();if(!s&&!t)return i.NextResponse.json({error:"Slides ou s3Key s\xe3o obrigat\xf3rios"},{status:400});let n=s;if(t&&!s){console.log("\uD83D\uDCE5 Processando slides do S3 para renderiza\xe7\xe3o:",t);let e=new u.$;n=(await e.parseFromS3(t)).slides}let a=r;if(!r&&n&&(a=d.createTimelineFromSlides(n)),!n||!a)return i.NextResponse.json({error:"Dados de slides e timeline s\xe3o obrigat\xf3rios"},{status:400});console.log("⚙️ Configura\xe7\xf5es de renderiza\xe7\xe3o:",{slides:n.length,duration:a.totalDuration,quality:o.quality,format:o.format});let l=await d.startRender(n,a,o);return console.log("✅ Job de renderiza\xe7\xe3o iniciado:",l),i.NextResponse.json({success:!0,jobId:l,status:"processing",message:"Renderiza\xe7\xe3o iniciada com sucesso",estimatedTime:Math.ceil(a.totalDuration/10),settings:{resolution:`${o.width}x${o.height}`,fps:o.fps,quality:o.quality,duration:a.totalDuration}})}catch(e){return console.error("❌ Erro na renderiza\xe7\xe3o:",e),i.NextResponse.json({success:!1,error:"Erro ao iniciar renderiza\xe7\xe3o",details:e instanceof Error?e.message:"Erro desconhecido"},{status:500})}}async function g(e){let{searchParams:t}=new URL(e.url),s=t.get("jobId");if(!s){let e=await d.getAllJobs();return i.NextResponse.json({success:!0,jobs:e.map(e=>({id:e.id,status:e.status,progress:e.progress,startTime:e.startTime,endTime:e.endTime,outputPath:e.outputPath,errorMessage:e.errorMessage}))})}let r=await d.getJobStatus(s);return r?i.NextResponse.json({success:!0,job:{id:r.id,status:r.status,progress:r.progress,startTime:r.startTime,endTime:r.endTime,outputPath:r.outputPath,errorMessage:r.errorMessage,settings:r.settings}}):i.NextResponse.json({error:"Job n\xe3o encontrado"},{status:404})}async function p(e){let{searchParams:t}=new URL(e.url),s=t.get("jobId");if(!s)return i.NextResponse.json({error:"Job ID \xe9 obrigat\xf3rio"},{status:400});try{let e=await d.cancelJob(s),t=await d.cleanupJob(s);return i.NextResponse.json({success:!0,cancelled:e,cleanedUp:t,message:"Job cancelado e limpo com sucesso"})}catch(e){return i.NextResponse.json({error:"Erro ao cancelar job",details:e instanceof Error?e.message:"Erro desconhecido"},{status:500})}}let m=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/v1/render/video-production/route",pathname:"/api/v1/render/video-production",filename:"route",bundlePath:"app/api/v1/render/video-production/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\v1\\render\\video-production\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:h,staticGenerationAsyncStorage:b,serverHooks:f}=m,j="/api/v1/render/video-production/route";function y(){return(0,a.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:b})}},84080:(e,t,s)=>{s.d(t,{$:()=>r});class r{async parseFile(e){return console.log("[PPTXParser] Parsing file:",e),{slides:[],totalSlides:0,metadata:{}}}async parseBuffer(e){return console.log("[PPTXParser] Parsing buffer"),{slides:[],totalSlides:0,metadata:{}}}async parseFromS3(e){return console.log("[PPTXParser] Parsing from S3:",e),{slides:[],totalSlides:0,metadata:{}}}}new r}};var t=require("../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[8948,5972],()=>s(37355));module.exports=r})();