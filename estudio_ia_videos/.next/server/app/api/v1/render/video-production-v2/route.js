"use strict";(()=>{var e={};e.id=7491,e.ids=[7491],e.modules={220399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},430517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},920846:(e,o,r)=>{r.r(o),r.d(o,{originalPathname:()=>j,patchFetch:()=>R,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>b,staticGenerationAsyncStorage:()=>h});var t={};r.r(t),r.d(t,{GET:()=>g,POST:()=>p});var s=r(349303),n=r(88716),a=r(60670),i=r(387070),d=r(224507),u=r(84770),c=r.n(u);!function(){var e=Error("Cannot find module '@/lib/video-render-pipeline'");throw e.code="MODULE_NOT_FOUND",e}();let l=new Map;async function p(e){console.log("\uD83C\uDFAC [Video Render v2] Iniciando renderiza\xe7\xe3o de produ\xe7\xe3o...");try{let{slides:o,timeline:r,settings:t}=await e.json();if(!o||!Array.isArray(o))return i.NextResponse.json({success:!1,error:"Slides s\xe3o obrigat\xf3rios"},{status:400});if(!r||!r.totalDuration)return i.NextResponse.json({success:!1,error:"Timeline \xe9 obrigat\xf3rio"},{status:400});let s={width:t?.width||1920,height:t?.height||1080,fps:t?.fps||30,bitrate:t?.bitrate||"8000k",format:t?.format||"mp4",quality:t?.quality||"high",audioQuality:t?.audioQuality||192,enableAudio:t?.enableAudio!==!1},n=`render_${c().randomBytes(16).toString("hex")}`,a={jobId:n,status:"queued",progress:0,startedAt:new Date().toISOString(),settings:s};return l.set(n,a),console.log("\uD83D\uDCCB [Video Render v2] Job criado:",{jobId:n,slides:o.length,duration:r.totalDuration,settings:s}),v(n,o,r,s).catch(e=>{console.error(`âŒ [Video Render v2] Erro no job ${n}:`,e);let o=l.get(n);o&&(o.status="failed",o.errorMessage=e instanceof Error?e.message:"Erro desconhecido",o.completedAt=new Date().toISOString(),l.set(n,o))}),i.NextResponse.json({success:!0,jobId:n,message:"Renderiza\xe7\xe3o iniciada com sucesso",estimatedTime:Math.ceil(2*r.totalDuration),status:"queued"})}catch(e){return console.error("âŒ [Video Render v2] Erro na cria\xe7\xe3o do job:",e),i.NextResponse.json({success:!1,error:"Erro interno na renderiza\xe7\xe3o",details:e instanceof Error?e.message:"Erro desconhecido"},{status:500})}}async function g(e){let{searchParams:o}=new URL(e.url),r=o.get("jobId");if(!r)return i.NextResponse.json({success:!1,error:"Job ID \xe9 obrigat\xf3rio"},{status:400});let t=l.get(r);return t?i.NextResponse.json({success:!0,job:{jobId:t.jobId,status:t.status,progress:t.progress,startedAt:t.startedAt,completedAt:t.completedAt,outputPath:t.outputPath||"Em processamento...",errorMessage:t.errorMessage,settings:t.settings}}):i.NextResponse.json({success:!1,error:"Job n\xe3o encontrado"},{status:404})}async function v(e,o,r,t){console.log(`ðŸ”„ [Video Render v2] Processando job ${e}...`);let s=l.get(e);if(s)try{s.status="processing",s.progress=10,l.set(e,s);let n=Object(function(){var e=Error("Cannot find module '@/lib/video-render-pipeline'");throw e.code="MODULE_NOT_FOUND",e}())(t);console.log(`ðŸ“¦ [Video Render v2] Preparando assets para job ${e}...`),await n.prepareAssets(o),s.progress=30,l.set(e,s),console.log(`ðŸŽ¨ [Video Render v2] Renderizando slides para job ${e}...`);let a=await n.renderSlides(o,r);s.progress=60,l.set(e,s),console.log(`ðŸŽžï¸ [Video Render v2] Compondo timeline para job ${e}...`);let i=await n.composeTimeline(a,r);s.progress=80,l.set(e,s),console.log(`ðŸ“¹ [Video Render v2] Codificando v\xeddeo final para job ${e}...`);let u=await n.encodeVideo(i,t);s.progress=95,l.set(e,s);let c=u;try{console.log(`â˜ï¸ [Video Render v2] Fazendo upload para S3 do job ${e}...`);let o=`rendered-videos/${e}.${t.format}`,r=await d.f.uploadFile(Buffer.from(""),o,`video/${t.format}`);r.success&&(c=r.key||u)}catch(o){console.warn(`âš ï¸ [Video Render v2] Upload S3 falhou para job ${e}:`,o)}s.status="completed",s.progress=100,s.outputPath=c,s.completedAt=new Date().toISOString(),l.set(e,s),console.log(`âœ… [Video Render v2] Job ${e} conclu\xeddo com sucesso!`)}catch(o){console.error(`âŒ [Video Render v2] Erro no job ${e}:`,o),s.status="failed",s.errorMessage=o instanceof Error?o.message:"Erro desconhecido na renderiza\xe7\xe3o",s.completedAt=new Date().toISOString(),l.set(e,s)}}let m=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/v1/render/video-production-v2/route",pathname:"/api/v1/render/video-production-v2",filename:"route",bundlePath:"app/api/v1/render/video-production-v2/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\v1\\render\\video-production-v2\\route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:f,staticGenerationAsyncStorage:h,serverHooks:b}=m,j="/api/v1/render/video-production-v2/route";function R(){return(0,a.patchFetch)({serverHooks:b,staticGenerationAsyncStorage:h})}},224507:(e,o,r)=>{r.d(o,{f:()=>t});class t{}}};var o=require("../../../../../webpack-runtime.js");o.C(e);var r=e=>o(o.s=e),t=o.X(0,[8948,5972],()=>r(920846));module.exports=t})();