"use strict";(()=>{var e={};e.id=6074,e.ids=[6074,3936],e.modules={21841:e=>{e.exports=require("@aws-sdk/client-s3")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},55315:e=>{e.exports=require("path")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},78303:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>g,patchFetch:()=>S,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>h,staticGenerationAsyncStorage:()=>f});var r={};s.r(r),s.d(r,{GET:()=>l,POST:()=>p});var o=s(49303),a=s(88716),i=s(60670),n=s(87070),c=s(24507),u=s(13936);async function p(e){try{let t=(0,u.getSupabaseForRequest)(e),{data:{user:r},error:o}=await t.auth.getUser();if(o||!r)return n.NextResponse.json({error:"Usu\xe1rio n\xe3o autenticado"},{status:401});let{s3Key:a,jobId:i}=await e.json();if(!a||!i)return n.NextResponse.json({error:"S3 key e job ID s\xe3o obrigat\xf3rios"},{status:400});console.log("\uD83D\uDD04 Starting PPTX processing:",{s3Key:a,jobId:i}),console.log("\uD83D\uDCE5 Downloading file from S3...");let p=await c.f.downloadFile(a);if(!p.success||!p.buffer)throw Error(`Failed to download file: ${p.error}`);console.log(`ðŸ“¦ File downloaded: ${p.buffer.length} bytes`),console.log("\uD83D\uDD0D Processing PPTX content...");let{pptxProcessor:l}=await s.e(1273).then(s.bind(s,41273)),d=await l.processBuffer(p.buffer,{extractImages:!0,extractNotes:!0});if(!d.slides)throw Error("Processing failed: No slides found");console.log(`âœ… Processing successful: ${d.slides.length} slides`);let m=d.slides.reduce((e,t)=>e+(t.duration||5),0),f=d.slides.reduce((e,t)=>e+t.images.length,0),h=d.slides.some(e=>e.animations&&e.animations.length>0),g={slides:d.slides.map(e=>({id:e.id,title:e.title,content:e.textContent||e.content,images:e.images.length,duration:e.duration||5,animations:e.animations||[]})),totalDuration:m,slideCount:d.slides.length,imageCount:f,hasAnimations:h,metadata:{title:d.metadata?.title||"Untitled",author:d.metadata?.author||"Unknown",subject:d.metadata?.subject||"",createdAt:d.metadata?.createdAt||new Date().toISOString(),modifiedAt:d.metadata?.modifiedAt||new Date().toISOString()}};return n.NextResponse.json({success:!0,data:g,message:"Processamento conclu\xeddo com sucesso",processingTime:Date.now()-Date.now()})}catch(e){return console.error("Processing API Error:",e),n.NextResponse.json({error:"Erro durante o processamento",details:e instanceof Error?e.message:"Erro desconhecido"},{status:500})}}async function l(e){let{searchParams:t}=new URL(e.url);if(!t.get("jobId"))return n.NextResponse.json({error:"Job ID \xe9 obrigat\xf3rio"},{status:400});try{return n.NextResponse.json({success:!0,status:"completed",progress:100,message:"Processamento conclu\xeddo"})}catch(e){return console.error("Status check error:",e),n.NextResponse.json({error:"Erro ao verificar status"},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/v1/pptx/process-production/route",pathname:"/api/v1/pptx/process-production",filename:"route",bundlePath:"app/api/v1/pptx/process-production/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\v1\\pptx\\process-production\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:f,serverHooks:h}=d,g="/api/v1/pptx/process-production/route";function S(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:f})}},24507:(e,t,s)=>{s.d(t,{f:()=>u});var r=s(92048),o=s(55315),a=s.n(o),i=s(21841),n=s(61657);function c(){return(process.env.STORAGE_PROVIDER||"local").toLowerCase()}class u{static async deleteFile(e){if("local"===c()){let t=a().join(process.cwd(),"public","uploads",e);await r.promises.rm(t,{force:!0});return}}static async downloadFile(e){try{let t=c();if("local"===t){let t=a().join(process.cwd(),"public","uploads",e),s=await r.promises.readFile(t);return{success:!0,buffer:s}}if("supabase"===t){let t=process.env.SUPABASE_URL||"https://ofhzrdiadxigrvmrhaiz.supabase.co",s=process.env.SUPABASE_SERVICE_ROLE_KEY||"",r=process.env.SUPABASE_STORAGE_BUCKET||"public",o=(0,n.eI)(t,s),{data:a,error:i}=await o.storage.from(r).download(e);if(i||!a)return{success:!1,error:i?.message||"Download failed"};let c=await a.arrayBuffer();return{success:!0,buffer:Buffer.from(c)}}let s=process.env.AWS_REGION||"us-east-1",o=process.env.AWS_S3_BUCKET||"";if(!o)return{success:!1,error:"AWS_S3_BUCKET not configured"};let u=new i.S3Client({region:s}),p=(await u.send(new i.GetObjectCommand({Bucket:o,Key:e}))).Body,l=[];for await(let e of p)l.push(Buffer.isBuffer(e)?e:Buffer.from(e));return{success:!0,buffer:Buffer.concat(l)}}catch(e){return{success:!1,error:String(e)}}}static async fileExists(e){if("local"===c()){let t=a().join(process.cwd(),"public","uploads",e);try{await r.promises.access(t)}catch{return!1}}return!0}static async uploadFile(e,t,s){let o=c();if("local"===o){let s=a().join(process.cwd(),"public","uploads",e);return await r.promises.mkdir(a().dirname(s),{recursive:!0}),await r.promises.writeFile(s,t),`/uploads/${e}`.replace(/\\/g,"/")}if("supabase"===o){let r=process.env.SUPABASE_URL||"https://ofhzrdiadxigrvmrhaiz.supabase.co",o=process.env.SUPABASE_SERVICE_ROLE_KEY||"",a=process.env.SUPABASE_STORAGE_BUCKET||"public",i=(0,n.eI)(r,o),{error:c}=await i.storage.from(a).upload(e,t,{contentType:s,upsert:!0});if(c)throw c;let{data:u}=i.storage.from(a).getPublicUrl(e);return u.publicUrl}let u=process.env.AWS_REGION||"us-east-1",p=process.env.AWS_S3_BUCKET||"",l=new i.S3Client({region:u});return await l.send(new i.PutObjectCommand({Bucket:p,Key:e,Body:t,ContentType:s||"application/octet-stream"})),`https://${p}.s3.${u}.amazonaws.com/${e}`}static async getSignedUrl(e,t=3600){let s=c();if("local"===s)return`/uploads/${e}`.replace(/\\/g,"/");if("supabase"===s){let s=process.env.SUPABASE_URL||"https://ofhzrdiadxigrvmrhaiz.supabase.co",r=process.env.SUPABASE_SERVICE_ROLE_KEY||"",o=process.env.SUPABASE_STORAGE_BUCKET||"public",a=(0,n.eI)(s,r),{data:i,error:c}=await a.storage.from(o).createSignedUrl(e,t);if(c||!i)throw c||Error("Failed to sign URL");return i.signedUrl}let r=process.env.AWS_REGION||"us-east-1",o=process.env.AWS_S3_BUCKET||"";return`https://${o}.s3.${r}.amazonaws.com/${e}`}}},13936:(e,t,s)=>{s.d(t,{e:()=>i,getSupabaseForRequest:()=>c,p:()=>n});var r=s(67721),o=s(61657),a=s(71615);let i=()=>{let e=(0,a.cookies)();return(0,r.createServerClient)("https://ofhzrdiadxigrvmrhaiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ",{cookies:{get:t=>e.get(t)?.value,set(t,s,r){try{e.set({name:t,value:s,...r})}catch(e){}},remove(t,s){try{e.set({name:t,value:"",...s})}catch(e){}}}})},n=(0,o.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}});function c(e){let t=e.headers.get("authorization")||e.headers.get("Authorization");return t?(0,o.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ",{global:{headers:{Authorization:t}},auth:{persistSession:!1,autoRefreshToken:!1}}):i()}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[8948,5972,1657,9702],()=>s(78303));module.exports=r})();