"use strict";(()=>{var e={};e.id=9840,e.ids=[9840],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},81045:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>v,patchFetch:()=>N,requestAsyncStorage:()=>m,routeModule:()=>x,serverHooks:()=>h,staticGenerationAsyncStorage:()=>f});var o={};t.r(o),t.d(o,{GET:()=>g,POST:()=>c});var a=t(49303),s=t(88716),n=t(60670),i=t(87070),l=t(8261),u=t(68582),p=t(8803);class d{async generateForSlide(e,r){return console.log("[AutoNarration] Generating narration for slide"),{audioBuffer:Buffer.from([]),duration:0,transcript:e}}async generateForPresentation(e,r){return console.log("[AutoNarration] Generating narration for presentation"),e.map(e=>({audioBuffer:Buffer.from([]),duration:0,transcript:e}))}async generateNarrations(e,r,t){try{p.kg.info("AutoNarration",`Iniciando gera\xe7\xe3o de narra\xe7\xe3o para projeto ${r}`,{slideCount:e.length});let o=[],a=0;for(let s of e){let e="";if(!(e=t.preferNotes&&s.notes&&s.notes.trim().length>0?s.notes:s.elements.filter(e=>("text"===e.type||"shape"===e.type)&&(e.text||e.content)).map(e=>e.text||e.content).join(". "))||0===e.trim().length){p.kg.warn("AutoNarration",`Slide ${s.slideNumber} sem texto para narrar. Pulando.`);continue}e.length>5e3&&(e=e.substring(0,5e3));try{let n=`${r}/slide-${s.slideNumber}-${Date.now()}.mp3`,i=t.voice||"21m00Tcm4TlvDq8ikWAM",l=await (0,u.wS)(e,n,i),d=e.split(/\s+/).length,c=Math.ceil(d/150*6e4);o.push({slideNumber:s.slideNumber,audioUrl:l,script:e,provider:"elevenlabs",voice:i,duration:c}),a+=c,p.kg.info("AutoNarration",`Narra\xe7\xe3o gerada para slide ${s.slideNumber}`)}catch(e){p.kg.error("AutoNarration",`Erro ao gerar narra\xe7\xe3o para slide ${s.slideNumber}`,e)}}return{success:!0,narrations:o,totalDuration:a}}catch(e){return p.kg.error("AutoNarration","Erro fatal na gera\xe7\xe3o de narra\xe7\xf5es",e),{success:!1,narrations:[],totalDuration:0,error:e instanceof Error?e.message:"Erro desconhecido"}}}}async function c(e){console.log("\uD83C\uDF99ï¸ [Auto-Narrate] Iniciando gera\xe7\xe3o de narra\xe7\xe3o...");try{let{projectId:r,options:t}=await e.json();if(!r)return i.NextResponse.json({error:"projectId \xe9 obrigat\xf3rio"},{status:400});let o=await l._.project.findUnique({where:{id:r},include:{timeline:!0,slides:!0}});if(!o)return i.NextResponse.json({error:"Projeto n\xe3o encontrado"},{status:404});let a=[];if(o.slides&&o.slides.length>0)a=o.slides.map((e,r)=>{let t=e.content,o="string"==typeof t?.notes?t?.notes:"",a=Array.isArray(t?.elements)?t?.elements:[];return{slideNumber:r+1,notes:o,elements:a}});else if(o.slidesData){let e=o.slidesData;Array.isArray(e)&&(a=e.map((e,r)=>({slideNumber:r+1,notes:"string"==typeof e.notes?e.notes:"",elements:Array.isArray(e.elements)?e.elements:[]})))}else if(o.timeline?.tracks){let e=o.timeline.tracks;if(Array.isArray(e)){let r=e.find(e=>e?.type==="video"||e?.type==="main"),t=r?.elements||[];Array.isArray(t)&&(a=t.map((e,r)=>({slideNumber:r+1,notes:"string"==typeof e?.notes?e?.notes:"",elements:Array.isArray(e?.children)?e?.children:[]})))}}if(0===a.length)return i.NextResponse.json({error:"Projeto n\xe3o possui slides para narra\xe7\xe3o"},{status:400});let s={provider:t?.provider||"elevenlabs",voice:t?.voice||"21m00Tcm4TlvDq8ikWAM",speed:t?.speed||1,pitch:t?.pitch||1,preferNotes:t?.preferNotes!==!1};console.log(`ðŸ“Š Gerando narra\xe7\xe3o para ${a.length} slides...`),console.log("âš™ï¸ Op\xe7\xf5es:",s);let n=new d,u=await n.generateNarrations(a,r,s);if(!u.success)return i.NextResponse.json({error:u.error||"Erro ao gerar narra\xe7\xe3o"},{status:500});if(o.slidesData){let e=o.slidesData;if(Array.isArray(e)){for(let r of u.narrations){let t=r.slideNumber-1;e[t]&&(e[t].voiceover={audioUrl:r.audioUrl,script:r.script,provider:r.provider,voice:r.voice,duration:r.duration})}await l._.project.update({where:{id:r},data:{slidesData:e,autoNarration:!0,updatedAt:new Date}})}}else await l._.project.update({where:{id:r},data:{autoNarration:!0,updatedAt:new Date}});return console.log(`âœ… Narra\xe7\xe3o gerada com sucesso: ${u.narrations.length} slides`),i.NextResponse.json({success:!0,narrations:u.narrations,totalDuration:u.totalDuration,stats:{totalSlides:a.length,narratedSlides:u.narrations.length,skippedSlides:a.length-u.narrations.length,totalDurationSeconds:Math.round(u.totalDuration/1e3),averageDurationPerSlide:Math.round(u.totalDuration/u.narrations.length/1e3)}})}catch(e){return console.error("âŒ [Auto-Narrate] Erro:",e),i.NextResponse.json({error:"Erro ao gerar narra\xe7\xe3o",details:e instanceof Error?e.message:"Erro desconhecido"},{status:500})}}async function g(e){try{let{searchParams:r}=new URL(e.url),t=r.get("projectId");if(!t)return i.NextResponse.json({error:"projectId \xe9 obrigat\xf3rio"},{status:400});let o=await l._.project.findUnique({where:{id:t},select:{id:!0,title:!0,autoNarration:!0,slidesData:!0,totalSlides:!0}});if(!o)return i.NextResponse.json({error:"Projeto n\xe3o encontrado"},{status:404});let a=0,s=o.totalSlides||0;if(o.slidesData){let e=o.slidesData;Array.isArray(e)&&(s=e.length,a=e.filter(e=>!!(e?.voiceover&&e.voiceover&&e.voiceover&&e.voiceover.audioUrl)).length)}return i.NextResponse.json({projectId:o.id,projectName:o.title,autoNarration:o.autoNarration,narratedSlides:a,totalSlides:s,progress:s>0?a/s*100:0})}catch(e){return console.error("âŒ [Auto-Narrate] Erro ao buscar status:",e),i.NextResponse.json({error:"Erro ao buscar status"},{status:500})}}new d;let x=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/v1/pptx/auto-narrate/route",pathname:"/api/v1/pptx/auto-narrate",filename:"route",bundlePath:"app/api/v1/pptx/auto-narrate/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\v1\\pptx\\auto-narrate\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:m,staticGenerationAsyncStorage:f,serverHooks:h}=x,v="/api/v1/pptx/auto-narrate/route";function N(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:f})}},8261:(e,r,t)=>{t.d(r,{_:()=>a});var o=t(53524);let a=global.prisma||new o.PrismaClient({log:["error"]})}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[8948,5972,1657,6394,8582],()=>t(81045));module.exports=o})();