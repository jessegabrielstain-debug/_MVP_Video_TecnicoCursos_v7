"use strict";(()=>{var e={};e.id=9840,e.ids=[9840],e.modules={220399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},430517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},67946:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>f,patchFetch:()=>v,requestAsyncStorage:()=>p,routeModule:()=>u,serverHooks:()=>m,staticGenerationAsyncStorage:()=>c});var o={};t.r(o),t.d(o,{GET:()=>d,POST:()=>l});var a=t(349303),n=t(88716),s=t(60670),i=t(387070);async function l(e){console.log("\uD83C\uDF99ï¸ [Auto-Narrate] Iniciando gera\xe7\xe3o de narra\xe7\xe3o...");try{let{projectId:r,options:t}=await e.json();if(!r)return i.NextResponse.json({error:"projectId \xe9 obrigat\xf3rio"},{status:400});let o=await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).project.findUnique({where:{id:r},include:{timeline:!0,slides:!0}});if(!o)return i.NextResponse.json({error:"Projeto n\xe3o encontrado"},{status:404});let a=[];if(o.slides&&o.slides.length>0)a=o.slides.map((e,r)=>{let t=e.content,o="string"==typeof t?.notes?t?.notes:"",a=Array.isArray(t?.elements)?t?.elements:[];return{slideNumber:r+1,notes:o,elements:a}});else if(o.slidesData){let e=o.slidesData;Array.isArray(e)&&(a=e.map((e,r)=>({slideNumber:r+1,notes:"string"==typeof e.notes?e.notes:"",elements:Array.isArray(e.elements)?e.elements:[]})))}else if(o.timeline?.tracks){let e=o.timeline.tracks;if(Array.isArray(e)){let r=e.find(e=>e?.type==="video"||e?.type==="main"),t=r?.elements||[];Array.isArray(t)&&(a=t.map((e,r)=>({slideNumber:r+1,notes:"string"==typeof e?.notes?e?.notes:"",elements:Array.isArray(e?.children)?e?.children:[]})))}}if(0===a.length)return i.NextResponse.json({error:"Projeto n\xe3o possui slides para narra\xe7\xe3o"},{status:400});let n={provider:t?.provider||"azure",voice:t?.voice||"pt-BR-FranciscaNeural",speed:t?.speed||1,pitch:t?.pitch||1,preferNotes:t?.preferNotes!==!1};console.log(`ðŸ“Š Gerando narra\xe7\xe3o para ${a.length} slides...`),console.log("âš™ï¸ Op\xe7\xf5es:",n);let s=Object(function(){var e=Error("Cannot find module '@/lib/pptx/auto-narration-service'");throw e.code="MODULE_NOT_FOUND",e}())(),l=await s.generateNarrations(a,r,n);if(!l.success)return i.NextResponse.json({error:l.error||"Erro ao gerar narra\xe7\xe3o"},{status:500});if(o.slidesData){let e=o.slidesData;if(Array.isArray(e)){for(let r of l.narrations){let t=r.slideNumber-1;e[t]&&(e[t].voiceover={audioUrl:r.audioUrl,script:r.script,provider:r.provider,voice:r.voice,duration:r.duration})}await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).project.update({where:{id:r},data:{slidesData:e,autoNarration:!0,updatedAt:new Date}})}}else await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).project.update({where:{id:r},data:{autoNarration:!0,updatedAt:new Date}});return console.log(`âœ… Narra\xe7\xe3o gerada com sucesso: ${l.narrations.length} slides`),i.NextResponse.json({success:!0,narrations:l.narrations,totalDuration:l.totalDuration,stats:{totalSlides:a.length,narratedSlides:l.narrations.length,skippedSlides:a.length-l.narrations.length,totalDurationSeconds:Math.round(l.totalDuration/1e3),averageDurationPerSlide:Math.round(l.totalDuration/l.narrations.length/1e3)}})}catch(e){return console.error("âŒ [Auto-Narrate] Erro:",e),i.NextResponse.json({error:"Erro ao gerar narra\xe7\xe3o",details:e instanceof Error?e.message:"Erro desconhecido"},{status:500})}}async function d(e){try{let{searchParams:r}=new URL(e.url),t=r.get("projectId");if(!t)return i.NextResponse.json({error:"projectId \xe9 obrigat\xf3rio"},{status:400});let o=await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).project.findUnique({where:{id:t},select:{id:!0,name:!0,autoNarration:!0,slidesData:!0,totalSlides:!0}});if(!o)return i.NextResponse.json({error:"Projeto n\xe3o encontrado"},{status:404});let a=0,n=o.totalSlides||0;if(o.slidesData){let e=o.slidesData;Array.isArray(e)&&(n=e.length,a=e.filter(e=>!!(e?.voiceover&&e.voiceover&&e.voiceover&&e.voiceover.audioUrl)).length)}return i.NextResponse.json({projectId:o.id,projectName:o.name,autoNarration:o.autoNarration,narratedSlides:a,totalSlides:n,progress:n>0?a/n*100:0})}catch(e){return console.error("âŒ [Auto-Narrate] Erro ao buscar status:",e),i.NextResponse.json({error:"Erro ao buscar status"},{status:500})}}(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e})(),function(){var e=Error("Cannot find module '@/lib/pptx/auto-narration-service'");throw e.code="MODULE_NOT_FOUND",e}();let u=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/v1/pptx/auto-narrate/route",pathname:"/api/v1/pptx/auto-narrate",filename:"route",bundlePath:"app/api/v1/pptx/auto-narrate/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\v1\\pptx\\auto-narrate\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:p,staticGenerationAsyncStorage:c,serverHooks:m}=u,f="/api/v1/pptx/auto-narrate/route";function v(){return(0,s.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:c})}}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[8948,5972],()=>t(67946));module.exports=o})();