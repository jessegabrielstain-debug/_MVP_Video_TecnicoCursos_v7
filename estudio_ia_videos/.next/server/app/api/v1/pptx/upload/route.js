"use strict";(()=>{var e={};e.id=4074,e.ids=[4074],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},17702:e=>{e.exports=require("events")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},52558:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>P,patchFetch:()=>w,requestAsyncStorage:()=>x,routeModule:()=>g,serverHooks:()=>v,staticGenerationAsyncStorage:()=>y});var s={};r.r(s),r.d(s,{GET:()=>f,POST:()=>m,dynamic:()=>u,maxDuration:()=>l,runtime:()=>p});var a=r(49303),o=r(88716),n=r(60670),i=r(87070),c=r(86840);let l=60,u="force-dynamic",p="nodejs",d=new Map;async function m(e){let t=Date.now();try{if(console.log("\uD83D\uDCE4 Iniciando upload e processamento PPTX..."),!(e.headers.get("content-type")||"").includes("multipart/form-data"))return i.NextResponse.json({success:!1,message:"Content-Type deve ser multipart/form-data",error:"INVALID_CONTENT_TYPE"},{status:400});let r=(await e.formData()).get("file");if(!r)return i.NextResponse.json({success:!1,message:"Nenhum arquivo enviado",error:"NO_FILE"},{status:400});let s=await h(r);if(!s.isValid)return i.NextResponse.json({success:!1,message:s.error||"Arquivo inv\xe1lido",error:"INVALID_FILE"},{status:400});console.log(`ðŸ“„ Arquivo v\xe1lido: ${r.name} (${r.size} bytes)`);let a=await r.arrayBuffer(),o=Buffer.from(a),n=function(){let e=Date.now().toString(36),t=Math.random().toString(36).substring(2,15);return`pptx_${e}_${t}`}();console.log(`âš™ï¸ Iniciando processamento com ID: ${n}`);let l=await c.QP.extract(o);d.set(n,l),function(){if(d.size>10){let e=Array.from(d.keys()),t=e.slice(0,e.length-10);t.forEach(e=>{d.delete(e)}),console.log(`ðŸ§¹ Cache limpo: removidos ${t.length} resultados antigos`)}}();let u=Date.now()-t;console.log(`âœ… Processamento conclu\xeddo em ${u}ms`);let p={success:l.success,message:l.success?`Arquivo processado com sucesso! ${l.slides.length} slides encontrados.`:`Erro no processamento: ${l.error}`,data:{processingId:n,fileName:r.name,fileSize:r.size,result:l.success?l:void 0}};if(!l.success)return i.NextResponse.json(p,{status:422});return i.NextResponse.json(p,{status:200})}catch(e){return console.error("âŒ Erro no upload/processamento:",e),i.NextResponse.json({success:!1,message:"Erro interno do servidor",error:e instanceof Error?e.message:"Erro desconhecido"},{status:500})}}async function f(e){try{let{searchParams:t}=new URL(e.url),r=t.get("id");if(!r)return i.NextResponse.json({success:!1,message:"ID de processamento \xe9 obrigat\xf3rio",error:"MISSING_ID"},{status:400});let s=d.get(r);if(!s)return i.NextResponse.json({success:!1,message:"Resultado n\xe3o encontrado ou expirado",error:"NOT_FOUND"},{status:404});return i.NextResponse.json({success:!0,message:"Resultado encontrado",data:{processingId:r,result:s}},{status:200})}catch(e){return console.error("âŒ Erro ao consultar resultado:",e),i.NextResponse.json({success:!1,message:"Erro interno do servidor",error:e instanceof Error?e.message:"Erro desconhecido"},{status:500})}}async function h(e){try{if(!e.name.toLowerCase().endsWith(".pptx"))return{isValid:!1,error:"Arquivo deve ter extens\xe3o .pptx"};if(e.size>52428800)return{isValid:!1,error:`Arquivo muito grande. M\xe1ximo permitido: 50MB`};if(e.size<1024)return{isValid:!1,error:"Arquivo muito pequeno ou corrompido"};let t=await e.arrayBuffer(),r=Buffer.from(t).subarray(0,4);if(!(80===r[0]&&75===r[1]&&3===r[2]&&4===r[3]))return{isValid:!1,error:"Arquivo n\xe3o \xe9 um PPTX v\xe1lido (cabe\xe7alho inv\xe1lido)"};return{isValid:!0}}catch(e){return{isValid:!1,error:`Erro na valida\xe7\xe3o: ${e instanceof Error?e.message:"Erro desconhecido"}`}}}let g=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/v1/pptx/upload/route",pathname:"/api/v1/pptx/upload",filename:"route",bundlePath:"app/api/v1/pptx/upload/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\v1\\pptx\\upload\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:x,staticGenerationAsyncStorage:y,serverHooks:v}=g,P="/api/v1/pptx/upload/route";function w(){return(0,n.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:y})}},39953:(e,t,r)=>{r.d(t,{h$:()=>s,o9:()=>o});class s{async parse(e){return console.log("[PPTX Parser] Parsing presentation"),{slides:[],metadata:{slideCount:0},images:[]}}async extractImages(e){return[]}}let a=new s;async function o(e){return a.parse(e)}},86840:(e,t,r)=>{r.d(t,{QP:()=>c,ZP:()=>l});var s=r(89190),a=r.n(s),o=r(4096);class n{constructor(e){this.jobId=e,this.parser=new o.Z({ignoreAttributes:!1,attributeNamePrefix:"@_"})}async parseStructure(e){console.log(`[PPTX Core ${this.jobId||""}] Parsing structure`);let t=await a().loadAsync(e),r={slides:[],layouts:[],masters:[]},s=Object.keys(t.files).filter(e=>e.match(/^ppt\/slides\/slide\d+\.xml$/));for(let e of(s.sort((e,t)=>parseInt(e.match(/slide(\d+)\.xml/)[1])-parseInt(t.match(/slide(\d+)\.xml/)[1])),s)){let s=await t.file(e)?.async("string");if(!s)continue;let a=this.parser.parse(s),o=this.extractText(a);r.slides.push({id:e,content:o})}return r}async parseFile(e,t,r){r?.(.1);let s=await this.parseStructure(e);return r?.(.9),{id:`doc_${Date.now()}`,title:t.replace(".pptx",""),author:"Unknown",slides:s.slides.map((e,t)=>({slideNumber:t+1,title:`Slide ${t+1}`,content:e.content.map(e=>({type:"text",content:e}))})),metadata:{createdAt:new Date().toISOString()}}}extractText(e){let t=[];return function e(r){if(Array.isArray(r)){r.forEach(e);return}if("object"==typeof r&&null!==r){if(r["a:t"]){let e=r["a:t"],s="";"string"==typeof e?s=e:"object"==typeof e&&null!==e&&"#text"in e&&(s=e["#text"]),s&&"string"==typeof s&&s.trim().length>0&&t.push(s.trim())}for(let t in r)e(r[t])}}(e),t}async extractRels(e){return{}}}new n;var i=r(39953);class c{async process(e){return console.log("[PPTX Processor] Processing presentation"),await this.coreParser.parseStructure(e),(await this.advancedParser.parse(e)).slides.map(e=>({index:e.index,title:e.title,content:Array.isArray(e.content)?e.content.join("\n"):String(e.content||""),images:[],notes:e.notes}))}async extractText(e){return(await this.process(e)).map(e=>e.content).join("\n\n")}static async extract(e){try{let t=await a().loadAsync(e),r=new o.Z({ignoreAttributes:!1,attributeNamePrefix:"@_"}),s={title:"Sem t\xedtulo",author:"Desconhecido",totalSlides:0,application:"Unknown",dimensions:{width:0,height:0}},n=t.file("docProps/core.xml");if(n){let e=await n.async("string"),t=r.parse(e)["cp:coreProperties"];t&&(s.title=t["dc:title"]||s.title,s.author=t["dc:creator"]||s.author)}let i=t.file("docProps/app.xml");if(i){let e=await i.async("string"),t=r.parse(e).Properties;t&&(s.application=t.Application||s.application,s.totalSlides=parseInt(t.Slides||"0"))}s.dimensions={width:1920,height:1080};let c=[],l=Object.keys(t.files).filter(e=>e.match(/ppt\/slides\/slide\d+\.xml/));l.sort((e,t)=>{let r=parseInt(e.match(/slide(\d+)\.xml/)[1]),s=parseInt(t.match(/slide(\d+)\.xml/)[1]);return r-s});for(let e=0;e<l.length;e++){let s=l[e],a=await t.file(s).async("string"),o=r.parse(a),n=e+1,i="",u="",p="",d=[],m=o["p:sld"]?.["p:cSld"]?.["p:spTree"],f=m?.["p:sp"];f&&(Array.isArray(f)?f:[f]).forEach(e=>{let t=e["p:txBody"];t&&(Array.isArray(t["a:p"])?t["a:p"]:[t["a:p"]]).forEach(e=>{e&&e["a:r"]&&(Array.isArray(e["a:r"])?e["a:r"]:[e["a:r"]]).forEach(e=>{e&&e["a:t"]&&d.push(e["a:t"])})})}),d.length>0&&(i=d[0],u=d.join(" "));let h=t.file(`ppt/notesSlides/notesSlide${n}.xml`);if(h){let e=await h.async("string"),t=r.parse(e),s=t["p:notes"]?.["p:cSld"]?.["p:spTree"],a=s?.["p:sp"];a&&(Array.isArray(a)?a:[a]).forEach(e=>{let t=e["p:txBody"];t&&(Array.isArray(t["a:p"])?t["a:p"]:[t["a:p"]]).forEach(e=>{e&&e["a:r"]&&(Array.isArray(e["a:r"])?e["a:r"]:[e["a:r"]]).forEach(e=>{e&&e["a:t"]&&(p+=e["a:t"]+" ")})})})}c.push({slideNumber:n,title:i,content:u,notes:p.trim(),layout:"default",images:[],animations:[],duration:5,shapes:1,textBlocks:d.length})}let u={images:[],videos:[],audio:[]};Object.keys(t.files).filter(e=>e.startsWith("ppt/media/")).forEach(e=>{(e.endsWith(".png")||e.endsWith(".jpg"))&&u.images.push(e)});let p={totalDuration:5*c.length,scenes:c.map((e,t)=>({sceneId:`scene_${t+1}`,slideNumber:e.slideNumber,startTime:5*t,endTime:(t+1)*5,transitions:[]}))},d={textBlocks:10,images:u.images.length,shapes:5,charts:0,tables:0};return{success:!0,slides:c,metadata:s,assets:u,timeline:p,extractionStats:d}}catch(e){return{success:!1,error:e,slides:[]}}}static async generateThumbnail(e,t){try{if(e.toString().includes("invalid"))return null;return"thumbnails/mock.png"}catch(e){return null}}constructor(){this.coreParser=new n,this.advancedParser=new i.h$}}new c;let l=c}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972,9190,4096],()=>r(52558));module.exports=s})();