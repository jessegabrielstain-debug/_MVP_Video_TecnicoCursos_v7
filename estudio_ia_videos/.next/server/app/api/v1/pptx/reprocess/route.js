"use strict";(()=>{var e={};e.id=5736,e.ids=[5736],e.modules={21841:e=>{e.exports=require("@aws-sdk/client-s3")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},55315:e=>{e.exports=require("path")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},89528:(e,r,s)=>{s.r(r),s.d(r,{originalPathname:()=>S,patchFetch:()=>E,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>f});var t={};s.r(t),s.d(t,{POST:()=>p});var o=s(49303),a=s(88716),n=s(60670),i=s(87070),c=s(24507);async function p(e){console.log("\uD83D\uDD04 Iniciando reprocessamento PPTX...");try{let{s3Key:r,options:s}=await e.json();if(!r)return i.NextResponse.json({success:!1,error:"S3 key \xe9 obrigat\xf3ria"},{status:400});if(!await c.f.fileExists(r))return i.NextResponse.json({success:!1,error:"Arquivo n\xe3o encontrado no S3"},{status:404});console.log(`ðŸ”§ Reprocessando: ${r}`);let t=await c.f.downloadFile(r);if(!t.success)return i.NextResponse.json({success:!1,error:"Erro ao baixar arquivo para reprocessamento"},{status:500});let o=await u(r,t.buffer,s);return console.log("âœ… Reprocessamento conclu\xeddo"),i.NextResponse.json({success:!0,data:o,reprocessedAt:new Date().toISOString()})}catch(e){return console.error("âŒ Erro no reprocessamento:",e),i.NextResponse.json({success:!1,error:e instanceof Error?e.message:"Erro interno"},{status:500})}}async function u(e,r,s={}){let t={extractTextDeep:s?.extractTextDeep||!0,generateThumbnails:s?.generateThumbnails||!0,analyzeImages:s?.analyzeImages||!0,detectAnimations:s?.detectAnimations||!0,...s};return console.log("\uD83C\uDFAF Op\xe7\xf5es de reprocessamento:",t),{enhanced:!0,options:t,improvements:["Extra\xe7\xe3o de texto melhorada","An\xe1lise de imagens mais precisa","Detec\xe7\xe3o de anima\xe7\xf5es avan\xe7ada","Gera\xe7\xe3o de thumbnails de alta qualidade"]}}let l=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/v1/pptx/reprocess/route",pathname:"/api/v1/pptx/reprocess",filename:"route",bundlePath:"app/api/v1/pptx/reprocess/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\v1\\pptx\\reprocess\\route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:d,staticGenerationAsyncStorage:f,serverHooks:m}=l,S="/api/v1/pptx/reprocess/route";function E(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:f})}},24507:(e,r,s)=>{s.d(r,{f:()=>p});var t=s(92048),o=s(55315),a=s.n(o),n=s(21841),i=s(61657);function c(){return(process.env.STORAGE_PROVIDER||"local").toLowerCase()}class p{static async deleteFile(e){if("local"===c()){let r=a().join(process.cwd(),"public","uploads",e);await t.promises.rm(r,{force:!0});return}}static async downloadFile(e){try{let r=c();if("local"===r){let r=a().join(process.cwd(),"public","uploads",e),s=await t.promises.readFile(r);return{success:!0,buffer:s}}if("supabase"===r){let r=process.env.SUPABASE_URL||"https://ofhzrdiadxigrvmrhaiz.supabase.co",s=process.env.SUPABASE_SERVICE_ROLE_KEY||"",t=process.env.SUPABASE_STORAGE_BUCKET||"public",o=(0,i.eI)(r,s),{data:a,error:n}=await o.storage.from(t).download(e);if(n||!a)return{success:!1,error:n?.message||"Download failed"};let c=await a.arrayBuffer();return{success:!0,buffer:Buffer.from(c)}}let s=process.env.AWS_REGION||"us-east-1",o=process.env.AWS_S3_BUCKET||"";if(!o)return{success:!1,error:"AWS_S3_BUCKET not configured"};let p=new n.S3Client({region:s}),u=(await p.send(new n.GetObjectCommand({Bucket:o,Key:e}))).Body,l=[];for await(let e of u)l.push(Buffer.isBuffer(e)?e:Buffer.from(e));return{success:!0,buffer:Buffer.concat(l)}}catch(e){return{success:!1,error:String(e)}}}static async fileExists(e){if("local"===c()){let r=a().join(process.cwd(),"public","uploads",e);try{await t.promises.access(r)}catch{return!1}}return!0}static async uploadFile(e,r,s){let o=c();if("local"===o){let s=a().join(process.cwd(),"public","uploads",e);return await t.promises.mkdir(a().dirname(s),{recursive:!0}),await t.promises.writeFile(s,r),`/uploads/${e}`.replace(/\\/g,"/")}if("supabase"===o){let t=process.env.SUPABASE_URL||"https://ofhzrdiadxigrvmrhaiz.supabase.co",o=process.env.SUPABASE_SERVICE_ROLE_KEY||"",a=process.env.SUPABASE_STORAGE_BUCKET||"public",n=(0,i.eI)(t,o),{error:c}=await n.storage.from(a).upload(e,r,{contentType:s,upsert:!0});if(c)throw c;let{data:p}=n.storage.from(a).getPublicUrl(e);return p.publicUrl}let p=process.env.AWS_REGION||"us-east-1",u=process.env.AWS_S3_BUCKET||"",l=new n.S3Client({region:p});return await l.send(new n.PutObjectCommand({Bucket:u,Key:e,Body:r,ContentType:s||"application/octet-stream"})),`https://${u}.s3.${p}.amazonaws.com/${e}`}static async getSignedUrl(e,r=3600){let s=c();if("local"===s)return`/uploads/${e}`.replace(/\\/g,"/");if("supabase"===s){let s=process.env.SUPABASE_URL||"https://ofhzrdiadxigrvmrhaiz.supabase.co",t=process.env.SUPABASE_SERVICE_ROLE_KEY||"",o=process.env.SUPABASE_STORAGE_BUCKET||"public",a=(0,i.eI)(s,t),{data:n,error:c}=await a.storage.from(o).createSignedUrl(e,r);if(c||!n)throw c||Error("Failed to sign URL");return n.signedUrl}let t=process.env.AWS_REGION||"us-east-1",o=process.env.AWS_S3_BUCKET||"";return`https://${o}.s3.${t}.amazonaws.com/${e}`}}}};var r=require("../../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[8948,5972,1657],()=>s(89528));module.exports=t})();