"use strict";(()=>{var e={};e.id=863,e.ids=[863],e.modules={220399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},430517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},916154:(e,t,o)=>{o.r(t),o.d(t,{originalPathname:()=>f,patchFetch:()=>m,requestAsyncStorage:()=>u,routeModule:()=>l,serverHooks:()=>p,staticGenerationAsyncStorage:()=>c});var r={};o.r(r),o.d(r,{POST:()=>d});var i=o(349303),a=o(88716),n=o(60670),s=o(387070);async function d(e){try{let t=await e.json();if(console.log("\uD83C\uDFAC Starting professional video export:",{project:t.project?.name,slides:t.upload?.slides,duration:t.timeline?.totalDuration||t.upload?.duration}),!t.upload||!t.project)return s.NextResponse.json({success:!1,error:"Dados insuficientes para export"},{status:400});try{await Object(function(){var e=Error("Cannot find module '../../../../lib/ffmpeg-service'");throw e.code="MODULE_NOT_FOUND",e}()).initialize()}catch(e){return console.error("FFmpeg initialization failed:",e),s.NextResponse.json({success:!1,error:"Falha ao inicializar o engine de renderiza\xe7\xe3o"},{status:500})}let o={width:1920,height:1080,fps:30,quality:"high",format:"mp4",codec:"h264",audioCodec:"aac",...t.renderSettings},r={id:t.project.name,name:t.project.name,frames:[],totalDuration:t.timeline?.totalDuration||t.upload?.duration||30,audioTrack:t.tts?.audioBase64?{url:`data:audio/mp3;base64,${t.tts.audioBase64}`,offset:0,volume:1}:void 0};Object(function(){var e=Error("Cannot find module '../../../../lib/canvas-to-video'");throw e.code="MODULE_NOT_FOUND",e}())(o);try{let e=[],i=Math.ceil(r.totalDuration*o.fps);for(let t=0;t<Math.min(i,90);t++){let r=document.createElement("canvas");r.width=o.width,r.height=o.height;let i=r.getContext("2d"),a=i.createLinearGradient(0,0,o.width,o.height);a.addColorStop(0,"#667eea"),a.addColorStop(1,"#764ba2"),i.fillStyle=a,i.fillRect(0,0,o.width,o.height),i.fillStyle="white",i.font="48px Arial",i.textAlign="center",i.fillText(`Frame ${t+1}`,o.width/2,o.height/2);let n=await new Promise(e=>{r.toBlob(t=>e(t),"image/png")});e.push(n)}let a=null;if(t.tts?.audioBase64){let e=atob(t.tts.audioBase64),o=new Uint8Array(e.length);for(let t=0;t<e.length;t++)o[t]=e.charCodeAt(t);a=new Blob([o],{type:"audio/mp3"})}let n=await Object(function(){var e=Error("Cannot find module '../../../../lib/ffmpeg-service'");throw e.code="MODULE_NOT_FOUND",e}()).renderVideo(e,a,o,3),d=new Blob([n],{type:`video/${o.format}`}),l=URL.createObjectURL(d),u={format:o.format,resolution:`${o.width}x${o.height}`,framerate:o.fps,duration:r.totalDuration,bitrate:o.bitrate||"5000kbps",codec:o.codec.toUpperCase(),audioCodec:o.audioCodec.toUpperCase(),fileSize:Math.round(d.size/1048576*100)/100};return console.log("✅ Professional video export completed:",{videoUrl:l,metadata:u,size:`${u.fileSize}MB`}),s.NextResponse.json({success:!0,videoUrl:l,downloadUrl:l,metadata:u,stats:{processingTime:3e3,slides:t.upload.slides,duration:u.duration,fileSize:`${u.fileSize}MB`,exportedAt:new Date().toISOString(),engine:"FFmpeg Professional",quality:o.quality},project:{name:t.project.name,status:"completed"}})}catch(e){return console.error("❌ FFmpeg render error:",e),console.error("❌ Video rendering failed completely"),s.NextResponse.json({success:!1,error:"Video rendering failed"},{status:500})}}catch(e){return console.error("❌ Professional video export error:",e),s.NextResponse.json({success:!1,error:e.message||"Erro na renderiza\xe7\xe3o profissional de v\xeddeo"},{status:500})}}(function(){var e=Error("Cannot find module '../../../../lib/ffmpeg-service'");throw e.code="MODULE_NOT_FOUND",e})(),function(){var e=Error("Cannot find module '../../../../lib/canvas-to-video'");throw e.code="MODULE_NOT_FOUND",e}();let l=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/v1/export/video/route",pathname:"/api/v1/export/video",filename:"route",bundlePath:"app/api/v1/export/video/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\v1\\export\\video\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:u,staticGenerationAsyncStorage:c,serverHooks:p}=l,f="/api/v1/export/video/route";function m(){return(0,n.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:c})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),r=t.X(0,[8948,5972],()=>o(916154));module.exports=r})();