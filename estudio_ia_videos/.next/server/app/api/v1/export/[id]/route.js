"use strict";(()=>{var e={};e.id=7758,e.ids=[7758],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},69970:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>j,patchFetch:()=>E,requestAsyncStorage:()=>b,routeModule:()=>f,serverHooks:()=>A,staticGenerationAsyncStorage:()=>x});var r,o,n,i,a,l={};s.r(l),s.d(l,{DELETE:()=>h,GET:()=>m});var u=s(49303),c=s(88716),d=s(60670),p=s(87070);(function(e){e.PENDING="pending",e.PROCESSING="processing",e.COMPLETED="completed",e.FAILED="failed",e.CANCELLED="cancelled"})(r||(r={})),function(e){e.MP4="mp4",e.WEBM="webm",e.MOV="mov"}(o||(o={})),function(e){e.HD_720="720p",e.FULL_HD_1080="1080p",e.UHD_4K="4k"}(n||(n={})),function(e){e.LOW="low",e.MEDIUM="medium",e.HIGH="high",e.ULTRA="ultra"}(i||(i={})),function(e){e.INITIALIZING="initializing",e.PROCESSING_VIDEO="processing_video",e.PROCESSING_AUDIO="processing_audio",e.MERGING="merging",e.ENCODING="encoding",e.FINALIZING="finalizing"}(a||(a={}));var g=s(88526);async function m(e,{params:t}){try{let e=t.id;if(!e)return p.NextResponse.json({error:"Job ID is required"},{status:400});let s=(0,g.wF)(),r=await s.getJob(e);if(!r)return p.NextResponse.json({error:"Job not found"},{status:404});let o=0;if(r.startedAt){let e=r.completedAt||new Date;o=Math.floor((e.getTime()-r.startedAt.getTime())/1e3)}return p.NextResponse.json({success:!0,job:{id:r.id,status:r.status,progress:r.progress,settings:r.settings,outputUrl:r.outputUrl,fileSize:r.fileSize,duration:r.duration,error:r.error,createdAt:r.createdAt,startedAt:r.startedAt,completedAt:r.completedAt,elapsedTime:o,estimatedTimeRemaining:r.estimatedTimeRemaining}})}catch(e){return console.error("[Export API] Error fetching job:",e),p.NextResponse.json({error:"Failed to fetch job status",details:String(e)},{status:500})}}async function h(e,{params:t}){try{let e=t.id;if(!e)return p.NextResponse.json({error:"Job ID is required"},{status:400});let s=(0,g.wF)();if(!await s.cancelJob(e))return p.NextResponse.json({error:"Job cannot be cancelled (not found or already completed)"},{status:400});return console.log(`[Export API] Cancelled job ${e}`),p.NextResponse.json({success:!0,message:"Job cancelled successfully"})}catch(e){return console.error("[Export API] Error cancelling job:",e),p.NextResponse.json({error:"Failed to cancel job",details:String(e)},{status:500})}}let f=new u.AppRouteRouteModule({definition:{kind:c.x.APP_ROUTE,page:"/api/v1/export/[id]/route",pathname:"/api/v1/export/[id]",filename:"route",bundlePath:"app/api/v1/export/[id]/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\v1\\export\\[id]\\route.ts",nextConfigOutput:"",userland:l}),{requestAsyncStorage:b,staticGenerationAsyncStorage:x,serverHooks:A}=f,j="/api/v1/export/[id]/route";function E(){return(0,d.patchFetch)({serverHooks:A,staticGenerationAsyncStorage:x})}},88526:(e,t,s)=>{s.d(t,{wF:()=>n});class r{async addJob(e,t){let s=crypto.randomUUID();return console.log("[ExportQueue] Adding job:",s),this.jobs.set(s,{id:s,videoId:e,format:t,status:"pending",progress:0,createdAt:new Date}),s}async getJob(e){return this.jobs.get(e)||null}async updateProgress(e,t,s){let r=this.jobs.get(e);if(r){r.progress=t,s&&(r.status=s);let o=Array.from(this.jobs.values()).filter(e=>"processing"===e.status).length;this.maxConcurrent=Math.max(this.maxConcurrent,o),console.log("[ExportQueue] Updated job:",e,t)}}async completeJob(e,t){let s=this.jobs.get(e);s&&(s.status="completed",s.progress=100,s.outputPath=t,s.completedAt=new Date)}async failJob(e,t){let s=this.jobs.get(e);s&&(s.status="failed",s.error=t,s.completedAt=new Date)}async getQueueStatus(){let e=Array.from(this.jobs.values());return{total:e.length,pending:e.filter(e=>"pending"===e.status).length,processing:e.filter(e=>"processing"===e.status).length,completed:e.filter(e=>"completed"===e.status).length,failed:e.filter(e=>"failed"===e.status).length}}async cancelJob(e){let t=this.jobs.get(e);return!!t&&("pending"===t.status||"processing"===t.status)&&(t.status="cancelled",t.completedAt=new Date,!0)}getStatistics(){let e=Array.from(this.jobs.values()),t=e.filter(e=>"completed"===e.status&&e.completedAt),s=t.length?t.reduce((e,t)=>e+(t.completedAt.getTime()-t.createdAt.getTime()||0),0)/t.length:0;return{totalJobs:e.length,queueSize:e.filter(e=>"pending"===e.status).length,processing:e.filter(e=>"processing"===e.status).length,averageDuration:s,maxConcurrent:this.maxConcurrent||Math.max(1,e.filter(e=>"processing"===e.status).length)}}constructor(){this.jobs=new Map,this.maxConcurrent=0}}let o=new r,n=()=>o}};var t=require("../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[8948,5972],()=>s(69970));module.exports=r})();