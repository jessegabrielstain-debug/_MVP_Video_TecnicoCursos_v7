"use strict";(()=>{var e={};e.id=2628,e.ids=[2628,3936],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},86624:e=>{e.exports=require("querystring")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},29438:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>A,patchFetch:()=>E,requestAsyncStorage:()=>f,routeModule:()=>v,serverHooks:()=>I,staticGenerationAsyncStorage:()=>x});var s={};t.r(s),t.d(s,{GET:()=>h,POST:()=>m});var i=t(49303),a=t(88716),o=t(60670),n=t(87070),u=t(75571),d=t(95306),l=t(86047),c=t(13936);async function p(e){let r=c.p,{data:t}=await r.from("user_roles").select("role").eq("user_id",e),s=(t||[]).map(e=>e.role);return{id:e,roles:s.length?s:["viewer"]}}async function h(e){let r=await (0,u.getServerSession)(d.L);if(!r?.user?.id)return n.NextResponse.json({error:"Unauthorized"},{status:401});let t=await p(r.user.id);(0,l.tA)(t,"users.read");let s=c.p,{data:i,error:a}=await s.from("users").select("id");if(a)return n.NextResponse.json({error:"Falha ao buscar usu\xe1rios"},{status:500});let o=await s.from("user_roles").select("user_id, role"),h=new Map;(o.data||[]).forEach(e=>{let r=h.get(e.user_id)||[];r.push(e.role),h.set(e.user_id,r)});let m=(i||[]).map(e=>({id:e.id,roles:h.get(e.id)||["viewer"]}));return n.NextResponse.json({users:m})}async function m(e){let r=await (0,u.getServerSession)(d.L);if(!r?.user?.id)return n.NextResponse.json({error:"Unauthorized"},{status:401});let t=await p(r.user.id);(0,l.tA)(t,"users.write");let{userId:s,role:i}=await e.json().catch(()=>({}))||{};if(!s||!i)return n.NextResponse.json({error:"userId e role obrigat\xf3rios"},{status:400});let a=await p(s),o=await (0,l.mE)(a,i,t.id);return n.NextResponse.json({updated:o})}let v=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/admin/users/route",pathname:"/api/admin/users",filename:"route",bundlePath:"app/api/admin/users/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\admin\\users\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:x,serverHooks:I}=v,A="/api/admin/users/route";function E(){return(0,o.patchFetch)({serverHooks:I,staticGenerationAsyncStorage:x})}},95306:(e,r,t)=>{t.d(r,{L:()=>s});let s={providers:[],session:{strategy:"jwt"},callbacks:{}}},86047:(e,r,t)=>{t.d(r,{tA:()=>d,mE:()=>l,BT:()=>u});let s={enableAdvancedAnalytics:!1,enableVideoPreview:!1,enableBetaEditor:!1};function i(e,r=process.env){let t=r[e];if(t){if(["1","true","on","yes"].includes(t.toLowerCase()))return!0;if(["0","false","off","no"].includes(t.toLowerCase()))return!1}}let a=function(e=process.env){return{enableAdvancedAnalytics:i("FLAG_ENABLE_ADVANCED_ANALYTICS",e)??s.enableAdvancedAnalytics,enableVideoPreview:i("FLAG_ENABLE_VIDEO_PREVIEW",e)??s.enableVideoPreview,enableBetaEditor:i("FLAG_ENABLE_BETA_EDITOR",e)??s.enableBetaEditor}}();var o=t(13936);let n={admin:["users.read","users.write","roles.read","roles.write","videos.read","videos.render","admin.dashboard"],editor:["users.read","videos.read","videos.render"],viewer:["users.read","videos.read"]};function u(e,r){if(a.enableAdvancedAnalytics&&"admin.dashboard"===r){var t;if(t="editor",e.roles.includes(t))return!0}return(function(e){let r=new Set;for(let t of e.roles)for(let e of n[t]||[])r.add(e);return r})(e).has(r)}function d(e,r){if(!u(e,r)){let e=Error(`Permiss\xe3o negada: ${r}`);throw e.code="RBAC_DENIED",e}}async function l(e,r,t){let s=e.roles.includes(r)?e:{...e,roles:[...e.roles,r]};try{let s=o.p;await s.from("analytics_events").insert({user_id:t,event_type:"rbac_role_assigned",event_data:{targetUserId:e.id,role:r,previousRoles:e.roles}})}catch(e){console.error("[RBAC] Falha ao auditar assignRole:",e.message)}return s}},13936:(e,r,t)=>{t.d(r,{e:()=>o,getSupabaseForRequest:()=>u,p:()=>n});var s=t(67721),i=t(61657),a=t(71615);let o=()=>{let e=(0,a.cookies)();return(0,s.createServerClient)("https://ofhzrdiadxigrvmrhaiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ",{cookies:{get:r=>e.get(r)?.value,set(r,t,s){try{e.set({name:r,value:t,...s})}catch(e){}},remove(r,t){try{e.set({name:r,value:"",...t})}catch(e){}}}})},n=(0,i.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}});function u(e){let r=e.headers.get("authorization")||e.headers.get("Authorization");return r?(0,i.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ",{global:{headers:{Authorization:r}},auth:{persistSession:!1,autoRefreshToken:!1}}):o()}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[8948,5972,1657,9702,5571],()=>t(29438));module.exports=s})();