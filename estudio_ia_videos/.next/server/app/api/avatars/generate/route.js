"use strict";(()=>{var e={};e.id=504,e.ids=[504],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},94096:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>R,patchFetch:()=>q,requestAsyncStorage:()=>w,routeModule:()=>h,serverHooks:()=>A,staticGenerationAsyncStorage:()=>y});var a={};t.r(a),t.d(a,{GET:()=>f,POST:()=>x,PUT:()=>j});var o=t(49303),s=t(88716),n=t(60670),i=t(87070),u=t(75571),p=t(95306),d=t(8261),l=t(60519),c=t(91585);let v=c.Ry({projectId:c.Z_(),avatarConfig:c.Ry({model:c.Km(["default","professional","casual","custom"]),gender:c.Km(["male","female"]).optional(),style:c.Km(["realistic","cartoon","professional"]).optional(),clothing:c.Z_().optional(),background:c.Z_().optional()}),script:c.Z_().min(1),voice:c.Ry({provider:c.Km(["elevenlabs","azure","google"]).optional(),voiceId:c.Z_(),language:c.Z_().default("pt-BR"),speed:c.Rx().min(.5).max(2).default(1),pitch:c.Rx().min(-20).max(20).default(0)}).optional()});class m{async generateAvatar(e,r,t,a){try{let o={id:`avatar_${e}_${Date.now()}`,model:r.model,config:r,script:t,voice:a,status:"generating",createdAt:new Date().toISOString()};return await this.simulateAvatarGeneration(o),await d._.project.update({where:{id:e},data:{metadata:{avatar:{...o,status:"completed",generatedAt:new Date().toISOString(),videoUrl:`/api/avatars/video/${o.id}`,thumbnailUrl:`/api/avatars/thumbnail/${o.id}`}}}}),{...o,status:"completed",videoUrl:`/api/avatars/video/${o.id}`,thumbnailUrl:`/api/avatars/thumbnail/${o.id}`}}catch(e){throw console.error("Error generating avatar:",e),Error("Failed to generate avatar")}}async simulateAvatarGeneration(e){await new Promise(e=>setTimeout(e,2e3)),console.log("Avatar generation completed:",e.id)}async generateLipSync(e,r){try{return{audioUrl:e,avatarModel:r,visemes:[{time:0,viseme:"sil"},{time:.1,viseme:"PP"},{time:.2,viseme:"FF"}],duration:5e3}}catch(e){throw console.error("Error generating lip sync:",e),Error("Failed to generate lip sync")}}async renderAvatarVideo(e,r,t){try{let e=`video_${Date.now()}`;return`/api/avatars/video/${e}.mp4`}catch(e){throw console.error("Error rendering avatar video:",e),Error("Failed to render avatar video")}}async getAvatarModels(){return[{id:"default",name:"Avatar Padr\xe3o",description:"Avatar profissional padr\xe3o",thumbnail:"/avatars/thumbnails/default.jpg",category:"professional"},{id:"professional",name:"Executivo",description:"Avatar executivo em traje formal",thumbnail:"/avatars/thumbnails/professional.jpg",category:"professional"},{id:"casual",name:"Casual",description:"Avatar em roupas casuais",thumbnail:"/avatars/thumbnails/casual.jpg",category:"casual"}]}}let g=new m;async function x(e){try{let r=await (0,u.getServerSession)(p.L);if(!r?.user?.id)return i.NextResponse.json({error:"Unauthorized"},{status:401});let t=await e.json(),a=v.parse(t);if(!await d._.project.findFirst({where:{id:a.projectId,userId:r.user.id}}))return i.NextResponse.json({error:"Project not found"},{status:404});await l.B.updateWorkflowStep(a.projectId,"avatar","processing");let o=await g.generateAvatar(a.projectId,a.avatarConfig,a.script,a.voice);return await l.B.updateWorkflowStep(a.projectId,"avatar","completed",o),i.NextResponse.json({success:!0,avatar:o,message:"Avatar generated successfully"})}catch(t){console.error("Avatar 3D API Error:",t);let r=await e.json().catch(()=>({}));return r.projectId&&await l.B.updateWorkflowStep(r.projectId,"avatar","error",{error:t instanceof Error?t.message:"Unknown error"}),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function f(e){try{let r=await (0,u.getServerSession)(p.L);if(!r?.user?.id)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:t}=new URL(e.url),a=t.get("action"),o=t.get("projectId");if("models"===a){let e=await g.getAvatarModels();return i.NextResponse.json({models:e})}if("status"===a&&o){let e=await d._.project.findFirst({where:{id:o,userId:r.user.id}});if(!e)return i.NextResponse.json({error:"Project not found"},{status:404});return i.NextResponse.json({avatar:e.metadata?.avatar||null})}return i.NextResponse.json({error:"Invalid action"},{status:400})}catch(e){return console.error("Avatar 3D GET Error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function j(e){try{let r=await (0,u.getServerSession)(p.L);if(!r?.user?.id)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{projectId:t,updates:a}=await e.json();if(!t||!a)return i.NextResponse.json({error:"Project ID and updates required"},{status:400});let o=await d._.project.findFirst({where:{id:t,userId:r.user.id}});if(!o)return i.NextResponse.json({error:"Project not found"},{status:404});return await d._.project.update({where:{id:t},data:{metadata:{...o.metadata,avatar:{...o.metadata?.avatar,...a,updatedAt:new Date().toISOString()}}}}),i.NextResponse.json({success:!0,message:"Avatar configuration updated"})}catch(e){return console.error("Avatar 3D PUT Error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}let h=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/avatars/generate/route",pathname:"/api/avatars/generate",filename:"route",bundlePath:"app/api/avatars/generate/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\avatars\\generate\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:w,staticGenerationAsyncStorage:y,serverHooks:A}=h,R="/api/avatars/generate/route";function q(){return(0,n.patchFetch)({serverHooks:A,staticGenerationAsyncStorage:y})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[8948,5972,5571,1585,1145],()=>t(94096));module.exports=a})();