"use strict";(()=>{var e={};e.id=17,e.ids=[17,3936],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},97140:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>j,patchFetch:()=>x,requestAsyncStorage:()=>g,routeModule:()=>f,serverHooks:()=>v,staticGenerationAsyncStorage:()=>h});var a={};t.r(a),t.d(a,{GET:()=>c,POST:()=>m,PUT:()=>y});var o=t(49303),s=t(88716),i=t(60670),n=t(87070),u=t(13936),l=t(91585),d=t(26033);let p=l.Ry({project_id:l.Z_().refine(e=>/^[0-9a-fA-F-]{36}$/.test(e),"ID do projeto inv\xe1lido"),name:l.Z_().min(1,"Nome \xe9 obrigat\xf3rio").max(100,"Nome muito longo"),ready_player_me_url:l.Z_().url("URL do Ready Player Me inv\xe1lida"),avatar_type:l.Km(["full_body","half_body","head_only"]).default("half_body"),gender:l.Km(["male","female","other"]).optional(),style:l.Km(["realistic","cartoon","anime"]).default("realistic"),animations:l.IX(l.Ry({name:l.Z_(),type:l.Km(["idle","talking","gesture","emotion","custom"]),duration:l.Rx().positive(),loop:l.O7().default(!1),file_url:l.Z_().url().optional()})).default([]),voice_settings:l.Ry({voice_id:l.Z_().optional(),language:l.Z_().default("pt-BR"),speed:l.Rx().min(.5).max(2).default(1),pitch:l.Rx().min(-20).max(20).default(0),volume:l.Rx().min(0).max(1).default(.8)}).optional(),properties:l.IM(l._4()).default({})});async function c(e){try{let r=(0,u.getSupabaseForRequest)(e),{data:{user:t},error:a}=await r.auth.getUser();if(a||!t)return n.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let{searchParams:o}=new URL(e.url),s=o.get("project_id"),i=o.get("avatar_type"),l=o.get("style"),d=parseInt(o.get("limit")||"20"),p=parseInt(o.get("offset")||"0"),c=r.from("avatars_3d").select(`
        *,
        projects:project_id (
          id,
          name,
          owner_id,
          collaborators,
          is_public
        )
      `).order("created_at",{ascending:!1}).range(p,p+d-1);s&&(c=c.eq("project_id",s)),i&&(c=c.eq("avatar_type",i)),l&&(c=c.eq("style",l));let{data:m,error:_}=await c;if(_)return console.error("Erro ao buscar avatares:",_),n.NextResponse.json({error:"Erro interno do servidor"},{status:500});let y=(m||[]).filter(e=>{let r=e.projects;return r.owner_id===t.id||Array.isArray(r.collaborators)&&r.collaborators.includes(t.id)||r.is_public});return n.NextResponse.json({avatars:y})}catch(e){return console.error("Erro na API de avatares:",e),n.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function m(e){try{let r=(0,u.getSupabaseForRequest)(e),{data:{user:t},error:a}=await r.auth.getUser();if(a||!t)return n.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let o=await e.json(),s=p.parse(o),{data:i}=await r.from("projects").select("owner_id, collaborators").eq("id",s.project_id).single();if(!i)return n.NextResponse.json({error:"Projeto n\xe3o encontrado"},{status:404});if(!(i.owner_id===t.id||i.collaborators?.includes(t.id)))return n.NextResponse.json({error:"Sem permiss\xe3o para criar avatares neste projeto"},{status:403});let{data:l}=await r.from("avatars_3d").select("id").eq("project_id",s.project_id).eq("name",s.name).single();if(l)return n.NextResponse.json({error:`J\xe1 existe um avatar com nome "${s.name}" neste projeto`},{status:409});if(!function(e){try{let r=new URL(e);return r.hostname.includes("readyplayer.me")||r.hostname.includes("models.readyplayer.me")}catch{return!1}}(s.ready_player_me_url))return n.NextResponse.json({error:"URL do Ready Player Me inv\xe1lida"},{status:400});let d=await _(s.ready_player_me_url),{data:c,error:m}=await r.from("avatars_3d").insert({...s,user_id:t.id,model_url:d.model_url,thumbnail_url:d.thumbnail_url,metadata:d.metadata}).select().single();if(m)return console.error("Erro ao criar avatar:",m),n.NextResponse.json({error:"Erro ao criar avatar"},{status:500});return await r.from("project_history").insert({project_id:s.project_id,user_id:t.id,action:"create",entity_type:"avatar_3d",entity_id:c.id,description:`Avatar 3D "${s.name}" criado`,changes:{avatar_name:s.name,avatar_type:s.avatar_type,style:s.style}}),n.NextResponse.json({avatar:c},{status:201})}catch(e){if(e instanceof d.jm)return n.NextResponse.json({error:"Dados inv\xe1lidos",details:e.errors},{status:400});return console.error("Erro ao criar avatar:",e),n.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function _(e){let r=e.split("/").pop()?.split(".")[0]||"default";return{model_url:`https://models.readyplayer.me/${r}.glb`,thumbnail_url:`https://models.readyplayer.me/${r}.png`,metadata:{id:r,created_at:new Date().toISOString(),body_type:"fullbody",outfit:"casual",hair_color:"#8B4513",skin_color:"#FDBCB4",eye_color:"#4A90E2"}}}async function y(e){try{let r=(0,u.getSupabaseForRequest)(e),{data:{user:t},error:a}=await r.auth.getUser();if(a||!t)return n.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let{project_id:o,global_settings:s}=await e.json();if(!o||!s)return n.NextResponse.json({error:"project_id e global_settings s\xe3o obrigat\xf3rios"},{status:400});let{data:i}=await r.from("projects").select("owner_id, collaborators, settings").eq("id",o).single();if(!i)return n.NextResponse.json({error:"Projeto n\xe3o encontrado"},{status:404});if(!(i.owner_id===t.id||i.collaborators?.includes(t.id)))return n.NextResponse.json({error:"Sem permiss\xe3o para atualizar configura\xe7\xf5es de avatares"},{status:403});let l={...i.settings,avatars_3d:{...i.settings?.avatars_3d,...s}},{error:d}=await r.from("projects").update({settings:l}).eq("id",o);if(d)return console.error("Erro ao atualizar configura\xe7\xf5es:",d),n.NextResponse.json({error:"Erro ao atualizar configura\xe7\xf5es"},{status:500});return await r.from("project_history").insert({project_id:o,user_id:t.id,action:"update",entity_type:"project_settings",entity_id:o,description:"Configura\xe7\xf5es globais de avatares 3D atualizadas",changes:{avatars_3d_settings:s}}),n.NextResponse.json({message:"Configura\xe7\xf5es atualizadas com sucesso",settings:l.avatars_3d})}catch(e){return console.error("Erro ao atualizar configura\xe7\xf5es de avatares:",e),n.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}p.omit({project_id:!0}).partial();let f=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/avatars/route",pathname:"/api/avatars",filename:"route",bundlePath:"app/api/avatars/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\avatars\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:g,staticGenerationAsyncStorage:h,serverHooks:v}=f,j="/api/avatars/route";function x(){return(0,i.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:h})}},13936:(e,r,t)=>{t.d(r,{e:()=>i,getSupabaseForRequest:()=>u,p:()=>n});var a=t(67721),o=t(61657),s=t(71615);let i=()=>{let e=(0,s.cookies)();return(0,a.createServerClient)("https://ofhzrdiadxigrvmrhaiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ",{cookies:{get:r=>e.get(r)?.value,set(r,t,a){try{e.set({name:r,value:t,...a})}catch(e){}},remove(r,t){try{e.set({name:r,value:"",...t})}catch(e){}}}})},n=(0,o.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}});function u(e){let r=e.headers.get("authorization")||e.headers.get("Authorization");return r?(0,o.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ",{global:{headers:{Authorization:r}},auth:{persistSession:!1,autoRefreshToken:!1}}):i()}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[8948,5972,1657,9702,1585],()=>t(97140));module.exports=a})();