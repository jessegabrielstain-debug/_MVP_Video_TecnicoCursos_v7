"use strict";(()=>{var e={};e.id=8921,e.ids=[8921,3936],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},44742:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>j,patchFetch:()=>g,requestAsyncStorage:()=>x,routeModule:()=>y,serverHooks:()=>f,staticGenerationAsyncStorage:()=>h});var a={};r.r(a),r.d(a,{DELETE:()=>_,GET:()=>c,PUT:()=>m});var o=r(49303),s=r(88716),i=r(60670),n=r(87070),l=r(13936),u=r(91585),p=r(26033);let d=u.Ry({name:u.Z_().min(1).max(100).optional(),ready_player_me_url:u.Z_().url().optional(),avatar_type:u.Km(["full_body","half_body","head_only"]).optional(),gender:u.Km(["male","female","other"]).optional(),style:u.Km(["realistic","cartoon","anime"]).optional(),animations:u.IX(u.Ry({name:u.Z_(),type:u.Km(["idle","talking","gesture","emotion","custom"]),duration:u.Rx().positive(),loop:u.O7().default(!1),file_url:u.Z_().url().optional()})).optional(),voice_settings:u.Ry({voice_id:u.Z_().optional(),language:u.Z_().optional(),speed:u.Rx().min(.5).max(2).optional(),pitch:u.Rx().min(-20).max(20).optional(),volume:u.Rx().min(0).max(1).optional()}).optional(),properties:u.IM(u._4()).optional()});async function c(e,{params:t}){try{let r=(0,l.getSupabaseForRequest)(e),{data:{user:a},error:o}=await r.auth.getUser();if(o||!a)return n.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let s=t.id,{data:i,error:u}=await r.from("avatars_3d").select(`
        *,
        projects:project_id (
          id,
          name,
          owner_id,
          collaborators,
          is_public
        )
      `).eq("id",s).single();if(u||!i)return n.NextResponse.json({error:"Avatar n\xe3o encontrado"},{status:404});let p=i.projects;if(!(p.owner_id===a.id||p.collaborators?.includes(a.id)||p.is_public))return n.NextResponse.json({error:"Sem permiss\xe3o para acessar este avatar"},{status:403});return await r.from("avatars_3d").update({last_used_at:new Date().toISOString()}).eq("id",s),n.NextResponse.json({avatar:i})}catch(e){return console.error("Erro ao buscar avatar:",e),n.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function m(e,{params:t}){try{let r=(0,l.getSupabaseForRequest)(e),{data:{user:a},error:o}=await r.auth.getUser();if(o||!a)return n.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let s=t.id,i=await e.json(),u=d.parse(i),{data:p}=await r.from("avatars_3d").select(`
        *,
        projects:project_id (
          owner_id,
          collaborators
        )
      `).eq("id",s).single();if(!p)return n.NextResponse.json({error:"Avatar n\xe3o encontrado"},{status:404});let c=p.projects;if(!(c.owner_id===a.id||c.collaborators?.includes(a.id)))return n.NextResponse.json({error:"Sem permiss\xe3o para atualizar este avatar"},{status:403});if(u.name&&u.name!==p.name){let{data:e}=await r.from("avatars_3d").select("id").eq("project_id",p.project_id).eq("name",u.name).neq("id",s).single();if(e)return n.NextResponse.json({error:`J\xe1 existe um avatar com nome "${u.name}" neste projeto`},{status:409})}let m={...u,updated_at:new Date().toISOString()};if(u.ready_player_me_url&&u.ready_player_me_url!==p.ready_player_me_url){if(!function(e){try{let t=new URL(e);return t.hostname.includes("readyplayer.me")||t.hostname.includes("models.readyplayer.me")}catch{return!1}}(u.ready_player_me_url))return n.NextResponse.json({error:"URL do Ready Player Me inv\xe1lida"},{status:400});let e=await v(u.ready_player_me_url);m.model_url=e.model_url,m.thumbnail_url=e.thumbnail_url,m.metadata=e.metadata}u.properties&&p.properties&&(m.properties={...p.properties,...u.properties}),u.voice_settings&&p.voice_settings&&(m.voice_settings={...p.voice_settings,...u.voice_settings});let{data:_,error:y}=await r.from("avatars_3d").update(m).eq("id",s).select().single();if(y)return console.error("Erro ao atualizar avatar:",y),n.NextResponse.json({error:"Erro ao atualizar avatar"},{status:500});return await r.from("project_history").insert({project_id:p.project_id,user_id:a.id,action:"update",entity_type:"avatar_3d",entity_id:s,description:`Avatar 3D "${p.name}" atualizado`,changes:u}),n.NextResponse.json({avatar:_})}catch(e){if(e instanceof p.jm)return n.NextResponse.json({error:"Dados inv\xe1lidos",details:e.errors},{status:400});return console.error("Erro ao atualizar avatar:",e),n.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function _(e,{params:t}){try{let r=(0,l.getSupabaseForRequest)(e),{data:{user:a},error:o}=await r.auth.getUser();if(o||!a)return n.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let s=t.id,{data:i}=await r.from("avatars_3d").select(`
        *,
        projects:project_id (
          owner_id,
          collaborators
        )
      `).eq("id",s).single();if(!i)return n.NextResponse.json({error:"Avatar n\xe3o encontrado"},{status:404});let u=i.projects;if(!(u.owner_id===a.id||u.collaborators?.includes(a.id)))return n.NextResponse.json({error:"Sem permiss\xe3o para excluir este avatar"},{status:403});let{data:p}=await r.from("timeline_elements").select("id").eq("type","avatar_3d").contains("properties",{avatar_id:s}).limit(1);if(p&&p.length>0)return n.NextResponse.json({error:"N\xe3o \xe9 poss\xedvel excluir avatar que est\xe1 sendo usado na timeline"},{status:400});let{error:d}=await r.from("avatars_3d").delete().eq("id",s);if(d)return console.error("Erro ao excluir avatar:",d),n.NextResponse.json({error:"Erro ao excluir avatar"},{status:500});return await r.from("project_history").insert({project_id:i.project_id,user_id:a.id,action:"delete",entity_type:"avatar_3d",entity_id:s,description:`Avatar 3D "${i.name}" exclu\xeddo`,changes:{deleted_avatar:{name:i.name,avatar_type:i.avatar_type,style:i.style}}}),n.NextResponse.json({message:"Avatar exclu\xeddo com sucesso"})}catch(e){return console.error("Erro ao excluir avatar:",e),n.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function v(e){let t=e.split("/").pop()?.split(".")[0]||"default";return{model_url:`https://models.readyplayer.me/${t}.glb`,thumbnail_url:`https://models.readyplayer.me/${t}.png`,metadata:{id:t,created_at:new Date().toISOString(),body_type:"fullbody",outfit:"casual",hair_color:"#8B4513",skin_color:"#FDBCB4",eye_color:"#4A90E2"}}}let y=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/avatars/[id]/route",pathname:"/api/avatars/[id]",filename:"route",bundlePath:"app/api/avatars/[id]/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\avatars\\[id]\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:x,staticGenerationAsyncStorage:h,serverHooks:f}=y,j="/api/avatars/[id]/route";function g(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:h})}},13936:(e,t,r)=>{r.d(t,{e:()=>i,getSupabaseForRequest:()=>l,p:()=>n});var a=r(67721),o=r(61657),s=r(71615);let i=()=>{let e=(0,s.cookies)();return(0,a.createServerClient)("https://ofhzrdiadxigrvmrhaiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ",{cookies:{get:t=>e.get(t)?.value,set(t,r,a){try{e.set({name:t,value:r,...a})}catch(e){}},remove(t,r){try{e.set({name:t,value:"",...r})}catch(e){}}}})},n=(0,o.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}});function l(e){let t=e.headers.get("authorization")||e.headers.get("Authorization");return t?(0,o.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ",{global:{headers:{Authorization:t}},auth:{persistSession:!1,autoRefreshToken:!1}}):i()}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[8948,5972,1657,9702,1585],()=>r(44742));module.exports=a})();