"use strict";(()=>{var e={};e.id=637,e.ids=[637],e.modules={220399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},430517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},477189:(e,t,o)=>{o.r(t),o.d(t,{originalPathname:()=>b,patchFetch:()=>f,requestAsyncStorage:()=>y,routeModule:()=>v,serverHooks:()=>x,staticGenerationAsyncStorage:()=>S});var r={};o.r(r),o.d(r,{GET:()=>h,POST:()=>l});var i=o(349303),a=o(88716),n=o(60670),s=o(387070);class c{static getInstance(){return this.instance||(this.instance=new c),this.instance}async synthesizeSpeech(e){return await new Promise(e=>setTimeout(e,1e3)),{success:!0,audioUrl:`/api/audio/generated/${Date.now()}.mp3`,duration:d(e.text,e.speed),provider:e.provider,quality:.85,phonemes:e.lipSyncPrecision?[]:void 0,lipSyncData:e.lipSyncPrecision?{}:void 0,cacheHit:Math.random()>.7}}}class p{static getInstance(){return this.instance||(this.instance=new p),this.instance}async createRenderJob(e,t,o){let r=`job_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,i={id:r,status:"pending",progress:0,startTime:new Date().toISOString(),endTime:null,estimatedCompletion:new Date(Date.now()+3e4).toISOString(),output:null,error:null,metrics:{},text:e,config:t,metadata:o};return this.jobs.set(r,i),setTimeout(()=>{let o=this.jobs.get(r);o&&(o.status="completed",o.progress=100,o.endTime=new Date().toISOString(),o.output={audioUrl:`/api/audio/generated/${r}.mp3`,videoUrl:`/api/video/generated/${r}.mp4`,duration:d(e,t.tts?.speed||1)})},5e3),r}getJobStatus(e){return this.jobs.get(e)||null}constructor(){this.jobs=new Map}}let u={language:"pt-BR",provider:"elevenlabs",speed:1,pitch:1,emotion:"neutral",quality:"high",enableLipSync:!0,lipSyncPrecision:"high",useUnifiedPipeline:!1};function d(e,t=1){return Math.ceil(e.split(/\s+/).length/(160*t)*6e4+300*(e.match(/[.!?;:,]/g)||[]).length)}async function l(e){let t=Date.now();try{let o;try{o=await e.json()}catch(e){return s.NextResponse.json({success:!1,error:"JSON inv\xe1lido no body da requisi\xe7\xe3o",details:"Verifique se o JSON est\xe1 bem formatado"},{status:400})}let r=function(e){let t=[];return e.text?"string"!=typeof e.text?t.push('Campo "text" deve ser uma string'):0===e.text.trim().length?t.push('Campo "text" n\xe3o pode estar vazio'):e.text.length>1e4&&t.push('Campo "text" muito longo (m\xe1ximo 10.000 caracteres)'):t.push('Campo "text" \xe9 obrigat\xf3rio'),e.voiceId&&"string"!=typeof e.voiceId&&t.push('Campo "voiceId" deve ser uma string'),e.language&&!["pt-BR","en-US","es-ES"].includes(e.language)&&t.push('Campo "language" deve ser pt-BR, en-US ou es-ES'),e.provider&&!["elevenlabs","azure","google","synthetic"].includes(e.provider)&&t.push('Campo "provider" deve ser elevenlabs, azure, google ou synthetic'),void 0!==e.speed&&("number"!=typeof e.speed||e.speed<.25||e.speed>4)&&t.push('Campo "speed" deve ser um n\xfamero entre 0.25 e 4.0'),void 0!==e.pitch&&("number"!=typeof e.pitch||e.pitch<-20||e.pitch>20)&&t.push('Campo "pitch" deve ser um n\xfamero entre -20 e 20'),e.emotion&&!["neutral","happy","sad","angry","excited"].includes(e.emotion)&&t.push('Campo "emotion" deve ser neutral, happy, sad, angry ou excited'),e.quality&&!["low","medium","high","ultra"].includes(e.quality)&&t.push('Campo "quality" deve ser low, medium, high ou ultra'),e.lipSyncPrecision&&!["low","medium","high","ultra"].includes(e.lipSyncPrecision)&&t.push('Campo "lipSyncPrecision" deve ser low, medium, high ou ultra'),{isValid:0===t.length,errors:t}}(o);if(!r.isValid)return s.NextResponse.json({success:!1,error:"Dados de entrada inv\xe1lidos",details:r.errors.join(", ")},{status:400});let i={...u,...o,voiceId:o.voiceId||function(e,t){let o={elevenlabs:{"pt-BR":"pNInz6obpgDQGcFmaJgB","en-US":"21m00Tcm4TlvDq8ikWAM","es-ES":"XB0fDUnXU5powFXDhCwa"},azure:{"pt-BR":"pt-BR-FranciscaNeural","en-US":"en-US-JennyNeural","es-ES":"es-ES-ElviraNeural"},google:{"pt-BR":"pt-BR-Wavenet-A","en-US":"en-US-Wavenet-F","es-ES":"es-ES-Wavenet-C"},synthetic:{"pt-BR":"synthetic-pt-br-female","en-US":"synthetic-en-us-female","es-ES":"synthetic-es-es-female"}};return o[e]?.[t]||o.synthetic[t]}(o.provider||u.provider,o.language||u.language)};if(console.log(`ðŸŽ¤ Gerando speech para texto: "${i.text.substring(0,50)}..." (${i.text.length} chars)`),console.log(`ðŸ“‹ Configura\xe7\xe3o: provider=${i.provider}, voice=${i.voiceId}, quality=${i.quality}`),i.useUnifiedPipeline)return await g(i,t);return await m(i,t)}catch(o){console.error("âŒ Erro ao gerar speech:",o);let e=Date.now()-t;return s.NextResponse.json({success:!1,error:"Erro interno do servidor",details:o instanceof Error?o.message:"Erro desconhecido",metadata:{processingTime:e,timestamp:new Date().toISOString()}},{status:500})}}async function g(e,t){try{let o=p.getInstance(),r={tts:{provider:e.provider,voiceId:e.voiceId,language:e.language,speed:e.speed,pitch:e.pitch,emotion:e.emotion,quality:e.quality},lipSync:{precision:e.lipSyncPrecision,frameRate:60,smoothing:.3,intensity:.8,enableEmotions:!0,enableBreathing:!0,enableMicroExpressions:!1},performance:{enableCache:!0,enablePreprocessing:!0,enableOptimizations:!0,maxConcurrentJobs:3,timeoutMs:3e5,retryAttempts:2}},i=await o.createRenderJob(e.text,r,e.metadata),a=Date.now()-t,n={success:!0,jobId:i,text:e.text,voiceId:e.voiceId,avatarId:e.avatarId,metadata:{quality:.9,processingTime:a,provider:e.provider,language:e.language,textLength:e.text.length,estimatedDuration:d(e.text,e.speed),cacheHit:!1}};return console.log(`âœ… Job ${i} criado no pipeline unificado em ${a}ms`),s.NextResponse.json(n)}catch(e){throw console.error("âŒ Erro no pipeline unificado:",e),e}}async function m(e,t){try{let o=c.getInstance(),r={text:e.text,language:e.language,voice:e.voiceId,speed:e.speed,pitch:e.pitch,emotion:e.emotion,provider:e.provider,lipSyncPrecision:e.enableLipSync?e.lipSyncPrecision:void 0};console.log(`ðŸ”„ Gerando TTS com ${e.provider}...`);let i=await o.synthesizeSpeech(r);if(!i.success||!i.audioUrl)throw Error(`Falha ao gerar \xe1udio TTS: ${i.error||"Erro desconhecido"}`);let a=Date.now()-t,n={success:!0,audioUrl:i.audioUrl,duration:i.duration||d(e.text,e.speed),provider:i.provider||e.provider,avatarId:e.avatarId,text:e.text,voiceId:e.voiceId,phonemes:e.enableLipSync?i.phonemes:void 0,lipSyncData:e.enableLipSync?i.lipSyncData:void 0,metadata:{quality:i.quality||.8,processingTime:a,provider:i.provider||e.provider,language:e.language,textLength:e.text.length,estimatedDuration:d(e.text,e.speed),cacheHit:i.cacheHit||!1}};return console.log(`âœ… TTS gerado com sucesso em ${a}ms`),console.log(`ðŸ“Š Qualidade: ${n.metadata?.quality}, Provider: ${n.provider}`),s.NextResponse.json(n)}catch(e){throw console.error("âŒ Erro no TTS direto:",e),e}}async function h(e){try{let{searchParams:t}=new URL(e.url),o=t.get("jobId");if(!o)return s.NextResponse.json({success:!1,error:"jobId \xe9 obrigat\xf3rio"},{status:400});let r=p.getInstance().getJobStatus(o);if(!r)return s.NextResponse.json({success:!1,error:"Job n\xe3o encontrado"},{status:404});return s.NextResponse.json({success:!0,job:{id:r.id,status:r.status,progress:r.progress,startTime:r.startTime,endTime:r.endTime,estimatedCompletion:r.estimatedCompletion,output:r.output,error:r.error,metrics:r.metrics}})}catch(e){return console.error("âŒ Erro ao obter status do job:",e),s.NextResponse.json({success:!1,error:"Erro interno do servidor",details:e instanceof Error?e.message:"Erro desconhecido"},{status:500})}}let v=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/avatars/generate-speech/route",pathname:"/api/avatars/generate-speech",filename:"route",bundlePath:"app/api/avatars/generate-speech/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\avatars\\generate-speech\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:y,staticGenerationAsyncStorage:S,serverHooks:x}=v,b="/api/avatars/generate-speech/route";function f(){return(0,n.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:S})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),r=t.X(0,[8948,5972],()=>o(477189));module.exports=r})();