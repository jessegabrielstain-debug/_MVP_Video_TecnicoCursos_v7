"use strict";(()=>{var e={};e.id=8501,e.ids=[8501],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},86624:e=>{e.exports=require("querystring")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},49073:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>E,patchFetch:()=>f,requestAsyncStorage:()=>x,routeModule:()=>y,serverHooks:()=>_,staticGenerationAsyncStorage:()=>h});var s={};r.r(s),r.d(s,{DELETE:()=>g,GET:()=>l});var a=r(49303),o=r(88716),n=r(60670),i=r(87070),u=r(737),c=r(71487),d=r(75571);let p="videos";async function l(e,{params:t}){try{let r=await (0,d.getServerSession)();if(!r?.user?.id)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:s}=new URL(e.url),a=parseInt(s.get("expiresIn")||"3600"),o=s.get("bucket")||p,n=await u.c.getSignedUrl(o,t.key,a),{ip:l,userAgent:g}=(0,c.h9)(e);return await c.Ps.logUserAction(r.user.id,c.V6.FILE_DOWNLOAD,`${o}/${t.key}`,{key:t.key,bucket:o,ip:l,userAgent:g}),i.NextResponse.json({url:n})}catch(e){return i.NextResponse.json({error:e instanceof Error?e.message:String(e)},{status:500})}}async function g(e,{params:t}){try{let r=await (0,d.getServerSession)();if(!r?.user?.id)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:s}=new URL(e.url),a=s.get("bucket")||p;await u.c.delete(a,t.key);let{ip:o,userAgent:n}=(0,c.h9)(e);return await c.Ps.logUserAction(r.user.id,c.V6.FILE_DELETE,`${a}/${t.key}`,{key:t.key,bucket:a,ip:o,userAgent:n}),i.NextResponse.json({success:!0})}catch(e){return i.NextResponse.json({error:e instanceof Error?e.message:String(e)},{status:500})}}let y=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/storage/files/[key]/route",pathname:"/api/storage/files/[key]",filename:"route",bundlePath:"app/api/storage/files/[key]/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\storage\\files\\[key]\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:x,staticGenerationAsyncStorage:h,serverHooks:_}=y,E="/api/storage/files/[key]/route";function f(){return(0,n.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:h})}},71487:(e,t,r)=>{r.d(t,{Ps:()=>n,V6:()=>s,h9:()=>i});var s,a=r(61657);class o{constructor(){let e="https://ofhzrdiadxigrvmrhaiz.supabase.co",t=process.env.SUPABASE_SERVICE_ROLE_KEY;e&&t||console.warn("⚠️ Supabase credentials not found in AuditLoggingService"),this.supabase=(0,a.eI)(e,t,{auth:{autoRefreshToken:!1,persistSession:!1}})}async log(e){try{let{error:t}=await this.supabase.from("analytics_events").insert({user_id:e.userId,event_type:`audit.${e.action}`,event_data:{resource:e.resource,...e.metadata},created_at:new Date().toISOString()});t&&console.error("Failed to write audit log:",t)}catch(e){console.error("Error in audit logger:",e)}}async query(e){try{let t=this.supabase.from("analytics_events").select("*").ilike("event_type","audit.%").order("created_at",{ascending:!1});e.userId&&(t=t.eq("user_id",e.userId)),e.action&&(t=t.eq("event_type",`audit.${e.action}`));let{data:r,error:s}=await t.limit(100);if(s)throw s;return(r||[]).map(e=>({id:e.id,userId:e.user_id,action:e.event_type.replace("audit.",""),resource:e.event_data?.resource||"unknown",timestamp:new Date(e.created_at),metadata:e.event_data}))}catch(e){return console.error("Failed to query audit logs:",e),[]}}async getUserActivity(e,t=50){return this.query({userId:e})}async logUserAction(e,t,r,s){return this.log({userId:e,action:t,resource:r,metadata:s})}}let n=new o;function i(e){return{ip:e.headers.get("x-forwarded-for")||"unknown",userAgent:e.headers.get("user-agent")||"unknown"}}!function(e){e.CREATE="create",e.UPDATE="update",e.DELETE="delete",e.READ="read",e.LOGIN="login",e.LOGOUT="logout",e.UPLOAD="upload",e.DOWNLOAD="download",e.FILE_UPLOAD="file_upload",e.FILE_DOWNLOAD="file_download",e.FILE_DELETE="file_delete"}(s||(s={}))}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972,1657,5571,1175],()=>r(49073));module.exports=s})();