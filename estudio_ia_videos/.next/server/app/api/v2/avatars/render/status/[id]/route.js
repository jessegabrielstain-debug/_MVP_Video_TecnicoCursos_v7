"use strict";(()=>{var e={};e.id=149,e.ids=[149,3936],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},87561:e=>{e.exports=require("node:fs")},83398:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>w,patchFetch:()=>S,requestAsyncStorage:()=>f,routeModule:()=>h,serverHooks:()=>v,staticGenerationAsyncStorage:()=>b});var r={};a.r(r),a.d(r,{DELETE:()=>_,GET:()=>p,POST:()=>g});var s=a(49303),o=a(88716),n=a(60670),i=a(87070),l=a(99963),d=a(6251),c=a(13936);let u=(0,l.H2)(l.wS.render);async function p(e,{params:t}){return u(e,async e=>{try{let a=t.id,r=(0,c.getSupabaseForRequest)(e);console.log(`ðŸ“Š API v2: Verificando status do job ${a}`);let s=await d.N.getRenderJobStatus(a);if(!s)return i.NextResponse.json({success:!1,error:{message:"Job n\xe3o encontrado",code:"JOB_NOT_FOUND"}},{status:404});let{data:o}=await r.from("avatar_models").select("id, name, display_name, category").eq("id",s.avatarId).single(),n=Date.now(),l=s.endTime?s.endTime-s.startTime:n-s.startTime,u="completed"===s.status,p="failed"===s.status,m="processing"===s.status,g=null;if(m&&s.progress>0){let e=l/s.progress,t=100-s.progress;g=Math.round(e*t)}let y=s.lipSyncData,_={success:!0,data:{job:{id:s.id,avatarId:s.avatarId,userId:s.userId,avatarName:o?.name||o?.display_name||"Desconhecido",status:s.status,progress:s.progress||0,startTime:s.startTime?new Date(s.startTime).toISOString():null,endTime:s.endTime?new Date(s.endTime).toISOString():null,duration:Math.round(l/1e3),estimatedTimeRemaining:g?Math.round(g/1e3):null,error:s.error},avatar:o?{id:o.id,name:o.name,displayName:o.display_name,category:o.category}:null,output:{videoUrl:s.outputVideo,thumbnailUrl:s.outputThumbnail,available:u&&!!s.outputVideo,downloadUrl:u&&s.outputVideo?`/api/v2/avatars/render/download/${s.id}`:null},lipSync:y?{accuracy:y.accuracy||s.lipSyncAccuracy,processingTime:y.processingTime,audio2FaceEnabled:s.audio2FaceEnabled||!1,frameCount:y.metadata?.totalFrames,frameRate:y.metadata?.frameRate,audioLength:y.metadata?.audioLength}:s.lipSyncAccuracy?{accuracy:s.lipSyncAccuracy,audio2FaceEnabled:s.audio2FaceEnabled||!1}:null,render:{quality:s.quality||"hyperreal",resolution:s.resolution||"4K",rayTracing:s.rayTracingEnabled||!1,realTimeLipSync:s.realTimeLipSync||!1,language:s.language||"pt-BR"},performance:{renderingEngine:"Unreal Engine 5.3 + Audio2Face",qualityLevel:u?"Hiper-realista":"Processando...",polygonCount:u?85e4:null,textureResolution:u?"8K":null,rayTracingEnabled:s.rayTracingEnabled||!1,audio2FaceEnabled:s.audio2FaceEnabled||!1},metadata:{version:"2.0.0",timestamp:new Date().toISOString(),statusCheckedAt:n,nextCheckRecommended:m?n+5e3:null,createdAt:s.createdAt?new Date(s.createdAt).toISOString():null,updatedAt:s.updatedAt?new Date(s.updatedAt).toISOString():null}}},h={"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"};return m?(h["X-Poll-Interval"]="5000",h["X-Status"]="processing"):u?h["X-Status"]="completed":p&&(h["X-Status"]="failed"),i.NextResponse.json(_,{headers:h})}catch(e){return console.error("âŒ Erro ao verificar status:",e),i.NextResponse.json({success:!1,error:{message:"Erro ao verificar status do job",details:e instanceof Error?e.message:"Erro desconhecido",code:"STATUS_CHECK_ERROR"}},{status:500})}})}let m=(0,l.H2)(l.wS.render);async function g(e,{params:t}){return m(e,async e=>{try{let a=t.id,{action:r}=await e.json(),s=(0,c.getSupabaseForRequest)(e);console.log(`ðŸŽ¬ API v2: A\xe7\xe3o ${r} no job ${a}`);let o=await d.N.getRenderJobStatus(a);if(!o)return i.NextResponse.json({success:!1,error:{message:"Job n\xe3o encontrado",code:"JOB_NOT_FOUND"}},{status:404});switch(r){case"cancel":if("processing"!==o.status)return i.NextResponse.json({success:!1,error:{message:"Job n\xe3o pode ser cancelado (n\xe3o est\xe1 em processamento)",code:"CANNOT_CANCEL"}},{status:400});let n=await d.N.cancelRenderJob(a);return i.NextResponse.json({success:!0,data:{message:"Job cancelado com sucesso",jobId:a,cancelled:n,timestamp:new Date().toISOString()}});case"retry":if("failed"!==o.status)return i.NextResponse.json({success:!1,error:{message:"Job n\xe3o pode ser reexecutado (n\xe3o falhou)",code:"CANNOT_RETRY"}},{status:400});let{error:l}=await s.from("render_jobs").update({status:"queued",progress:0,error_message:null,completed_at:null,updated_at:new Date().toISOString()}).eq("id",a);if(l)throw Error(`Erro ao atualizar job: ${l.message}`);return i.NextResponse.json({success:!0,data:{message:"Job recolocado na fila para reprocessamento",jobId:a,newStatus:"queued",timestamp:new Date().toISOString()}});case"download":if("completed"!==o.status||!o.outputVideo)return i.NextResponse.json({success:!1,error:{message:"Job n\xe3o est\xe1 completo ou n\xe3o tem sa\xedda dispon\xedvel",code:"NO_OUTPUT_AVAILABLE"}},{status:400});let u=o.lipSyncData;return i.NextResponse.json({success:!0,data:{downloadUrl:o.outputVideo,thumbnailUrl:o.outputThumbnail,fileSize:"~50MB",format:"MP4",resolution:"4K",duration:u?.metadata?.audioLength||5}});default:return i.NextResponse.json({success:!1,error:{message:"A\xe7\xe3o n\xe3o suportada",code:"UNSUPPORTED_ACTION"}},{status:400})}}catch(e){return console.error("âŒ Erro na a\xe7\xe3o do job:",e),i.NextResponse.json({success:!1,error:{message:"Erro ao executar a\xe7\xe3o no job",details:e instanceof Error?e.message:"Erro desconhecido",code:"JOB_ACTION_ERROR"}},{status:500})}})}let y=(0,l.H2)(l.wS.authenticated);async function _(e,{params:t}){return y(e,async e=>{try{let a=t.id,r=(0,c.getSupabaseForRequest)(e);console.log(`ðŸ—‘ï¸ API v2: Removendo job ${a}`);let s=await d.N.getRenderJobStatus(a);if(!s)return i.NextResponse.json({success:!1,error:{message:"Job n\xe3o encontrado",code:"JOB_NOT_FOUND"}},{status:404});if("processing"===s.status)return i.NextResponse.json({success:!1,error:{message:"N\xe3o \xe9 poss\xedvel remover job em processamento. Cancele primeiro.",code:"CANNOT_DELETE_PROCESSING"}},{status:400});let{error:o}=await r.from("render_jobs").delete().eq("id",a);if(o)throw Error(`Erro ao remover job: ${o.message}`);return await d.N.cancelRenderJob(a),i.NextResponse.json({success:!0,data:{message:"Job removido com sucesso",jobId:a,timestamp:new Date().toISOString()}})}catch(e){return console.error("âŒ Erro ao remover job:",e),i.NextResponse.json({success:!1,error:{message:"Erro ao remover job",details:e instanceof Error?e.message:"Erro desconhecido",code:"DELETE_JOB_ERROR"}},{status:500})}})}let h=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/v2/avatars/render/status/[id]/route",pathname:"/api/v2/avatars/render/status/[id]",filename:"route",bundlePath:"app/api/v2/avatars/render/status/[id]/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\v2\\avatars\\render\\status\\[id]\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:f,staticGenerationAsyncStorage:b,serverHooks:v}=h,w="/api/v2/avatars/render/status/[id]/route";function S(){return(0,n.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:b})}},6251:(e,t,a)=>{a.d(t,{N:()=>o});var r=a(8261),s=a(36527);let o={renderAvatar:async e=>e?{success:!1,error:"Use renderHyperRealisticAvatar for real rendering"}:{success:!1,error:"Invalid avatar config"},customizeAvatar:async(e,t)=>{let a=s.e4.getById(e);return a?{success:!0,avatarData:{id:e,...a.metadata,...t}}:{success:!1,error:"Avatar not found in registry"}},renderHyperRealisticAvatar:async(e,t,a,s)=>{try{let o=await r._.renderJob.create({data:{status:"queued",renderSettings:JSON.parse(JSON.stringify({type:"avatar_render",text:t,voiceProfileId:a,options:s,userId:e})),progress:0}});return{success:!0,jobId:o.id,status:"queued",audio2FaceEnabled:!!s.audio2FaceEnabled}}catch(e){return console.error("Error creating render job:",e),{success:!1,error:"Failed to create render job"}}},getRenderJobStatus:async e=>{try{let t=await r._.renderJob.findUnique({where:{id:e}});if(!t)return{status:"not_found",error:"Job not found"};let a=t.renderSettings||{};return{id:t.id,status:t.status||"unknown",outputVideo:t.outputUrl||void 0,error:t.errorMessage||void 0,progress:t.progress||0,avatarId:a.avatarId,userId:t.userId||void 0,startTime:t.createdAt.getTime(),endTime:t.completedAt?.getTime(),outputThumbnail:t.thumbnailUrl||void 0,lipSyncAccuracy:95,audio2FaceEnabled:!0,quality:a.quality,resolution:a.resolution,rayTracingEnabled:a.rayTracing,realTimeLipSync:a.realTimeLipSync,language:a.language,createdAt:t.createdAt,updatedAt:t.updatedAt}}catch(e){return console.error("Error fetching job status:",e),{status:"error",error:"Database error"}}},getAllCategories:()=>["business","casual","medical","industrial"],getAvatarsByCategory:e=>s.e4.getAll().filter(t=>{let a=t.metadata?.style||"";return"business"!==e||"professional"===a}),getAllAvatars:()=>s.e4.getAll(),getAvatar:e=>s.e4.getById(e),getPipelineStats:async()=>{let e=new Date;e.setHours(0,0,0,0);let[t,a,s,o]=await Promise.all([r._.renderJob.count({where:{status:"processing"}}),r._.renderJob.count({where:{status:"queued"}}),r._.renderJob.count({where:{status:"completed",createdAt:{gte:e}}}),r._.renderJob.findMany({where:{status:"completed",durationMs:{not:null}},select:{durationMs:!0},take:100})]),n=o.length>0?o.reduce((e,t)=>e+(t.durationMs||0),0)/o.length:0,i=await r._.renderJob.count(),l=await r._.renderJob.count({where:{status:"completed"}});return{activeJobs:t,queuedJobs:a,completedToday:s,averageRenderTime:Math.round(n),successRate:Math.round(10*(i>0?l/i*100:100))/10,audio2FaceStatus:!0}},generateHyperRealisticLipSync:async(e,t,a,r)=>{let o=s.e4.getById(e);return o?.engine==="ue5"?{success:!0,audio2FaceEnabled:!0,accuracy:95,processingTime:1200,lipSyncData:[]}:{success:!1,audio2FaceEnabled:!1,accuracy:0,error:"Avatar does not support Audio2Face"}},cancelRenderJob:async e=>{try{let t=await r._.renderJob.findUnique({where:{id:e}});if(!t||["completed","failed","cancelled"].includes(t.status||""))return!1;return await r._.renderJob.update({where:{id:e},data:{status:"cancelled"}}),!0}catch(e){return console.error("Error cancelling job:",e),!1}},cleanupOldJobs:async()=>{let e=new Date;e.setDate(e.getDate()-30),await r._.renderJob.deleteMany({where:{createdAt:{lt:e},status:{in:["completed","failed","cancelled"]}}})}}},36527:(e,t,a)=>{a.d(t,{e4:()=>o});let r=[{id:"heygen_anna_news",name:"Anna (News Anchor)",type:"video",engine:"heygen",gender:"female",description:"Apresentadora profissional ideal para comunicados oficiais e treinamentos corporativos.",style:"professional",tags:["news","formal","enterprise"],previewUrl:"https://files.heygen.ai/avatar/v3/3f2583200c854a0397f129e60b811467/full/preview_target.webp",metadata:{style:"professional",quality:"high",tags:["news","formal"]},heyGenConfig:{avatarId:"Anna_public_3_20240108"}},{id:"heygen_josh_casual",name:"Josh (Casual)",type:"video",engine:"heygen",gender:"male",description:"Especialista descontra\xeddo, \xf3timo para v\xeddeos educacionais e comunicados internos.",style:"casual",tags:["explainer","friendly"],previewUrl:"https://files.heygen.ai/avatar/v3/4a90e2/full/preview_target.webp",metadata:{style:"casual",quality:"high",tags:["explainer","friendly"]},heyGenConfig:{avatarId:"Josh_public_2_20240108"}},{id:"mh_male_01",name:"Professional Male (UE5)",type:"3d",engine:"ue5",gender:"male",description:"MetaHuman masculino para renders imersivos em ambientes industriais.",style:"professional",tags:["ue5","metahuman"],metadata:{style:"professional",age_range:"30-40",clothing_options:["suit","casual"],expression_presets:["neutral","smile","speak"]}},{id:"mh_female_01",name:"Professional Female (UE5)",type:"3d",engine:"ue5",gender:"female",description:"MetaHuman feminino indicado para aulas t\xe9cnicas e conte\xfados executivos.",style:"professional",tags:["ue5","metahuman"],metadata:{style:"professional",age_range:"25-35",clothing_options:["suit","casual"],expression_presets:["neutral","smile","speak"]}},{id:"local_male_01",name:"Simple Male (2D)",type:"2d",engine:"local",gender:"male",description:"Avatar 2D leve para pr\xe9-visualiza\xe7\xf5es r\xe1pidas e anima\xe7\xf5es simples.",style:"cartoon",tags:["2d","fast-render"],metadata:{style:"cartoon",color:"#4a90e2"}},{id:"local_female_01",name:"Simple Female (2D)",type:"2d",engine:"local",gender:"female",description:"Avatar 2D feminino otimizado para storyboards e prot\xf3tipos.",style:"cartoon",tags:["2d","fast-render"],metadata:{style:"cartoon",color:"#e24a90"}}];class s{getAll(){return r}getById(e){return r.find(t=>t.id===e)}getByEngine(e){return r.filter(t=>t.engine===e)}}let o=new s},8261:(e,t,a)=>{a.d(t,{_:()=>s});var r=a(53524);let s=global.prisma||new r.PrismaClient({log:["error"]})},13936:(e,t,a)=>{a.d(t,{e:()=>n,getSupabaseForRequest:()=>l,p:()=>i});var r=a(67721),s=a(61657),o=a(71615);let n=()=>{let e=(0,o.cookies)();return(0,r.createServerClient)("https://ofhzrdiadxigrvmrhaiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ",{cookies:{get:t=>e.get(t)?.value,set(t,a,r){try{e.set({name:t,value:a,...r})}catch(e){}},remove(t,a){try{e.set({name:t,value:"",...a})}catch(e){}}}})},i=(0,s.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}});function l(e){let t=e.headers.get("authorization")||e.headers.get("Authorization");return t?(0,s.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ",{global:{headers:{Authorization:t}},auth:{persistSession:!1,autoRefreshToken:!1}}):n()}},99963:(e,t,a)=>{a.d(t,{H2:()=>o,wS:()=>n});var r=a(87070),s=a(5213);function o(e){let{limit:t,windowMs:a,message:o="Muitas requisi\xe7\xf5es. Tente novamente mais tarde.",keyGenerator:n=e=>`ip:${function(e){let t=e.headers.get("x-forwarded-for");if(t)return t.split(",")[0].trim();let a=e.headers.get("cf-connecting-ip");return a?a:e.headers.get("x-real-ip")||"unknown"}(e)}`,skip:i}=e;return async function(e,l){if(i&&await i(e))return l(e);let d=n(e),c=(0,s.D)(d,t,a);if(!c.allowed)return r.NextResponse.json({error:o,retryAfter:c.retryAfterSec},{status:429,headers:{"Retry-After":c.retryAfterSec.toString(),"X-RateLimit-Limit":t.toString(),"X-RateLimit-Reset":new Date(Date.now()+1e3*c.retryAfterSec).toISOString()}});let u=await l(e);return u.headers.set("X-RateLimit-Limit",t.toString()),u.headers.set("X-RateLimit-Remaining",(t-(c.retryAfterSec||0)).toString()),u}}let n={authenticated:{limit:100,windowMs:6e4,message:"Limite de requisi\xe7\xf5es excedido. Aguarde 1 minuto."},anonymous:{limit:20,windowMs:6e4,message:"Limite de requisi\xe7\xf5es excedido para usu\xe1rios n\xe3o autenticados."},upload:{limit:10,windowMs:36e5,message:"Limite de uploads excedido. Aguarde 1 hora."},render:{limit:5,windowMs:36e5,message:"Limite de renderiza\xe7\xf5es excedido. Aguarde 1 hora."},public:{limit:50,windowMs:6e4,message:"Limite de requisi\xe7\xf5es para API p\xfablica excedido."},webhook:{limit:100,windowMs:6e4,message:"Limite de webhooks excedido."}}},5213:(e,t,a)=>{a.d(t,{D:()=>n,U:()=>i});var r=a(87561);let s=e=>{let t=process.env.RATE_LIMIT_DEBUG_LOG;if(t)try{(0,r.appendFileSync)(t,`${JSON.stringify({ts:Date.now(),...e})}
`,{encoding:"utf-8"})}catch(e){"true"===process.env.DEBUG_RATE_LIMIT&&console.error("[rate-limit] debug log failed",e)}},o=()=>{let e=globalThis.process;if(e)return e.__app_rate_limit_store__||(e.__app_rate_limit_store__=new Map),e.__app_rate_limit_store__;let t=globalThis;return t.__app_rate_limit_store__||(t.__app_rate_limit_store__=new Map),t.__app_rate_limit_store__};function n(e,t,a){let r=o(),n=Date.now(),i=r.get(e),l=i?n-i.lastRequest:0;if(!i||l>=a&&n>=(i.blockedUntil||0))return r.set(e,{windowStart:n,lastRequest:n,count:1,blockedUntil:0}),"true"===process.env.DEBUG_RATE_LIMIT&&console.info("[rate-limit] reset",{key:e,limit:t,windowMs:a,idle:l}),s({type:"reset",key:e,limit:t,windowMs:a,idle:l}),{allowed:!0,retryAfterSec:0};if((i=r.get(e)).blockedUntil&&n<i.blockedUntil){let a=Math.max(0,Math.ceil((i.blockedUntil-n)/1e3));return"true"===process.env.DEBUG_RATE_LIMIT&&console.info("[rate-limit] still-blocked",{key:e,retryAfterSec:a}),s({type:"blocked",key:e,count:i.count,limit:t,retryAfterSec:a}),i.lastRequest=n,{allowed:!1,retryAfterSec:a}}if(i.count>=t){i.blockedUntil=i.windowStart+a,i.blockedUntil<=n&&(i.blockedUntil=n+a);let r=Math.max(0,Math.ceil((i.blockedUntil-n)/1e3));return"true"===process.env.DEBUG_RATE_LIMIT&&console.info("[rate-limit] blocked",{key:e,count:i.count,limit:t,retryAfterSec:r}),s({type:"blocked",key:e,count:i.count,limit:t,retryAfterSec:r}),i.lastRequest=n,{allowed:!1,retryAfterSec:r}}return i.count+=1,i.lastRequest=n,"true"===process.env.DEBUG_RATE_LIMIT&&console.info("[rate-limit] allowed",{key:e,count:i.count,limit:t,idle:l}),s({type:"allowed",key:e,count:i.count,limit:t,idle:l}),{allowed:!0,retryAfterSec:0}}function i(e){return o().get(e)}}};var t=require("../../../../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[8948,5972,1657,9702],()=>a(83398));module.exports=r})();