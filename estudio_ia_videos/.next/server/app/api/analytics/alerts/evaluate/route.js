"use strict";(()=>{var e={};e.id=603,e.ids=[603],e.modules={220399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},430517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},689513:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>y,requestAsyncStorage:()=>v,routeModule:()=>g,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m});var a={};r.r(a),r.d(a,{GET:()=>p,POST:()=>c});var n=r(349303),s=r(88716),o=r(60670),i=r(387070);(function(){var e=Error("Cannot find module '@/lib/analytics/alert-system'");throw e.code="MODULE_NOT_FOUND",e})(),function(){var e=Error("Cannot find module '@/lib/analytics/api-performance-middleware'");throw e.code="MODULE_NOT_FOUND",e}();let l=process.env.CRON_TOKEN||"default-cron-token";async function u(e){try{let t=e.headers.get("authorization"),r=e.headers.get("x-cron-token");if(!t&&r!==l)return i.NextResponse.json({error:"Unauthorized. Valid authorization or cron token required."},{status:401});let{force:a=!1,organizationId:n,ruleTypes:s=[],dryRun:o=!1}=await e.json().catch(()=>({})),u=Object(function(){var e=Error("Cannot find module '@/lib/analytics/alert-system'");throw e.code="MODULE_NOT_FOUND",e}())(),d=Date.now(),c=await u.evaluateAlerts(),p=Date.now()-d;console.log("[Alert Evaluation] Completed",{force:a,dryRun:o,organizationId:n,ruleTypes:s,evaluated:c.evaluated,triggered:c.triggered,durationMs:p}),c.alerts.length>0&&console.log("[Alert Evaluation] Triggered alerts",{alerts:c.alerts.map(e=>({id:e.id,severity:e.severity,title:e.title}))});let g={success:!0,message:"Alert evaluation completed successfully",execution:{startedAt:new Date(Date.now()-p),completedAt:new Date,durationMs:p,dryRun:o},results:{evaluated:c.evaluated,triggered:c.triggered,alerts:c.alerts.map(e=>({id:e.id,type:e.type,severity:e.severity,title:e.title,value:e.value,threshold:e.threshold,triggeredAt:e.triggeredAt}))},stats:{criticalAlerts:c.alerts.filter(e=>"critical"===e.severity).length,warningAlerts:c.alerts.filter(e=>"warning"===e.severity).length,errorAlerts:c.alerts.filter(e=>"error"===e.severity).length,infoAlerts:c.alerts.filter(e=>"info"===e.severity).length}};return g.stats.criticalAlerts>0&&console.warn("[Alert Evaluation] Critical alerts triggered",{count:g.stats.criticalAlerts}),i.NextResponse.json(g)}catch(e){return console.error("[Alert Evaluation] Critical error",e),i.NextResponse.json({success:!1,error:"Alert evaluation failed",message:e instanceof Error?e.message:"Unknown error",execution:{startedAt:new Date,completedAt:new Date,durationMs:0,failed:!0}},{status:500})}}async function d(e){try{let t=e.headers.get("authorization"),r=e.headers.get("x-cron-token");if(!t&&r!==l)return i.NextResponse.json({error:"Unauthorized"},{status:401});let a={timestamp:new Date,status:"success",evaluated:0,triggered:0,executionTime:0};return i.NextResponse.json({lastExecution:a,systemStatus:"operational",nextScheduledRun:new Date(Date.now()+3e5),configuration:{evaluationInterval:"5 minutes",enabledRules:["render_failures","queue_stalled","high_latency","low_engagement"],notifications:{email:!0,slack:!0,sms:!1},dryRunSupported:!0,defaultThresholds:{render_failures:3,queue_stalled:2,high_latency:5e3,low_engagement:20}}})}catch(e){return console.error("[Alert Evaluation Status] Error",e),i.NextResponse.json({error:"Failed to fetch alert evaluation status",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}let c=Object(function(){var e=Error("Cannot find module '@/lib/analytics/api-performance-middleware'");throw e.code="MODULE_NOT_FOUND",e}())(u),p=Object(function(){var e=Error("Cannot find module '@/lib/analytics/api-performance-middleware'");throw e.code="MODULE_NOT_FOUND",e}())(d),g=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/analytics/alerts/evaluate/route",pathname:"/api/analytics/alerts/evaluate",filename:"route",bundlePath:"app/api/analytics/alerts/evaluate/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\analytics\\alerts\\evaluate\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:v,staticGenerationAsyncStorage:m,serverHooks:h}=g,f="/api/analytics/alerts/evaluate/route";function y(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[8948,5972],()=>r(689513));module.exports=a})();