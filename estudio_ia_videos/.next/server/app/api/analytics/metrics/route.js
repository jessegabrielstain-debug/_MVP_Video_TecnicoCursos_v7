"use strict";(()=>{var e={};e.id=6412,e.ids=[6412,3474],e.modules={453524:e=>{e.exports=require("@prisma/client")},572934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},554580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},345869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},220399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},430517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},627790:e=>{e.exports=require("assert")},978893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},532615:e=>{e.exports=require("http")},735240:e=>{e.exports=require("https")},986624:e=>{e.exports=require("querystring")},917360:e=>{e.exports=require("url")},521764:e=>{e.exports=require("util")},671568:e=>{e.exports=require("zlib")},73222:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>y,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>g,staticGenerationAsyncStorage:()=>m});var a={};r.r(a),r.d(a,{GET:()=>d});var o=r(349303),s=r(88716),i=r(60670),n=r(387070),c=r(95715),u=r(303474);async function d(e){try{let t=await (0,c.getServerSession)(Object(function(){var e=Error("Cannot find module '@/lib/auth/auth-config'");throw e.code="MODULE_NOT_FOUND",e}()));if(!t?.user?.id)return n.NextResponse.json({error:"Unauthorized"},{status:401});let r=t.user.id,a=new URL(e.url).searchParams.get("period")||"30d",o=new Date,s="7d"===a?7:"30d"===a?30:90,i=new Date(o.getTime()-864e5*s),[d,p,l,m,g,x]=await Promise.all([u.prisma.analyticsEvent.count({where:{userId:r,category:"pptx",action:"upload",createdAt:{gte:i}}}),u.prisma.analyticsEvent.count({where:{userId:r,category:"render",action:"complete",createdAt:{gte:i}}}),u.prisma.analyticsEvent.count({where:{userId:r,category:"video",action:"download",createdAt:{gte:i}}}),u.prisma.renderJob.groupBy({by:["status"],where:{userId:r,createdAt:{gte:i}},_count:{id:!0}}),u.prisma.project.findMany({where:{userId:r,createdAt:{gte:i}},orderBy:{createdAt:"desc"},take:5,select:{id:!0,name:!0,status:!0,createdAt:!0,videoUrl:!0}}),u.prisma.$queryRaw`
        SELECT 
          DATE(created_at) as date,
          category,
          COUNT(*) as count
        FROM "AnalyticsEvent"
        WHERE user_id = ${r}
          AND created_at >= ${i}
        GROUP BY DATE(created_at), category
        ORDER BY date DESC
      `]),y=d>0?(p/d*100).toFixed(1):"0",v=await u.prisma.analyticsEvent.aggregate({where:{userId:r,category:"render",action:"complete",duration:{not:null},createdAt:{gte:i}},_avg:{duration:!0}});return n.NextResponse.json({period:a,metrics:{totalUploads:d,totalRenders:p,totalDownloads:l,conversionRate:parseFloat(y),avgRenderTime:v._avg.duration?Math.round(v._avg.duration/1e3):null},renderJobs:m.map(e=>({status:e.status,count:e._count.id})),recentProjects:g,eventsByDay:x})}catch(e){return console.error("[Analytics Metrics] Error:",e),n.NextResponse.json({error:e.message},{status:500})}}!function(){var e=Error("Cannot find module '@/lib/auth/auth-config'");throw e.code="MODULE_NOT_FOUND",e}();let p=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/analytics/metrics/route",pathname:"/api/analytics/metrics",filename:"route",bundlePath:"app/api/analytics/metrics/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\analytics\\metrics\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:l,staticGenerationAsyncStorage:m,serverHooks:g}=p,x="/api/analytics/metrics/route";function y(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:m})}},303474:(e,t,r)=>{r.d(t,{prisma:()=>o});var a=r(453524);let o=global.prisma||new a.PrismaClient({log:["query"]})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[8948,5972,5715],()=>r(73222));module.exports=a})();