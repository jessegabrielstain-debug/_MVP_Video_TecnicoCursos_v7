"use strict";(()=>{var e={};e.id=8149,e.ids=[8149,3936],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},86624:e=>{e.exports=require("querystring")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},87046:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>j,patchFetch:()=>b,requestAsyncStorage:()=>x,routeModule:()=>I,serverHooks:()=>y,staticGenerationAsyncStorage:()=>v});var a={};r.r(a),r.d(a,{GET:()=>g});var s=r(49303),n=r(88716),o=r(60670),i=r(87070),l=r(75571),u=r(95306),d=r(13936),c=r(12065);class p{constructor(e=3e4){this.cache=new Map,this.cleanupInterval=null,this.defaultTtl=e,this.cleanupInterval=setInterval(()=>this.cleanup(),6e4)}get(e){let t=this.cache.get(e);return t?t.expiresAt>0&&Date.now()>t.expiresAt?(this.cache.delete(e),null):t.value:null}set(e,t,r){let a="number"==typeof r?r:this.defaultTtl;this.cache.set(e,{value:t,expiresAt:a>0?Date.now()+a:0})}setex(e,t,r){this.set(e,r,1e3*t)}del(e){this.cache.delete(e)}clear(){this.cache.clear()}disconnect(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null),this.cache.clear()}cleanup(){let e=Date.now();for(let[t,r]of this.cache.entries())r.expiresAt>0&&e>r.expiresAt&&this.cache.delete(t)}}let m=null;var _=r(91585);_.Ry({projectId:_.Z_().uuid("ID de projeto inv\xe1lido"),title:_.Z_().min(1,"T\xedtulo \xe9 obrigat\xf3rio").max(200,"T\xedtulo muito longo"),slideIds:_.IX(_.Z_().uuid()).min(1,"Pelo menos um slide \xe9 necess\xe1rio"),settings:_.Ry({resolution:_.Km(["720p","1080p","4k"]).default("1080p"),fps:_.Rx().int().min(24).max(60).default(30),format:_.Km(["mp4","webm","mov"]).default("mp4"),quality:_.Km(["low","medium","high","ultra"]).default("high")}).optional(),metadata:_.IM(_._4()).optional()}),_.Ry({jobId:_.Z_().uuid("ID de job inv\xe1lido")}),_.Ry({page:_.oQ.number().int().positive().default(1),limit:_.oQ.number().int().positive().max(100).default(20),status:_.Km(["pending","processing","completed","failed","cancelled"]).optional(),projectId:_.Z_().uuid().optional(),sortBy:_.Km(["createdAt","updatedAt","status"]).default("createdAt"),sortOrder:_.Km(["asc","desc"]).default("desc")}),_.Ry({startDate:_.oQ.date().optional(),endDate:_.oQ.date().optional(),projectId:_.Z_().uuid().optional(),groupBy:_.Km(["day","week","month"]).default("day"),includeDetails:_.oQ.boolean().default(!1)});let h=_.Ry({timeRange:_.Km(["1h","24h","7d","30d","90d"]).default("24h"),status:_.Km(["all","queued","pending","processing","completed","failed"]).default("all"),userId:_.Z_().uuid().optional(),projectType:_.Z_().optional(),includeErrors:_.oQ.boolean().default(!1),includePerformance:_.oQ.boolean().default(!1)});_.Ry({jobId:_.Z_().uuid("ID de job inv\xe1lido"),reason:_.Z_().max(500).optional()}),_.Ry({jobId:_.Z_().uuid("ID de job inv\xe1lido"),force:_.oQ.boolean().default(!1)}),_.Ry({eventType:_.Km(["slide_reordered","video_exported","project_created","render_started","render_completed","render_failed","user_login","user_logout"]),eventData:_.IM(_._4()),userId:_.Z_().uuid().optional(),sessionId:_.Z_().optional(),timestamp:_.oQ.date().default(()=>new Date)}),_.Ry({startDate:_.oQ.date(),endDate:_.oQ.date(),eventTypes:_.IX(_.Z_()).optional(),userId:_.Z_().uuid().optional(),limit:_.oQ.number().int().positive().max(1e3).default(100),offset:_.oQ.number().int().nonnegative().default(0)}),_.Ry({name:_.Z_().min(1,"Nome \xe9 obrigat\xf3rio").max(200),description:_.Z_().max(2e3).optional(),originalFileName:_.Z_().optional(),metadata:_.IM(_._4()).optional()}),_.Ry({slideId:_.Z_().uuid(),content:_.Z_().optional(),duration:_.Rx().positive().optional(),transitionType:_.Z_().optional(),orderIndex:_.Rx().int().nonnegative().optional()}),_.Ry({email:_.Z_().email("Email inv\xe1lido"),password:_.Z_().min(6,"Senha deve ter pelo menos 6 caracteres")}),_.Ry({email:_.Z_().email("Email inv\xe1lido"),password:_.Z_().min(6,"Senha deve ter pelo menos 6 caracteres"),name:_.Z_().min(1,"Nome \xe9 obrigat\xf3rio").max(200)});let f=function(e={}){return m||(m=new p(e.ttl)),m}({ttl:3e4});async function g(e){let t=await (0,l.getServerSession)(u.L);if(!t?.user)return i.NextResponse.json({error:"Unauthorized"},{status:401});let r=e.url,a=f.get(r);if(a){let e=i.NextResponse.json(a);return e.headers.set("X-Cache","HIT"),e}let s=Object.fromEntries(e.nextUrl.searchParams.entries()),n=h.safeParse(s);if(!n.success)return i.NextResponse.json({error:"Invalid query parameters",details:n.error.flatten()},{status:400});let o=n.data,p=d.p.from("render_jobs").select("id, created_at, started_at, completed_at, status, error_message, render_settings, projects!inner(user_id, type)",{count:"exact"}).gte("created_at",(function(e){let t=Date.now(),r={"1h":36e5,"24h":864e5,"7d":6048e5,"30d":2592e6,"90d":7776e6};return new Date(t-(r[e]??r["24h"]))})(o.timeRange).toISOString()).order("created_at",{ascending:!1}).limit(5e3);o.userId&&(p=p.eq("projects.user_id",o.userId)),o.projectType&&(p=p.eq("projects.type",o.projectType)),"all"!==o.status&&(p=p.eq("status",o.status));let{data:m,error:_,count:g}=await p;if(_)return console.error("Supabase error while fetching render jobs:",_),i.NextResponse.json({error:"Failed to fetch render jobs"},{status:500});let I=m.map(e=>({id:e.id,created_at:e.created_at,started_at:e.started_at,completed_at:e.completed_at,status:e.status,error_message:e.error_message,render_settings:e.render_settings,user_id:e.projects?.user_id,project_type:e.projects?.type})),x=("number"==typeof g?g:I.length)>I.length||5e3===I.length,v=(0,c.qw)(I),y=(0,c.E6)(I),j=o.includePerformance?(0,c.x7)(I):void 0,b=o.includeErrors?(0,c.A_)(I):void 0,w=o.includeErrors?(0,c.cu)(I):void 0,Z={metadata:{generated_at:new Date().toISOString(),time_range:o.timeRange,filters:{userId:o.userId??null,projectType:o.projectType??null,status:o.status},row_count:I.length,truncated:x},basic_stats:v,queue_stats:y,...j&&{performance_metrics:j},...b&&{error_analysis:b},...w&&{error_categories:w}};f.set(r,Z);let q=i.NextResponse.json(Z);return q.headers.set("X-Cache","MISS"),q}let I=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/analytics/render-stats/route",pathname:"/api/analytics/render-stats",filename:"route",bundlePath:"app/api/analytics/render-stats/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\analytics\\render-stats\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:x,staticGenerationAsyncStorage:v,serverHooks:y}=I,j="/api/analytics/render-stats/route";function b(){return(0,o.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:v})}},12065:(e,t,r)=>{function a(e){let t=e.length,r=e.filter(e=>"completed"===e.status).length,a=e.filter(e=>"failed"===e.status).length,s=e.filter(e=>"completed"===e.status&&e.started_at&&e.completed_at).map(e=>{let t=new Date(e.started_at).getTime(),r=new Date(e.completed_at).getTime();return r>t?(r-t)/1e3:0}).filter(e=>e>0),n=s.reduce((e,t)=>e+t,0);return{total_renders:t,successful_renders:r,failed_renders:a,avg_render_time:Math.round(s.length?n/s.length:0),total_render_time:n,success_rate:t?Math.round(r/t*100):0}}function s(e){let t=e.filter(e=>"completed"===e.status&&e.started_at&&e.completed_at),r=t.map(e=>{let t=new Date(e.started_at).getTime(),r=new Date(e.completed_at).getTime();return r>t?(r-t)/1e3:0}).filter(e=>e>0),a=r.length?Math.min(...r):0,s=r.length?Math.max(...r):0,n=[...r].sort((e,t)=>e-t),o=e=>{if(!n.length)return 0;let t=Math.min(n.length-1,Math.floor(e*(n.length-1)));return n[t]},i={},l={};for(let e of t){let t=e.render_settings,r=t?.resolution??"unknown",a=t?.format??"unknown";i[r]=(i[r]||0)+1,l[a]=(l[a]||0)+1}return{fastest_render:a,slowest_render:s,most_common_resolution:Object.entries(i).sort((e,t)=>t[1]-e[1])[0]?.[0]||"N/A",most_common_format:Object.entries(l).sort((e,t)=>t[1]-e[1])[0]?.[0]||"N/A",p50_render_time:o(.5),p90_render_time:o(.9),p95_render_time:o(.95)}}function n(e,t=10){let r=e.filter(e=>"failed"===e.status&&e.error_message),a={};for(let e of r){let t=e.error_message,r=(t?.split(":")[0]||t||"unknown").trim();a[r]||(a[r]={error_type:r,count:0,last_occurrence:e.created_at}),a[r].count++,new Date(e.created_at)>new Date(a[r].last_occurrence)&&(a[r].last_occurrence=e.created_at)}return Object.values(a).sort((e,t)=>t.count-e.count).slice(0,t)}function o(e,t=10){let r=e.filter(e=>"failed"===e.status&&e.error_message),a={};for(let e of r){let t=e.error_message,r=function(e){if(!e)return"unknown";let t=e.toLowerCase();return t.includes("ffmpeg")?"ffmpeg":t.includes("network")||t.includes("fetch")||t.includes("dns")?"network":t.includes("s3")||t.includes("storage")||t.includes("bucket")?"storage":t.includes("permission")||t.includes("auth")?"auth":t.includes("memory")||t.includes("out of memory")?"resource":t.includes("validation")||t.includes("invalid")?"validation":t.includes("timeout")?"timeout":"unknown"}(t);a[r]||(a[r]={category:r,count:0,sample_errors:[]}),a[r].count++,a[r].sample_errors.length<3&&a[r].sample_errors.push(t.slice(0,200))}return Object.values(a).sort((e,t)=>t.count-e.count).slice(0,t)}function i(e){let t=e.filter(e=>["queued","pending"].includes(e.status)),r=e.filter(e=>"processing"===e.status),a=e.filter(e=>e.started_at).map(e=>{let t=new Date(e.created_at).getTime(),r=new Date(e.started_at).getTime();return r>t?(r-t)/1e3:0}).filter(e=>e>0),s=a.length?a.reduce((e,t)=>e+t,0)/a.length:0;return{current_queue_length:t.length,processing_jobs:r.length,avg_wait_time:Math.round(s),peak_queue_time:new Date().toISOString()}}r.d(t,{A_:()=>n,E6:()=>i,cu:()=>o,qw:()=>a,x7:()=>s})},95306:(e,t,r)=>{r.d(t,{L:()=>a});let a={providers:[],session:{strategy:"jwt"},callbacks:{}}},13936:(e,t,r)=>{r.d(t,{e:()=>o,getSupabaseForRequest:()=>l,p:()=>i});var a=r(67721),s=r(61657),n=r(71615);let o=()=>{let e=(0,n.cookies)();return(0,a.createServerClient)("https://ofhzrdiadxigrvmrhaiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ",{cookies:{get:t=>e.get(t)?.value,set(t,r,a){try{e.set({name:t,value:r,...a})}catch(e){}},remove(t,r){try{e.set({name:t,value:"",...r})}catch(e){}}}})},i=(0,s.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}});function l(e){let t=e.headers.get("authorization")||e.headers.get("Authorization");return t?(0,s.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maHpyZGlhZHhpZ3J2bXJoYWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTE3NjEsImV4cCI6MjA3NTI4Nzc2MX0.u-F5m9lvYc1lx9aA-MoTZqCAa83QHGVk8uTh-_KPfCQ",{global:{headers:{Authorization:t}},auth:{persistSession:!1,autoRefreshToken:!1}}):o()}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[8948,5972,1657,9702,5571,1585],()=>r(87046));module.exports=a})();