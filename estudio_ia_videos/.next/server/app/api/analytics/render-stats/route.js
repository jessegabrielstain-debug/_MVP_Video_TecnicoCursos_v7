"use strict";(()=>{var e={};e.id=8149,e.ids=[8149],e.modules={572934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},554580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},345869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},220399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},430517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},627790:e=>{e.exports=require("assert")},978893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},532615:e=>{e.exports=require("http")},735240:e=>{e.exports=require("https")},986624:e=>{e.exports=require("querystring")},917360:e=>{e.exports=require("url")},521764:e=>{e.exports=require("util")},671568:e=>{e.exports=require("zlib")},477590:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>v,requestAsyncStorage:()=>f,routeModule:()=>_,serverHooks:()=>x,staticGenerationAsyncStorage:()=>g});var n={};r.r(n),r.d(n,{GET:()=>h});var s=r(349303),a=r(88716),o=r(60670),i=r(387070),l=r(95715),u=r(691585);class c{constructor(e=3e4){this.cache=new Map,this.cleanupInterval=null,this.defaultTtl=e,this.cleanupInterval=setInterval(()=>this.cleanup(),6e4)}get(e){let t=this.cache.get(e);return t?t.expiresAt>0&&Date.now()>t.expiresAt?(this.cache.delete(e),null):t.value:null}set(e,t,r){let n="number"==typeof r?r:this.defaultTtl;this.cache.set(e,{value:t,expiresAt:n>0?Date.now()+n:0})}setex(e,t,r){this.set(e,r,1e3*t)}del(e){this.cache.delete(e)}clear(){this.cache.clear()}disconnect(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null),this.cache.clear()}cleanup(){let e=Date.now();for(let[t,r]of this.cache.entries())r.expiresAt>0&&e>r.expiresAt&&this.cache.delete(t)}}let d=null;(function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e})(),function(){var e=Error("Cannot find module '@/lib/supabase/admin'");throw e.code="MODULE_NOT_FOUND",e}();let p=u.Ry({timeRange:u.Km(["1h","24h","7d","30d","90d"]).default("24h"),userId:u.Z_().min(1).optional(),projectType:u.Z_().min(1).optional(),status:u.Km(["all","completed","failed","processing","pending"]).default("all"),includeErrors:u.Km(["true","false"]).default("true").transform(e=>"true"===e),includePerformance:u.Km(["true","false"]).default("true").transform(e=>"true"===e)}),m=function(e={}){return d||(d=new c(e.ttl)),d}({ttl:3e4});async function h(e){let t=await (0,l.getServerSession)(Object(function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e}()));if(!t?.user)return i.NextResponse.json({error:"Unauthorized"},{status:401});let r=e.url,n=m.get(r);if(n){let e=i.NextResponse.json(n);return e.headers.set("X-Cache","HIT"),e}let s=Object.fromEntries(e.nextUrl.searchParams.entries()),a=p.safeParse(s);if(!a.success)return i.NextResponse.json({error:"Invalid query parameters",details:a.error.flatten()},{status:400});let o=a.data,u=Object(function(){var e=Error("Cannot find module '@/lib/supabase/admin'");throw e.code="MODULE_NOT_FOUND",e}())().from("render_jobs").select("id, created_at, started_at, completed_at, status, error_message, render_settings, user_id, project_type",{count:"exact"}).gte("created_at",(function(e){let t=Date.now(),r={"1h":36e5,"24h":864e5,"7d":6048e5,"30d":2592e6,"90d":7776e6};return new Date(t-(r[e]??r["24h"]))})(o.timeRange).toISOString()).order("created_at",{ascending:!1}).limit(5e3);o.userId&&(u=u.eq("user_id",o.userId)),o.projectType&&(u=u.eq("project_type",o.projectType)),"all"!==o.status&&(u=u.eq("status",o.status));let{data:c,error:d,count:h}=await u;if(d)return console.error("Supabase error while fetching render jobs:",d),i.NextResponse.json({error:"Failed to fetch render jobs"},{status:500});let _=c??[],f=("number"==typeof h?h:_.length)>_.length||5e3===_.length,g=function(e){let t=e.length,r=e.filter(e=>"completed"===e.status).length,n=e.filter(e=>"failed"===e.status).length,s=e.filter(e=>"completed"===e.status&&e.started_at&&e.completed_at).map(e=>{let t=new Date(e.started_at).getTime(),r=new Date(e.completed_at).getTime();return r>t?(r-t)/1e3:0}).filter(e=>e>0),a=s.reduce((e,t)=>e+t,0);return{total_renders:t,successful_renders:r,failed_renders:n,avg_render_time:Math.round(s.length?a/s.length:0),total_render_time:a,success_rate:t?Math.round(r/t*100):0}}(_),x=function(e){let t=e.filter(e=>"queued"===e.status),r=e.filter(e=>"processing"===e.status),n=e.filter(e=>e.started_at).map(e=>{let t=new Date(e.created_at).getTime(),r=new Date(e.started_at).getTime();return r>t?(r-t)/1e3:0}).filter(e=>e>0),s=n.length?n.reduce((e,t)=>e+t,0)/n.length:0;return{current_queue_length:t.length,processing_jobs:r.length,avg_wait_time:Math.round(s),peak_queue_time:new Date().toISOString()}}(_),w=o.includePerformance?function(e){let t=e.filter(e=>"completed"===e.status&&e.started_at&&e.completed_at),r=t.map(e=>{let t=new Date(e.started_at).getTime(),r=new Date(e.completed_at).getTime();return r>t?(r-t)/1e3:0}).filter(e=>e>0),n=r.length?Math.min(...r):0,s=r.length?Math.max(...r):0,a=[...r].sort((e,t)=>e-t),o=e=>{if(!a.length)return 0;let t=Math.min(a.length-1,Math.floor(e*(a.length-1)));return a[t]},i={},l={};for(let e of t){let t=e.render_settings,r=t?.resolution??"unknown",n=t?.format??"unknown";i[r]=(i[r]||0)+1,l[n]=(l[n]||0)+1}return{fastest_render:n,slowest_render:s,most_common_resolution:Object.entries(i).sort((e,t)=>t[1]-e[1])[0]?.[0]||"N/A",most_common_format:Object.entries(l).sort((e,t)=>t[1]-e[1])[0]?.[0]||"N/A",p50_render_time:o(.5),p90_render_time:o(.9),p95_render_time:o(.95)}}(_):void 0,v=o.includeErrors?function(e,t=10){let r=e.filter(e=>"failed"===e.status&&e.error_message),n={};for(let e of r){let t=e.error_message,r=(t?.split(":")[0]||t||"unknown").trim();n[r]||(n[r]={error_type:r,count:0,last_occurrence:e.created_at}),n[r].count++,new Date(e.created_at)>new Date(n[r].last_occurrence)&&(n[r].last_occurrence=e.created_at)}return Object.values(n).sort((e,t)=>t.count-e.count).slice(0,t)}(_):void 0,j=o.includeErrors?function(e,t=10){let r=e.filter(e=>"failed"===e.status&&e.error_message),n={};for(let e of r){let t=e.error_message,r=function(e){if(!e)return"unknown";let t=e.toLowerCase();return t.includes("ffmpeg")?"ffmpeg":t.includes("network")||t.includes("fetch")||t.includes("dns")?"network":t.includes("s3")||t.includes("storage")||t.includes("bucket")?"storage":t.includes("permission")||t.includes("auth")?"auth":t.includes("memory")||t.includes("out of memory")?"resource":t.includes("validation")||t.includes("invalid")?"validation":t.includes("timeout")?"timeout":"unknown"}(t);n[r]||(n[r]={category:r,count:0,sample_errors:[]}),n[r].count++,n[r].sample_errors.length<3&&n[r].sample_errors.push(t.slice(0,200))}return Object.values(n).sort((e,t)=>t.count-e.count).slice(0,t)}(_):void 0,y={metadata:{generated_at:new Date().toISOString(),time_range:o.timeRange,filters:{userId:o.userId??null,projectType:o.projectType??null,status:o.status},row_count:_.length,truncated:f},basic_stats:g,queue_stats:x,...w&&{performance_metrics:w},...v&&{error_analysis:v},...j&&{error_categories:j}};m.set(r,y);let q=i.NextResponse.json(y);return q.headers.set("X-Cache","MISS"),q}let _=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/analytics/render-stats/route",pathname:"/api/analytics/render-stats",filename:"route",bundlePath:"app/api/analytics/render-stats/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\analytics\\render-stats\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:f,staticGenerationAsyncStorage:g,serverHooks:x}=_,w="/api/analytics/render-stats/route";function v(){return(0,o.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:g})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[8948,5972,5715,1585],()=>r(477590));module.exports=n})();