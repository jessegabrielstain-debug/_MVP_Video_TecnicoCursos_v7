"use strict";(()=>{var e={};e.id=6280,e.ids=[6280],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},94291:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>w,patchFetch:()=>h,requestAsyncStorage:()=>v,routeModule:()=>m,serverHooks:()=>_,staticGenerationAsyncStorage:()=>y});var s={};a.r(s),a.d(s,{GET:()=>g,POST:()=>d});var r=a(49303),n=a(88716),i=a(60670),o=a(87070),c=a(61657);let l={DAY:"day"};class u{constructor(){let e=process.env.SUPABASE_SERVICE_ROLE_KEY;this.supabase=(0,c.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co",e)}static getInstance(){return u.instance||(u.instance=new u),u.instance}async trackEvent(e,t,a){let s={event_type:e,event_data:{properties:t,metadata:a},created_at:new Date().toISOString()},{data:r,error:n}=await this.supabase.from("analytics_events").insert(s).select().single();if(n)throw Error(`Failed to track event: ${n.message}`);return{id:r.id,type:r.event_type,userId:r.user_id,timestamp:new Date(r.created_at),properties:r.event_data?.properties,metadata:r.event_data?.metadata}}async trackEventsBatch(e){let t=e.map(e=>({event_type:e.type,event_data:{properties:e.properties,metadata:e.metadata},created_at:new Date().toISOString()})),{data:a,error:s}=await this.supabase.from("analytics_events").insert(t).select();if(s)throw Error(`Failed to track events batch: ${s.message}`);return a.map(e=>({id:e.id,type:e.event_type,userId:e.user_id,timestamp:new Date(e.created_at),properties:e.event_data?.properties,metadata:e.event_data?.metadata}))}async getEvents(e){let t=this.supabase.from("analytics_events").select("*");e.types&&(t=t.in("event_type",e.types)),e.startDate&&(t=t.gte("created_at",e.startDate.toISOString())),e.endDate&&(t=t.lte("created_at",e.endDate.toISOString())),e.userId&&(t=t.eq("user_id",e.userId)),e.limit&&(t=t.limit(e.limit));let{data:a,error:s}=await t;if(s)throw Error(`Failed to get events: ${s.message}`);return a.map(e=>({id:e.id,type:e.event_type,userId:e.user_id,timestamp:new Date(e.created_at),properties:e.event_data?.properties,metadata:e.event_data?.metadata}))}async getMetrics(e){let t=this.supabase.from("analytics_events").select("*").eq("event_type","metric_record");e.startDate&&(t=t.gte("created_at",e.startDate.toISOString())),e.endDate&&(t=t.lte("created_at",e.endDate.toISOString()));let{data:a,error:s}=await t;return s?[]:a.map(e=>({value:e.event_data?.value||0,timestamp:new Date(e.created_at),labels:e.event_data?.labels}))}async createConversionFunnel(e,t,a,s){let r=[],n=0;for(let e=0;e<t.length;e++){let i=t[e],{count:o,error:c}=await this.supabase.from("analytics_events").select("*",{count:"exact",head:!0}).eq("event_type",i.event).gte("created_at",a.toISOString()).lte("created_at",s.toISOString()),l=o||0,u=0===e?100:n>0?l/n*100:0;r.push({step:i.name,count:l,conversionRate:Math.round(100*u)/100}),n=l}return{name:e,steps:t,results:r}}async performCohortAnalysis(e,t,a,s,r){return{cohortPeriod:e,metric:t,cohorts:[],note:"Cohort analysis requires advanced SQL aggregation not yet implemented in MVP"}}async createABTest(e){let t={event_type:"ab_test_created",event_data:e,created_at:new Date().toISOString()};return await this.supabase.from("analytics_events").insert(t).select().single(),{name:e.name,variants:e.variants.map(e=>({name:e,conversions:0,total:0,rate:0})),winner:void 0}}async getABTestResults(e){return{name:e,variants:[],winner:void 0}}async calculateUsageStats(e,t,a){let{data:s,error:r}=await this.supabase.from("analytics_events").select("event_type").gte("created_at",t.toISOString()).lte("created_at",a.toISOString());if(r)throw Error(`Failed to calculate usage stats: ${r.message}`);let n={};return s.forEach(e=>{n[e.event_type]=(n[e.event_type]||0)+1}),n}async calculatePerformanceStats(e,t,a){let{data:s,error:r}=await this.supabase.from("render_jobs").select("status, duration_ms").gte("created_at",t.toISOString()).lte("created_at",a.toISOString());if(r)throw Error(`Failed to calculate performance stats: ${r.message}`);let n=s.length,i=s.filter(e=>"completed"===e.status),o=s.filter(e=>"failed"===e.status),c=i.reduce((e,t)=>e+(t.duration_ms||0),0)/(i.length||1);return{total_jobs:n,completed_jobs:i.length,failed_jobs:o.length,avg_duration_ms:c}}defineMetric(e){}recordMetric(e,t,a){}getMetric(e){return[]}getAllMetrics(){return new Map}clearMetrics(){}}u.getInstance();let p=u.getInstance();async function d(e){try{let t=new URL(e.url).pathname;if("/api/analytics/track"===t){let{type:t,properties:a,metadata:s}=await e.json();if(!t)return o.NextResponse.json({success:!1,error:"Tipo de evento \xe9 obrigat\xf3rio"},{status:400});let r=await p.trackEvent(t,a,s);return o.NextResponse.json({success:!0,event:{id:r.id,type:r.type,userId:r.userId,timestamp:r.timestamp}})}if("/api/analytics/track/batch"===t){let{events:t}=await e.json();if(!t||!Array.isArray(t))return o.NextResponse.json({success:!1,error:"Lista de eventos \xe9 obrigat\xf3ria"},{status:400});let a=await p.trackEventsBatch(t);return o.NextResponse.json({success:!0,count:a.length,events:a.map(e=>({id:e.id,type:e.type,userId:e.userId}))})}if("/api/analytics/funnel"===t){let{name:t,steps:a,startDate:s,endDate:r}=await e.json();if(!t||!a||!s||!r)return o.NextResponse.json({success:!1,error:"Par\xe2metros obrigat\xf3rios: name, steps, startDate, endDate"},{status:400});let n=await p.createConversionFunnel(t,a,new Date(s),new Date(r));return o.NextResponse.json({success:!0,funnel:n})}if("/api/analytics/cohort"===t){let{cohortPeriod:t,metric:a,startDate:s,endDate:r,periods:n}=await e.json();if(!t||!a||!s||!r)return o.NextResponse.json({success:!1,error:"Par\xe2metros obrigat\xf3rios: cohortPeriod, metric, startDate, endDate"},{status:400});let i=await p.performCohortAnalysis(t,a,new Date(s),new Date(r),n);return o.NextResponse.json({success:!0,analysis:i})}if("/api/analytics/abtest"===t){let t=await e.json();if(!t.name||!t.variants)return o.NextResponse.json({success:!1,error:"Par\xe2metros obrigat\xf3rios: name, variants"},{status:400});let a=await p.createABTest(t);return o.NextResponse.json({success:!0,test:a})}return o.NextResponse.json({success:!1,error:"Endpoint n\xe3o encontrado"},{status:404})}catch(e){return console.error("[Analytics API] Erro:",e),o.NextResponse.json({success:!1,error:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function g(e){try{let t=new URL(e.url),a=t.pathname,s=t.searchParams;if("/api/analytics/events"===a){let e={},t=s.get("types");t&&(e.types=t.split(","));let a=s.get("startDate");a&&(e.startDate=new Date(a));let r=s.get("endDate");r&&(e.endDate=new Date(r));let n=s.get("userId");n&&(e.userId=n);let i=s.get("limit");i&&(e.limit=parseInt(i));let c=await p.getEvents(e);return o.NextResponse.json({success:!0,count:c.length,events:c})}if("/api/analytics/metrics"===a){let e={},t=s.get("names");t&&(e.names=t.split(","));let a=s.get("categories");a&&(e.categories=a.split(","));let r=s.get("period");r&&(e.period=r);let n=s.get("startDate");n&&(e.startDate=new Date(n));let i=s.get("endDate");i&&(e.endDate=new Date(i));let c=await p.getMetrics(e);return o.NextResponse.json({success:!0,count:c.length,metrics:c})}if("/api/analytics/usage"===a){let e=s.get("period")||l.DAY,t=new Date(s.get("startDate")||Date.now()-2592e6),a=new Date(s.get("endDate")||Date.now()),r=await p.calculateUsageStats(e,t,a);return o.NextResponse.json({success:!0,stats:r})}if("/api/analytics/performance"===a){let e=s.get("period")||l.DAY,t=new Date(s.get("startDate")||Date.now()-2592e6),a=new Date(s.get("endDate")||Date.now()),r=await p.calculatePerformanceStats(e,t,a);return o.NextResponse.json({success:!0,stats:r})}if(a.startsWith("/api/analytics/abtest/")){let e=a.split("/").pop();if(!e)return o.NextResponse.json({success:!1,error:"Nome do teste \xe9 obrigat\xf3rio"},{status:400});let t=await p.getABTestResults(e);return o.NextResponse.json({success:!0,result:t})}return o.NextResponse.json({success:!1,error:"Endpoint n\xe3o encontrado"},{status:404})}catch(e){return console.error("[Analytics API] Erro:",e),o.NextResponse.json({success:!1,error:e instanceof Error?e.message:"Unknown error"},{status:500})}}let m=new r.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/analytics/[[...slug]]/route",pathname:"/api/analytics/[[...slug]]",filename:"route",bundlePath:"app/api/analytics/[[...slug]]/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\analytics\\[[...slug]]\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:v,staticGenerationAsyncStorage:y,serverHooks:_}=m,w="/api/analytics/[[...slug]]/route";function h(){return(0,i.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:y})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[8948,5972,1657],()=>a(94291));module.exports=s})();