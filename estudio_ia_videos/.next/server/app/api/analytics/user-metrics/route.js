(()=>{var e={};e.id=6350,e.ids=[6350],e.modules={150673:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=150673,e.exports=t},636372:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=636372,e.exports=t},367696:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=367696,e.exports=t},768626:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=768626,e.exports=t},572934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},554580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},345869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},220399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},430517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},627790:e=>{"use strict";e.exports=require("assert")},978893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},532615:e=>{"use strict";e.exports=require("http")},735240:e=>{"use strict";e.exports=require("https")},768621:e=>{"use strict";e.exports=require("punycode")},986624:e=>{"use strict";e.exports=require("querystring")},276162:e=>{"use strict";e.exports=require("stream")},917360:e=>{"use strict";e.exports=require("url")},521764:e=>{"use strict";e.exports=require("util")},671568:e=>{"use strict";e.exports=require("zlib")},513661:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>q,patchFetch:()=>O,requestAsyncStorage:()=>w,routeModule:()=>y,serverHooks:()=>x,staticGenerationAsyncStorage:()=>j});var s={};r.r(s),r.d(s,{GET:()=>v});var a=r(349303),o=r(88716),i=r(60670),n=r(387070),c=r(95715),u=r(577711),d=r(691585),l=r(326033);!function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e}();let p=d.Ry({timeRange:d.Km(["1h","24h","7d","30d","90d"]).default("24h"),userId:d.Z_().optional(),includeActivity:d.Z_().transform(e=>"true"===e).default("true"),includePatterns:d.Z_().transform(e=>"true"===e).default("false")});async function _(e,t){try{let{data:r,error:s}=await u.supabaseAdmin.from("projects").select("id, status, project_type, created_at, updated_at, metadata").eq("owner_id",e).gte("created_at",t.toISOString());if(s)throw s;let a=r?.length||0,o=r?.filter(e=>"completed"===e.status).length||0,i=r?.filter(e=>"active"===e.status).length||0,n=(r?.filter(e=>"completed"===e.status)||[]).map(e=>{let t=new Date(e.created_at).getTime();return(new Date(e.updated_at).getTime()-t)/864e5}),c=n.length>0?n.reduce((e,t)=>e+t,0)/n.length:0,d=r?.reduce((e,t)=>{let r=t.project_type||"unknown";return e[r]=(e[r]||0)+1,e},{})||{},l=Object.entries(d).map(([e,t])=>({type:e,count:t})).sort((e,t)=>t.count-e.count).slice(0,5);return{total_projects:a,completed_projects:o,active_projects:i,avg_project_duration:Math.round(100*c)/100,favorite_project_types:l}}catch(e){return console.error("Error getting user project stats:",e),{total_projects:0,completed_projects:0,active_projects:0,avg_project_duration:0,favorite_project_types:[]}}}async function m(e,t){try{let{data:r,error:s}=await u.supabaseAdmin.from("render_jobs").select("id, status, created_at, completed_at, render_time_seconds").eq("user_id",e).gte("created_at",t.toISOString());if(s)throw s;let a=(r||[]).filter(e=>"completed"===e.status);return{total_render_time:a.reduce((e,t)=>e+(t.render_time_seconds||0),0),completed_renders:a.length}}catch(e){return console.error("Error getting user render stats:",e),{total_render_time:0,completed_renders:0}}}async function g(e){try{let{data:t,error:r}=await u.supabaseAdmin.from("projects").select("id").eq("owner_id",e);if(r)throw r;let{data:s,error:a}=await u.supabaseAdmin.from("project_collaborators").select("project_id, role").eq("user_id",e);if(a)throw a;let{data:o,error:i}=await u.supabaseAdmin.from("project_collaborators").select("project_id").in("project_id",t?.map(e=>e.id)||[]);if(i)throw i;let n=new Set(o?.map(e=>e.project_id)||[]);return{owned_projects:t?.length||0,collaborated_projects:s?.length||0,shared_projects:n.size}}catch(e){return console.error("Error getting collaboration stats:",e),{owned_projects:0,collaborated_projects:0,shared_projects:0}}}async function f(e,t,r=20){try{let{data:s,error:a}=await u.supabaseAdmin.from("analytics_events").select("id, category, action, metadata, created_at, project_id").eq("user_id",e).gte("created_at",t.toISOString()).order("created_at",{ascending:!1}).limit(r);if(a)throw a;return s?.map(e=>({id:e.id,type:e.category,action:e.action,timestamp:e.created_at,metadata:e.metadata,project_id:e.project_id}))||[]}catch(e){return console.error("Error getting recent activity:",e),[]}}async function h(e,t){try{let{data:r,error:s}=await u.supabaseAdmin.from("analytics_events").select("created_at, action, category").eq("user_id",e).gte("created_at",t.toISOString());if(s)throw s;let a=Array(24).fill(0);r?.forEach(e=>{let t=new Date(e.created_at).getHours();a[t]++});let o=a.map((e,t)=>({hour:t,count:e})).sort((e,t)=>t.count-e.count).slice(0,3).map(e=>e.hour),i=r?.reduce((e,t)=>{let r=`${t.category}_${t.action}`;return e[r]=(e[r]||0)+1,e},{})||{},n=Object.entries(i).sort(([,e],[,t])=>t-e).slice(0,5).map(([e])=>e),c=[];if(r&&r.length>1){let e=[...r].sort((e,t)=>new Date(e.created_at).getTime()-new Date(t.created_at).getTime()),t=new Date(e[0].created_at).getTime(),s=t;for(let r=1;r<e.length;r++){let a=new Date(e[r].created_at).getTime();(a-s)/1e3>1800&&(c.push((s-t)/1e3),t=a),s=a}c.push((s-t)/1e3)}let d=c.length>0?Math.round(c.reduce((e,t)=>e+t,0)/c.length):0;return{most_active_hours:o,preferred_features:n,avg_session_duration:d}}catch(e){return console.error("Error getting usage patterns:",e),{most_active_hours:[],preferred_features:[],avg_session_duration:0}}}async function v(e){try{let t=await (0,c.getServerSession)(Object(function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e}()));if(!t?.user)return n.NextResponse.json({success:!1,error:"Authentication required"},{status:401});let{searchParams:r}=new URL(e.url),s={timeRange:r.get("timeRange")||"24h",userId:r.get("userId"),includeActivity:r.get("includeActivity")||"true",includePatterns:r.get("includePatterns")||"false"},a=p.parse(s),o=t.user.id;if(a.userId&&a.userId!==t.user.id){let{data:e,error:r}=await u.OQ.from("users").select("role").eq("id",t.user.id).single();if(r||e?.role!=="admin")return n.NextResponse.json({success:!1,error:"Admin access required to view other user metrics"},{status:403});o=a.userId}let i=function(e){let t=new Date,r={"1h":new Date(t.getTime()-36e5),"24h":new Date(t.getTime()-864e5),"7d":new Date(t.getTime()-6048e5),"30d":new Date(t.getTime()-2592e6),"90d":new Date(t.getTime()-7776e6)};return r[e]||r["24h"]}(a.timeRange),[d,l,v,y,w]=await Promise.all([_(o,i),m(o,i),g(o),a.includeActivity?f(o,i):[],a.includePatterns?h(o,i):null]),j={...d,...l,collaboration_stats:v,...a.includeActivity&&{recent_activity:y},...a.includePatterns&&w&&{usage_patterns:w}};return n.NextResponse.json({success:!0,data:j,metadata:{userId:o,timeRange:a.timeRange,generatedAt:new Date().toISOString(),includeActivity:a.includeActivity,includePatterns:a.includePatterns}})}catch(e){if(console.error("User metrics API error:",e),e instanceof l.jm)return n.NextResponse.json({success:!1,error:"Invalid query parameters",details:e.errors},{status:400});return n.NextResponse.json({success:!1,error:"Failed to fetch user metrics",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}let y=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/analytics/user-metrics/route",pathname:"/api/analytics/user-metrics",filename:"route",bundlePath:"app/api/analytics/user-metrics/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\analytics\\user-metrics\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:w,staticGenerationAsyncStorage:j,serverHooks:x}=y,q="/api/analytics/user-metrics/route";function O(){return(0,i.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:j})}},577711:(e,t,r)=>{"use strict";r.d(t,{OQ:()=>i});var s=r(366763);let a=process.env.NEXT_PUBLIC_SUPABASE_URL,o=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;if(!a||!o)throw Error("Faltam vari\xe1veis de ambiente do Supabase. Verifique o arquivo .env");let i=(0,s.createClient)(a,o,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0},realtime:{params:{eventsPerSecond:10}}})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972,5715,6763,1585],()=>r(513661));module.exports=s})();