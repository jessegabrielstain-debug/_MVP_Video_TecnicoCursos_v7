"use strict";(()=>{var e={};e.id=8341,e.ids=[8341],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},87561:e=>{e.exports=require("node:fs")},69090:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>S,requestAsyncStorage:()=>h,routeModule:()=>g,serverHooks:()=>x,staticGenerationAsyncStorage:()=>k});var i={};r.r(i),r.d(i,{POST:()=>f});var o=r(49303),s=r(88716),a=r(60670),n=r(87070),l=r(99963),u=r(92048),d=r(55315),c=r.n(d);let p=c().join(process.cwd(),"uploads","temp"),m=c().join(process.cwd(),"uploads","metadata");async function _(){try{await u.promises.mkdir(p,{recursive:!0}),await u.promises.mkdir(m,{recursive:!0})}catch(e){console.error("Error creating directories:",e)}}let w=(0,l.H2)(l.wS.upload);async function f(e){return w(e,async e=>{await _();try{let{uploadId:t,filename:r,totalSize:i,chunks:o}=await e.json();if(!t||!r||!i||!o)return n.NextResponse.json({error:"Missing required fields"},{status:400});let s=c().join(m,`${t}.json`),a=[];try{let e=await u.promises.readFile(s,"utf-8");a=JSON.parse(e).uploadedChunks||[];let r=[];for(let e of a){let i=c().join(p,`${t}_chunk_${e}`);try{await u.promises.access(i),r.push(e)}catch{console.warn(`Chunk ${e} for upload ${t} not found`)}}a=r}catch{let e={uploadId:t,filename:r,totalSize:i,totalChunks:o.length,uploadedChunks:[],createdAt:new Date().toISOString(),lastUpdated:new Date().toISOString()};await u.promises.writeFile(s,JSON.stringify(e,null,2))}return n.NextResponse.json({uploadId:t,uploadedChunks:a,totalChunks:o.length,resumable:a.length>0})}catch(e){return console.error("Upload status error:",e),n.NextResponse.json({error:"Internal server error"},{status:500})}})}let g=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/upload/status/route",pathname:"/api/upload/status",filename:"route",bundlePath:"app/api/upload/status/route"},resolvedPagePath:"C:\\xampp\\htdocs\\_MVP_Video_TecnicoCursos_v7\\estudio_ia_videos\\app\\api\\upload\\status\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:h,staticGenerationAsyncStorage:k,serverHooks:x}=g,y="/api/upload/status/route";function S(){return(0,a.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:k})}},99963:(e,t,r)=>{r.d(t,{H2:()=>s,wS:()=>a});var i=r(87070),o=r(5213);function s(e){let{limit:t,windowMs:r,message:s="Muitas requisi\xe7\xf5es. Tente novamente mais tarde.",keyGenerator:a=e=>`ip:${function(e){let t=e.headers.get("x-forwarded-for");if(t)return t.split(",")[0].trim();let r=e.headers.get("cf-connecting-ip");return r?r:e.headers.get("x-real-ip")||"unknown"}(e)}`,skip:n}=e;return async function(e,l){if(n&&await n(e))return l(e);let u=a(e),d=(0,o.D)(u,t,r);if(!d.allowed)return i.NextResponse.json({error:s,retryAfter:d.retryAfterSec},{status:429,headers:{"Retry-After":d.retryAfterSec.toString(),"X-RateLimit-Limit":t.toString(),"X-RateLimit-Reset":new Date(Date.now()+1e3*d.retryAfterSec).toISOString()}});let c=await l(e);return c.headers.set("X-RateLimit-Limit",t.toString()),c.headers.set("X-RateLimit-Remaining",(t-(d.retryAfterSec||0)).toString()),c}}let a={authenticated:{limit:100,windowMs:6e4,message:"Limite de requisi\xe7\xf5es excedido. Aguarde 1 minuto."},anonymous:{limit:20,windowMs:6e4,message:"Limite de requisi\xe7\xf5es excedido para usu\xe1rios n\xe3o autenticados."},upload:{limit:10,windowMs:36e5,message:"Limite de uploads excedido. Aguarde 1 hora."},render:{limit:5,windowMs:36e5,message:"Limite de renderiza\xe7\xf5es excedido. Aguarde 1 hora."},public:{limit:50,windowMs:6e4,message:"Limite de requisi\xe7\xf5es para API p\xfablica excedido."},webhook:{limit:100,windowMs:6e4,message:"Limite de webhooks excedido."}}},5213:(e,t,r)=>{r.d(t,{D:()=>a,U:()=>n});var i=r(87561);let o=e=>{let t=process.env.RATE_LIMIT_DEBUG_LOG;if(t)try{(0,i.appendFileSync)(t,`${JSON.stringify({ts:Date.now(),...e})}
`,{encoding:"utf-8"})}catch(e){"true"===process.env.DEBUG_RATE_LIMIT&&console.error("[rate-limit] debug log failed",e)}},s=()=>{let e=globalThis.process;if(e)return e.__app_rate_limit_store__||(e.__app_rate_limit_store__=new Map),e.__app_rate_limit_store__;let t=globalThis;return t.__app_rate_limit_store__||(t.__app_rate_limit_store__=new Map),t.__app_rate_limit_store__};function a(e,t,r){let i=s(),a=Date.now(),n=i.get(e),l=n?a-n.lastRequest:0;if(!n||l>=r&&a>=(n.blockedUntil||0))return i.set(e,{windowStart:a,lastRequest:a,count:1,blockedUntil:0}),"true"===process.env.DEBUG_RATE_LIMIT&&console.info("[rate-limit] reset",{key:e,limit:t,windowMs:r,idle:l}),o({type:"reset",key:e,limit:t,windowMs:r,idle:l}),{allowed:!0,retryAfterSec:0};if((n=i.get(e)).blockedUntil&&a<n.blockedUntil){let r=Math.max(0,Math.ceil((n.blockedUntil-a)/1e3));return"true"===process.env.DEBUG_RATE_LIMIT&&console.info("[rate-limit] still-blocked",{key:e,retryAfterSec:r}),o({type:"blocked",key:e,count:n.count,limit:t,retryAfterSec:r}),n.lastRequest=a,{allowed:!1,retryAfterSec:r}}if(n.count>=t){n.blockedUntil=n.windowStart+r,n.blockedUntil<=a&&(n.blockedUntil=a+r);let i=Math.max(0,Math.ceil((n.blockedUntil-a)/1e3));return"true"===process.env.DEBUG_RATE_LIMIT&&console.info("[rate-limit] blocked",{key:e,count:n.count,limit:t,retryAfterSec:i}),o({type:"blocked",key:e,count:n.count,limit:t,retryAfterSec:i}),n.lastRequest=a,{allowed:!1,retryAfterSec:i}}return n.count+=1,n.lastRequest=a,"true"===process.env.DEBUG_RATE_LIMIT&&console.info("[rate-limit] allowed",{key:e,count:n.count,limit:t,idle:l}),o({type:"allowed",key:e,count:n.count,limit:t,idle:l}),{allowed:!0,retryAfterSec:0}}function n(e){return s().get(e)}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[8948,5972],()=>r(69090));module.exports=i})();