"use strict";exports.id=8582,exports.ids=[8582],exports.modules={16428:(e,t,o)=>{o.d(t,{t:()=>i});var r=o(61657),a=o(8803);let n=process.env.SUPABASE_SERVICE_ROLE_KEY,l=(0,r.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co",n);async function i(e,t,o){try{let{error:r}=await l.from("analytics_events").insert({user_id:t,event_type:e,event_data:o,created_at:new Date().toISOString()});r?a.kg.error("UsageTracker","Failed to track usage event",r):a.kg.info("UsageTracker","Usage event tracked",{eventType:e,userId:t})}catch(e){a.kg.error("UsageTracker","Exception tracking usage event",e)}}},8803:(e,t,o)=>{o.d(t,{kg:()=>s});var r=o(92048),a=o.n(r),n=o(55315),l=o.n(n);class i{constructor(){this.maxFileSize=10485760,this.maxFiles=5,this.logDir=l().join(process.cwd(),"logs"),a().existsSync(this.logDir)||a().mkdirSync(this.logDir,{recursive:!0}),this.currentLogFile=l().join(this.logDir,`app-${this.getDateString()}.log`)}static getInstance(){return i.instance||(i.instance=new i),i.instance}getDateString(){let e=new Date;return`${e.getFullYear()}${String(e.getMonth()+1).padStart(2,"0")}${String(e.getDate()).padStart(2,"0")}`}getTimestamp(){return new Date().toISOString()}formatConsole(e){let t={DEBUG:"\x1b[36m",INFO:"\x1b[37m",WARN:"\x1b[33m",ERROR:"\x1b[31m",FATAL:"\x1b[35m",RESET:"\x1b[0m"},o=t[e.level],r={DEBUG:"\uD83D\uDD0D",INFO:"â„¹ï¸",WARN:"âš ï¸",ERROR:"âŒ",FATAL:"\uD83D\uDC80"}[e.level],a=`${o}[${e.timestamp}] ${r} ${e.level} [${e.component}] ${e.message}${t.RESET}`;return e.data&&(a+=`
${o}   Data: ${JSON.stringify(e.data,null,2)}${t.RESET}`),e.stack&&(a+=`
${o}   Stack: ${e.stack}${t.RESET}`),a}writeToFile(e){try{this.rotateIfNeeded();let t=JSON.stringify(e)+"\n";a().appendFileSync(this.currentLogFile,t,"utf-8")}catch(e){console.error("Erro ao escrever log:",e)}}rotateIfNeeded(){try{if(a().existsSync(this.currentLogFile)&&a().statSync(this.currentLogFile).size>=this.maxFileSize){let e=Date.now(),t=this.currentLogFile.replace(".log",`-${e}.log`);a().renameSync(this.currentLogFile,t),this.cleanOldLogs()}}catch(e){console.error("Erro ao rotacionar logs:",e)}}cleanOldLogs(){try{let e=a().readdirSync(this.logDir).filter(e=>e.endsWith(".log")).map(e=>({name:e,path:l().join(this.logDir,e),time:a().statSync(l().join(this.logDir,e)).mtime.getTime()})).sort((e,t)=>t.time-e.time);e.length>this.maxFiles&&e.slice(this.maxFiles).forEach(e=>{a().unlinkSync(e.path)})}catch(e){console.error("Erro ao limpar logs antigos:",e)}}log(e,t,o,r,a){let n={timestamp:this.getTimestamp(),level:e,component:t,message:o,data:r};a&&(n.stack=a.stack),this.writeToFile(n)}debug(e,t,o){this.log("DEBUG",e,t,o)}info(e,t,o){this.log("INFO",e,t,o)}warn(e,t,o){this.log("WARN",e,t,o)}error(e,t,o,r){this.log("ERROR",e,t,r,o)}fatal(e,t,o,r){this.log("FATAL",e,t,r,o)}analyzeLogs(e){let t=e||this.currentLogFile;if(!a().existsSync(t))throw Error(`Arquivo de log n\xe3o encontrado: ${t}`);let o=a().readFileSync(t,"utf-8").split("\n").filter(e=>e.trim()).map(e=>{try{return JSON.parse(e)}catch{return null}}).filter(e=>null!==e),r={totalLogs:o.length,byLevel:{DEBUG:o.filter(e=>"DEBUG"===e.level).length,INFO:o.filter(e=>"INFO"===e.level).length,WARN:o.filter(e=>"WARN"===e.level).length,ERROR:o.filter(e=>"ERROR"===e.level).length,FATAL:o.filter(e=>"FATAL"===e.level).length},byComponent:{},errors:o.filter(e=>"ERROR"===e.level||"FATAL"===e.level),warnings:o.filter(e=>"WARN"===e.level),timeRange:{start:o[0]?.timestamp||"",end:o[o.length-1]?.timestamp||""}};return o.forEach(e=>{r.byComponent[e.component]||(r.byComponent[e.component]=0),r.byComponent[e.component]++}),r}searchLogs(e,t,o,r){let n=r||this.currentLogFile;return a().existsSync(n)?a().readFileSync(n,"utf-8").split("\n").filter(e=>e.trim()).map(e=>{try{return JSON.parse(e)}catch{return null}}).filter(e=>null!==e).filter(r=>(!t||r.level===t)&&(!o||r.component===o)&&(!e||JSON.stringify(r).toLowerCase().includes(e.toLowerCase()))):[]}printAnalysis(e){console.log("\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"),console.log("â•‘                    \uD83D\uDCCA AN\xc1LISE DE LOGS                            â•‘"),console.log("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n"),console.log(`ðŸ“‹ Total de Logs: ${e.totalLogs}`),console.log(`â° Per\xedodo: ${e.timeRange.start} â†’ ${e.timeRange.end}
`),console.log("\uD83D\uDCCA Por N\xedvel:"),console.log(`   ðŸ” DEBUG: ${e.byLevel.DEBUG}`),console.log(`   â„¹ï¸  INFO:  ${e.byLevel.INFO}`),console.log(`   âš ï¸  WARN:  ${e.byLevel.WARN}`),console.log(`   âŒ ERROR: ${e.byLevel.ERROR}`),console.log(`   ðŸ’€ FATAL: ${e.byLevel.FATAL}
`),console.log("\uD83D\uDCE6 Por Componente:"),Object.entries(e.byComponent).sort(([,e],[,t])=>t-e).forEach(([e,t])=>{console.log(`   - ${e}: ${t}`)}),e.errors.length>0&&(console.log(`
âŒ Erros Recentes (${e.errors.length}):`),e.errors.slice(-5).forEach(e=>{console.log(`   [${e.timestamp}] ${e.component}: ${e.message}`)})),e.warnings.length>0&&(console.log(`
âš ï¸  Avisos Recentes (${e.warnings.length}):`),e.warnings.slice(-5).forEach(e=>{console.log(`   [${e.timestamp}] ${e.component}: ${e.message}`)})),console.log("\n")}getLogFiles(){return a().readdirSync(this.logDir).filter(e=>e.endsWith(".log")).map(e=>l().join(this.logDir,e))}clearLogs(){let e=this.getLogFiles();e.forEach(e=>a().unlinkSync(e)),console.log(`âœ… ${e.length} arquivos de log removidos`)}}let s=i.getInstance()},68582:(e,t,o)=>{o.d(t,{PY:()=>m,T9:()=>u,wS:()=>d});var r=o(86394),a=o(8803),n=o(61657),l=o(16428);let i=process.env.ELEVENLABS_API_KEY,s="https://ofhzrdiadxigrvmrhaiz.supabase.co",c=process.env.SUPABASE_SERVICE_ROLE_KEY;i||a.kg.warn("ElevenLabsService","A chave da API da ElevenLabs (ELEVENLABS_API_KEY) n\xe3o est\xe1 configurada. O servi\xe7o de TTS n\xe3o funcionar\xe1."),s&&c||a.kg.warn("ElevenLabsService","Credenciais do Supabase n\xe3o configuradas. Upload de \xe1udio n\xe3o funcionar\xe1.");let g=new r.ElevenLabsClient({apiKey:i}),h=s&&c?(0,n.eI)(s,c):null;async function u(e,t="21m00Tcm4TlvDq8ikWAM",o="eleven_multilingual_v2"){if(!i)throw Error("A API da ElevenLabs n\xe3o est\xe1 configurada.");try{a.kg.info("ElevenLabsService","Iniciando gera\xe7\xe3o de \xe1udio TTS com ElevenLabs.",{voiceId:t,modelId:o,textLength:e.length});let r=0,n=null;for(;r<3;)try{n=await g.generate({voice:t,model_id:o,text:e});break}catch(e){if(r++,a.kg.warn("ElevenLabsService",`Tentativa ${r} falhou.`,{error:e}),r>=3)throw e;await new Promise(e=>setTimeout(e,1e3*Math.pow(2,r)))}if(!n)throw Error("Falha ao obter stream de \xe1udio ap\xf3s tentativas.");let i=[];for await(let e of n)i.push(e);let s=Buffer.concat(i);return a.kg.info("ElevenLabsService","\xc1udio TTS gerado com sucesso.",{audioSize:s.length}),await (0,l.t)("tts_generated",null,{provider:"elevenlabs",details:{textLength:e.length,voiceId:t,modelId:o}}),s}catch(e){throw a.kg.error("ElevenLabsService","Falha ao gerar \xe1udio TTS com ElevenLabs.",e),Error("Falha na comunica\xe7\xe3o com a API da ElevenLabs.")}}async function d(e,t,o,r){if(!h)throw Error("Supabase n\xe3o est\xe1 configurado.");try{let n=await u(e,o,r),l=`audio/tts/${t}`,{data:i,error:s}=await h.storage.from("assets").upload(l,n,{contentType:"audio/mpeg",upsert:!0});if(s)throw a.kg.error("ElevenLabsService","Falha ao fazer upload de \xe1udio para o Storage.",s),s;let{data:c}=h.storage.from("assets").getPublicUrl(l);return a.kg.info("ElevenLabsService","\xc1udio TTS enviado com sucesso para o Storage.",{publicUrl:c.publicUrl}),c.publicUrl}catch(e){throw a.kg.error("ElevenLabsService","Falha ao gerar e enviar \xe1udio TTS.",e),e}}async function m(){if(!i)throw Error("A API da ElevenLabs n\xe3o est\xe1 configurada.");try{let e=await fetch("https://api.elevenlabs.io/v1/voices",{headers:{"xi-api-key":i}});if(!e.ok)throw Error(`Falha ao listar vozes: ${e.status}`);return(await e.json()).voices}catch(e){throw a.kg.error("ElevenLabsService","Falha ao listar vozes.",e),e}}}};