"use strict";exports.id=4053,exports.ids=[4053],exports.modules={64053:(e,t,a)=>{a.d(t,{b:()=>u});var r=a(37470),n=a(10607),o=a(72721);class s{async render(e){try{let t={video_inputs:[{character:{type:"avatar",avatar_id:e.avatarId,avatar_style:"normal"},voice:e.audioUrl?{type:"audio",audio_url:e.audioUrl}:{type:"text",input_text:e.text||"Hello",voice_id:e.voiceId||"e0cc82c22f414c95b1f25696c732f058"},background:{type:"color",value:e.background||"#00FF00"}}],test:e.test??!1};return{jobId:await o.N.generateVideo(t),status:"pending"}}catch(e){throw console.error("HeyGen Render Error:",e),e}}async checkStatus(e){let t=await o.N.checkStatus(e);return{jobId:t.video_id,status:t.status,videoUrl:t.video_url}}}new s;let i={createSession:async(e={})=>{let t=process.env.AUDIO2FACE_API_URL;if(!t)return console.warn("⚠️ AUDIO2FACE_API_URL not set, using mock session"),`session_${Date.now()}`;try{let a=await fetch(`${t}/sessions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok)throw Error(`Failed to create session: ${a.statusText}`);return(await a.json()).sessionId}catch(e){throw console.error("Error creating Audio2Face session:",e),e}},processAudio:async(e,t,a={})=>{console.log("DEBUG: processAudio called with audio length:",t.byteLength);let r=process.env.AUDIO2FACE_API_URL;if(0===t.byteLength)return{success:!1,error:"Audio buffer is empty"};if(t.byteLength<200)return{success:!1,error:"Audio input is too short for lip-sync processing"};if(!r){console.log("Mocked audio2FaceService.processAudio called for session:",e);let t=95;return"low"===a.quality&&(t=93.5),"high"===a.quality&&(t=98.5),{success:!0,accuracy:t,lipSyncData:[{timestampMs:0,phoneme:"X",intensity:.5,jawOpen:.6,mouthClose:.8},{timestampMs:100,phoneme:"A",intensity:.8,mouthFunnel:.7,mouthPucker:.6},{timestampMs:200,phoneme:"B",intensity:.6,mouthLeft:.5,mouthRight:.5},{timestampMs:300,phoneme:"C",intensity:.5,mouthRollLower:.5},{timestampMs:400,phoneme:"D",intensity:.5,tongueOut:.4},{timestampMs:500,phoneme:"E",intensity:.5,mouthSmile:.6},{timestampMs:600,phoneme:"F",intensity:.5,mouthShrugUpper:.5}],metadata:{frameRate:a.frameRate??60,totalFrames:100,audioLength:a.audioLengthMs?Math.round(a.audioLengthMs/1e3):void 0,audioLengthMs:a.audioLengthMs},qualityMetrics:a.includeMetrics?{phonemeAccuracy:92,temporalConsistency:88,visualRealism:85}:void 0}}try{let n=new FormData,o=t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength),s=new Blob([o],{type:"audio/wav"});n.append("audio",s,"audio.wav"),n.append("options",JSON.stringify(a));let i=await fetch(`${r}/sessions/${e}/process`,{method:"POST",body:n});if(!i.ok){let e=await i.text();return{success:!1,error:`API Error: ${i.status} - ${e}`}}let l=await i.json();return{success:!0,accuracy:l.accuracy,lipSyncData:l.lipSyncData,metadata:l.metadata,qualityMetrics:l.qualityMetrics}}catch(e){return console.error("Error processing audio with Audio2Face:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}},destroySession:async e=>{let t=process.env.AUDIO2FACE_API_URL;if(!t)return console.log("Mocked audio2FaceService.destroySession called for session:",e),{success:!0};try{return{success:(await fetch(`${t}/sessions/${e}`,{method:"DELETE"})).ok}}catch(e){return console.error("Error destroying session:",e),{success:!1}}}};var l=a(36527);class c{static getInstance(){return c.instance||(c.instance=new c),c.instance}getAllAvatars(){return l.e4.getAll()}getAvatar(e){let t=l.e4.getById(e);if(!t)return;let a=t.metadata||{};return{...t,modelUrl:a.modelUrl,lipSyncAccuracy:a.lipSyncAccuracy||95,ageRange:a.age_range}}async render(e){switch(await this.selectEngine(e.engine)){case"heygen":let t=await this.heygen.render(e.config);return{type:"video",jobId:t.jobId,status:t.status,url:t.videoUrl};case"ue5":return{type:"frames",frames:(await this.ue5.render(e.config,e.duration)).frames};default:let a=Math.floor(30*e.duration);return{type:"frames",frames:await this.local.renderSequence(e.config,a)}}}async selectEngine(e){return"heygen"===e?"heygen":"ue5"===e?await this.ue5.isAvailable()?"ue5":"local":"local"===e?"local":await this.ue5.isAvailable()?"ue5":"local"}async checkHeyGenStatus(e){return this.heygen.checkStatus(e)}async generateLipSyncFrames(e,t,a){try{let e;let r=await i.createSession();if(t.startsWith("http")){let a=await fetch(t),r=await a.arrayBuffer();e=Buffer.from(r)}else console.warn("Invalid audio URL for lip sync, using mock data:",t),e=Buffer.from("mock-audio-data");let n=await i.processAudio(r,e,{audioLengthMs:1e3*a,includeMetrics:!0});if(await i.destroySession(r),n.success)return n.lipSyncData;{let e="error"in n?n.error:"Unknown error";return console.error("LipSync generation failed:",e),this.generateFallbackFrames(a)}}catch(e){return console.error("Error generating lip sync frames:",e),this.generateFallbackFrames(a)}}generateFallbackFrames(e){let t=[],a=Math.floor(30*e);for(let e=0;e<a;e++)t.push({timestampMs:e/30*1e3,phoneme:"X",intensity:.5*Math.random()+.2});return t}getLipSyncFrameAtTime(e,t){if(e&&0!==e.length)return e.reduce((e,a)=>Math.abs(a.timestampMs-t)<Math.abs(e.timestampMs-t)?a:e)}applyBlendShapes(e,t,a,r=1){e&&e.morphTargetDictionary&&e.morphTargetInfluences&&(Object.entries({jawOpen:t.jawOpen,mouthClose:t.mouthClose,mouthFunnel:t.mouthFunnel,mouthPucker:t.mouthPucker,mouthLeft:t.mouthLeft,mouthRight:t.mouthRight,mouthRollLower:t.mouthRollLower,tongueOut:t.tongueOut,mouthSmile:t.mouthSmile,mouthShrugUpper:t.mouthShrugUpper}).forEach(([t,a])=>{if(void 0!==a){let r=e.morphTargetDictionary[t];void 0!==r&&(e.morphTargetInfluences[r]=a)}}),a&&"neutral"!==a&&this.applyEmotion(e,a,r))}applyEmotion(e,t,a){let r={happy:{mouthSmileLeft:.7,mouthSmileRight:.7,cheekSquintLeft:.5,cheekSquintRight:.5,eyeSquintLeft:.3,eyeSquintRight:.3},sad:{mouthFrownLeft:.7,mouthFrownRight:.7,browInnerUp:.8,eyeSquintLeft:.2,eyeSquintRight:.2},angry:{browDownLeft:.9,browDownRight:.9,mouthFrownLeft:.5,mouthFrownRight:.5,noseSneerLeft:.7,noseSneerRight:.7},surprised:{browOuterUpLeft:.8,browOuterUpRight:.8,eyeWideLeft:.6,eyeWideRight:.6,jawOpen:.2},fear:{browInnerUp:.8,browOuterUpLeft:.3,browOuterUpRight:.3,eyeWideLeft:.7,eyeWideRight:.7,mouthStretchLeft:.4,mouthStretchRight:.4}}[t];r&&Object.entries(r).forEach(([t,r])=>{let n=e.morphTargetDictionary[t];if(void 0!==n){let t=e.morphTargetInfluences[n];e.morphTargetInfluences[n]=Math.min(1,t+r*a)}})}constructor(){this.ue5=new r.us,this.local=new n.t,this.heygen=new s}}let u=new c},36527:(e,t,a)=>{a.d(t,{e4:()=>o});let r=[{id:"heygen_anna_news",name:"Anna (News Anchor)",type:"video",engine:"heygen",gender:"female",description:"Apresentadora profissional ideal para comunicados oficiais e treinamentos corporativos.",style:"professional",tags:["news","formal","enterprise"],previewUrl:"https://files.heygen.ai/avatar/v3/3f2583200c854a0397f129e60b811467/full/preview_target.webp",metadata:{style:"professional",quality:"high",tags:["news","formal"]},heyGenConfig:{avatarId:"Anna_public_3_20240108"}},{id:"heygen_josh_casual",name:"Josh (Casual)",type:"video",engine:"heygen",gender:"male",description:"Especialista descontra\xeddo, \xf3timo para v\xeddeos educacionais e comunicados internos.",style:"casual",tags:["explainer","friendly"],previewUrl:"https://files.heygen.ai/avatar/v3/4a90e2/full/preview_target.webp",metadata:{style:"casual",quality:"high",tags:["explainer","friendly"]},heyGenConfig:{avatarId:"Josh_public_2_20240108"}},{id:"mh_male_01",name:"Professional Male (UE5)",type:"3d",engine:"ue5",gender:"male",description:"MetaHuman masculino para renders imersivos em ambientes industriais.",style:"professional",tags:["ue5","metahuman"],metadata:{style:"professional",age_range:"30-40",clothing_options:["suit","casual"],expression_presets:["neutral","smile","speak"]}},{id:"mh_female_01",name:"Professional Female (UE5)",type:"3d",engine:"ue5",gender:"female",description:"MetaHuman feminino indicado para aulas t\xe9cnicas e conte\xfados executivos.",style:"professional",tags:["ue5","metahuman"],metadata:{style:"professional",age_range:"25-35",clothing_options:["suit","casual"],expression_presets:["neutral","smile","speak"]}},{id:"local_male_01",name:"Simple Male (2D)",type:"2d",engine:"local",gender:"male",description:"Avatar 2D leve para pr\xe9-visualiza\xe7\xf5es r\xe1pidas e anima\xe7\xf5es simples.",style:"cartoon",tags:["2d","fast-render"],metadata:{style:"cartoon",color:"#4a90e2"}},{id:"local_female_01",name:"Simple Female (2D)",type:"2d",engine:"local",gender:"female",description:"Avatar 2D feminino otimizado para storyboards e prot\xf3tipos.",style:"cartoon",tags:["2d","fast-render"],metadata:{style:"cartoon",color:"#e24a90"}}];class n{getAll(){return r}getById(e){return r.find(t=>t.id===e)}getByEngine(e){return r.filter(t=>t.engine===e)}}let o=new n},37470:(e,t,a)=>{a.d(t,{Gc:()=>o,us:()=>n});var r=a(36527);class n{getAvailableMetaHumans(){return r.e4.getByEngine("ue5").map(e=>{let t=e.metadata||{};return{id:e.id,name:e.name,display_name:e.name,gender:e.gender,ethnicity:t.ethnicity,age_range:t.age_range,style:t.style,blendshape_count:t.blendshape_count,expression_presets:t.expression_presets,clothing_options:t.clothing_options,hair_options:t.hair_options,polygon_count:t.polygon_count,texture_resolution:t.texture_resolution,optimization_level:t.optimization_level}})}getMetaHuman(e){let t=r.e4.getById(e);if(!t||"ue5"!==t.engine)return;let a=t.metadata||{};return{id:t.id,name:t.name,display_name:t.name,gender:t.gender,ethnicity:a.ethnicity,age_range:a.age_range,style:a.style,blendshape_count:a.blendshape_count,expression_presets:a.expression_presets,clothing_options:a.clothing_options,hair_options:a.hair_options,polygon_count:a.polygon_count,texture_resolution:a.texture_resolution,optimization_level:a.optimization_level}}async startRender(e){return console.log("[UE5] Starting render job for:",e.metahuman_id),`job_ue5_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}async render(e,t){let{quality:a,resolution:r}=e;console.log(`[UE5] Rendering avatar at ${a} quality (${r.width}x${r.height})`);let n=process.env.UE5_RENDER_API_URL;if(n)try{console.log(`[UE5] Connecting to Render Service at ${n}`);let a=await fetch(`${n}/render`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({options:e,duration:t})});a.ok?(await a.json(),console.log("[UE5] Render successful via API")):console.error(`[UE5] Render API failed: ${a.statusText}`)}catch(e){console.error("[UE5] Error connecting to Render Service:",e)}else console.warn("[UE5] UE5_RENDER_API_URL not set. Using mock rendering.");return{frames:Array(Math.floor(30*t)).fill(Buffer.from("")),fps:30,totalDuration:t}}async isAvailable(){let e=process.env.UE5_RENDER_API_URL;if(e)try{return(await fetch(`${e}/health`)).ok}catch{}return!1}getJobStatus(e){return{job_id:e,status:"completed",progress:100,checkpoints:[],timings:{queued_at:new Date(Date.now()-1e4),audio2face_start:new Date(Date.now()-9e3),audio2face_end:new Date(Date.now()-8e3),ue5_render_start:new Date(Date.now()-7e3),ue5_render_end:new Date(Date.now()-2e3),encoding_start:new Date(Date.now()-1500),completed_at:new Date},output:{video_url:"https://example.com/video.mp4"},error:null,config:{metahuman_id:"default",resolution:{width:1920,height:1080},fps:30,environment:"studio"}}}}let o=new n},72721:(e,t,a)=>{a.d(t,{N:()=>o});var r=a(61657);class n{constructor(){this.apiKey=process.env.HEYGEN_API_KEY||"";let e=process.env.SUPABASE_SERVICE_ROLE_KEY;this.supabase=(0,r.eI)("https://ofhzrdiadxigrvmrhaiz.supabase.co",e)}static getInstance(){return n.instance||(n.instance=new n),n.instance}async request(e,t="GET",a){if(!this.apiKey)throw Error("HeyGen API Key not configured");let r=await fetch(`https://api.heygen.com/v2/${e}`,{method:t,headers:{"X-Api-Key":this.apiKey,"Content-Type":"application/json"},body:a?JSON.stringify(a):void 0});if(!r.ok){let e=await r.text();throw Error(`HeyGen API Error: ${r.status} - ${e}`)}return await r.json()}async listAvatars(){try{return(await this.request("avatars")).data.avatars.map(e=>({avatar_id:e.avatar_id,name:e.name,gender:e.gender,preview_image_url:e.preview_image_url,preview_video_url:e.preview_video_url}))}catch(e){return console.error("Failed to list HeyGen avatars:",e),[]}}async listVoices(){try{return(await this.request("voices")).data.voices}catch(e){return console.error("Failed to list HeyGen voices:",e),[]}}async generateVideo(e){console.log("\uD83C\uDFAC Starting HeyGen video generation...");let t=await this.request("video/generate","POST",e);if(!t.data||!t.data.video_id)throw Error("Failed to get video_id from HeyGen response");return t.data.video_id}async checkStatus(e){let t=await this.request(`video_status.get?video_id=${e}`),a=t.data.status,r={video_id:e,status:"completed"===a?"completed":"failed"===a?"failed":"processing"===a?"processing":"pending"};return"completed"===a?(r.video_url=t.data.video_url,r.thumbnail_url=t.data.thumbnail_url):"failed"===a&&(r.error=t.data.error?.message||"Unknown error"),r}async getQuota(){try{let e=await this.request("user/remaining_quota");return{remaining_quota:e.data.remaining_quota??0,used_quota:e.data.used_quota??0,quota_reset_date:e.data.quota_reset_date}}catch(e){return console.error("Failed to get HeyGen quota:",e),{remaining_quota:0,used_quota:0,error:e instanceof Error?e.message:"Unknown error"}}}}let o=new n},10607:(e,t,a)=>{a.d(t,{t:()=>s});var r=a(46718),n=a(92048),o=a.n(n);class s{async render(e,t){let{width:a,height:n}=e.dimensions,s=(0,r.createCanvas)(a,n),i=s.getContext("2d");i.clearRect(0,0,a,n);try{if(e.assetPath&&o().existsSync(e.assetPath)){let t=await (0,r.loadImage)(e.assetPath);i.drawImage(t,0,0,a,n)}else this.drawPlaceholderAvatar(i,a,n,t)}catch(e){console.error(`[Avatar] Error rendering frame ${t}:`,e),this.drawPlaceholderAvatar(i,a,n,t)}return s.toBuffer("image/png")}drawPlaceholderAvatar(e,t,a,r){let n=t/2,o=a/2,s=Math.min(t,a)/3;e.fillStyle="#f0f0f0",e.fillRect(0,0,t,a),e.beginPath(),e.arc(n,o,s,0,2*Math.PI),e.fillStyle="#3b82f6",e.fill(),e.beginPath(),e.ellipse(n,o+.3*s,.4*s,10*Math.sin(.5*r)+10,0,0,2*Math.PI),e.fillStyle="#1d4ed8",e.fill(),e.fillStyle="white",e.beginPath(),e.arc(n-.3*s,o-.2*s,.1*s,0,2*Math.PI),e.arc(n+.3*s,o-.2*s,.1*s,0,2*Math.PI),e.fill()}async renderSequence(e,t){let a=[];for(let r=0;r<t;r++)a.push(await this.render(e,r));return a}}new s}};