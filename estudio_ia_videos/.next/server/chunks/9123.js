"use strict";exports.id=9123,exports.ids=[9123],exports.modules={99123:(t,e,r)=>{r.d(e,{parseCompletePPTX:()=>x});var a=r(89190),i=r.n(a),s=r(4096);function n(t){return t?Array.isArray(t)?t:[t]:[]}function l(t){return void 0===t?"":String(t)}function o(t){return void 0===t?0:"number"==typeof t?t:parseFloat(t)||0}class c{constructor(){this.xmlParser=new s.Z({ignoreAttributes:!1,attributeNamePrefix:"@_",allowBooleanAttributes:!0,parseAttributeValue:!0,trimValues:!0})}async extractText(t){try{let e=t.filter(t=>!!t.match(/^ppt\/slides\/slide\d+\.xml$/)),r=[];for(let a=0;a<e.length;a++){let e=a+1,i=await this.extractTextFromSlide(t,e);if(i.success){let a=i.textBoxes?.map(t=>t.formatting).filter(Boolean)||[];r.push({slideNumber:e,text:i.plainText||"",formatting:a,bulletPoints:i.bulletPoints||[],hyperlinks:await this.extractHyperlinks(t,e)})}}return r}catch(t){return console.error("Error extracting text from slides:",t),[]}}async extractTextFromSlide(t,e){try{let r=`ppt/slides/slide${e}.xml`,a=t.file(r);if(!a)return{success:!1,error:"Slide n\xe3o encontrado"};let i=await a.async("string"),s=this.xmlParser.parse(i),o=[],c=[],u="",p=s?.["p:sld"]?.["p:cSld"]?.["p:spTree"];if(!p)return{success:!0,plainText:"",wordCount:0,characterCount:0,bulletPoints:[],textBoxes:[]};let d=n(p["p:sp"]);for(let t=0;t<d.length;t++){let e=d[t];if(!e||!e["p:txBody"])continue;let r=e["p:txBody"],a=this.extractPosition(e),i=this.extractFormattingFromShape(e,`shape-${t}`),s="";for(let t of n(r["a:p"])){if(!t)continue;let e=t["a:pPr"]?.["a:buFont"]||t["a:pPr"]?.["a:buChar"],r=n(t["a:r"]),a="";for(let t of r){if(!t)continue;let e=l(t["a:t"]);e&&(a+=e)}a&&(e&&c.push(a),s+=a+"\n")}s.trim()&&(o.push({id:`textbox-${t}`,text:s.trim(),position:a,formatting:i}),u+=s+" ")}let h=u.trim(),m=h?h.split(/\s+/).length:0,f=h.length;return{success:!0,plainText:h,wordCount:m,characterCount:f,bulletPoints:c,textBoxes:o}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Erro desconhecido"}}}extractPosition(t){try{let e=t["p:spPr"];if(!e)return;let r=e["a:xfrm"];if(!r)return;let a=r["a:off"],i=r["a:ext"],s={};return a&&(s.x=o(a["@_x"]),s.y=o(a["@_y"])),i&&(s.width=o(i["@_cx"]),s.height=o(i["@_cy"])),r["@_rot"]&&(s.rotation=o(r["@_rot"])/6e4),s}catch{return}}extractFormattingFromShape(t,e){let r={id:e};try{let e=t["p:txBody"];if(!e)return r;let a=n(e["a:p"]);if(0===a.length)return r;let i=a[0],s=i["a:pPr"];if(s?.["@_algn"]){let t=s["@_algn"];"l"===t?r.alignment="left":"ctr"===t?r.alignment="center":"r"===t?r.alignment="right":"just"===t&&(r.alignment="justify")}let c=n(i["a:r"]);if(c.length>0){let t=c[0]["a:rPr"];if(t){let e=o(t["@_sz"]);e&&(r.fontSize=e/100),("1"===t["@_b"]||1===t["@_b"]||!0===t["@_b"])&&(r.bold=!0),("1"===t["@_i"]||1===t["@_i"]||!0===t["@_i"])&&(r.italic=!0),"none"!==t["@_u"]&&t["@_u"]&&(r.underline=!0);let a=t["a:latin"],i=l(a?.["@_typeface"]);i&&(r.fontFamily=i);let s=t["a:solidFill"];if(s){let t=s["a:srgbClr"],e=l(t?.["@_val"]);e&&(r.color=`#${e}`)}}}}catch{}return r}async extractFormatting(t,e){try{let r=await this.extractTextFromSlide(t,e);if(!r.success||!r.textBoxes)return{success:!1,formatting:[]};let a=r.textBoxes.filter(t=>t.formatting).map(t=>t.formatting);return{success:!0,formatting:a}}catch{return{success:!1,formatting:[]}}}async extractBulletPoints(t,e){try{return(await this.extractTextFromSlide(t,e)).bulletPoints||[]}catch{return[]}}async extractHyperlinks(t,e){try{let r=`ppt/slides/slide${e}.xml`,a=t.file(r);if(!a)return[];let i=await a.async("string"),s=this.xmlParser.parse(i),o=`ppt/slides/_rels/slide${e}.xml.rels`,c=t.file(o),u={};if(c){let t=await c.async("string"),e=this.xmlParser.parse(t);for(let t of n(e?.Relationships?.Relationship))t&&t["@_Id"]&&t["@_Target"]&&(u[t["@_Id"]]=t["@_Target"])}let p=[],d=s?.["p:sld"]?.["p:cSld"]?.["p:spTree"];if(!d)return[];let h=n(d["p:sp"]);for(let t=0;t<h.length;t++){let e=h[t];if(e?.["p:txBody"]){for(let r of n(e["p:txBody"]["a:p"]))if(r)for(let e of n(r["a:r"])){if(!e)continue;let r=e["a:rPr"],a=r?.["a:hlinkClick"];if(a){let r=l(e["a:t"]),i=l(a["@_r:id"]),s=l(a["@_tooltip"]),n=i&&u[i]||s||i;n&&p.push({id:`hyperlink-${t}-${p.length}`,text:r,url:n,target:"_blank"})}}}}return p}catch{return[]}}}var u=r(3003);class p{constructor(){this.xmlParser=new s.Z({ignoreAttributes:!1,attributeNamePrefix:"@_"})}static async extractImages(t,e,r={}){return new p().extract(t,e,r)}async extract(t,e,r={}){let a=[],i=[];try{let s=Object.keys(t.files).filter(e=>e.startsWith("ppt/media/")&&!t.files[e].dir),n=r.maxImages||s.length;for(let l of s.slice(0,n))try{let s=t.files[l],n=await s.async("nodebuffer"),o=this.getMimeType(l),c=l.split("/").pop()||`image-${i.length}`,u={id:`img-${i.length}`,filename:c,buffer:n,mimeType:o};if(r.uploadToS3)try{let t=await this.uploadToSupabase(n,e,c,o);if(u.url=t,r.generateThumbnails){let t=await p.generateThumbnail(n,300,225);if(t){let r=await this.uploadToSupabase(t,e,`thumb_${c}`,"image/png");u.thumbnailUrl=r}}}catch(t){a.push(`Erro ao fazer upload de ${c}: ${t}`)}i.push(u)}catch(t){a.push(`Erro ao processar ${l}: ${t}`)}return{success:0===a.length,totalImages:i.length,images:i,errors:a}}catch(t){return{success:!1,totalImages:0,images:[],errors:[t instanceof Error?t.message:"Erro desconhecido"]}}}getMimeType(t){return({png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",svg:"image/svg+xml",bmp:"image/bmp",webp:"image/webp"})[t.toLowerCase().split(".").pop()||""]||"application/octet-stream"}async uploadToSupabase(t,e,r,a){let i=(0,u.W)(),s=`${e}/${Date.now()}-${r}`,{data:n,error:l}=await i.storage.from("assets").upload(s,t,{contentType:a,upsert:!1});if(l)throw Error(`Erro no upload: ${l.message}`);let{data:o}=i.storage.from("assets").getPublicUrl(n.path);return o.publicUrl}async extractImages(t,e){try{let r=`ppt/slides/_rels/slide${e}.xml.rels`,a=t.file(r);if(!a)return[];let i=await a.async("text"),s=this.xmlParser.parse(i);if(!s.Relationships?.Relationship)return[];let n=Array.isArray(s.Relationships.Relationship)?s.Relationships.Relationship:[s.Relationships.Relationship],l=[];for(let e of n){let r=e["@_Type"],a=e["@_Target"];if(r&&r.includes("image")&&a){let r=a.startsWith("../")?`ppt/${a.substring(3)}`:`ppt/slides/${a}`,i=t.file(r);if(i){let t=await i.async("nodebuffer"),a=r.split("/").pop()||`image-${l.length}`;l.push({id:e["@_Id"]||`img-${l.length}`,filename:a,buffer:t,mimeType:this.getMimeType(a),url:`/temp/images/${a}`})}}}return l}catch(t){return console.warn(`Erro ao extrair imagens do slide ${e}:`,t),[]}}static async generateThumbnail(t,e,a){try{let i=r(57441);return await i(t).resize(e,a,{fit:"inside",withoutEnlargement:!0}).png().toBuffer()}catch(t){return console.error("Sharp is not available or error generating thumbnail:",t),null}}}class d{constructor(){this.xmlParser=new s.Z({ignoreAttributes:!1,attributeNamePrefix:"@_"})}async detectLayout(t,e){try{let r=`ppt/slides/slide${e}.xml`,a=t.file(r);if(!a)return{success:!1,error:"Slide n\xe3o encontrado"};let i=await a.async("string"),s=this.xmlParser.parse(i),l=s?.["p:sld"]?.["p:cSld"]?.["p:sldLayout"],o=l?.["@_r:id"],c={name:"Unknown",type:"blank"};if(o){let r=`ppt/slides/_rels/slide${e}.xml.rels`,a=t.file(r);if(a){let e=await a.async("string"),r=this.xmlParser.parse(e),i=n(r?.Relationships?.Relationship).find(t=>t["@_Id"]===o);if(i){let e=`ppt/${i["@_Target"].replace("../","")}`,r=t.file(e);if(r){let t=await r.async("string"),e=this.xmlParser.parse(t),a=e?.["p:sldLayout"];if(a){let t=a["@_type"]||"blank";c={name:this.getLayoutName(t),type:t,layoutId:o}}}}}}let u=await this.extractLayoutElements(t,e);"blank"===c.type&&u.length>0&&(c.type=await this.detectLayoutType(u),c.name=this.getLayoutName(c.type));let p=await this.calculateConfidence(c,u);return{success:!0,layout:c,elements:u,confidence:p}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Erro desconhecido"}}}async extractLayoutElements(t,e){try{let r=`ppt/slides/slide${e}.xml`,a=t.file(r);if(!a)return[];let i=await a.async("string"),s=this.xmlParser.parse(i),n=[],l=s?.["p:sld"]?.["p:cSld"]?.["p:spTree"];if(!l)return[];for(let t of this.toArray(l["p:sp"]))if(t?.["p:txBody"]){let e=this.extractElementInfo(t,"text");e&&n.push(e)}for(let t of this.toArray(l["p:pic"])){let e=this.extractElementInfo(t,"image");e&&n.push(e)}for(let t of this.toArray(l["p:graphicFrame"])){let e=t?.["p:nvGraphicFramePr"],r=e?.["p:cNvPr"],a=r?.["@_name"]?.toLowerCase()||"",i="shape";a.includes("chart")?i="chart":a.includes("table")&&(i="table");let s=this.extractElementInfo(t,i);s&&n.push(s)}return n}catch{return[]}}extractElementInfo(t,e){try{let r;let a=t["p:spPr"];if(a){let t=a["a:xfrm"];if(t){let e=t["a:off"],a=t["a:ext"];e&&(r={x:o(e["@_x"]),y:o(e["@_y"])}),a&&r&&(r.width=o(a["@_cx"]),r.height=o(a["@_cy"]))}}return{id:`element-${e}-${Math.random().toString(36).substr(2,9)}`,elementType:e,position:r}}catch{return null}}async analyzeSlideContent(t,e){let r=await this.extractLayoutElements(t,e);if(0===r.length)return{textPercentage:0,imagePercentage:0,otherPercentage:0};let a=r.filter(t=>"text"===t.elementType).length,i=r.filter(t=>"image"===t.elementType).length,s=r.length-a-i,n=r.length;return{textPercentage:Math.round(a/n*100),imagePercentage:Math.round(i/n*100),otherPercentage:Math.round(s/n*100)}}async detectLayoutType(t){let e=t.filter(t=>"text"===t.elementType).length,r=t.filter(t=>"image"===t.elementType).length,a=t.filter(t=>"chart"===t.elementType).length,i=t.filter(t=>"table"===t.elementType).length;return 1===e&&0===r&&0===a?"title":e>=1&&r>=1?"titleContent":r>=1&&0===e?"picture":a>=1?"chart":i>=1?"table":e>=2?"twoContent":0===t.length?"blank":"obj"}getLayoutName(t){return({title:"Title Slide",titleContent:"Title and Content",sectionHeader:"Section Header",twoContent:"Two Content",comparison:"Comparison",titleOnly:"Title Only",blank:"Blank",contentCaption:"Content with Caption",picture:"Picture with Caption",chart:"Chart",table:"Table",obj:"Content"})[t]||t}async calculateConfidence(t,e=[]){return t.layoutId?.95:0===e.length?.5:e.length>=3?.85:.75}toArray(t){return void 0===t?[]:Array.isArray(t)?t:[t]}}class h{constructor(){this.xmlParser=new s.Z({ignoreAttributes:!1,attributeNamePrefix:"@_",parseAttributeValue:!0,trimValues:!0})}async extractNotes(t,e){try{let r=`ppt/notesSlides/notesSlide${e}.xml`,a=t.file(r);if(!a)return{success:!0,notes:"",wordCount:0,estimatedDuration:0};let i=await a.async("string"),s=this.xmlParser.parse(i),n=this.extractTextFromNotes(s),l=n?n.split(/\s+/).length:0;return{success:!0,notes:n,wordCount:l,estimatedDuration:l>0?Math.ceil(l/150*60):0}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Erro desconhecido"}}}extractTextFromNotes(t){try{let e=[],r=t?.["p:notes"]?.["p:cSld"]?.["p:spTree"];if(!r)return"";for(let t of n(r["p:sp"]))if(t?.["p:txBody"]){for(let r of n(t["p:txBody"]["a:p"]))if(r)for(let t of n(r["a:r"])){if(!t)continue;let r=l(t["a:t"]);r&&e.push(r)}}return e.join(" ").trim()}catch{return""}}async extractAllNotes(t){let e=new Map;for(let r of Object.keys(t.files).filter(t=>t.match(/ppt\/notesSlides\/notesSlide\d+\.xml/))){let a=r.match(/notesSlide(\d+)\.xml/);if(a){let r=parseInt(a[1],10),i=await this.extractNotes(t,r);e.set(r,i)}}return e}}let m={wordsPerMinute:150,visualProcessingTime:2,transitionTime:1,minSlideDuration:3,maxSlideDuration:120};class f{constructor(t){this.textParser=new c,this.layoutParser=new d,this.notesParser=new h,this.options={...m,...t}}async calculateDuration(t,e){try{let r=await this.textParser.extractTextFromSlide(t,e),a=r.wordCount||0,i=await this.notesParser.extractNotes(t,e),s=i.wordCount||0,n=await this.layoutParser.detectLayout(t,e),l=n.elements||[],o=0===s?this.calculateReadingTime(a):0,c=s>0?this.calculateReadingTime(s):0,u=this.calculateVisualProcessingTime(l.length),p=this.options.transitionTime,d=Math.max(o,c)+u+p;d=Math.max(this.options.minSlideDuration,d),d=Math.min(this.options.maxSlideDuration,d);let h=this.calculateConfidence(r,i,n);return{success:!0,estimatedDuration:Math.ceil(d),breakdown:{textReadingTime:Math.round(10*o)/10,notesNarrationTime:Math.round(10*c)/10,visualComplexityTime:Math.round(10*u)/10,transitionTime:p},confidence:h}}catch(t){return{success:!1,estimatedDuration:this.options.minSlideDuration,error:t instanceof Error?t.message:"Erro desconhecido"}}}calculateReadingTime(t){return t/this.options.wordsPerMinute*60}calculateVisualProcessingTime(t){return 0===t?0:1===t?this.options.visualProcessingTime:t<=3?1.5*this.options.visualProcessingTime:t<=5?2*this.options.visualProcessingTime:2.5*this.options.visualProcessingTime}calculateConfidence(t,e,r){let a=.5;return e.success&&e.wordCount&&e.wordCount>0&&(a+=.3),t.success&&t.wordCount&&t.wordCount>0&&(a+=.1),r.success&&r.confidence&&r.confidence>.7&&(a+=.1),Math.min(a,1)}async calculatePresentationDuration(t){try{let e=Object.keys(t.files).filter(t=>t.match(/ppt\/slides\/slide\d+\.xml/)),r=new Map;for(let a of e){let e=a.match(/slide(\d+)\.xml/);if(e){let a=parseInt(e[1],10),i=await this.calculateDuration(t,a);i.success&&r.set(a,i.estimatedDuration)}}let a=Array.from(r.values()),i=a.reduce((t,e)=>t+e,0),s=a.length>0?i/a.length:0;return{success:!0,totalDuration:i,slideDurations:r,averageSlideDuration:Math.round(s)}}catch(t){return{success:!1,totalDuration:0,slideDurations:new Map,averageSlideDuration:0,error:t instanceof Error?t.message:"Erro desconhecido"}}}}class g{constructor(){this.xmlParser=new s.Z({ignoreAttributes:!1,attributeNamePrefix:"@_",parseAttributeValue:!0,trimValues:!0})}async extractAnimations(t,e){try{let r=`ppt/slides/slide${e}.xml`,a=t.file(r);if(!a)return{success:!1,error:"Slide n\xe3o encontrado"};let i=await a.async("string"),s=this.xmlParser.parse(i),n=this.extractTransition(s),l=this.extractAnimationEffects(s),o=this.calculateTotalAnimationDuration(l);return{success:!0,transition:n,animations:l,totalAnimationDuration:o}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Erro desconhecido"}}}extractTransition(t){try{let e=t?.["p:sld"]?.["p:transition"];if(!e)return;let r={type:"none",advanceOnClick:!0};if(e["p:fade"])r.type="fade";else if(e["p:push"]){r.type="push";let t=e["p:push"]?.["@_dir"];t&&(r.direction=this.normalizeDirection(t))}else if(e["p:wipe"]){r.type="wipe";let t=e["p:wipe"]?.["@_dir"];t&&(r.direction=this.normalizeDirection(t))}else e["p:cut"]?r.type="cut":e["p:zoom"]&&(r.type="zoom");if(e["@_spd"]){let t=e["@_spd"];r.duration=this.speedToDuration(t)}return void 0!==e["@_advClick"]&&(r.advanceOnClick="1"===e["@_advClick"]||!0===e["@_advClick"]),e["@_advTm"]&&(r.advanceAfterTime=parseInt(String(e["@_advTm"]),10)),r}catch{return}}extractAnimationEffects(t){try{let e=[],r=t?.["p:sld"]?.["p:timing"];if(!r)return[];let a=r["p:tnLst"];if(!a)return[];let i=a["p:par"];if(!i)return[];let s=n(i);if(0===s.length)return[];let l=s[0]["p:cTn"];if(!l)return[];let o=l["p:childTnLst"];if(!o)return[];for(let t of this.toArray(o["p:seq"])){let r=t?.["p:cTn"];if(!r)continue;let a=r["p:childTnLst"];if(!a)continue;let i=this.toArray(a["p:par"]);for(let t=0;t<i.length;t++){let r=this.parseAnimationNode(i[t],t);r&&e.push(r)}}return e}catch{return[]}}parseAnimationNode(t,e){try{let r={id:`anim-${e}`,effectType:"entrance",effectName:"appear",order:e},a=t?.["p:cTn"];if(!a)return null;if(a["@_dur"]){let t=a["@_dur"];r.duration="indefinite"===t?1e3:parseInt(t,10)}a["@_delay"]&&(r.delay=parseInt(a["@_delay"],10));let i=a["p:stCondLst"];if(i){let t=this.toArray(i["p:cond"])[0];if(t){let e=t["p:tgtEl"];e?.["p:spTgt"]?.["@_spid"]&&(r.targetElementId=e["p:spTgt"]["@_spid"])}}let s=a["p:childTnLst"];if(s){let t=s["p:set"],e=s["p:animEffect"];if(e){let t=e["@_filter"];t&&(r.effectName=this.normalizeEffectName(t),r.effectType=this.determineEffectType(t))}else t&&(r.effectName="appear",r.effectType="entrance")}return r}catch{return null}}normalizeDirection(t){let e=t.toLowerCase();return e.includes("l")?"left":e.includes("r")?"right":e.includes("u")?"up":e.includes("d")?"down":"right"}speedToDuration(t){return({slow:2e3,med:1e3,fast:500})[t]||1e3}normalizeEffectName(t){let e=t.toLowerCase();for(let[t,r]of Object.entries({fade:"fade",wipe:"wipe",fly:"fly",box:"box",checkerboard:"checkerboard",blinds:"blinds",dissolve:"dissolve",appear:"appear"}))if(e.includes(t))return r;return"fade"}determineEffectType(t){let e=t.toLowerCase();return e.includes("exit")||e.includes("disappear")?"exit":e.includes("emphasis")||e.includes("pulse")?"emphasis":e.includes("path")||e.includes("motion")?"motion":"entrance"}calculateTotalAnimationDuration(t){if(0===t.length)return 0;let e=0;for(let r of t){let t=(r.delay||0)+(r.duration||1e3);t>e&&(e=t)}return e}toArray(t){return void 0===t?[]:Array.isArray(t)?t:[t]}async extractAllAnimations(t){let e=new Map;for(let r of Object.keys(t.files).filter(t=>t.match(/ppt\/slides\/slide\d+\.xml/))){let a=r.match(/slide(\d+)\.xml/);if(a){let r=parseInt(a[1],10),i=await this.extractAnimations(t,r);e.set(r,i)}}return e}}class y{constructor(){this.textParser=new c,this.imageParser=p,this.layoutParser=new d,this.notesParser=new h,this.durationCalculator=new f,this.animationParser=new g}async parseSlide(t,e,r,a={}){let{imageOptions:i={},durationOptions:s={},includeAnimations:n=!0,includeNotes:l=!0,includeImages:o=!0}=a,c=await this.textParser.extractTextFromSlide(t,e),u=[];o&&(u=(await this.imageParser.extractImages(t,r,i)).images);let p=await this.layoutParser.detectLayout(t,e),d={success:!0,notes:"",wordCount:0,estimatedDuration:0};l&&(d=await this.notesParser.extractNotes(t,e));let h=new f(s),m=await h.calculateDuration(t,e),g={success:!0,animations:[],totalAnimationDuration:0};return n&&(g=await this.animationParser.extractAnimations(t,e)),{slideNumber:e,text:c,images:u,layout:p,notes:d,duration:m,animations:g}}async parsePresentation(t,e,r={}){let a=[],i=[];try{for(let s of Object.keys(t.files).filter(t=>t.match(/ppt\/slides\/slide\d+\.xml/)).sort((t,e)=>{let r=parseInt(t.match(/slide(\d+)\.xml/)?.[1]||"0",10),a=parseInt(e.match(/slide(\d+)\.xml/)?.[1]||"0",10);return r-a})){let n=s.match(/slide(\d+)\.xml/);if(n){let s=parseInt(n[1],10);try{let a=await this.parseSlide(t,s,e,r);i.push(a)}catch(t){a.push(`Erro ao processar slide ${s}: ${t}`)}}}let s=i.reduce((t,e)=>t+(e.duration.estimatedDuration||0),0),n=i.reduce((t,e)=>t+e.images.length,0),l=i.length>0?s/i.length:0,o=i.some(t=>t.animations.animations&&t.animations.animations.length>0),c=i.some(t=>t.notes.wordCount&&t.notes.wordCount>0);return{success:0===a.length,slides:i,metadata:{totalSlides:i.length,totalDuration:s,totalImages:n,averageSlideDuration:Math.round(l),hasAnimations:o,hasSpeakerNotes:c},errors:a}}catch(t){return{success:!1,slides:[],metadata:{totalSlides:0,totalDuration:0,totalImages:0,averageSlideDuration:0,hasAnimations:!1,hasSpeakerNotes:!1},errors:[t instanceof Error?t.message:"Erro desconhecido"]}}}}async function x(t,e,r){let a=await i().loadAsync(t);return new y().parsePresentation(a,e,r)}}};