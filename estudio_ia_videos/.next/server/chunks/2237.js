"use strict";exports.id=2237,exports.ids=[2237],exports.modules={13197:(t,e,a)=>{a.d(e,{Q3:()=>u,te:()=>n});var o=a(84770);let i=["mp4","webm","mov","avi","mkv","gif","apng","mp3","wav","aac","ogg","zip","pdf","pptx"],r=new Set(["gif","apng","pdf","pptx","zip"]),s={mp4:"h264",webm:"vp9",mov:"h264",avi:"h264",mkv:"h265",gif:"gif",apng:"apng",mp3:"mp3",wav:"pcm_s16le",aac:"aac",ogg:"opus",zip:"zip",pdf:"pdf",pptx:"pptx"},n={youtube:{name:"YouTube HD",description:"Preset otimizado para upload no YouTube em 1080p.",format:"mp4",codec:"h264",audioCodec:"aac",quality:"high",resolution:"1920x1080",aspectRatio:"16:9",fps:30,targetBitrate:8e3,maxBitrate:12e3,maxDuration:7200,colorProfile:"bt709",optimization:"balanced"},vimeo:{name:"Vimeo Pro",description:"Perfil de alta qualidade com margem para p\xf3s-processamento.",format:"mp4",codec:"h264",audioCodec:"aac",quality:"high",resolution:"1920x1080",aspectRatio:"16:9",fps:30,targetBitrate:1e4,maxBitrate:2e4,colorProfile:"bt709",optimization:"best"},facebook:{name:"Facebook Feed",description:"Entrega equilibrada para feed do Facebook.",format:"mp4",codec:"h264",audioCodec:"aac",quality:"medium",resolution:"1080x1080",aspectRatio:"1:1",fps:30,targetBitrate:4500,maxBitrate:6e3,maxDuration:240,maxResolution:"1080x1080",optimization:"fast"},instagram:{name:"Instagram Feed",description:"V\xeddeos quadrados otimizados para o feed.",format:"mp4",codec:"h264",audioCodec:"aac",quality:"medium",resolution:"1080x1080",aspectRatio:"1:1",fps:30,targetBitrate:3500,maxBitrate:5e3,maxDuration:60,maxResolution:"1080x1080",optimization:"balanced"},tiktok:{name:"TikTok Vertical",description:"Preset vertical com foco em dispositivos m\xf3veis.",format:"mp4",codec:"h264",audioCodec:"aac",quality:"high",resolution:"1080x1920",aspectRatio:"9:16",fps:30,targetBitrate:4e3,maxBitrate:6e3,maxDuration:180,optimization:"balanced"},linkedin:{name:"LinkedIn HD",description:"Conte\xfado corporativo com foco em clareza.",format:"mp4",codec:"h264",audioCodec:"aac",quality:"high",resolution:"1920x1080",aspectRatio:"16:9",fps:30,targetBitrate:6500,maxBitrate:9e3,maxDuration:600,optimization:"balanced"},twitter:{name:"Twitter/X",description:"Compatibilidade garantida com limite de tamanho.",format:"mp4",codec:"h264",audioCodec:"aac",quality:"medium",resolution:"1280x720",aspectRatio:"16:9",fps:30,targetBitrate:3e3,maxBitrate:5e3,maxFileSize:512,maxDuration:140,optimization:"fast"},whatsapp:{name:"WhatsApp Share",description:"Foco em arquivo leve para compartilhamento r\xe1pido.",format:"mp4",codec:"h264",audioCodec:"aac",quality:"low",resolution:"854x480",aspectRatio:"16:9",fps:24,targetBitrate:1e3,maxBitrate:1500,maxFileSize:16,optimization:"fast"},snapchat:{name:"Snapchat Stories",description:"Vertical r\xe1pido com limite curto.",format:"mp4",codec:"h264",audioCodec:"aac",quality:"medium",resolution:"1080x1920",aspectRatio:"9:16",fps:30,targetBitrate:3800,maxDuration:60,optimization:"balanced"},pinterest:{name:"Pinterest Video Pin",description:"V\xeddeos verticais para pins patrocinados.",format:"mp4",codec:"h264",audioCodec:"aac",quality:"medium",resolution:"1080x1920",aspectRatio:"9:16",fps:30,targetBitrate:3500,maxBitrate:5e3,optimization:"balanced"},mobile:{name:"Mobile Universal",description:"Preset geral para smartphones e tablets.",format:"mp4",codec:"h264",audioCodec:"aac",quality:"medium",resolution:"1280x720",aspectRatio:"16:9",fps:30,targetBitrate:2500,maxBitrate:4e3,maxFileSize:200,optimization:"balanced"},web:{name:"Web Streaming",description:"Compress\xe3o avan\xe7ada para streaming em navegadores.",format:"webm",codec:"vp9",audioCodec:"opus",quality:"high",resolution:"1920x1080",aspectRatio:"16:9",fps:30,targetBitrate:3500,maxBitrate:6e3,colorProfile:"bt709",optimization:"best"}},p=[{phase:"initializing",minProgress:0,maxProgress:10,duration:250},{phase:"preprocessing",minProgress:10,maxProgress:30,duration:400},{phase:"encoding",minProgress:30,maxProgress:60,duration:700},{phase:"optimizing",minProgress:60,maxProgress:80,duration:450},{phase:"watermarking",minProgress:80,maxProgress:90,duration:250},{phase:"finalizing",minProgress:90,maxProgress:100,duration:350}],m=t=>new Promise(e=>setTimeout(e,t)),l=()=>"function"==typeof o.randomUUID?(0,o.randomUUID)():"undefined"!=typeof globalThis&&globalThis.crypto?.randomUUID?globalThis.crypto.randomUUID():`export_${Math.random().toString(36).slice(2)}_${Date.now()}`,c=t=>({...t,options:{...t.options},metadata:t.metadata?{...t.metadata}:void 0,metrics:{...t.metrics},logs:t.logs.map(t=>({...t}))});class d{async createExportJob(t,e,a){if(!t||!e)throw Error("Both projectId and userId are required to create an export job.");let o=this.normalizeOptions(a);this.validateOptions(o);let i=l(),r={id:i,projectId:t,userId:e,status:"pending",progress:0,currentPhase:"initializing",options:o,platform:o.targetPlatform,createdAt:new Date,metrics:{retries:0,lastUpdated:new Date},logs:[]};return this.jobs.set(i,r),this.enqueueJob(i),c(r)}async quickExport(t,e,a){let o=n[a];if(!o)throw Error(`Unsupported platform: ${a}`);let i={format:o.format,codec:o.codec,audioCodec:o.audioCodec,resolution:o.resolution,fps:o.fps,targetBitrate:o.targetBitrate,maxBitrate:o.maxBitrate,quality:o.quality,aspectRatio:o.aspectRatio,maxDuration:o.maxDuration,maxFileSize:o.maxFileSize,colorProfile:o.colorProfile,optimization:o.optimization??"balanced",includeThumbnail:!0,includeMetadata:!0,includeWatermark:!1,targetPlatform:a,presetName:o.name,filters:o.recommendedFilters?{presetFilters:o.recommendedFilters}:void 0};return this.createExportJob(t,e,i)}async batchExport(t,e,a){if(!Array.isArray(t)||0===t.length)throw Error("At least one projectId must be provided for batch export.");let o=[];for(let i of t){let t=await this.createExportJob(i,e,a);o.push(t)}return o}getJob(t){let e=this.jobs.get(t);return e?c(e):null}getJobsByProject(t){return Array.from(this.jobs.values()).filter(e=>e.projectId===t).map(c)}getJobsByUser(t){return Array.from(this.jobs.values()).filter(e=>e.userId===t).map(c)}listActiveJobs(){return Array.from(this.jobs.values()).filter(t=>"pending"===t.status||"processing"===t.status).map(c)}async cancelJob(t){let e=this.jobs.get(t);return!!e&&"completed"!==e.status&&"failed"!==e.status&&"cancelled"!==e.status&&(this.cancelledJobs.add(t),e.status="cancelled",e.error="Job cancelled by user.",e.progress=Math.min(e.progress,95),e.currentPhase="finalizing",e.completedAt=new Date,e.metrics.lastUpdated=new Date,this.log(e,"Export job cancelled."),this.removeFromQueue(t),!0)}async retryJob(t){let e=this.jobs.get(t);if(!e)return null;let a={...e.options},o=await this.createExportJob(e.projectId,e.userId,a);return o.metrics.retries=e.metrics.retries+1,this.jobs.set(o.id,{...this.jobs.get(o.id),metrics:o.metrics}),c(this.jobs.get(o.id))}getSystemMetrics(){let t=Array.from(this.jobs.values()),e={totalJobs:t.length,pending:0,processing:0,completed:0,failed:0,cancelled:0},a=[];for(let o of t)e[o.status]=e[o.status]+1,"completed"===o.status&&o.startedAt&&o.completedAt&&a.push(o.completedAt.getTime()-o.startedAt.getTime());let o=a.length?a.reduce((t,e)=>t+e,0)/a.length:null;return{...e,averageDuration:o}}getSupportedFormats(){return[...i]}enqueueJob(t){this.jobQueue.push(t),this.processQueue()}removeFromQueue(t){let e=this.jobQueue.indexOf(t);e>=0&&this.jobQueue.splice(e,1)}async processQueue(){if(this.activeJobs.size>=this.maxConcurrentJobs)return;let t=this.jobQueue.shift();if(!t)return;let e=this.jobs.get(t);if(e){this.activeJobs.add(t);try{await this.processJob(e)}finally{this.activeJobs.delete(t),this.jobQueue.length>0&&this.processQueue()}}}async processJob(t){for(let e of(t.status="processing",t.startedAt=new Date,t.metrics.lastUpdated=new Date,this.log(t,"Export job started."),p)){if(this.cancelledJobs.has(t.id)){this.log(t,`Processing stopped during ${e.phase}.`,"warn");return}t.currentPhase=e.phase,this.log(t,`Phase ${e.phase} started.`),await this.runPhase(t,e)}if(this.cancelledJobs.has(t.id)){this.log(t,"Job cancelled during finalization.","warn");return}t.progress=100,t.status="completed",t.completedAt=new Date,t.outputPath=this.buildOutputPath(t),t.thumbnailPath=this.buildThumbnailPath(t),t.metadata=this.generateMetadata(t),t.metrics.lastUpdated=new Date,t.metrics.qualityScore=this.calculateQualityScore(t),t.metrics.averageFps=t.metadata?.fps,this.log(t,"Export job completed successfully."),this.cancelledJobs.delete(t.id)}async runPhase(t,e){let a=(e.maxProgress-e.minProgress)/5,o=Math.max(e.duration/5,50);for(let i=1;i<=5;i+=1){if(this.cancelledJobs.has(t.id))return;let r=Math.min(e.maxProgress,Math.round(e.minProgress+a*i));t.progress=r,t.metrics.lastUpdated=new Date,await m(o+Math.floor(75*Math.random()))}}normalizeOptions(t){let e=t.format,a=t.codec??s[e],o=t.audioCodec??(r.has(e)?void 0:"aac"),i=t.resolution??"1920x1080",n=t.fps??30,p=t.bitrate??t.targetBitrate??this.suggestBitrate(e,i);return{quality:"high",optimization:"balanced",includeMetadata:!0,includeThumbnail:!0,includeWatermark:!1,compression:!0,...t,codec:a,audioCodec:o,resolution:i,fps:n,bitrate:p,targetBitrate:t.targetBitrate??p}}validateOptions(t){if(!i.includes(t.format))throw Error(`Unsupported export format: ${t.format}`);if(t.resolution&&!/^\d+x\d+$/.test(t.resolution))throw Error(`Invalid resolution provided: ${t.resolution}`);if(t.fps&&(t.fps<=0||t.fps>120))throw Error("Frames per second must be between 1 and 120.");if(t.bitrate&&t.bitrate<=0)throw Error("Bitrate must be a positive value.")}buildOutputPath(t){let e=t.options.format,a=t.options.customFileName??t.id;return`/exports/${a}.${e}`}buildThumbnailPath(t){if(t.options.includeThumbnail&&"zip"!==t.options.format)return`/exports/${t.id}.thumbnail.jpg`}generateMetadata(t){let e=Math.min(t.options.maxDuration??180,45+Math.floor(180*Math.random())),a=t.options.bitrate??t.options.targetBitrate??4e3,o=t.options.fps??30,i=this.estimateFileSize(a,e),s=t.startedAt&&t.completedAt?(t.completedAt.getTime()-t.startedAt.getTime())/1e3:.1*e;return{duration:e,fileSize:i,format:t.options.format,codec:t.options.codec,audioCodec:t.options.audioCodec,resolution:t.options.resolution,bitrate:a,fps:o,hasAudio:!r.has(t.options.format),hasSubtitles:!!t.options.includeSubtitles,processingTime:s,colorProfile:t.options.colorProfile??"bt709"}}estimateFileSize(t,e){return Math.max(1,Math.round(1e3*t*e/8/1048576))}suggestBitrate(t,e){let[a,o]=e.split("x").map(t=>Number.parseInt(t,10)),i=a*o,r="webm"===t?2800:3200;return i>=8294400?4*r:i>=2073600?2*r:i>=921600?Math.round(1.2*r):Math.round(.7*r)}calculateQualityScore(t){return Math.min(100,("ultra"===t.options.quality?95:"high"===t.options.quality?90:80)+("best"===t.options.optimization?4:"fast"===t.options.optimization?-2:0)+(t.options.bitrate&&t.options.bitrate>8e3?3:0))}log(t,e,a="info"){t.logs.push({timestamp:Date.now(),message:e,level:a}),t.logs.length>100&&t.logs.shift()}constructor(){this.jobs=new Map,this.jobQueue=[],this.activeJobs=new Set,this.cancelledJobs=new Set,this.maxConcurrentJobs=3}}let u=new d}};