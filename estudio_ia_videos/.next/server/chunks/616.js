exports.id=616,exports.ids=[616,7153],exports.modules={14464:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=14464,e.exports=t},8541:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=8541,e.exports=t},12308:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=12308,e.exports=t},54211:(e,t,r)=>{"use strict";r.d(t,{Yd:()=>s,kg:()=>n});var i=r(77686);class s{constructor(e){this.isDevelopment=!1,this.minLevel=process.env.LOG_LEVEL||"info",this.namespace=null,this.levels={debug:0,info:1,warn:2,error:3},e&&(this.namespace=e)}shouldLog(e){return this.levels[e]>=this.levels[this.minLevel]}formatMessage(e){if(!this.isDevelopment)return JSON.stringify({level:e.level,message:e.message,timestamp:e.timestamp,...this.namespace?{namespace:this.namespace}:{},...e.context,...e.error?{error:{message:e.error.message,stack:e.error.stack,name:e.error.name}}:{}});let t=[`${{debug:"\uD83D\uDD0D",info:"ℹ️",warn:"⚠️",error:"❌"}[e.level]} [${e.level.toUpperCase()}]`,e.timestamp];return this.namespace&&t.push(`[${this.namespace}]`),t.push(e.message),e.context&&t.push(JSON.stringify(e.context,null,2)),e.error&&(t.push(`
Error: ${e.error.message}`),this.isDevelopment&&e.error.stack&&t.push(`
Stack: ${e.error.stack}`)),t.join(" ")}log(e,t,r,s){if(!this.shouldLog(e))return;let n={level:e,message:t,timestamp:new Date().toISOString(),context:r,error:s},a=this.formatMessage(n);switch(this.isDevelopment||("error"===e&&s?i.captureException(s,{extra:{...r,message:t}}):("error"===e||"warn"===e)&&i.captureMessage(t,{level:"warn"===e?"warning":"error",extra:r})),e){case"debug":this.isDevelopment&&console.debug(a);break;case"info":console.info(a);break;case"warn":console.warn(a);break;case"error":console.error(a)}}debug(e,t){this.log("debug",e,t)}info(e,t){this.log("info",e,t)}warn(e,t){this.log("warn",e,t)}error(e,t,r){this.log("error",e,r,t)}withContext(e){let t=new s(this.namespace||void 0),r=t.log.bind(t);return t.log=(t,i,s,n)=>{r(t,i,{...e,...s},n)},t}}let n=new s},8261:(e,t,r)=>{"use strict";r.d(t,{_:()=>s});var i=r(53524);let s=global.prisma||new i.PrismaClient({log:["error"]})},80338:(e,t,r)=>{"use strict";r.d(t,{DR:()=>h,wl:()=>o});var i=r(8261),s=r(54211),n=r(84770);class a{async listWebhooks(e){try{return await i._.webhook.findMany({where:{userId:e},orderBy:{createdAt:"desc"}})}catch(t){throw s.kg.error("Failed to list webhooks",t,{userId:e}),t}}async registerWebhook(e){try{let t=e.secret||(0,n.randomUUID)(),r=await i._.webhook.create({data:{userId:e.userId,url:e.url,secret:t,events:e.events,active:!0}});return s.kg.info("Webhook registered",{webhookId:r.id,userId:e.userId}),r}catch(t){throw s.kg.error("Failed to register webhook",t,{config:e}),t}}async deleteWebhook(e,t){try{return await i._.webhook.deleteMany({where:{id:e,userId:t}}),!0}catch(r){throw s.kg.error("Failed to delete webhook",r,{id:e,userId:t}),r}}async getWebhook(e){return await i._.webhook.findUnique({where:{id:e}})}}let o=new a;class l{async dispatch(e,t){try{let r=(await i._.webhook.findMany({where:{active:!0}})).filter(t=>{let r=t.events;return Array.isArray(r)&&(r.includes(e)||r.includes("*"))});if(0===r.length)return;s.kg.info(`Dispatching webhook event: ${e}`,{count:r.length});let n=r.map(async r=>{try{let n=await i._.webhookDelivery.create({data:{webhookId:r.id,event:e,payload:t,url:r.url,status:"pending",scheduledFor:new Date}});this.sendWebhook(r,n,e,t).catch(e=>{s.kg.error("Background webhook delivery failed",e,{deliveryId:n.id})})}catch(e){s.kg.error("Failed to create webhook delivery record",e,{webhookId:r.id})}});await Promise.all(n)}catch(t){s.kg.error("Webhook dispatch error",t,{event:e})}}async sendWebhook(e,t,r,s){let a=Date.now(),o=(0,n.createHmac)("sha256",e.secret).update(`${a}.${JSON.stringify(s)}`).digest("hex"),l=Date.now();try{let n=await fetch(e.url,{method:"POST",headers:{"Content-Type":"application/json","X-Webhook-Event":r,"X-Webhook-Signature":`t=${a},v1=${o}`,"User-Agent":"EstudioIA-Webhooks/1.0"},body:JSON.stringify(s)}),h=Date.now()-l,u=await n.text();await i._.webhookDelivery.update({where:{id:t.id},data:{status:n.ok?"completed":"failed",responseCode:n.status,responseBody:u.substring(0,1e3),responseTime:h,deliveredAt:new Date,attempts:{increment:1}}}),await i._.webhook.update({where:{id:e.id},data:{totalDeliveries:{increment:1},successfulDeliveries:n.ok?{increment:1}:void 0,failedDeliveries:n.ok?void 0:{increment:1},lastDeliveryAt:new Date}})}catch(n){let r=Date.now()-l,s=n instanceof Error?n.message:"Unknown error";await i._.webhookDelivery.update({where:{id:t.id},data:{status:"failed",error:s,responseTime:r,attempts:{increment:1},nextRetryAt:new Date(Date.now()+1e3*(e.retryInterval||60))}}),await i._.webhook.update({where:{id:e.id},data:{totalDeliveries:{increment:1},failedDeliveries:{increment:1},lastDeliveryAt:new Date}})}}async renderStarted(e){return this.dispatch("render.started",e)}async renderCompleted(e){return this.dispatch("render.completed",e)}async renderFailed(e){return this.dispatch("render.failed",e)}async projectCreated(e){return this.dispatch("project.created",e)}async storageUploaded(e){return this.dispatch("storage.uploaded",e)}async systemAlert(e){return this.dispatch("system.alert",e)}}let h=new l},83988:e=>{"use strict";e.exports=function(e){e.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}},10949:(e,t,r)=>{"use strict";function i(e){var t=this;if(t instanceof i||(t=new i),t.tail=null,t.head=null,t.length=0,e&&"function"==typeof e.forEach)e.forEach(function(e){t.push(e)});else if(arguments.length>0)for(var r=0,s=arguments.length;r<s;r++)t.push(arguments[r]);return t}function s(e,t,r,i){if(!(this instanceof s))return new s(e,t,r,i);this.list=i,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,r?(r.prev=this,this.next=r):this.next=null}e.exports=i,i.Node=s,i.create=i,i.prototype.removeNode=function(e){if(e.list!==this)throw Error("removing node which does not belong to this list");var t=e.next,r=e.prev;return t&&(t.prev=r),r&&(r.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=r),e.list.length--,e.next=null,e.prev=null,e.list=null,t},i.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},i.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},i.prototype.push=function(){for(var e,t=0,r=arguments.length;t<r;t++)e=arguments[t],this.tail=new s(e,this.tail,null,this),this.head||(this.head=this.tail),this.length++;return this.length},i.prototype.unshift=function(){for(var e,t=0,r=arguments.length;t<r;t++)e=arguments[t],this.head=new s(e,null,this.head,this),this.tail||(this.tail=this.head),this.length++;return this.length},i.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},i.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},i.prototype.forEach=function(e,t){t=t||this;for(var r=this.head,i=0;null!==r;i++)e.call(t,r.value,i,this),r=r.next},i.prototype.forEachReverse=function(e,t){t=t||this;for(var r=this.tail,i=this.length-1;null!==r;i--)e.call(t,r.value,i,this),r=r.prev},i.prototype.get=function(e){for(var t=0,r=this.head;null!==r&&t<e;t++)r=r.next;if(t===e&&null!==r)return r.value},i.prototype.getReverse=function(e){for(var t=0,r=this.tail;null!==r&&t<e;t++)r=r.prev;if(t===e&&null!==r)return r.value},i.prototype.map=function(e,t){t=t||this;for(var r=new i,s=this.head;null!==s;)r.push(e.call(t,s.value,this)),s=s.next;return r},i.prototype.mapReverse=function(e,t){t=t||this;for(var r=new i,s=this.tail;null!==s;)r.push(e.call(t,s.value,this)),s=s.prev;return r},i.prototype.reduce=function(e,t){var r,i=this.head;if(arguments.length>1)r=t;else if(this.head)i=this.head.next,r=this.head.value;else throw TypeError("Reduce of empty list with no initial value");for(var s=0;null!==i;s++)r=e(r,i.value,s),i=i.next;return r},i.prototype.reduceReverse=function(e,t){var r,i=this.tail;if(arguments.length>1)r=t;else if(this.tail)i=this.tail.prev,r=this.tail.value;else throw TypeError("Reduce of empty list with no initial value");for(var s=this.length-1;null!==i;s--)r=e(r,i.value,s),i=i.prev;return r},i.prototype.toArray=function(){for(var e=Array(this.length),t=0,r=this.head;null!==r;t++)e[t]=r.value,r=r.next;return e},i.prototype.toArrayReverse=function(){for(var e=Array(this.length),t=0,r=this.tail;null!==r;t++)e[t]=r.value,r=r.prev;return e},i.prototype.slice=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var r=new i;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var s=0,n=this.head;null!==n&&s<e;s++)n=n.next;for(;null!==n&&s<t;s++,n=n.next)r.push(n.value);return r},i.prototype.sliceReverse=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var r=new i;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var s=this.length,n=this.tail;null!==n&&s>t;s--)n=n.prev;for(;null!==n&&s>e;s--,n=n.prev)r.push(n.value);return r},i.prototype.splice=function(e,t,...r){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var i=0,n=this.head;null!==n&&i<e;i++)n=n.next;for(var a=[],i=0;n&&i<t;i++)a.push(n.value),n=this.removeNode(n);null===n&&(n=this.tail),n!==this.head&&n!==this.tail&&(n=n.prev);for(var i=0;i<r.length;i++)n=function(e,t,r){var i=t===e.head?new s(r,null,t,e):new s(r,t,t.next,e);return null===i.next&&(e.tail=i),null===i.prev&&(e.head=i),e.length++,i}(this,n,r[i]);return a},i.prototype.reverse=function(){for(var e=this.head,t=this.tail,r=e;null!==r;r=r.prev){var i=r.prev;r.prev=r.next,r.next=i}return this.head=t,this.tail=e,this};try{r(83988)(i)}catch(e){}}};