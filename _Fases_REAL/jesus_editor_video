# ğŸš€ **ROADMAP DE EVOLUÃ‡ÃƒO â€” ESTÃšDIO DE VÃDEO IA (V7 â” V8)**

**Data de AtualizaÃ§Ã£o:** 04 de Dezembro de 2025  
**Status Geral:** âœ… V7 Production Ready (100%) | ğŸš§ V8 Em Desenvolvimento

---

## ğŸ“‹ **Ãndice**

1. [VisÃ£o Geral e Status](#1-visÃ£o-geral-e-status)
2. [Sprint 1: IntegraÃ§Ã£o Base + Canvas (ConcluÃ­do)](#2-sprint-1-integraÃ§Ã£o-base--canvas-âœ…)
3. [Sprint 2: Timeline + Assets (ConcluÃ­do)](#3-sprint-2-timeline--assets-âœ…)
4. [Sprint 3: TTS + Avatar (Parcial)](#4-sprint-3-tts--avatar-ğŸ”„)
5. [Sprint 4: AnimaÃ§Ãµes + Efeitos (ConcluÃ­do)](#5-sprint-4-animaÃ§Ãµes--efeitos-âœ…)
6. [Sprint 5: RenderizaÃ§Ã£o + ExportaÃ§Ã£o (ConcluÃ­do)](#6-sprint-5-renderizaÃ§Ã£o--exportaÃ§Ã£o-âœ…)
7. [Sprint 6: UX, Templates e QA (ConcluÃ­do)](#7-sprint-6-ux-templates-e-qa-âœ…)
8. [ğŸš€ ROADMAP V8 (Novas Funcionalidades)](#8-ğŸš€-roadmap-v8-novas-funcionalidades)
9. [ğŸ“… Plano de ImplementaÃ§Ã£o Detalhado (V8)](#9-ğŸ“…-plano-de-implementaÃ§Ã£o-detalhado-v8)
10. [ğŸ› ï¸ EspecificaÃ§Ã£o TÃ©cnica: OtimizaÃ§Ã£o de Fluxo e Continuidade (Smart Flow)](#10-ğŸ› ï¸-especificaÃ§Ã£o-tÃ©cnica-otimizaÃ§Ã£o-de-fluxo-e-continuidade-smart-flow)
11. [ğŸ“ EspecificaÃ§Ãµes Detalhadas V8 (Funcionalidades-Chave)](#11-ğŸ“-especificaÃ§Ãµes-detalhadas-v8-funcionalidades-chave)
12. [âœ… PadrÃµes de Qualidade e Compatibilidade (V8)](#12-âœ…-padrÃµes-de-qualidade-e-compatibilidade-v8)
13. [ğŸ§ª Plano de Testes Expandido (Unit/Integration)](#13-ğŸ§ª-plano-de-testes-expandido-unitintegration)
14. [âš™ï¸ Benchmarks e Metas de Performance](#14-âš™ï¸-benchmarks-e-metas-de-performance)
15. [ğŸ“¦ EntregÃ¡veis e Versionamento](#15-ğŸ“¦-entregÃ¡veis-e-versionamento)

---

## 1. **VisÃ£o Geral e Status**

O projeto alcanÃ§ou o marco **V7 Production Ready** com 100% das funcionalidades core implementadas, documentadas e testadas. Este documento reflete o status atual de conclusÃ£o das fases originais e estabelece o roadmap para a versÃ£o V8 (Fase de EvoluÃ§Ã£o).

### **Fluxo de Arquitetura Atual (V7)**
```mermaid
graph TD
    A[PPTX Upload] -->|Parser| B(Editor Canvas)
    B -->|EdiÃ§Ã£o| C{Timeline}
    C -->|Assets| D[Ãudio/TTS]
    C -->|AnimaÃ§Ã£o| E[Preview]
    E -->|Render| F[Worker FFmpeg]
    F -->|Export| G[MP4 Final]
```

### **Legenda de Status**
* âœ… **[CONCLUÃDO]**: Implementado, testado e em produÃ§Ã£o.
* ğŸ”„ **[EM PROGRESSO]**: Em desenvolvimento ativo.
* ğŸ“… **[PLANEJADO]**: Mapeado para sprints futuros (V8).

---

## 2. **Sprint 1: IntegraÃ§Ã£o Base + Canvas** âœ…

### **US-01: Canvas Profissional**
*   âœ… Configurar canvas com Fabric.js (WebGL-accelerated)
*   âœ… Criar sistema de coordenadas responsivo
*   âœ… Implementar snap-to-grid e guides inteligentes
*   âœ… Adicionar histÃ³rico de aÃ§Ãµes (Undo/Redo com Zustand)
*   âœ… Atalhos de teclado (Ctrl+Z, Ctrl+C, Del)

### **US-02: Upload de Imagens e VÃ­deos**
*   âœ… Componente de upload (Drag & Drop)
*   âœ… CompressÃ£o automÃ¡tica e inserÃ§Ã£o no canvas
*   âœ… Suporte a PNG/JPG/WEBP e MP4/WEBM

### **US-03: Importar PPTX**
*   âœ… Parser de slides (8 parsers especializados)
*   âœ… ExtraÃ§Ã£o de layers (tÃ­tulo, corpo, imagem)
*   âœ… ConversÃ£o automÃ¡tica para cenas do editor

---

## 3. **Sprint 2: Timeline + Assets** âœ…

### **US-04: Timeline Profissional**
*   âœ… Timeline horizontal com miniaturas
*   âœ… Drag & drop entre cenas
*   âœ… Ajuste de duraÃ§Ã£o e reordenaÃ§Ã£o

### **US-05: Biblioteca de MÃºsicas e SFX**
*   âœ… Player de Ã¡udio com prÃ©via
*   âœ… Controle de volume e mixagem
*   âœ… Fade in/out automÃ¡tico

### **US-06: Asset Library**
*   âœ… UI de biblioteca lateral
*   âœ… Categorias e busca de assets
*   âœ… IntegraÃ§Ã£o com Supabase Storage

---

## 4. **Sprint 3: TTS + Avatar** ğŸ”„

### **US-07: MÃºltiplos provedores de TTS** âœ…
*   âœ… IntegraÃ§Ã£o ElevenLabs (29 vozes premium)
*   âœ… IntegraÃ§Ã£o Azure/Edge TTS (Vozes PT-BR)
*   âœ… Controle de velocidade e pitch
*   âœ… Cache de Ã¡udio automÃ¡tico

### **US-08: Avatar 3D (falante)** ğŸ“… *(Movido para V8)*
*   ğŸ“… Viewer 3D (Three.js + R3F)
*   ğŸ“… IntegraÃ§Ã£o HeyGen/Vidnoz (Em planejamento)
*   ğŸ“… Controle de gestos e expressÃµes

### **US-09: SincronizaÃ§Ã£o Labial (Lip-Sync)** ğŸ“… *(Movido para V8)*
*   ğŸ“… Mapa de visemes automÃ¡tico
*   ğŸ“… AnimaÃ§Ã£o de blendshapes em tempo real

---

## 5. **Sprint 4: AnimaÃ§Ãµes + Efeitos** âœ…

### **US-10: AnimaÃ§Ãµes de Texto**
*   âœ… Presets de animaÃ§Ã£o (Fade, Slide, Zoom)
*   âœ… IntegraÃ§Ã£o com Framer Motion
*   âœ… Preview em tempo real no Canvas

### **US-11: TransiÃ§Ãµes entre cenas**
*   âœ… TransiÃ§Ãµes bÃ¡sicas (Corte, Fade)
*   âœ… AplicaÃ§Ã£o via Remotion/FFmpeg

### **US-12: Efeitos Visuais**
*   âœ… Filtros CSS aplicÃ¡veis a objetos
*   âœ… RenderizaÃ§Ã£o fiel no vÃ­deo final

---

## 6. **Sprint 5: RenderizaÃ§Ã£o + ExportaÃ§Ã£o** âœ…

### **US-13: Render Pipeline**
*   âœ… Worker FFmpeg com BullMQ
*   âœ… RenderizaÃ§Ã£o 720p/1080p/4K
*   âœ… Barra de progresso via WebSocket/SSE
*   âœ… Logs estruturados e mÃ©tricas de erro

### **US-14: Exportar MP4**
*   âœ… Upload automÃ¡tico para S3/Supabase Storage
*   âœ… HistÃ³rico de versÃµes e downloads seguros
*   âœ… Thumbnails automÃ¡ticas

---

## 7. **Sprint 6: UX, Templates e QA** âœ…

### **US-15: Templates prontos de vÃ­deo NR**
*   âœ… 12 Templates de Normas Regulamentadoras (NR12, NR35, etc.)
*   âœ… Sistema de duplicaÃ§Ã£o de projetos
*   âœ… ValidaÃ§Ã£o de compliance NR

### **US-16: ColaboraÃ§Ã£o em tempo real** ğŸ“… *(Movido para V8)*
*   ğŸ“… PresenÃ§a (cursor realtime)
*   ğŸ“… EdiÃ§Ã£o simultÃ¢nea (Yjs/CRDT)

### **US-17: Performance e QA**
*   âœ… Testes E2E (Playwright) e UnitÃ¡rios (Jest) > 89% Coverage
*   âœ… Monitoramento Sentry configurado
*   âœ… OtimizaÃ§Ã£o de performance (Lighthouse scores)

---

## 8. ğŸš€ **ROADMAP V8 (Novas Funcionalidades)**

Estas funcionalidades estÃ£o planejadas para a prÃ³xima fase de evoluÃ§Ã£o do produto.

### **EPIC: ImersÃ£o e Interatividade (V8.1)**
*   [ ] **Avatares 3D Hiper-realistas**: IntegraÃ§Ã£o nativa com modelos ReadyPlayerMe ou HeyGen API.
*   [ ] **Lip-Sync Neural**: Sincronia labial baseada em IA generativa para qualquer idioma.
*   [ ] **Gestos AutomÃ¡ticos**: AnimaÃ§Ã£o de mÃ£os e corpo baseada na anÃ¡lise do texto (sentiment analysis).

### **EPIC: Ecossistema Mobile e LMS (V8.2)**
*   [ ] **App Mobile (React Native)**: VisualizaÃ§Ã£o de vÃ­deos, aprovaÃ§Ã£o de projetos e dashboard.
*   [ ] **ExportaÃ§Ã£o SCORM/xAPI**: Pacotes compatÃ­veis com Moodle, Cornerstone e outros LMS.
*   [ ] **Quiz Interativo no VÃ­deo**: Parada automÃ¡tica para perguntas durante a reproduÃ§Ã£o.

### **EPIC: ColaboraÃ§Ã£o Enterprise (V8.3)**
*   [ ] **EdiÃ§Ã£o Multiplayer**: VÃ¡rios usuÃ¡rios editando o mesmo slide simultaneamente.
*   [ ] **ComentÃ¡rios e AprovaÃ§Ãµes**: Fluxo de revisÃ£o tipo Frame.io dentro do editor.
*   [ ] **White-label**: PersonalizaÃ§Ã£o da interface para grandes clientes corporativos.

---

## 9. ğŸ“… **Plano de ImplementaÃ§Ã£o Detalhado (V8)**

Baseado na pesquisa de mercado e dores dos clientes, a implementaÃ§Ã£o da V8 serÃ¡ dividida em 3 fases estratÃ©gicas para maximizar valor imediato.

### **Fase 1: Performance e Acessibilidade (MÃªs 1-2)**
**Foco:** Resolver a barreira de hardware e facilitar o acesso.

*   **1.1 Cloud Rendering HÃ­brido**
    *   *O que:* UsuÃ¡rio edita "proxies" leves no navegador; servidor GPU renderiza o 4K.
    *   *Impacto:* Permite ediÃ§Ã£o 4K em notebooks i5/8GB (padrÃ£o BR).
*   **1.2 Timeline MagnÃ©tica Inteligente**
    *   *O que:* Auto-ajuste de clipes ao deletar/mover (sem "buracos" na timeline).
    *   *Impacto:* Reduz curva de aprendizado para RH/Marketing.
*   **1.3 Legendas AutomÃ¡ticas (KaraokÃª)**
    *   *O que:* TranscriÃ§Ã£o automÃ¡tica PT-BR com animaÃ§Ã£o palavra-por-palavra.
    *   *Impacto:* Aumenta retenÃ§Ã£o em mobile/social media.

### **Fase 2: AutomaÃ§Ã£o de ConteÃºdo (MÃªs 3-4)**
**Foco:** Escala de produÃ§Ã£o e "reciclagem" de ativos.

*   **2.1 "Corte MÃ¡gico" (Silence Removal)**
    *   *O que:* Detecta e remove silÃªncios/respiraÃ§Ãµes em videoaulas automaticamente.
    *   *Impacto:* Reduz tempo de ediÃ§Ã£o de brutos em 80%.
*   **2.2 Importador de Legado (PDF/PPT Antigo)**
    *   *O que:* Converte PDFs estÃ¡ticos em vÃ­deo com narraÃ§Ã£o IA.
    *   *Impacto:* Moderniza biblioteca de treinamento legada instantaneamente.
*   **2.3 PersonalizaÃ§Ã£o em Massa (Variable Data)**
    *   *O que:* Gera 100 variaÃ§Ãµes de vÃ­deo via CSV (ex: "OlÃ¡ [Nome] da filial [Cidade]").
    *   *Impacto:* HumanizaÃ§Ã£o em escala para grandes empresas.

### **Fase 3: ColaboraÃ§Ã£o e DistribuiÃ§Ã£o (MÃªs 5-6)**
**Foco:** Fluxo de aprovaÃ§Ã£o e integraÃ§Ã£o corporativa.

*   **3.1 AprovaÃ§Ã£o "Zap-Friendly"**
    *   *O que:* Link temporÃ¡rio leve para aprovaÃ§Ã£o via WhatsApp.
    *   *Impacto:* Agiliza feedback com gestores que nÃ£o usam PC.
*   **3.2 Quiz Interativo Integrado**
    *   *O que:* Pausa o vÃ­deo para perguntas obrigatÃ³rias.
    *   *Impacto:* Garante e comprova o aprendizado (Compliance).
*   **3.3 ExportaÃ§Ã£o LMS (SCORM 1.2/2004)**
    *   *O que:* Empacota vÃ­deo + quiz para Moodle/Cornerstone.
    *   *Impacto:* IntegraÃ§Ã£o nativa com ecossistema de T&D.

---

**Nota:** Este documento Ã© vivo e deve ser atualizado a cada sprint. Para detalhes tÃ©cnicos da implementaÃ§Ã£o atual, consulte `STATUS_FINAL_100_COMPLETO.md` e `PRD_ESTUDIO_IA_VIDEOS_2025.md`.

---

## 10. ğŸ› ï¸ **EspecificaÃ§Ã£o TÃ©cnica: OtimizaÃ§Ã£o de Fluxo e Continuidade (Smart Flow)**

Esta especificaÃ§Ã£o detalha melhorias focadas em **ritmo** e **continuidade visual**, visando resolver a dor de "Falta de Expertise" e elevar a qualidade final dos vÃ­deos automaticamente.

### **10.1 FunÃ§Ãµes de Ajuste AutomÃ¡tico de Ritmo (Auto-Pacing)**
*   **DetecÃ§Ã£o de Batidas (Beat Detection):**
    *   *Algoritmo:* AnÃ¡lise de espectro (spectral flux) para identificar BPM e onsets (picos de energia) com *peak picking* robusto.
    *   *AÃ§Ã£o:* Gera marcadores magnÃ©ticos na timeline ("Snap-to-Beat") e sugere pontos de corte naturais.
*   **SuavizaÃ§Ã£o de TransiÃ§Ãµes (Smart Crossfade):**
    *   *LÃ³gica:* Aplica *J-cuts* ou *L-cuts* automaticamente (Ã¡udio antecipa/estende sobre o vÃ­deo) considerando conteÃºdo visual e temporal.
    *   *Tech:* FFmpeg `acrossfade/afade` com parÃ¢metros adaptativos.
*   **Velocidade VariÃ¡vel (Time Remapping):**
    *   *Slow Motion:* 0.25x a 0.75x com *minterpolate* (motionâ€‘compensated) para suavidade.
    *   *Timeâ€‘lapse:* 2x a 10x via `setpts` com amostragem inteligente.
    *   *Curvas:* Curvas BÃ©zier para aceleraÃ§Ã£o/desaceleraÃ§Ã£o personalizadas.

### **10.2 Melhorias na Continuidade Visual**
*   **CorreÃ§Ã£o de Cor AutomÃ¡tica (Color Match):**
    *   *AnÃ¡lise:* BalanÃ§o de brancos, exposiÃ§Ã£o, tons de pele e histograma geral.
    *   *AplicaÃ§Ã£o:* Ajustes via `eq/colorbalance/lut3d`; preserva tons de pele com mÃ¡scara suave.
*   **TransiÃ§Ãµes Inteligentes:**
    *   *Base:* Reconhecimento de objetos em movimento, correspondÃªncia de planos de fundo e fluxo Ã³ptico entre cenas.
    *   *SugestÃ£o:* Escolha de transiÃ§Ã£o (cut/fade/wipe) conforme direÃ§Ã£o/velocidade do movimento e continuidade.
*   **Alinhamento Espacial (Auto-Reframing):**
    *   *ParÃ¢metros:* Perspectiva da cÃ¢mera, posicionamento de objetos principais e linhas de horizonte.
    *   *IA/HeurÃ­stica:* DetecÃ§Ã£o de sujeito e horizonte; fallback por regras geomÃ©tricas.

### **10.3 Interface de UsuÃ¡rio Aprimorada**
*   **Timeline de Ritmo:** VisualizaÃ§Ã£o grÃ¡fica de intensidade; overlay de batidas detectadas; marcadores de pontos de corte sugeridos.
*   **Controles Profissionais:** Ajuste milimÃ©trico de sincronizaÃ§Ã£o AV, fineâ€‘tuning de transiÃ§Ãµes, balanceamento de continuidade visual.
*   **Preview Realtime:** RenderizaÃ§Ã£o acelerada por GPU; modo comparaÃ§Ã£o antes/depois; baixa latÃªncia com prefetch.

### **10.4 Requisitos TÃ©cnicos**
*   **Compatibilidade:** Formatos MP4/MOV/AVI/MKV; codecs H.264/H.265/ProRes/DNxHD; resoluÃ§Ãµes atÃ© 8K.
*   **Performance:** Suporte a timelines com 100+ faixas, efeitos em tempo real e projetos > 4 horas.
*   **Robustez:** HistÃ³rico 100+ aÃ§Ãµes com Undo/Redo, salvamento automÃ¡tico de versÃµes e recuperaÃ§Ã£o de sessÃµes.

### **10.5 Plano de Testes ObrigatÃ³rios**
| CenÃ¡rio | Teste | CritÃ©rio de Aceite |
| :--- | :--- | :--- |
| **Estilos Variados** | Entrevistas, videoclipes musicais, documentÃ¡rios, vlogs. | Batidas/cortes sugeridos precisos; transiÃ§Ãµes naturais; continuidade preservada. |
| **Multitrack Complexo** | 5+ faixas de vÃ­deo simultÃ¢neas; 8+ faixas de Ã¡udio; efeitos aninhados. | Playback sem drop frames; UI responsiva; operaÃ§Ãµes fluÃ­das. |
| **ExportaÃ§Ã£o Completa** | Todos formatos (MP4/MOV/AVI/MKV) e codecs; bitrate variÃ¡vel; metadados; legendas; capas. | Arquivos vÃ¡lidos; sync perfeito; sem artefatos; metadados e legendas embutidos. |

### **10.6 Compatibilidade e ExportaÃ§Ã£o**
*   **Bitrate VariÃ¡vel:** Presets por perfil (qualidade/arquivo) com validaÃ§Ã£o por conteÃºdo.
*   **Metadados Personalizados:** TÃ­tulo, autor, descriÃ§Ã£o, palavrasâ€‘chave; carimbo de versÃ£o.
*   **Legendas Embutidas:** SRT/WEBVTT convertidas e embutidas (`mov_text`/`subtitles`).
*   **Capas Personalizadas:** Imagem anexada ao container suportado (quando aplicÃ¡vel).

### **10.7 Performance Extrema**
*   **VirtualizaÃ§Ã£o:** Lista/timeline virtualizada para 100+ faixas.
*   **Workers Dedicados:** Ãudio/visÃ£o em WebWorkers; priorizaÃ§Ã£o de tarefas; cache incremental.
*   **DegradaÃ§Ã£o Elegante:** Proxies de preview e qualidade adaptativa conforme carga.

### **10.8 HistÃ³rico e RecuperaÃ§Ã£o**
*   **Undo/Redo 100+:** Snapshots incrementais com compressÃ£o de diffs.
*   **Autoâ€‘Save:** VersÃµes automÃ¡ticas por tempo/aÃ§Ã£o; restauraÃ§Ã£o pÃ³sâ€‘falha.
*   **Checkpoints:** Em operaÃ§Ãµes longas (render/analyses) para retomada segura.

### **10.9 Matriz de ValidaÃ§Ã£o**
*   **PrecisÃ£o de Ritmo:** >= 90% de coincidÃªncia de batidas em clipes musicais.
*   **Continuidade Visual:** ReduÃ§Ã£o de discrepÃ¢ncias de cor em > 80% dos pares de clipes.
*   **Desempenho:** Playback fluido em projetos > 4h com 100+ faixas; latÃªncia de preview baixa.

### **10.10 Ritmo ContÃ­nuo (Continuous Flow)**
*   **Objetivo:** Manter o impulso narrativo e musical ao longo da ediÃ§Ã£o, alinhando cortes, transiÃ§Ãµes e dinÃ¢mica de velocidade ao BPM e ao conteÃºdo.
*   **Grade de Batidas:** Calcular BPM e onsets por faixa de Ã¡udio, gerar grade dinÃ¢mica de batidas com tolerÃ¢ncia configurÃ¡vel (ms) e marcadores magnÃ©ticos.
*   **Snapping de Cortes:** Bordas de clipes se alinham ao beat mais prÃ³ximo; exceÃ§Ãµes para fala sÃ£o priorizadas no fim de frase (detecÃ§Ã£o de pausas/energia vocal).
*   **Crossfade Adaptativo:** DuraÃ§Ã£o das transiÃ§Ãµes de Ã¡udio entre 0.25Ã— e 0.5Ã— do perÃ­odo da batida (ajuste automÃ¡tico por BPM).
*   **Sidechain de MÃºsica:** CompressÃ£o sutil do fundo musical em transiÃ§Ãµes com fala para preservar inteligibilidade (`sidechaincompress`).
*   **Velocidade ContÃ­nua:** Curvas BÃ©zier garantem aceleraÃ§Ã£o/desaceleraÃ§Ã£o suaves; slow motion com `minterpolate` e timeâ€‘lapse com `setpts` evitam artefatos.
*   **Continuidade de Movimento:** Preferir transiÃ§Ãµes que respeitam direÃ§Ã£o/velocidade do objeto (via fluxo Ã³ptico); microâ€‘ajustes de pan/zoom para continuidade visual.
*   **UI de Modo ContÃ­nuo:** Toggle "Ritmo ContÃ­nuo" com slider de estrita aderÃªncia ao BPM; indicadores visuais de conformidade de cortes e transiÃ§Ãµes.

**Exemplos de Pipeline (FFmpeg):**
*   `acrossfade=duration=0.25*beat_period,afade=t=in:st=0:d=0.05`
*   `minterpolate=fps=60:mi_mode=mci` + `setpts=PTS/0.5` (timeâ€‘lapse 2Ã—)
*   `sidechaincompress=threshold=0.015:ratio=4` para ducking leve em diÃ¡logo

**CritÃ©rios de Aceite (Ritmo ContÃ­nuo):**
*   Cortes e transiÃ§Ãµes alinhados Ã  grade de batidas sem perda de sincronizaÃ§Ã£o AV.
*   Fala permanece clara durante transiÃ§Ãµes com mÃºsica de fundo.
*   MudanÃ§as de velocidade nÃ£o introduzem tremores ou ghosting perceptÃ­vel.

#### **10.10.1 ConfiguraÃ§Ã£o de Job (JSON)**
```json
{
  "flow": {
    "enabled": true,
    "bpmSource": "auto",
    "bpmManual": null,
    "beatToleranceMs": 25,
    "crossfadeRatio": 0.35,
    "sidechain": { "threshold": 0.015, "ratio": 4 },
    "snapping": "strict",
    "speedCurves": [
      { "clipId": "clip-123", "curve": "bezier", "points": [[0,0],[0.3,0.6],[0.7,0.4],[1,1]] }
    ],
    "opticalFlow": "auto"
  }
}
```

#### **10.10.2 Modelo de Dados da Timeline**
*   **Track/Clip:** Clipes com `in/out`, transiÃ§Ãµes e meta de continuidade.
*   **Markers:** `beat`, `cutSuggestion` com `time` e `confidence`.
*   **Transition:** DuraÃ§Ã£o relativa ao perÃ­odo da batida (`beat_period * crossfadeRatio`).
*   **Indicators:** SinalizaÃ§Ã£o visual de conformidade ao BPM e continuidade de movimento.

#### **10.10.3 PseudocÃ³digo do Detector de Batidas**
```
audio = load_waveform(track)
stft = compute_stft(audio)
flux = spectral_flux(stft)
threshold = adaptive_threshold(flux)
peaks = peak_pick(flux, threshold)
bpm = estimate_bpm(peaks) // autocorrelation
beats = align_to_timeline(peaks, bpm)
return beats
```

#### **10.10.4 InteraÃ§Ãµes de UI/UX**
*   Toggle "Ritmo ContÃ­nuo" e slider de aderÃªncia ao BPM.
*   Overlay de batidas e marcadores de corte sugeridos.
*   Controles de fineâ€‘tuning de transiÃ§Ãµes e sincronizaÃ§Ã£o AV.

#### **10.10.5 Telemetria e Logs**
*   MÃ©tricas: `beat_detection_precision`, `crossfade_alignment_error_ms`, `playback_drop_frames`.
*   Eventos de progresso: SSE/WebSocket com estados da anÃ¡lise e render.
*   Logs estruturados com parÃ¢metros aplicados (BPM, tolerÃ¢ncias, curvas).

#### **10.10.6 Failover e DegradaÃ§Ã£o Elegante**
*   Fallback heurÃ­stico quando visÃ£o/fluxo Ã³ptico indisponÃ­vel.
*   Proxies de preview sob carga para manter baixa latÃªncia.
*   Desabilitar sidechain em containers sem suporte; preservar integridade de export.

#### **10.10.7 Presets e ParÃ¢metros Efetivos**
| ParÃ¢metro | Valor padrÃ£o | Faixa | ObservaÃ§Ãµes |
| :--- | :---: | :---: | :--- |
| `beatToleranceMs` | 25 | 10â€“50 | Ajusta snapping; maior tolerÃ¢ncia reduz estrita aderÃªncia. |
| `crossfadeRatio` | 0.35 | 0.25â€“0.5 | ProporÃ§Ã£o do perÃ­odo da batida; mÃºsica mais rÃ¡pida pede menor valor. |
| `sidechain.threshold` | 0.015 | 0.01â€“0.03 | Sensibilidade do ducking; ajustar conforme mix. |
| `sidechain.ratio` | 4 | 2â€“6 | Intensidade do ducking; maior ratio reduz mÃºsica mais agressivamente. |
| `minterpolate.fps` | 60 | 48â€“120 | FPS alvo para slow motion suave; custo computacional aumenta com FPS. |
| `timeLapseFactor` | 2 | 2â€“10 | Multiplicador de velocidade para timeâ€‘lapse; usar amostragem inteligente. |

#### **10.10.8 IntegraÃ§Ã£o com Worker (FFmpeg/BullMQ)**
*   Mapear `flow` do job JSON para filtros FFmpeg e sequenciamento.
*   Validar codec/container e suportes (H.264/H.265/ProRes/DNxHD; MP4/MOV/AVI/MKV).
*   Ajustar ordem dos filtros: anÃ¡lise â†’ transiÃ§Ãµes â†’ velocidade â†’ cor â†’ legendas â†’ metadados â†’ capa.
*   Em casos 8K ou 100+ faixas, habilitar presets de desempenho e proxies.

#### **10.10.9 Monitoramento e QA ContÃ­nuo**
*   Thresholds: `beat_detection_precision >= 0.9`, `alignment_error_ms <= 30`, `drop_frames == 0` em preview padrÃ£o.
*   RelatÃ³rios: logs por job com parÃ¢metros aplicados e mÃ©tricas agregadas por projeto.
*   Alarmes: latÃªncia de preview alta, instabilidade de FPS, falhas de encode em presets especÃ­ficos.

#### **10.10.10 CenÃ¡rios de ValidaÃ§Ã£o Exemplares**
*   **Videoclipe Musical:** Cortes em batidas, transiÃ§Ãµes curtas, sidechain desabilitado. Esperado: alto dinamismo sem perda de sync.
*   **Entrevista:** Snapping flexÃ­vel priorizando fim de frase; crossfade suave; sidechain ativo. Esperado: fala inteligÃ­vel com mÃºsica discreta.
*   **DocumentÃ¡rio:** TransiÃ§Ãµes contextâ€‘aware por movimento de cena; color match consistente. Esperado: continuidade e narrativa fluida.
*   **Vlog:** Timeâ€‘lapse em trechos de deslocamento; slow motion em destaques. Esperado: ritmo variado e engajamento visual.

#### **10.10.11 Riscos e MitigaÃ§Ãµes EspecÃ­ficos**
*   **Custo de Optical Flow:** Usar presets e permitir desativaÃ§Ã£o em 8K.
*   **Codecs/Containers Limitados:** Tabelas de compatibilidade e fallback automÃ¡tico.
*   **Carga de Multitrack Pesada:** VirtualizaÃ§Ã£o, workers dedicados e cache incremental.

---

## 11. ğŸ“ **EspecificaÃ§Ãµes Detalhadas V8 (Funcionalidades-Chave)**

### 11.1 Cloud Rendering HÃ­brido
- EspecificaÃ§Ã£o: ediÃ§Ã£o com proxies leves no navegador; renderizaÃ§Ã£o final 1080p/4K/8K em servidor GPU.
- Comportamento esperado:
  - Cliente gera/consome proxies (`720p`, bitrate reduzido); tarefas de render sobem como `job JSON`.
  - Progresso via `SSE/WebSocket` com estados: `queued`, `analyzing`, `rendering`, `uploading`, `completed`, `failed`.
- Diretrizes tÃ©cnicas:
  - Worker `FFmpeg` orquestrado por `BullMQ` e `Redis`.
  - Storage: `Supabase Storage` ou `S3` para assets, proxies e finais.
  - Job schema mÃ­nimo:
    ```json
    {
      "id":"job-uuid",
      "projectId":"proj-123",
      "preset":"1080p",
      "timeline":"/projects/proj-123/timeline.json",
      "flow": { "enabled": true },
      "outputs": [{"format":"mp4","codec":"h264","bitrate":"8M"}]
    }
    ```
- DependÃªncias/IntegraÃ§Ãµes: `FFmpeg`, `BullMQ`, `Redis`, `Supabase/S3`, `SSE/WebSocket`, `CUDA/NVENC` quando disponÃ­vel.
- Erros/Edge cases: desconexÃ£o de cliente; falta de GPU; codecs nÃ£o suportados; reprocesso com fallback `x264`.
- Testes:
  - Unit: mapeamento de `timeline.json` â†’ filtros FFmpeg; recuperaÃ§Ã£o de estados de fila.
  - IntegraÃ§Ã£o: worker + storage + SSE; tolerÃ¢ncia a quedas de rede; reintentos configurÃ¡veis.

### 11.2 Timeline MagnÃ©tica Inteligente
- EspecificaÃ§Ã£o: auto-ripple, fechamento de gaps e snapping inteligente a batidas/pausas de fala.
- Comportamento esperado:
  - Ao deletar/mover clipes, a timeline se recompacta sem buracos (respeitando locks).
  - Snapping a `markers: beat | cutSuggestion | speechPause` com tolerÃ¢ncia configurÃ¡vel.
- Diretrizes tÃ©cnicas:
  - Modelo: `Track/Clip` com `in/out`, `locked`, `transition`, `markers`.
  - Algoritmo ripple: varrer trilha respeitando `locked` e transiÃ§Ãµes; impedir sobreposiÃ§Ã£o ilegal.
- DependÃªncias: `Zustand`/store atual, eventos de UI; integraÃ§Ã£o com detectores de batida (SeÃ§Ã£o 10).
- Erros/Edge cases: transiÃ§Ãµes longas; clipes linkados AV; trilhas com prioridade; locks hierÃ¡rquicos.
- Testes:
  - Unit: funÃ§Ã£o de snapping com tolerÃ¢ncias; ripple sob estados variados.
  - IntegraÃ§Ã£o: operaÃ§Ãµes de drag/drop + preview consistente; sem perda de sync.

### 11.3 Legendas AutomÃ¡ticas (KaraokÃª)
- EspecificaÃ§Ã£o: transcriÃ§Ã£o PT-BR com marcaÃ§Ã£o palavraâ€‘porâ€‘palavra; destaque sincronizado no player.
- Comportamento esperado: geraÃ§Ã£o de `SRT/WEBVTT` + `word-timings.json`; overlay com animaÃ§Ã£o de preenchimento.
- Diretrizes tÃ©cnicas:
  - ASR: `Azure Speech` ou `Whisper` (server-side) com normalizaÃ§Ã£o de texto.
  - Alinhamento: `CTC forced alignment` ou heurÃ­stica de distribuiÃ§Ã£o por sÃ­labas.
  - Export: embutir legendas (`mov_text`) quando aplicÃ¡vel.
- DependÃªncias: `Azure Cognitive Services` ou modelo local; `FFmpeg` para mux; player com overlay.
- Erros/Edge cases: ruÃ­do alto; cÃ³digoâ€‘switching; nomes prÃ³prios; latÃªncia; fallback a frase por frase.
- Testes:
  - Unit: parser SRT/VTT; gerador de word timings; sincronizaÃ§Ã£o de highlight.
  - IntegraÃ§Ã£o: ASR â†’ overlay â†’ export; precisÃ£o mÃ­nima documentada.

### 11.4 "Corte MÃ¡gico" (Silence Removal)
- EspecificaÃ§Ã£o: detecÃ§Ã£o de silÃªncios/respiraÃ§Ãµes e remoÃ§Ã£o com crossfades sutis.
- Comportamento esperado: reduÃ§Ã£o automÃ¡tica de trechos sem fala; preserva ritmo por batidas (quando mÃºsica presente).
- Diretrizes tÃ©cnicas:
  - VAD: `webrtcvad`/`silencedetect` (FFmpeg) com thresholds adaptativos.
  - TransiÃ§Ãµes: `afade/acrossfade` conforme `beat_period` (ver 10.10).
- DependÃªncias: `FFmpeg`, VAD lib; integraÃ§Ã£o com `Smart Flow`.
- Erros/Edge cases: fala sussurrada; ruÃ­do constante; cortes em meio Ã  palavra; rollback por usuÃ¡rio.
- Testes:
  - Unit: detecÃ§Ã£o de silÃªncio; cÃ¡lculo de janelas; aplicaÃ§Ã£o de fades.
  - IntegraÃ§Ã£o: pipeline completo com mÃºsica de fundo; validaÃ§Ã£o auditiva objetiva/subjectiva.

### 11.5 Importador de Legado (PDF/PPT â†’ VÃ­deo)
- EspecificaÃ§Ã£o: converter PDFs/PPTs em cenas com narraÃ§Ã£o IA e transiÃ§Ãµes bÃ¡sicas.
- Comportamento esperado: extraÃ§Ã£o de tÃ­tulos/corpo/imagens; mapeamento para `timeline.json` com estilos.
- Diretrizes tÃ©cnicas:
  - Parser: reutilizar parsers de PPTX (V7) + OCR quando necessÃ¡rio.
  - TTS: `Azure/Edge TTS` com vozes PTâ€‘BR; cache automÃ¡tico.
- DependÃªncias: `Supabase Storage` para assets; `Azure TTS`; `OCR` opcional.
- Erros/Edge cases: fontes incomuns; slides com fundo imagem; tabelas complexas; pÃ¡ginas longas â†’ dividir.
- Testes:
  - Unit: parse de layouts; normalizaÃ§Ã£o de texto.
  - IntegraÃ§Ã£o: import â†’ timeline â†’ preview â†’ export; consistÃªncia visual.

### 11.6 PersonalizaÃ§Ã£o em Massa (Variable Data)
- EspecificaÃ§Ã£o: gerar N variaÃ§Ãµes via `CSV` com placeholders em texto/voz/imagens.
- Comportamento esperado: substituiÃ§Ã£o de `[Nome]`, `[Cidade]` etc.; render em lote com fila e rateâ€‘limit.
- Diretrizes tÃ©cnicas:
  - Template: definir `placeholders` no projeto; injeÃ§Ã£o segura de dados; validaÃ§Ã£o de schema.
  - Render: lote com `BullMQ`; isolaÃ§Ã£o de estado por variaÃ§Ã£o.
- DependÃªncias: `CSV parser`, `BullMQ`, `Redis`, `TTS` quando necessÃ¡rio.
- Erros/Edge cases: campos faltantes; caracteres especiais; nomes muito longos; colisÃ£o de assets.
- Testes:
  - Unit: mapeamento de placeholders; sanitizaÃ§Ã£o.
  - IntegraÃ§Ã£o: lote endâ€‘toâ€‘end; mÃ©tricas de throughput/erros.

---

## 12. âœ… **PadrÃµes de Qualidade e Compatibilidade (V8)**
- Backward compatibility:
  - Todos os recursos V8 sÃ£o optâ€‘in por `feature flags` em `project.json`.
  - Preservar exportaÃ§Ã£o e preview existentes quando `flags` desativados.
- Estilo e consistÃªncia:
  - Manter padrÃµes de estado com `Zustand`; nomenclatura de `Track/Clip/Marker` conforme V7.
  - Tipos fortes em `timeline.json` e schemas validados.
- SeguranÃ§a:
  - SanitizaÃ§Ã£o de inputs (CSV/ASR/Uploads); quotas e rateâ€‘limits; isolamento de jobs.
- Observabilidade:
  - Logs estruturados por job; mÃ©tricas (latÃªncia, erros, drop frames); traÃ§os por render.
- ResiliÃªncia:
  - Reintentos exponenciais; checkpoints em operaÃ§Ãµes longas; fallback de codecs.

---

## 13. ğŸ§ª **Plano de Testes Expandido (Unit/Integration)**
- Unit Tests por funcionalidade:
  - Cloud Rendering: mapeamento de presets, ordem de filtros, estados de fila.
  - Timeline MagnÃ©tica: snapping e ripple com tolerÃ¢ncias e locks.
  - Legendas KaraokÃª: parsing SRT/VTT e sincronizaÃ§Ã£o de palavra.
  - Corte MÃ¡gico: detecÃ§Ã£o e fades; preservaÃ§Ã£o de ritmo.
  - Importador Legado: extraÃ§Ã£o e normalizaÃ§Ã£o de estruturas.
  - PersonalizaÃ§Ã£o em Massa: placeholders e sanitizaÃ§Ã£o.
- Integration Tests:
  - Worker + Storage + SSE com falhas simuladas (rede, GPU indisponÃ­vel).
  - Editor â†’ Timeline â†’ Preview â†’ Render â†’ Upload.
  - Batch render com CSV (10, 100, 500 variaÃ§Ãµes) medindo throughput.
- DocumentaÃ§Ã£o de casos e resultados esperados:
  - Tabelas por cenÃ¡rio com critÃ©rios de aceite claros (precisÃ£o, latÃªncia, consistÃªncia visual/AV).

---

## 14. âš™ï¸ **Benchmarks e Metas de Performance**
- Cloud Rendering:
  - `1080p` render NVENC: 1.2Ã— tempo real mÃ©dio; fallback `x264`: 2.0Ã—.
  - LatÃªncia de fila `< 5s` sob carga mÃ©dia; upload final `< 8s` para arquivos â‰¤ 500MB.
- Timeline/Preview:
  - Preview sem drop frames em 60 FPS atÃ© 20 faixas; virtualizaÃ§Ã£o > 100 faixas (ver 10.7).
- Legendas/KaraokÃª:
  - ASR PTâ€‘BR WER â‰¤ 12% em Ã¡udio limpo; alinhamento palavra com erro â‰¤ 80ms.
- Corte MÃ¡gico:
  - ReduÃ§Ã£o â‰¥ 70% de trechos silenciosos sem artefatos audÃ­veis.
- Lote/CSV:
  - Throughput: 30 renders/h por nÃ³ GPU (1080p), erros â‰¤ 2% com reintentos.

---

## 15. ğŸ“¦ **EntregÃ¡veis e Versionamento**
- ImplementaÃ§Ã£o documental:
  - EspecificaÃ§Ãµes completas por funcionalidade (SeÃ§Ã£o 11).
  - Diretrizes tÃ©cnicas, dependÃªncias e edge cases.
  - Plano de testes e benchmarks (SeÃ§Ãµes 13â€“14).
- Test suite:
  - CatalogaÃ§Ã£o de casos unitÃ¡rios e de integraÃ§Ã£o; critÃ©rios de aceite anexos.
- DocumentaÃ§Ã£o:
  - AtualizaÃ§Ã£o do `Ãndice`, referÃªncias cruzadas e schemas de job/timeline.
- Commit sugerido:
  - `docs(v8): especificaÃ§Ãµes detalhadas + testes + benchmarks para Cloud Rendering, Timeline MagnÃ©tica, KaraokÃª, Corte MÃ¡gico, Importador Legado e PersonalizaÃ§Ã£o em Massa`
